!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.cesiumTdt=t():e.cesiumTdt=t()}(window,(function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(r,o,function(t){return e[t]}.bind(null,o));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=233)}([function(e,t,i){e.exports=i(165)},function(e,t,i){e.exports=i(162)},function(e,t,i){var r=i(168),o=i(176);function n(t){return e.exports=n="function"==typeof o&&"symbol"==typeof r?function(e){return typeof e}:function(e){return e&&"function"==typeof o&&e.constructor===o&&e!==o.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t){var i=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=i)},function(e,t,i){e.exports=i(153)},function(e,t,i){var r=i(63)("wks"),o=i(37),n=i(10).Symbol,s="function"==typeof n;(e.exports=function(e){return r[e]||(r[e]=s&&n[e]||(s?n:o)("Symbol."+e))}).store=r},function(e,t){var i=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(e,t,i){e.exports=i(147)},function(e,t,i){var r=i(6),o=i(3),n=i(53),s=i(29),a=i(28),l=function(e,t,i){var u,h,c,g=e&l.F,p=e&l.G,f=e&l.S,d=e&l.P,m=e&l.B,C=e&l.W,y=p?o:o[t]||(o[t]={}),v=y.prototype,A=p?r:f?r[t]:(r[t]||{}).prototype;for(u in p&&(i=t),i)(h=!g&&A&&void 0!==A[u])&&a(y,u)||(c=h?A[u]:i[u],y[u]=p&&"function"!=typeof A[u]?i[u]:m&&h?n(c,r):C&&A[u]==c?function(e){var t=function(t,i,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,i)}return new e(t,i,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(c):d&&"function"==typeof c?n(Function.call,c):c,d&&((y.virtual||(y.virtual={}))[u]=c,e&l.R&&v&&!v[u]&&s(v,u,c)))};l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,e.exports=l},function(e,t,i){e.exports=i(160)},function(e,t){var i=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(e,t,i){e.exports=!i(16)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,i){var r=i(71)("wks"),o=i(52),n=i(6).Symbol,s="function"==typeof n;(e.exports=function(e){return r[e]||(r[e]=s&&n[e]||(s?n:o)("Symbol."+e))}).store=r},function(e,t,i){e.exports=i(157)},function(e,t,i){var r=i(27),o=Math.min;e.exports=function(e){return e>0?o(r(e),9007199254740991):0}},function(e,t,i){var r=i(21);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,i){var r=i(18),o=i(46);e.exports=i(11)?function(e,t,i){return r.f(e,t,o(1,i))}:function(e,t,i){return e[t]=i,e}},function(e,t,i){var r=i(15),o=i(93),n=i(45),s=Object.defineProperty;t.f=i(11)?Object.defineProperty:function(e,t,i){if(r(e),t=n(t,!0),r(i),o)try{return s(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},function(e,t,i){var r=i(10),o=i(17),n=i(26),s=i(37)("src"),a=i(143),l=(""+a).split("toString");i(43).inspectSource=function(e){return a.call(e)},(e.exports=function(e,t,i,a){var u="function"==typeof i;u&&(n(i,"name")||o(i,"name",t)),e[t]!==i&&(u&&(n(i,s)||o(i,s,e[t]?""+e[t]:l.join(String(t)))),e===r?e[t]=i:a?e[t]?e[t]=i:o(e,t,i):(delete e[t],o(e,t,i)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[s]||a.call(this)}))},function(e,t,i){e.exports=!i(35)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,i){var r=i(10),o=i(43),n=i(17),s=i(19),a=i(48),l=function(e,t,i){var u,h,c,g,p=e&l.F,f=e&l.G,d=e&l.S,m=e&l.P,C=e&l.B,y=f?r:d?r[t]||(r[t]={}):(r[t]||{}).prototype,v=f?o:o[t]||(o[t]={}),A=v.prototype||(v.prototype={});for(u in f&&(i=t),i)c=((h=!p&&y&&void 0!==y[u])?y:i)[u],g=C&&h?a(c,r):m&&"function"==typeof c?a(Function.call,c):c,y&&s(y,u,c,e&l.U),v[u]!=c&&n(v,u,g),m&&A[u]!=c&&(A[u]=c)};r.core=o,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,e.exports=l},function(e,t,i){var r=i(24),o=i(103),n=i(74),s=Object.defineProperty;t.f=i(20)?Object.defineProperty:function(e,t,i){if(r(e),t=n(t,!0),r(i),o)try{return s(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},function(e,t,i){var r=i(30);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var i={}.hasOwnProperty;e.exports=function(e,t){return i.call(e,t)}},function(e,t){var i=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:i)(e)}},function(e,t){var i={}.hasOwnProperty;e.exports=function(e,t){return i.call(e,t)}},function(e,t,i){var r=i(23),o=i(55);e.exports=i(20)?function(e,t,i){return r.f(e,t,o(1,i))}:function(e,t,i){return e[t]=i,e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,i){e.exports=i(139)},function(e,t){e.exports={}},function(e,t,i){var r=i(25);e.exports=function(e){return Object(r(e))}},function(e,t,i){var r=i(149),o=i(50);e.exports=function(e){return r(o(e))}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,i){"use strict";var r=i(140),o=i(141),n=i(32),s=i(47);e.exports=i(142)(Array,"Array",(function(e,t){this._t=s(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,i=this._i++;return!e||i>=e.length?(this._t=void 0,o(1)):o(0,"keys"==t?i:"values"==t?e[i]:[i,e[i]])}),"values"),n.Arguments=n.Array,r("keys"),r("values"),r("entries")},function(e,t){var i=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++i+r).toString(36))}},function(e,t){var i={}.toString;e.exports=function(e){return i.call(e).slice(8,-1)}},function(e,t){var i={}.toString;e.exports=function(e){return i.call(e).slice(8,-1)}},function(e,t){e.exports=!0},function(e,t){e.exports={}},function(e,t,i){"use strict";if(i(11)){var r=i(44),o=i(10),n=i(16),s=i(22),a=i(119),l=i(188),u=i(48),h=i(121),c=i(46),g=i(17),p=i(120),f=i(27),d=i(14),m=i(122),C=i(49),y=i(45),v=i(26),A=i(57),_=i(21),I=i(33),b=i(189),w=i(64),G=i(100),E=i(61).f,S=i(190),P=i(37),T=i(5),x=i(191),N=i(99),L=i(104),M=i(36),R=i(32),O=i(195),F=i(124),D=i(123),k=i(196),U=i(18),B=i(88),W=U.f,V=B.f,j=o.RangeError,H=o.TypeError,z=o.Uint8Array,q=Array.prototype,X=l.ArrayBuffer,Y=l.DataView,K=x(0),Q=x(2),Z=x(3),J=x(4),$=x(5),ee=x(6),te=N(!0),ie=N(!1),re=M.values,oe=M.keys,ne=M.entries,se=q.lastIndexOf,ae=q.reduce,le=q.reduceRight,ue=q.join,he=q.sort,ce=q.slice,ge=q.toString,pe=q.toLocaleString,fe=T("iterator"),de=T("toStringTag"),me=P("typed_constructor"),Ce=P("def_constructor"),ye=a.CONSTR,ve=a.TYPED,Ae=a.VIEW,_e=x(1,(function(e,t){return Ee(L(e,e[Ce]),t)})),Ie=n((function(){return 1===new z(new Uint16Array([1]).buffer)[0]})),be=!!z&&!!z.prototype.set&&n((function(){new z(1).set({})})),we=function(e,t){var i=f(e);if(i<0||i%t)throw j("Wrong offset!");return i},Ge=function(e){if(_(e)&&ve in e)return e;throw H(e+" is not a typed array!")},Ee=function(e,t){if(!_(e)||!(me in e))throw H("It is not a typed array constructor!");return new e(t)},Se=function(e,t){return Pe(L(e,e[Ce]),t)},Pe=function(e,t){for(var i=0,r=t.length,o=Ee(e,r);r>i;)o[i]=t[i++];return o},Te=function(e,t,i){W(e,t,{get:function(){return this._d[i]}})},xe=function(e){var t,i,r,o,n,s,a=I(e),l=arguments.length,h=l>1?arguments[1]:void 0,c=void 0!==h,g=S(a);if(null!=g&&!b(g)){for(s=g.call(a),r=[],t=0;!(n=s.next()).done;t++)r.push(n.value);a=r}for(c&&l>2&&(h=u(h,arguments[2],2)),t=0,i=d(a.length),o=Ee(this,i);i>t;t++)o[t]=c?h(a[t],t):a[t];return o},Ne=function(){for(var e=0,t=arguments.length,i=Ee(this,t);t>e;)i[e]=arguments[e++];return i},Le=!!z&&n((function(){pe.call(new z(1))})),Me=function(){return pe.apply(Le?ce.call(Ge(this)):Ge(this),arguments)},Re={copyWithin:function(e,t){return k.call(Ge(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return J(Ge(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return D.apply(Ge(this),arguments)},filter:function(e){return Se(this,Q(Ge(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return $(Ge(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return ee(Ge(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){K(Ge(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return ie(Ge(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return te(Ge(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return ue.apply(Ge(this),arguments)},lastIndexOf:function(e){return se.apply(Ge(this),arguments)},map:function(e){return _e(Ge(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return ae.apply(Ge(this),arguments)},reduceRight:function(e){return le.apply(Ge(this),arguments)},reverse:function(){for(var e,t=Ge(this).length,i=Math.floor(t/2),r=0;r<i;)e=this[r],this[r++]=this[--t],this[t]=e;return this},some:function(e){return Z(Ge(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return he.call(Ge(this),e)},subarray:function(e,t){var i=Ge(this),r=i.length,o=C(e,r);return new(L(i,i[Ce]))(i.buffer,i.byteOffset+o*i.BYTES_PER_ELEMENT,d((void 0===t?r:C(t,r))-o))}},Oe=function(e,t){return Se(this,ce.call(Ge(this),e,t))},Fe=function(e){Ge(this);var t=we(arguments[1],1),i=this.length,r=I(e),o=d(r.length),n=0;if(o+t>i)throw j("Wrong length!");for(;n<o;)this[t+n]=r[n++]},De={entries:function(){return ne.call(Ge(this))},keys:function(){return oe.call(Ge(this))},values:function(){return re.call(Ge(this))}},ke=function(e,t){return _(e)&&e[ve]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Ue=function(e,t){return ke(e,t=y(t,!0))?c(2,e[t]):V(e,t)},Be=function(e,t,i){return!(ke(e,t=y(t,!0))&&_(i)&&v(i,"value"))||v(i,"get")||v(i,"set")||i.configurable||v(i,"writable")&&!i.writable||v(i,"enumerable")&&!i.enumerable?W(e,t,i):(e[t]=i.value,e)};ye||(B.f=Ue,U.f=Be),s(s.S+s.F*!ye,"Object",{getOwnPropertyDescriptor:Ue,defineProperty:Be}),n((function(){ge.call({})}))&&(ge=pe=function(){return ue.call(this)});var We=p({},Re);p(We,De),g(We,fe,De.values),p(We,{slice:Oe,set:Fe,constructor:function(){},toString:ge,toLocaleString:Me}),Te(We,"buffer","b"),Te(We,"byteOffset","o"),Te(We,"byteLength","l"),Te(We,"length","e"),W(We,de,{get:function(){return this[ve]}}),e.exports=function(e,t,i,l){var u=e+((l=!!l)?"Clamped":"")+"Array",c="get"+e,p="set"+e,f=o[u],C=f||{},y=f&&G(f),v=!f||!a.ABV,I={},b=f&&f.prototype,S=function(e,i){W(e,i,{get:function(){return function(e,i){var r=e._d;return r.v[c](i*t+r.o,Ie)}(this,i)},set:function(e){return function(e,i,r){var o=e._d;l&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),o.v[p](i*t+o.o,r,Ie)}(this,i,e)},enumerable:!0})};v?(f=i((function(e,i,r,o){h(e,f,u,"_d");var n,s,a,l,c=0,p=0;if(_(i)){if(!(i instanceof X||"ArrayBuffer"==(l=A(i))||"SharedArrayBuffer"==l))return ve in i?Pe(f,i):xe.call(f,i);n=i,p=we(r,t);var C=i.byteLength;if(void 0===o){if(C%t)throw j("Wrong length!");if((s=C-p)<0)throw j("Wrong length!")}else if((s=d(o)*t)+p>C)throw j("Wrong length!");a=s/t}else a=m(i),n=new X(s=a*t);for(g(e,"_d",{b:n,o:p,l:s,e:a,v:new Y(n)});c<a;)S(e,c++)})),b=f.prototype=w(We),g(b,"constructor",f)):n((function(){f(1)}))&&n((function(){new f(-1)}))&&O((function(e){new f,new f(null),new f(1.5),new f(e)}),!0)||(f=i((function(e,i,r,o){var n;return h(e,f,u),_(i)?i instanceof X||"ArrayBuffer"==(n=A(i))||"SharedArrayBuffer"==n?void 0!==o?new C(i,we(r,t),o):void 0!==r?new C(i,we(r,t)):new C(i):ve in i?Pe(f,i):xe.call(f,i):new C(m(i))})),K(y!==Function.prototype?E(C).concat(E(y)):E(C),(function(e){e in f||g(f,e,C[e])})),f.prototype=b,r||(b.constructor=f));var P=b[fe],T=!!P&&("values"==P.name||null==P.name),x=De.values;g(f,me,!0),g(b,ve,u),g(b,Ae,!0),g(b,Ce,f),(l?new f(1)[de]==u:de in b)||W(b,de,{get:function(){return u}}),I[u]=f,s(s.G+s.W+s.F*(f!=C),I),s(s.S,u,{BYTES_PER_ELEMENT:t}),s(s.S+s.F*n((function(){C.of.call(f,1)})),u,{from:xe,of:Ne}),"BYTES_PER_ELEMENT"in b||g(b,"BYTES_PER_ELEMENT",t),s(s.P,u,Re),F(u),s(s.P+s.F*be,u,{set:Fe}),s(s.P+s.F*!T,u,De),r||b.toString==ge||(b.toString=ge),s(s.P+s.F*n((function(){new f(1).slice()})),u,{slice:Oe}),s(s.P+s.F*(n((function(){return[1,2].toLocaleString()!=new f([1,2]).toLocaleString()}))||!n((function(){b.toLocaleString.call([1,2])}))),u,{toLocaleString:Me}),R[u]=T?P:x,r||T||g(b,fe,x)}}else e.exports=function(){}},function(e,t){var i=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=i)},function(e,t){e.exports=!1},function(e,t,i){var r=i(21);e.exports=function(e,t){if(!r(e))return e;var i,o;if(t&&"function"==typeof(i=e.toString)&&!r(o=i.call(e)))return o;if("function"==typeof(i=e.valueOf)&&!r(o=i.call(e)))return o;if(!t&&"function"==typeof(i=e.toString)&&!r(o=i.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,i){var r=i(95),o=i(25);e.exports=function(e){return r(o(e))}},function(e,t,i){var r=i(96);e.exports=function(e,t,i){if(r(e),void 0===t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,r){return e.call(t,i,r)};case 3:return function(i,r,o){return e.call(t,i,r,o)}}return function(){return e.apply(t,arguments)}}},function(e,t,i){var r=i(27),o=Math.max,n=Math.min;e.exports=function(e,t){return(e=r(e))<0?o(e+t,0):n(e,t)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,i){var r=i(101),o=i(72);e.exports=Object.keys||function(e){return r(e,o)}},function(e,t){var i=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++i+r).toString(36))}},function(e,t,i){var r=i(54);e.exports=function(e,t,i){if(r(e),void 0===t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,r){return e.call(t,i,r)};case 3:return function(i,r,o){return e.call(t,i,r,o)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,i){"use strict";var r=i(57),o=RegExp.prototype.exec;e.exports=function(e,t){var i=e.exec;if("function"==typeof i){var n=i.call(e,t);if("object"!=typeof n)throw new TypeError("RegExp exec method returned something other than an Object or null");return n}if("RegExp"!==r(e))throw new TypeError("RegExp#exec called on incompatible receiver");return o.call(e,t)}},function(e,t,i){var r=i(38),o=i(5)("toStringTag"),n="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,i,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?i:n?r(t):"Object"==(s=r(t))&&"function"==typeof t.callee?"Arguments":s}},function(e,t,i){"use strict";var r=i(15);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,i){"use strict";i(156);var r=i(19),o=i(17),n=i(16),s=i(25),a=i(5),l=i(78),u=a("species"),h=!n((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),c=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var i="ab".split(e);return 2===i.length&&"a"===i[0]&&"b"===i[1]}();e.exports=function(e,t,i){var g=a(e),p=!n((function(){var t={};return t[g]=function(){return 7},7!=""[e](t)})),f=p?!n((function(){var t=!1,i=/a/;return i.exec=function(){return t=!0,null},"split"===e&&(i.constructor={},i.constructor[u]=function(){return i}),i[g](""),!t})):void 0;if(!p||!f||"replace"===e&&!h||"split"===e&&!c){var d=/./[g],m=i(s,g,""[e],(function(e,t,i,r,o){return t.exec===l?p&&!o?{done:!0,value:d.call(t,i,r)}:{done:!0,value:e.call(i,t,r)}:{done:!1}})),C=m[0],y=m[1];r(String.prototype,e,C),o(RegExp.prototype,g,2==t?function(e,t){return y.call(e,this,t)}:function(e){return y.call(e,this)})}}},function(e,t,i){var r=i(23).f,o=i(28),n=i(12)("toStringTag");e.exports=function(e,t,i){e&&!o(e=i?e:e.prototype,n)&&r(e,n,{configurable:!0,value:t})}},function(e,t,i){var r=i(98),o=i(66).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,o)}},function(e,t,i){for(var r=i(36),o=i(97),n=i(19),s=i(10),a=i(17),l=i(32),u=i(5),h=u("iterator"),c=u("toStringTag"),g=l.Array,p={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},f=o(p),d=0;d<f.length;d++){var m,C=f[d],y=p[C],v=s[C],A=v&&v.prototype;if(A&&(A[h]||a(A,h,g),A[c]||a(A,c,C),l[C]=g,y))for(m in r)A[m]||n(A,m,r[m],!0)}},function(e,t,i){var r=i(43),o=i(10),n=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(e.exports=function(e,t){return n[e]||(n[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:i(44)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t,i){var r=i(15),o=i(145),n=i(66),s=i(65)("IE_PROTO"),a=function(){},l=function(){var e,t=i(94)("iframe"),r=n.length;for(t.style.display="none",i(146).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),l=e.F;r--;)delete l.prototype[n[r]];return l()};e.exports=Object.create||function(e,t){var i;return null!==e?(a.prototype=r(e),i=new a,a.prototype=null,i[s]=e):i=l(),void 0===t?i:o(i,t)}},function(e,t,i){var r=i(63)("keys"),o=i(37);e.exports=function(e){return r[e]||(r[e]=o(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,i){var r=i(18).f,o=i(26),n=i(5)("toStringTag");e.exports=function(e,t,i){e&&!o(e=i?e:e.prototype,n)&&r(e,n,{configurable:!0,value:t})}},function(e,t,i){var r=i(50);e.exports=function(e){return Object(r(e))}},function(e,t){var i=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:i)(e)}},function(e,t,i){var r=i(71)("keys"),o=i(52);e.exports=function(e){return r[e]||(r[e]=o(e))}},function(e,t,i){var r=i(3),o=i(6),n=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(e.exports=function(e,t){return n[e]||(n[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:i(40)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,i){var r=i(30),o=i(6).document,n=r(o)&&r(o.createElement);e.exports=function(e){return n?o.createElement(e):{}}},function(e,t,i){var r=i(30);e.exports=function(e,t){if(!r(e))return e;var i,o;if(t&&"function"==typeof(i=e.toString)&&!r(o=i.call(e)))return o;if("function"==typeof(i=e.valueOf)&&!r(o=i.call(e)))return o;if(!t&&"function"==typeof(i=e.toString)&&!r(o=i.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e,t,i){"use strict";var r=i(76),o=i(15),n=i(104),s=i(77),a=i(14),l=i(56),u=i(78),h=i(16),c=Math.min,g=[].push,p="length",f=!h((function(){RegExp(4294967295,"y")}));i(59)("split",2,(function(e,t,i,h){var d;return d="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1)[p]||2!="ab".split(/(?:ab)*/)[p]||4!=".".split(/(.?)(.?)/)[p]||".".split(/()()/)[p]>1||"".split(/.?/)[p]?function(e,t){var o=String(this);if(void 0===e&&0===t)return[];if(!r(e))return i.call(o,e,t);for(var n,s,a,l=[],h=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),c=0,f=void 0===t?4294967295:t>>>0,d=new RegExp(e.source,h+"g");(n=u.call(d,o))&&!((s=d.lastIndex)>c&&(l.push(o.slice(c,n.index)),n[p]>1&&n.index<o[p]&&g.apply(l,n.slice(1)),a=n[0][p],c=s,l[p]>=f));)d.lastIndex===n.index&&d.lastIndex++;return c===o[p]?!a&&d.test("")||l.push(""):l.push(o.slice(c)),l[p]>f?l.slice(0,f):l}:"0".split(void 0,0)[p]?function(e,t){return void 0===e&&0===t?[]:i.call(this,e,t)}:i,[function(i,r){var o=e(this),n=null==i?void 0:i[t];return void 0!==n?n.call(i,o,r):d.call(String(o),i,r)},function(e,t){var r=h(d,e,this,t,d!==i);if(r.done)return r.value;var u=o(e),g=String(this),p=n(u,RegExp),m=u.unicode,C=(u.ignoreCase?"i":"")+(u.multiline?"m":"")+(u.unicode?"u":"")+(f?"y":"g"),y=new p(f?u:"^(?:"+u.source+")",C),v=void 0===t?4294967295:t>>>0;if(0===v)return[];if(0===g.length)return null===l(y,g)?[g]:[];for(var A=0,_=0,I=[];_<g.length;){y.lastIndex=f?_:0;var b,w=l(y,f?g:g.slice(_));if(null===w||(b=c(a(y.lastIndex+(f?0:_)),g.length))===A)_=s(g,_,m);else{if(I.push(g.slice(A,_)),I.length===v)return I;for(var G=1;G<=w.length-1;G++)if(I.push(w[G]),I.length===v)return I;_=A=b}}return I.push(g.slice(A)),I}]}))},function(e,t,i){var r=i(21),o=i(38),n=i(5)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[n])?!!t:"RegExp"==o(e))}},function(e,t,i){"use strict";var r=i(155)(!0);e.exports=function(e,t,i){return t+(i?r(e,t).length:1)}},function(e,t,i){"use strict";var r,o,n=i(58),s=RegExp.prototype.exec,a=String.prototype.replace,l=s,u=(r=/a/,o=/b*/g,s.call(r,"a"),s.call(o,"a"),0!==r.lastIndex||0!==o.lastIndex),h=void 0!==/()??/.exec("")[1];(u||h)&&(l=function(e){var t,i,r,o,l=this;return h&&(i=new RegExp("^"+l.source+"$(?!\\s)",n.call(l))),u&&(t=l.lastIndex),r=s.call(l,e),u&&r&&(l.lastIndex=l.global?r.index+r[0].length:t),h&&r&&r.length>1&&a.call(r[0],i,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(r[o]=void 0)})),r}),e.exports=l},function(e,t,i){var r=i(24),o=i(105),n=i(72),s=i(70)("IE_PROTO"),a=function(){},l=function(){var e,t=i(73)("iframe"),r=n.length;for(t.style.display="none",i(106).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),l=e.F;r--;)delete l.prototype[n[r]];return l()};e.exports=Object.create||function(e,t){var i;return null!==e?(a.prototype=r(e),i=new a,a.prototype=null,i[s]=e):i=l(),void 0===t?i:o(i,t)}},function(e,t,i){var r=i(18).f,o=Function.prototype,n=/^\s*function ([^ (]*)/;"name"in o||i(11)&&r(o,"name",{configurable:!0,get:function(){try{return(""+this).match(n)[1]}catch(e){return""}}})},function(e,t,i){"use strict";i(159);var r=i(15),o=i(58),n=i(11),s=/./.toString,a=function(e){i(19)(RegExp.prototype,"toString",e,!0)};i(16)((function(){return"/a/b"!=s.call({source:"a",flags:"b"})}))?a((function(){var e=r(this);return"/".concat(e.source,"/","flags"in e?e.flags:!n&&e instanceof RegExp?o.call(e):void 0)})):"toString"!=s.name&&a((function(){return s.call(this)}))},function(e,t,i){"use strict";var r=i(57),o={};o[i(5)("toStringTag")]="z",o+""!="[object z]"&&i(19)(Object.prototype,"toString",(function(){return"[object "+r(this)+"]"}),!0)},function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(e,t,i){"use strict";var r=i(15),o=i(33),n=i(14),s=i(27),a=i(77),l=i(56),u=Math.max,h=Math.min,c=Math.floor,g=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g;i(59)("replace",2,(function(e,t,i,f){return[function(r,o){var n=e(this),s=null==r?void 0:r[t];return void 0!==s?s.call(r,n,o):i.call(String(n),r,o)},function(e,t){var o=f(i,e,this,t);if(o.done)return o.value;var c=r(e),g=String(this),p="function"==typeof t;p||(t=String(t));var m=c.global;if(m){var C=c.unicode;c.lastIndex=0}for(var y=[];;){var v=l(c,g);if(null===v)break;if(y.push(v),!m)break;""===String(v[0])&&(c.lastIndex=a(g,n(c.lastIndex),C))}for(var A,_="",I=0,b=0;b<y.length;b++){v=y[b];for(var w=String(v[0]),G=u(h(s(v.index),g.length),0),E=[],S=1;S<v.length;S++)E.push(void 0===(A=v[S])?A:String(A));var P=v.groups;if(p){var T=[w].concat(E,G,g);void 0!==P&&T.push(P);var x=String(t.apply(void 0,T))}else x=d(w,g,G,E,P,t);G>=I&&(_+=g.slice(I,G)+x,I=G+w.length)}return _+g.slice(I)}];function d(e,t,r,n,s,a){var l=r+e.length,u=n.length,h=p;return void 0!==s&&(s=o(s),h=g),i.call(a,h,(function(i,o){var a;switch(o.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(l);case"<":a=s[o.slice(1,-1)];break;default:var h=+o;if(0===h)return i;if(h>u){var g=c(h/10);return 0===g?i:g<=u?void 0===n[g-1]?o.charAt(1):n[g-1]+o.charAt(1):i}a=n[h-1]}return void 0===a?"":a}))}}))},function(e,t,i){t.f=i(12)},function(e,t,i){var r=i(6),o=i(3),n=i(40),s=i(85),a=i(23).f;e.exports=function(e){var t=o.Symbol||(o.Symbol=n?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:s.f(e)})}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,i){var r=i(197),o=i(46),n=i(47),s=i(45),a=i(26),l=i(93),u=Object.getOwnPropertyDescriptor;t.f=i(11)?u:function(e,t){if(e=n(e),t=s(t,!0),l)try{return u(e,t)}catch(e){}if(a(e,t))return o(!r.f.call(e,t),e[t])}},function(e,t,i){"use strict";var r=i(54);function o(e){var t,i;this.promise=new e((function(e,r){if(void 0!==t||void 0!==i)throw TypeError("Bad Promise constructor");t=e,i=r})),this.resolve=r(t),this.reject=r(i)}e.exports.f=function(e){return new o(e)}},function(e,t,i){e.exports=i(206)},function(e,t){var i,r,o=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(i===setTimeout)return setTimeout(e,0);if((i===n||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:n}catch(e){i=n}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var l,u=[],h=!1,c=-1;function g(){h&&l&&(h=!1,l.length?u=l.concat(u):c=-1,u.length&&p())}function p(){if(!h){var e=a(g);h=!0;for(var t=u.length;t;){for(l=u,u=[];++c<t;)l&&l[c].run();c=-1,t=u.length}l=null,h=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function d(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];u.push(new f(e,t)),1!==u.length||h||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=d,o.addListener=d,o.once=d,o.off=d,o.removeListener=d,o.removeAllListeners=d,o.emit=d,o.prependListener=d,o.prependOnceListener=d,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,i){e.exports=!i(11)&&!i(16)((function(){return 7!=Object.defineProperty(i(94)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,i){var r=i(21),o=i(10).document,n=r(o)&&r(o.createElement);e.exports=function(e){return n?o.createElement(e):{}}},function(e,t,i){var r=i(38);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,i){var r=i(98),o=i(66);e.exports=Object.keys||function(e){return r(e,o)}},function(e,t,i){var r=i(26),o=i(47),n=i(99)(!1),s=i(65)("IE_PROTO");e.exports=function(e,t){var i,a=o(e),l=0,u=[];for(i in a)i!=s&&r(a,i)&&u.push(i);for(;t.length>l;)r(a,i=t[l++])&&(~n(u,i)||u.push(i));return u}},function(e,t,i){var r=i(47),o=i(14),n=i(49);e.exports=function(e){return function(t,i,s){var a,l=r(t),u=o(l.length),h=n(s,u);if(e&&i!=i){for(;u>h;)if((a=l[h++])!=a)return!0}else for(;u>h;h++)if((e||h in l)&&l[h]===i)return e||h||0;return!e&&-1}}},function(e,t,i){var r=i(26),o=i(33),n=i(65)("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=o(e),r(e,n)?e[n]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},function(e,t,i){var r=i(28),o=i(34),n=i(150)(!1),s=i(70)("IE_PROTO");e.exports=function(e,t){var i,a=o(e),l=0,u=[];for(i in a)i!=s&&r(a,i)&&u.push(i);for(;t.length>l;)r(a,i=t[l++])&&(~n(u,i)||u.push(i));return u}},function(e,t,i){var r=i(69),o=Math.min;e.exports=function(e){return e>0?o(r(e),9007199254740991):0}},function(e,t,i){e.exports=!i(20)&&!i(35)((function(){return 7!=Object.defineProperty(i(73)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,i){var r=i(15),o=i(96),n=i(5)("species");e.exports=function(e,t){var i,s=r(e).constructor;return void 0===s||null==(i=r(s)[n])?t:o(i)}},function(e,t,i){var r=i(23),o=i(24),n=i(51);e.exports=i(20)?Object.defineProperties:function(e,t){o(e);for(var i,s=n(t),a=s.length,l=0;a>l;)r.f(e,i=s[l++],t[i]);return e}},function(e,t,i){var r=i(6).document;e.exports=r&&r.documentElement},function(e,t,i){var r=i(39);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,i){var r=i(8),o=i(50),n=i(35),s=i(83),a="["+s+"]",l=RegExp("^"+a+a+"*"),u=RegExp(a+a+"*$"),h=function(e,t,i){var o={},a=n((function(){return!!s[e]()||"​"!="​"[e]()})),l=o[e]=a?t(c):s[e];i&&(o[i]=l),r(r.P+r.F*a,"String",o)},c=h.trim=function(e,t){return e=String(o(e)),1&t&&(e=e.replace(l,"")),2&t&&(e=e.replace(u,"")),e};e.exports=h},function(e,t,i){"use strict";var r=i(170)(!0);i(110)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,i=this._i;return i>=t.length?{value:void 0,done:!0}:(e=r(t,i),this._i+=e.length,{value:e,done:!1})}))},function(e,t,i){"use strict";var r=i(40),o=i(8),n=i(111),s=i(29),a=i(41),l=i(171),u=i(60),h=i(172),c=i(12)("iterator"),g=!([].keys&&"next"in[].keys()),p=function(){return this};e.exports=function(e,t,i,f,d,m,C){l(i,t,f);var y,v,A,_=function(e){if(!g&&e in G)return G[e];switch(e){case"keys":case"values":return function(){return new i(this,e)}}return function(){return new i(this,e)}},I=t+" Iterator",b="values"==d,w=!1,G=e.prototype,E=G[c]||G["@@iterator"]||d&&G[d],S=E||_(d),P=d?b?_("entries"):S:void 0,T="Array"==t&&G.entries||E;if(T&&(A=h(T.call(new e)))!==Object.prototype&&A.next&&(u(A,I,!0),r||"function"==typeof A[c]||s(A,c,p)),b&&E&&"values"!==E.name&&(w=!0,S=function(){return E.call(this)}),r&&!C||!g&&!w&&G[c]||s(G,c,S),a[t]=S,a[I]=p,d)if(y={values:b?S:_("values"),keys:m?S:_("keys"),entries:P},C)for(v in y)v in G||n(G,v,y[v]);else o(o.P+o.F*(g||w),t,y);return y}},function(e,t,i){e.exports=i(29)},function(e,t,i){i(173);for(var r=i(6),o=i(29),n=i(41),s=i(12)("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),l=0;l<a.length;l++){var u=a[l],h=r[u],c=h&&h.prototype;c&&!c[s]&&o(c,s,u),n[u]=n.Array}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,i){var r=i(101),o=i(72).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,o)}},function(e,t){},function(e,t,i){var r,o,n;
/**
 * @license bytebuffer.js (c) 2015 Daniel Wirtz <dcode@dcode.io>
 * Backing buffer: ArrayBuffer, Accessor: Uint8Array
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/bytebuffer.js for details
 */o=[i(185)],void 0===(n="function"==typeof(r=function(e){"use strict";var t=function(e,i,o){if(void 0===e&&(e=t.DEFAULT_CAPACITY),void 0===i&&(i=t.DEFAULT_ENDIAN),void 0===o&&(o=t.DEFAULT_NOASSERT),!o){if((e|=0)<0)throw RangeError("Illegal capacity");i=!!i,o=!!o}this.buffer=0===e?r:new ArrayBuffer(e),this.view=0===e?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=e,this.littleEndian=i,this.noAssert=o};t.VERSION="5.0.1",t.LITTLE_ENDIAN=!0,t.BIG_ENDIAN=!1,t.DEFAULT_CAPACITY=16,t.DEFAULT_ENDIAN=t.BIG_ENDIAN,t.DEFAULT_NOASSERT=!1,t.Long=e||null;var i=t.prototype;i.__isByteBuffer__,Object.defineProperty(i,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var r=new ArrayBuffer(0),o=String.fromCharCode;function n(e){var t=0;return function(){return t<e.length?e.charCodeAt(t++):null}}function s(){var e=[],t=[];return function(){if(0===arguments.length)return t.join("")+o.apply(String,e);e.length+arguments.length>1024&&(t.push(o.apply(String,e)),e.length=0),Array.prototype.push.apply(e,arguments)}}function a(e,t,i,r,o){var n,s,a=8*o-r-1,l=(1<<a)-1,u=l>>1,h=-7,c=i?o-1:0,g=i?-1:1,p=e[t+c];for(c+=g,n=p&(1<<-h)-1,p>>=-h,h+=a;h>0;n=256*n+e[t+c],c+=g,h-=8);for(s=n&(1<<-h)-1,n>>=-h,h+=r;h>0;s=256*s+e[t+c],c+=g,h-=8);if(0===n)n=1-u;else{if(n===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),n-=u}return(p?-1:1)*s*Math.pow(2,n-r)}function l(e,t,i,r,o,n){var s,a,l,u=8*n-o-1,h=(1<<u)-1,c=h>>1,g=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:n-1,f=r?1:-1,d=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=h):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+c>=1?g/l:g*Math.pow(2,1-c))*l>=2&&(s++,l/=2),s+c>=h?(a=0,s=h):s+c>=1?(a=(t*l-1)*Math.pow(2,o),s+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,o),s=0));o>=8;e[i+p]=255&a,p+=f,a/=256,o-=8);for(s=s<<o|a,u+=o;u>0;e[i+p]=255&s,p+=f,s/=256,u-=8);e[i+p-f]|=128*d}t.accessor=function(){return Uint8Array},t.allocate=function(e,i,r){return new t(e,i,r)},t.concat=function(e,i,r,o){"boolean"!=typeof i&&"string"==typeof i||(o=r,r=i,i=void 0);for(var n,s=0,a=0,l=e.length;a<l;++a)t.isByteBuffer(e[a])||(e[a]=t.wrap(e[a],i)),(n=e[a].limit-e[a].offset)>0&&(s+=n);if(0===s)return new t(0,r,o);var u,h=new t(s,r,o);for(a=0;a<l;)(n=(u=e[a++]).limit-u.offset)<=0||(h.view.set(u.view.subarray(u.offset,u.limit),h.offset),h.offset+=n);return h.limit=h.offset,h.offset=0,h},t.isByteBuffer=function(e){return!0===(e&&e.__isByteBuffer__)},t.type=function(){return ArrayBuffer},t.wrap=function(e,r,o,n){if("string"!=typeof r&&(n=o,o=r,r=void 0),"string"==typeof e)switch(void 0===r&&(r="utf8"),r){case"base64":return t.fromBase64(e,o);case"hex":return t.fromHex(e,o);case"binary":return t.fromBinary(e,o);case"utf8":return t.fromUTF8(e,o);case"debug":return t.fromDebug(e,o);default:throw Error("Unsupported encoding: "+r)}if(null===e||"object"!=typeof e)throw TypeError("Illegal buffer");var s;if(t.isByteBuffer(e))return(s=i.clone.call(e)).markedOffset=-1,s;if(e instanceof Uint8Array)s=new t(0,o,n),e.length>0&&(s.buffer=e.buffer,s.offset=e.byteOffset,s.limit=e.byteOffset+e.byteLength,s.view=new Uint8Array(e.buffer));else if(e instanceof ArrayBuffer)s=new t(0,o,n),e.byteLength>0&&(s.buffer=e,s.offset=0,s.limit=e.byteLength,s.view=e.byteLength>0?new Uint8Array(e):null);else{if("[object Array]"!==Object.prototype.toString.call(e))throw TypeError("Illegal buffer");(s=new t(e.length,o,n)).limit=e.length;for(var a=0;a<e.length;++a)s.view[a]=e[a]}return s},i.writeBitSet=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(!(e instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var r,o=t,n=e.length,s=n>>3,a=0;for(t+=this.writeVarint32(n,t);s--;)r=1&!!e[a++]|(1&!!e[a++])<<1|(1&!!e[a++])<<2|(1&!!e[a++])<<3|(1&!!e[a++])<<4|(1&!!e[a++])<<5|(1&!!e[a++])<<6|(1&!!e[a++])<<7,this.writeByte(r,t++);if(a<n){var l=0;for(r=0;a<n;)r|=(1&!!e[a++])<<l++;this.writeByte(r,t++)}return i?(this.offset=t,this):t-o},i.readBitSet=function(e){var t=void 0===e;t&&(e=this.offset);var i,r=this.readVarint32(e),o=r.value,n=o>>3,s=0,a=[];for(e+=r.length;n--;)i=this.readByte(e++),a[s++]=!!(1&i),a[s++]=!!(2&i),a[s++]=!!(4&i),a[s++]=!!(8&i),a[s++]=!!(16&i),a[s++]=!!(32&i),a[s++]=!!(64&i),a[s++]=!!(128&i);if(s<o){var l=0;for(i=this.readByte(e++);s<o;)a[s++]=!!(i>>l++&1)}return t&&(this.offset=e),a},i.readBytes=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+"+e+") <= "+this.buffer.byteLength)}var r=this.slice(t,t+e);return i&&(this.offset+=e),r},i.writeBytes=i.append,i.writeInt8=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=1,this.view[t]=e,i&&(this.offset+=1),this},i.writeByte=i.writeInt8,i.readInt8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i=this.view[e];return 128==(128&i)&&(i=-(255-i+1)),t&&(this.offset+=1),i},i.readByte=i.readInt8,i.writeUint8=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=1,this.view[t]=e,i&&(this.offset+=1),this},i.writeUInt8=i.writeUint8,i.readUint8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i=this.view[e];return t&&(this.offset+=1),i},i.readUInt8=i.readUint8,i.writeInt16=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),i&&(this.offset+=2),this},i.writeShort=i.writeInt16,i.readInt16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e],i|=this.view[e+1]<<8):(i=this.view[e]<<8,i|=this.view[e+1]),32768==(32768&i)&&(i=-(65535-i+1)),t&&(this.offset+=2),i},i.readShort=i.readInt16,i.writeUint16=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),i&&(this.offset+=2),this},i.writeUInt16=i.writeUint16,i.readUint16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e],i|=this.view[e+1]<<8):(i=this.view[e]<<8,i|=this.view[e+1]),t&&(this.offset+=2),i},i.readUInt16=i.readUint16,i.writeInt32=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),i&&(this.offset+=4),this},i.writeInt=i.writeInt32,i.readInt32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0),i|=0,t&&(this.offset+=4),i},i.readInt=i.readInt32,i.writeUint32=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),i&&(this.offset+=4),this},i.writeUInt32=i.writeUint32,i.readUint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0),t&&(this.offset+=4),i},i.readUInt32=i.readUint32,e&&(i.writeInt64=function(t,i){var r=void 0===i;if(r&&(i=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if("string"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t)),i+=8;var o=this.buffer.byteLength;i>o&&this.resize((o*=2)>i?o:i),i-=8;var n=t.low,s=t.high;return this.littleEndian?(this.view[i+3]=n>>>24&255,this.view[i+2]=n>>>16&255,this.view[i+1]=n>>>8&255,this.view[i]=255&n,i+=4,this.view[i+3]=s>>>24&255,this.view[i+2]=s>>>16&255,this.view[i+1]=s>>>8&255,this.view[i]=255&s):(this.view[i]=s>>>24&255,this.view[i+1]=s>>>16&255,this.view[i+2]=s>>>8&255,this.view[i+3]=255&s,i+=4,this.view[i]=n>>>24&255,this.view[i+1]=n>>>16&255,this.view[i+2]=n>>>8&255,this.view[i+3]=255&n),r&&(this.offset+=8),this},i.writeLong=i.writeInt64,i.readInt64=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var r=0,o=0;this.littleEndian?(r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0,t+=4,o=this.view[t+2]<<16,o|=this.view[t+1]<<8,o|=this.view[t],o+=this.view[t+3]<<24>>>0):(o=this.view[t+1]<<16,o|=this.view[t+2]<<8,o|=this.view[t+3],o+=this.view[t]<<24>>>0,t+=4,r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0);var n=new e(r,o,!1);return i&&(this.offset+=8),n},i.readLong=i.readInt64,i.writeUint64=function(t,i){var r=void 0===i;if(r&&(i=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if("string"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t)),i+=8;var o=this.buffer.byteLength;i>o&&this.resize((o*=2)>i?o:i),i-=8;var n=t.low,s=t.high;return this.littleEndian?(this.view[i+3]=n>>>24&255,this.view[i+2]=n>>>16&255,this.view[i+1]=n>>>8&255,this.view[i]=255&n,i+=4,this.view[i+3]=s>>>24&255,this.view[i+2]=s>>>16&255,this.view[i+1]=s>>>8&255,this.view[i]=255&s):(this.view[i]=s>>>24&255,this.view[i+1]=s>>>16&255,this.view[i+2]=s>>>8&255,this.view[i+3]=255&s,i+=4,this.view[i]=n>>>24&255,this.view[i+1]=n>>>16&255,this.view[i+2]=n>>>8&255,this.view[i+3]=255&n),r&&(this.offset+=8),this},i.writeUInt64=i.writeUint64,i.readUint64=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var r=0,o=0;this.littleEndian?(r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0,t+=4,o=this.view[t+2]<<16,o|=this.view[t+1]<<8,o|=this.view[t],o+=this.view[t+3]<<24>>>0):(o=this.view[t+1]<<16,o|=this.view[t+2]<<8,o|=this.view[t+3],o+=this.view[t]<<24>>>0,t+=4,r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0);var n=new e(r,o,!0);return i&&(this.offset+=8),n},i.readUInt64=i.readUint64),i.writeFloat32=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=4,l(this.view,e,t,this.littleEndian,23,4),i&&(this.offset+=4),this},i.writeFloat=i.writeFloat32,i.readFloat32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var i=a(this.view,e,this.littleEndian,23,4);return t&&(this.offset+=4),i},i.readFloat=i.readFloat32,i.writeFloat64=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=8;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=8,l(this.view,e,t,this.littleEndian,52,8),i&&(this.offset+=8),this},i.writeDouble=i.writeFloat64,i.readFloat64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var i=a(this.view,e,this.littleEndian,52,8);return t&&(this.offset+=8),i},i.readDouble=i.readFloat64,t.MAX_VARINT32_BYTES=5,t.calculateVarint32=function(e){return(e>>>=0)<128?1:e<16384?2:e<1<<21?3:e<1<<28?4:5},t.zigZagEncode32=function(e){return((e|=0)<<1^e>>31)>>>0},t.zigZagDecode32=function(e){return e>>>1^-(1&e)|0},i.writeVarint32=function(e,i){var r=void 0===i;if(r&&(i=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var o,n=t.calculateVarint32(e);i+=n;var s=this.buffer.byteLength;for(i>s&&this.resize((s*=2)>i?s:i),i-=n,e>>>=0;e>=128;)o=127&e|128,this.view[i++]=o,e>>>=7;return this.view[i++]=e,r?(this.offset=i,this):n},i.writeVarint32ZigZag=function(e,i){return this.writeVarint32(t.zigZagEncode32(e),i)},i.readVarint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i,r=0,o=0;do{if(!this.noAssert&&e>this.limit){var n=Error("Truncated");throw n.truncated=!0,n}i=this.view[e++],r<5&&(o|=(127&i)<<7*r),++r}while(0!=(128&i));return o|=0,t?(this.offset=e,o):{value:o,length:r}},i.readVarint32ZigZag=function(e){var i=this.readVarint32(e);return"object"==typeof i?i.value=t.zigZagDecode32(i.value):i=t.zigZagDecode32(i),i},e&&(t.MAX_VARINT64_BYTES=10,t.calculateVarint64=function(t){"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t));var i=t.toInt()>>>0,r=t.shiftRightUnsigned(28).toInt()>>>0,o=t.shiftRightUnsigned(56).toInt()>>>0;return 0==o?0==r?i<16384?i<128?1:2:i<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:o<128?9:10},t.zigZagEncode64=function(t){return"number"==typeof t?t=e.fromNumber(t,!1):"string"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),t.shiftLeft(1).xor(t.shiftRight(63)).toUnsigned()},t.zigZagDecode64=function(t){return"number"==typeof t?t=e.fromNumber(t,!1):"string"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),t.shiftRightUnsigned(1).xor(t.and(e.ONE).toSigned().negate()).toSigned()},i.writeVarint64=function(i,r){var o=void 0===r;if(o&&(r=this.offset),!this.noAssert){if("number"==typeof i)i=e.fromNumber(i);else if("string"==typeof i)i=e.fromString(i);else if(!(i&&i instanceof e))throw TypeError("Illegal value: "+i+" (not an integer or Long)");if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof i?i=e.fromNumber(i,!1):"string"==typeof i?i=e.fromString(i,!1):!1!==i.unsigned&&(i=i.toSigned());var n=t.calculateVarint64(i),s=i.toInt()>>>0,a=i.shiftRightUnsigned(28).toInt()>>>0,l=i.shiftRightUnsigned(56).toInt()>>>0;r+=n;var u=this.buffer.byteLength;switch(r>u&&this.resize((u*=2)>r?u:r),r-=n,n){case 10:this.view[r+9]=l>>>7&1;case 9:this.view[r+8]=9!==n?128|l:127&l;case 8:this.view[r+7]=8!==n?a>>>21|128:a>>>21&127;case 7:this.view[r+6]=7!==n?a>>>14|128:a>>>14&127;case 6:this.view[r+5]=6!==n?a>>>7|128:a>>>7&127;case 5:this.view[r+4]=5!==n?128|a:127&a;case 4:this.view[r+3]=4!==n?s>>>21|128:s>>>21&127;case 3:this.view[r+2]=3!==n?s>>>14|128:s>>>14&127;case 2:this.view[r+1]=2!==n?s>>>7|128:s>>>7&127;case 1:this.view[r]=1!==n?128|s:127&s}return o?(this.offset+=n,this):n},i.writeVarint64ZigZag=function(e,i){return this.writeVarint64(t.zigZagEncode64(e),i)},i.readVarint64=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r=t,o=0,n=0,s=0,a=0;if(o=127&(a=this.view[t++]),128&a&&(o|=(127&(a=this.view[t++]))<<7,(128&a||this.noAssert&&void 0===a)&&(o|=(127&(a=this.view[t++]))<<14,(128&a||this.noAssert&&void 0===a)&&(o|=(127&(a=this.view[t++]))<<21,(128&a||this.noAssert&&void 0===a)&&(n=127&(a=this.view[t++]),(128&a||this.noAssert&&void 0===a)&&(n|=(127&(a=this.view[t++]))<<7,(128&a||this.noAssert&&void 0===a)&&(n|=(127&(a=this.view[t++]))<<14,(128&a||this.noAssert&&void 0===a)&&(n|=(127&(a=this.view[t++]))<<21,(128&a||this.noAssert&&void 0===a)&&(s=127&(a=this.view[t++]),(128&a||this.noAssert&&void 0===a)&&(s|=(127&(a=this.view[t++]))<<7,128&a||this.noAssert&&void 0===a))))))))))throw Error("Buffer overrun");var l=e.fromBits(o|n<<28,n>>>4|s<<24,!1);return i?(this.offset=t,l):{value:l,length:t-r}},i.readVarint64ZigZag=function(i){var r=this.readVarint64(i);return r&&r.value instanceof e?r.value=t.zigZagDecode64(r.value):r=t.zigZagDecode64(r),r}),i.writeCString=function(e,t){var i=void 0===t;i&&(t=this.offset);var r,o=e.length;if(!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");for(r=0;r<o;++r)if(0===e.charCodeAt(r))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}o=h.calculateUTF16asUTF8(n(e))[1],t+=o+1;var s=this.buffer.byteLength;return t>s&&this.resize((s*=2)>t?s:t),t-=o+1,h.encodeUTF16toUTF8(n(e),function(e){this.view[t++]=e}.bind(this)),this.view[t++]=0,i?(this.offset=t,this):o},i.readCString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i,r=e,o=-1;return h.decodeUTF8toUTF16(function(){if(0===o)return null;if(e>=this.limit)throw RangeError("Illegal range: Truncated data, "+e+" < "+this.limit);return 0===(o=this.view[e++])?null:o}.bind(this),i=s(),!0),t?(this.offset=e,i()):{string:i(),length:e-r}},i.writeIString=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var r,o=t;r=h.calculateUTF16asUTF8(n(e),this.noAssert)[1],t+=4+r;var s=this.buffer.byteLength;if(t>s&&this.resize((s*=2)>t?s:t),t-=4+r,this.littleEndian?(this.view[t+3]=r>>>24&255,this.view[t+2]=r>>>16&255,this.view[t+1]=r>>>8&255,this.view[t]=255&r):(this.view[t]=r>>>24&255,this.view[t+1]=r>>>16&255,this.view[t+2]=r>>>8&255,this.view[t+3]=255&r),t+=4,h.encodeUTF16toUTF8(n(e),function(e){this.view[t++]=e}.bind(this)),t!==o+4+r)throw RangeError("Illegal range: Truncated data, "+t+" == "+(t+4+r));return i?(this.offset=t,this):t-o},i.readIString=function(e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=e,o=this.readUint32(e),n=this.readUTF8String(o,t.METRICS_BYTES,e+=4);return e+=n.length,i?(this.offset=e,n.string):{string:n.string,length:e-r}},t.METRICS_CHARS="c",t.METRICS_BYTES="b",i.writeUTF8String=function(e,t){var i,r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var o=t;i=h.calculateUTF16asUTF8(n(e))[1],t+=i;var s=this.buffer.byteLength;return t>s&&this.resize((s*=2)>t?s:t),t-=i,h.encodeUTF16toUTF8(n(e),function(e){this.view[t++]=e}.bind(this)),r?(this.offset=t,this):t-o},i.writeString=i.writeUTF8String,t.calculateUTF8Chars=function(e){return h.calculateUTF16asUTF8(n(e))[0]},t.calculateUTF8Bytes=function(e){return h.calculateUTF16asUTF8(n(e))[1]},t.calculateString=t.calculateUTF8Bytes,i.readUTF8String=function(e,i,r){"number"==typeof i&&(r=i,i=void 0);var o=void 0===r;if(o&&(r=this.offset),void 0===i&&(i=t.METRICS_CHARS),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");if(e|=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var n,a=0,l=r;if(i===t.METRICS_CHARS){if(n=s(),h.decodeUTF8(function(){return a<e&&r<this.limit?this.view[r++]:null}.bind(this),(function(e){++a,h.UTF8toUTF16(e,n)})),a!==e)throw RangeError("Illegal range: Truncated data, "+a+" == "+e);return o?(this.offset=r,n()):{string:n(),length:r-l}}if(i===t.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+"+e+") <= "+this.buffer.byteLength)}var u=r+e;if(h.decodeUTF8toUTF16(function(){return r<u?this.view[r++]:null}.bind(this),n=s(),this.noAssert),r!==u)throw RangeError("Illegal range: Truncated data, "+r+" == "+u);return o?(this.offset=r,n()):{string:n(),length:r-l}}throw TypeError("Unsupported metrics: "+i)},i.readString=i.readUTF8String,i.writeVString=function(e,i){var r=void 0===i;if(r&&(i=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var o,s,a=i;o=h.calculateUTF16asUTF8(n(e),this.noAssert)[1],s=t.calculateVarint32(o),i+=s+o;var l=this.buffer.byteLength;if(i>l&&this.resize((l*=2)>i?l:i),i-=s+o,i+=this.writeVarint32(o,i),h.encodeUTF16toUTF8(n(e),function(e){this.view[i++]=e}.bind(this)),i!==a+o+s)throw RangeError("Illegal range: Truncated data, "+i+" == "+(i+o+s));return r?(this.offset=i,this):i-a},i.readVString=function(e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=e,o=this.readVarint32(e),n=this.readUTF8String(o.value,t.METRICS_BYTES,e+=o.length);return e+=n.length,i?(this.offset=e,n.string):{string:n.string,length:e-r}},i.append=function(e,i,r){"number"!=typeof i&&"string"==typeof i||(r=i,i=void 0);var o=void 0===r;if(o&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}e instanceof t||(e=t.wrap(e,i));var n=e.limit-e.offset;if(n<=0)return this;r+=n;var s=this.buffer.byteLength;return r>s&&this.resize((s*=2)>r?s:r),r-=n,this.view.set(e.view.subarray(e.offset,e.limit),r),e.offset+=n,o&&(this.offset+=n),this},i.appendTo=function(e,t){return e.append(this,t),this},i.assert=function(e){return this.noAssert=!e,this},i.capacity=function(){return this.buffer.byteLength},i.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},i.clone=function(e){var i=new t(0,this.littleEndian,this.noAssert);return e?(i.buffer=new ArrayBuffer(this.buffer.byteLength),i.view=new Uint8Array(i.buffer)):(i.buffer=this.buffer,i.view=this.view),i.offset=this.offset,i.markedOffset=this.markedOffset,i.limit=this.limit,i},i.compact=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(0===e&&t===this.buffer.byteLength)return this;var i=t-e;if(0===i)return this.buffer=r,this.view=null,this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=0,this;var o=new ArrayBuffer(i),n=new Uint8Array(o);return n.set(this.view.subarray(e,t)),this.buffer=o,this.view=n,this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=i,this},i.copy=function(e,i){if(void 0===e&&(e=this.offset),void 0===i&&(i=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal end: Not an integer");if(i>>>=0,e<0||e>i||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+i+" <= "+this.buffer.byteLength)}if(e===i)return new t(0,this.littleEndian,this.noAssert);var r=i-e,o=new t(r,this.littleEndian,this.noAssert);return o.offset=0,o.limit=r,o.markedOffset>=0&&(o.markedOffset-=e),this.copyTo(o,0,e,i),o},i.copyTo=function(e,i,r,o){var n,s;if(!this.noAssert&&!t.isByteBuffer(e))throw TypeError("Illegal target: Not a ByteBuffer");if(i=(s=void 0===i)?e.offset:0|i,r=(n=void 0===r)?this.offset:0|r,o=void 0===o?this.limit:0|o,i<0||i>e.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+i+" <= "+e.buffer.byteLength);if(r<0||o>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+r+" <= "+this.buffer.byteLength);var a=o-r;return 0===a?e:(e.ensureCapacity(i+a),e.view.set(this.view.subarray(r,o),i),n&&(this.offset+=a),s&&(e.offset+=a),this)},i.ensureCapacity=function(e){var t=this.buffer.byteLength;return t<e?this.resize((t*=2)>e?t:e):this},i.fill=function(e,t,i){var r=void 0===t;if(r&&(t=this.offset),"string"==typeof e&&e.length>0&&(e=e.charCodeAt(0)),void 0===t&&(t=this.offset),void 0===i&&(i=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal end: Not an integer");if(i>>>=0,t<0||t>i||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+i+" <= "+this.buffer.byteLength)}if(t>=i)return this;for(;t<i;)this.view[t++]=e;return r&&(this.offset=t),this},i.flip=function(){return this.limit=this.offset,this.offset=0,this},i.mark=function(e){if(e=void 0===e?this.offset:e,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=e,this},i.order=function(e){if(!this.noAssert&&"boolean"!=typeof e)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!e,this},i.LE=function(e){return this.littleEndian=void 0===e||!!e,this},i.BE=function(e){return this.littleEndian=void 0!==e&&!e,this},i.prepend=function(e,i,r){"number"!=typeof i&&"string"==typeof i||(r=i,i=void 0);var o=void 0===r;if(o&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}e instanceof t||(e=t.wrap(e,i));var n=e.limit-e.offset;if(n<=0)return this;var s=n-r;if(s>0){var a=new ArrayBuffer(this.buffer.byteLength+s),l=new Uint8Array(a);l.set(this.view.subarray(r,this.buffer.byteLength),n),this.buffer=a,this.view=l,this.offset+=s,this.markedOffset>=0&&(this.markedOffset+=s),this.limit+=s,r+=s}else new Uint8Array(this.buffer);return this.view.set(e.view.subarray(e.offset,e.limit),r-n),e.offset=e.limit,o&&(this.offset-=n),this},i.prependTo=function(e,t){return e.prepend(this,t),this},i.printDebug=function(e){"function"!=typeof e&&(e=console.log.bind(console)),e(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},i.remaining=function(){return this.limit-this.offset},i.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},i.resize=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal capacity: "+e+" (not an integer)");if((e|=0)<0)throw RangeError("Illegal capacity: 0 <= "+e)}if(this.buffer.byteLength<e){var t=new ArrayBuffer(e),i=new Uint8Array(t);i.set(this.view),this.buffer=t,this.view=i}return this},i.reverse=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}return e===t||Array.prototype.reverse.call(this.view.subarray(e,t)),this},i.skip=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");e|=0}var t=this.offset+e;if(!this.noAssert&&(t<0||t>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+e+" <= "+this.buffer.byteLength);return this.offset=t,this},i.slice=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var i=this.clone();return i.offset=e,i.limit=t,i},i.toBuffer=function(e){var t=this.offset,i=this.limit;if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: Not an integer");if(t>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal limit: Not an integer");if(i>>>=0,t<0||t>i||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+i+" <= "+this.buffer.byteLength)}if(!e&&0===t&&i===this.buffer.byteLength)return this.buffer;if(t===i)return r;var o=new ArrayBuffer(i-t);return new Uint8Array(o).set(new Uint8Array(this.buffer).subarray(t,i),0),o},i.toArrayBuffer=i.toBuffer,i.toString=function(e,t,i){if(void 0===e)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof e&&(i=t=e="utf8"),e){case"utf8":return this.toUTF8(t,i);case"base64":return this.toBase64(t,i);case"hex":return this.toHex(t,i);case"binary":return this.toBinary(t,i);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+e)}};var u=function(){for(var e={},t=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],i=[],r=0,o=t.length;r<o;++r)i[t[r]]=r;return e.encode=function(e,i){for(var r,o;null!==(r=e());)i(t[r>>2&63]),o=(3&r)<<4,null!==(r=e())?(i(t[63&((o|=r>>4&15)|r>>4&15)]),o=(15&r)<<2,null!==(r=e())?(i(t[63&(o|r>>6&3)]),i(t[63&r])):(i(t[63&o]),i(61))):(i(t[63&o]),i(61),i(61))},e.decode=function(e,t){var r,o,n;function s(e){throw Error("Illegal character code: "+e)}for(;null!==(r=e());)if(void 0===(o=i[r])&&s(r),null!==(r=e())&&(void 0===(n=i[r])&&s(r),t(o<<2>>>0|(48&n)>>4),null!==(r=e()))){if(void 0===(o=i[r])){if(61===r)break;s(r)}if(t((15&n)<<4>>>0|(60&o)>>2),null!==(r=e())){if(void 0===(n=i[r])){if(61===r)break;s(r)}t((3&o)<<6>>>0|n)}}},e.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)},e}();i.toBase64=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity||e>t)throw RangeError("begin, end");var i;return u.encode(function(){return e<t?this.view[e++]:null}.bind(this),i=s()),i()},t.fromBase64=function(e,i){if("string"!=typeof e)throw TypeError("str");var r=new t(e.length/4*3,i),o=0;return u.decode(n(e),(function(e){r.view[o++]=e})),r.limit=o,r},t.btoa=function(e){return t.fromBinary(e).toBase64()},t.atob=function(e){return t.fromBase64(e).toBinary()},i.toBinary=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity()||e>t)throw RangeError("begin, end");if(e===t)return"";for(var i=[],r=[];e<t;)i.push(this.view[e++]),i.length>=1024&&(r.push(String.fromCharCode.apply(String,i)),i=[]);return r.join("")+String.fromCharCode.apply(String,i)},t.fromBinary=function(e,i){if("string"!=typeof e)throw TypeError("str");for(var r,o=0,n=e.length,s=new t(n,i);o<n;){if((r=e.charCodeAt(o))>255)throw RangeError("illegal char code: "+r);s.view[o++]=r}return s.limit=n,s},i.toDebug=function(e){for(var t,i=-1,r=this.buffer.byteLength,o="",n="",s="";i<r;){if(-1!==i&&(o+=(t=this.view[i])<16?"0"+t.toString(16).toUpperCase():t.toString(16).toUpperCase(),e&&(n+=t>32&&t<127?String.fromCharCode(t):".")),++i,e&&i>0&&i%16==0&&i!==r){for(;o.length<51;)o+=" ";s+=o+n+"\n",o=n=""}i===this.offset&&i===this.limit?o+=i===this.markedOffset?"!":"|":i===this.offset?o+=i===this.markedOffset?"[":"<":i===this.limit?o+=i===this.markedOffset?"]":">":o+=i===this.markedOffset?"'":e||0!==i&&i!==r?" ":""}if(e&&" "!==o){for(;o.length<51;)o+=" ";s+=o+n+"\n"}return e?s:o},t.fromDebug=function(e,i,r){for(var o,n,s=e.length,a=new t((s+1)/3|0,i,r),l=0,u=0,h=!1,c=!1,g=!1,p=!1,f=!1;l<s;){switch(o=e.charAt(l++)){case"!":if(!r){if(c||g||p){f=!0;break}c=g=p=!0}a.offset=a.markedOffset=a.limit=u,h=!1;break;case"|":if(!r){if(c||p){f=!0;break}c=p=!0}a.offset=a.limit=u,h=!1;break;case"[":if(!r){if(c||g){f=!0;break}c=g=!0}a.offset=a.markedOffset=u,h=!1;break;case"<":if(!r){if(c){f=!0;break}c=!0}a.offset=u,h=!1;break;case"]":if(!r){if(p||g){f=!0;break}p=g=!0}a.limit=a.markedOffset=u,h=!1;break;case">":if(!r){if(p){f=!0;break}p=!0}a.limit=u,h=!1;break;case"'":if(!r){if(g){f=!0;break}g=!0}a.markedOffset=u,h=!1;break;case" ":h=!1;break;default:if(!r&&h){f=!0;break}if(n=parseInt(o+e.charAt(l++),16),!r&&(isNaN(n)||n<0||n>255))throw TypeError("Illegal str: Not a debug encoded string");a.view[u++]=n,h=!0}if(f)throw TypeError("Illegal str: Invalid symbol at "+l)}if(!r){if(!c||!p)throw TypeError("Illegal str: Missing offset or limit");if(u<a.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+u+" < "+s)}return a},i.toHex=function(e,t){if(e=void 0===e?this.offset:e,t=void 0===t?this.limit:t,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}for(var i,r=new Array(t-e);e<t;)(i=this.view[e++])<16?r.push("0",i.toString(16)):r.push(i.toString(16));return r.join("")},t.fromHex=function(e,i,r){if(!r){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if(e.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var o,n=e.length,s=new t(n/2|0,i),a=0,l=0;a<n;a+=2){if(o=parseInt(e.substring(a,a+2),16),!r&&(!isFinite(o)||o<0||o>255))throw TypeError("Illegal str: Contains non-hex characters");s.view[l++]=o}return s.limit=l,s};var h=function(){var e={MAX_CODEPOINT:1114111,encodeUTF8:function(e,t){var i=null;for("number"==typeof e&&(i=e,e=function(){return null});null!==i||null!==(i=e());)i<128?t(127&i):i<2048?(t(i>>6&31|192),t(63&i|128)):i<65536?(t(i>>12&15|224),t(i>>6&63|128),t(63&i|128)):(t(i>>18&7|240),t(i>>12&63|128),t(i>>6&63|128),t(63&i|128)),i=null},decodeUTF8:function(e,t){for(var i,r,o,n,s=function(e){e=e.slice(0,e.indexOf(null));var t=Error(e.toString());throw t.name="TruncatedError",t.bytes=e,t};null!==(i=e());)if(0==(128&i))t(i);else if(192==(224&i))null===(r=e())&&s([i,r]),t((31&i)<<6|63&r);else if(224==(240&i))(null===(r=e())||null===(o=e()))&&s([i,r,o]),t((15&i)<<12|(63&r)<<6|63&o);else{if(240!=(248&i))throw RangeError("Illegal starting byte: "+i);(null===(r=e())||null===(o=e())||null===(n=e()))&&s([i,r,o,n]),t((7&i)<<18|(63&r)<<12|(63&o)<<6|63&n)}},UTF16toUTF8:function(e,t){for(var i,r=null;null!==(i=null!==r?r:e());)i>=55296&&i<=57343&&null!==(r=e())&&r>=56320&&r<=57343?(t(1024*(i-55296)+r-56320+65536),r=null):t(i);null!==r&&t(r)},UTF8toUTF16:function(e,t){var i=null;for("number"==typeof e&&(i=e,e=function(){return null});null!==i||null!==(i=e());)i<=65535?t(i):(t(55296+((i-=65536)>>10)),t(i%1024+56320)),i=null},encodeUTF16toUTF8:function(t,i){e.UTF16toUTF8(t,(function(t){e.encodeUTF8(t,i)}))},decodeUTF8toUTF16:function(t,i){e.decodeUTF8(t,(function(t){e.UTF8toUTF16(t,i)}))},calculateCodePoint:function(e){return e<128?1:e<2048?2:e<65536?3:4},calculateUTF8:function(e){for(var t,i=0;null!==(t=e());)i+=t<128?1:t<2048?2:t<65536?3:4;return i},calculateUTF16asUTF8:function(t){var i=0,r=0;return e.UTF16toUTF8(t,(function(e){++i,r+=e<128?1:e<2048?2:e<65536?3:4})),[i,r]}};return e}();return i.toUTF8=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var i;try{h.decodeUTF8toUTF16(function(){return e<t?this.view[e++]:null}.bind(this),i=s())}catch(i){if(e!==t)throw RangeError("Illegal range: Truncated data, "+e+" != "+t)}return i()},t.fromUTF8=function(e,i,r){if(!r&&"string"!=typeof e)throw TypeError("Illegal str: Not a string");var o=new t(h.calculateUTF16asUTF8(n(e),!0)[1],i,r),s=0;return h.encodeUTF16toUTF8(n(e),(function(e){o.view[s++]=e})),o.limit=s,o},t})?r.apply(t,o):r)||(e.exports=n)},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,i){(function(e){function i(e,t){for(var i=0,r=e.length-1;r>=0;r--){var o=e[r];"."===o?e.splice(r,1):".."===o?(e.splice(r,1),i++):i&&(e.splice(r,1),i--)}if(t)for(;i--;i)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var i=[],r=0;r<e.length;r++)t(e[r],r,e)&&i.push(e[r]);return i}t.resolve=function(){for(var t="",o=!1,n=arguments.length-1;n>=-1&&!o;n--){var s=n>=0?arguments[n]:e.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(t=s+"/"+t,o="/"===s.charAt(0))}return(o?"/":"")+(t=i(r(t.split("/"),(function(e){return!!e})),!o).join("/"))||"."},t.normalize=function(e){var n=t.isAbsolute(e),s="/"===o(e,-1);return(e=i(r(e.split("/"),(function(e){return!!e})),!n).join("/"))||n||(e="."),e&&s&&(e+="/"),(n?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(r(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,i){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var i=e.length-1;i>=0&&""===e[i];i--);return t>i?[]:e.slice(t,i-t+1)}e=t.resolve(e).substr(1),i=t.resolve(i).substr(1);for(var o=r(e.split("/")),n=r(i.split("/")),s=Math.min(o.length,n.length),a=s,l=0;l<s;l++)if(o[l]!==n[l]){a=l;break}var u=[];for(l=a;l<o.length;l++)u.push("..");return(u=u.concat(n.slice(a))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),i=47===t,r=-1,o=!0,n=e.length-1;n>=1;--n)if(47===(t=e.charCodeAt(n))){if(!o){r=n;break}}else o=!1;return-1===r?i?"/":".":i&&1===r?"/":e.slice(0,r)},t.basename=function(e,t){var i=function(e){"string"!=typeof e&&(e+="");var t,i=0,r=-1,o=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!o){i=t+1;break}}else-1===r&&(o=!1,r=t+1);return-1===r?"":e.slice(i,r)}(e);return t&&i.substr(-1*t.length)===t&&(i=i.substr(0,i.length-t.length)),i},t.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,i=0,r=-1,o=!0,n=0,s=e.length-1;s>=0;--s){var a=e.charCodeAt(s);if(47!==a)-1===r&&(o=!1,r=s+1),46===a?-1===t?t=s:1!==n&&(n=1):-1!==t&&(n=-1);else if(!o){i=s+1;break}}return-1===t||-1===r||0===n||1===n&&t===r-1&&t===i+1?"":e.slice(t,r)};var o="b"==="ab".substr(-1)?function(e,t,i){return e.substr(t,i)}:function(e,t,i){return t<0&&(t=e.length+t),e.substr(t,i)}}).call(this,i(91))},function(e,t,i){for(var r,o=i(10),n=i(17),s=i(37),a=s("typed_array"),l=s("view"),u=!(!o.ArrayBuffer||!o.DataView),h=u,c=0,g="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");c<9;)(r=o[g[c++]])?(n(r.prototype,a,!0),n(r.prototype,l,!0)):h=!1;e.exports={ABV:u,CONSTR:h,TYPED:a,VIEW:l}},function(e,t,i){var r=i(19);e.exports=function(e,t,i){for(var o in t)r(e,o,t[o],i);return e}},function(e,t){e.exports=function(e,t,i,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(i+": incorrect invocation!");return e}},function(e,t,i){var r=i(27),o=i(14);e.exports=function(e){if(void 0===e)return 0;var t=r(e),i=o(t);if(t!==i)throw RangeError("Wrong length!");return i}},function(e,t,i){"use strict";var r=i(33),o=i(49),n=i(14);e.exports=function(e){for(var t=r(this),i=n(t.length),s=arguments.length,a=o(s>1?arguments[1]:void 0,i),l=s>2?arguments[2]:void 0,u=void 0===l?i:o(l,i);u>a;)t[a++]=e;return t}},function(e,t,i){"use strict";var r=i(10),o=i(18),n=i(11),s=i(5)("species");e.exports=function(e){var t=r[e];n&&t&&!t[s]&&o.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,i){var r=i(39),o=i(12)("toStringTag"),n="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,i,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?i:n?r(t):"Object"==(s=r(t))&&"function"==typeof t.callee?"Arguments":s}},function(e,t,i){var r=i(24),o=i(54),n=i(12)("species");e.exports=function(e,t){var i,s=r(e).constructor;return void 0===s||null==(i=r(s)[n])?t:o(i)}},function(e,t,i){var r,o,n,s=i(53),a=i(215),l=i(106),u=i(73),h=i(6),c=h.process,g=h.setImmediate,p=h.clearImmediate,f=h.MessageChannel,d=h.Dispatch,m=0,C={},y=function(){var e=+this;if(C.hasOwnProperty(e)){var t=C[e];delete C[e],t()}},v=function(e){y.call(e.data)};g&&p||(g=function(e){for(var t=[],i=1;arguments.length>i;)t.push(arguments[i++]);return C[++m]=function(){a("function"==typeof e?e:Function(e),t)},r(m),m},p=function(e){delete C[e]},"process"==i(39)(c)?r=function(e){c.nextTick(s(y,e,1))}:d&&d.now?r=function(e){d.now(s(y,e,1))}:f?(n=(o=new f).port2,o.port1.onmessage=v,r=s(n.postMessage,n,1)):h.addEventListener&&"function"==typeof postMessage&&!h.importScripts?(r=function(e){h.postMessage(e+"","*")},h.addEventListener("message",v,!1)):r="onreadystatechange"in u("script")?function(e){l.appendChild(u("script")).onreadystatechange=function(){l.removeChild(this),y.call(e)}}:function(e){setTimeout(s(y,e,1),0)}),e.exports={set:g,clear:p}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,i){var r=i(24),o=i(30),n=i(89);e.exports=function(e,t){if(r(e),o(t)&&t.constructor===e)return t;var i=n.f(e);return(0,i.resolve)(t),i.promise}},function(e,t,i){"use strict";var r=i(15),o=i(14),n=i(77),s=i(56);i(59)("match",1,(function(e,t,i,a){return[function(i){var r=e(this),o=null==i?void 0:i[t];return void 0!==o?o.call(i,r):new RegExp(i)[t](String(r))},function(e){var t=a(i,e,this);if(t.done)return t.value;var l=r(e),u=String(this);if(!l.global)return s(l,u);var h=l.unicode;l.lastIndex=0;for(var c,g=[],p=0;null!==(c=s(l,u));){var f=String(c[0]);g[p]=f,""===f&&(l.lastIndex=n(u,o(l.lastIndex),h)),p++}return 0===p?null:g}]}))},function(e,t,i){var r=i(10),o=i(132),n=i(18).f,s=i(61).f,a=i(76),l=i(58),u=r.RegExp,h=u,c=u.prototype,g=/a/g,p=/a/g,f=new u(g)!==g;if(i(11)&&(!f||i(16)((function(){return p[i(5)("match")]=!1,u(g)!=g||u(p)==p||"/a/i"!=u(g,"i")})))){u=function(e,t){var i=this instanceof u,r=a(e),n=void 0===t;return!i&&r&&e.constructor===u&&n?e:o(f?new h(r&&!n?e.source:e,t):h((r=e instanceof u)?e.source:e,r&&n?l.call(e):t),i?this:c,u)};for(var d=function(e){e in u||n(u,e,{configurable:!0,get:function(){return h[e]},set:function(t){h[e]=t}})},m=s(h),C=0;m.length>C;)d(m[C++]);c.constructor=u,u.prototype=c,i(19)(r,"RegExp",u)}i(124)("RegExp")},function(e,t,i){var r=i(21),o=i(224).set;e.exports=function(e,t,i){var n,s=t.constructor;return s!==i&&"function"==typeof s&&(n=s.prototype)!==i.prototype&&r(n)&&o&&o(e,n),e}},function(e,t,i){"use strict";var r=i(10),o=i(26),n=i(38),s=i(132),a=i(45),l=i(16),u=i(61).f,h=i(88).f,c=i(18).f,g=i(225).trim,p=r.Number,f=p,d=p.prototype,m="Number"==n(i(64)(d)),C="trim"in String.prototype,y=function(e){var t=a(e,!1);if("string"==typeof t&&t.length>2){var i,r,o,n=(t=C?t.trim():g(t,3)).charCodeAt(0);if(43===n||45===n){if(88===(i=t.charCodeAt(2))||120===i)return NaN}else if(48===n){switch(t.charCodeAt(1)){case 66:case 98:r=2,o=49;break;case 79:case 111:r=8,o=55;break;default:return+t}for(var s,l=t.slice(2),u=0,h=l.length;u<h;u++)if((s=l.charCodeAt(u))<48||s>o)return NaN;return parseInt(l,r)}}return+t};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(e){var t=arguments.length<1?0:e,i=this;return i instanceof p&&(m?l((function(){d.valueOf.call(i)})):"Number"!=n(i))?s(new f(y(t)),i,p):y(t)};for(var v,A=i(11)?u(f):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),_=0;A.length>_;_++)o(f,v=A[_])&&!o(p,v)&&c(p,v,h(f,v));p.prototype=d,d.constructor=p,i(19)(r,"Number",p)}},function(e,t,i){var r=i(76),o=i(25);e.exports=function(e,t,i){if(r(t))throw TypeError("String#"+i+" doesn't accept regex!");return String(o(e))}},function(e,t,i){var r=i(5)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(i){try{return t[r]=!1,!"/./"[e](t)}catch(e){}}return!0}},function(e,t,i){e.exports=i(201)},function(e,t,i){e.exports=i(208)},function(e,t,i){"use strict";(function(e,t){var r=i(31),o=i.n(r),n=(i(62),i(36),i(7)),s=i.n(n),a=i(4),l=i.n(a),u=(i(75),i(13)),h=i.n(u),c=(i(80),i(81),i(82),i(9)),g=i.n(c),p=i(1),f=i.n(p),d=i(0),m=i.n(d),C=(i(84),i(2)),y=i.n(C);!function(e,r){var o=i(116);window.dcodeIO=window.dcodeIO||{},window.dcodeIO.ByteBuffer=o,"function"==typeof define&&i(117)?define(["bytebuffer"],r):"object"===y()(t)&&t&&t.exports?t.exports=r(i(116),!0):(e.dcodeIO=e.dcodeIO||{}).ProtoBuf=r(e.dcodeIO.ByteBuffer)}(window,(function(t,r){var n,a={};return a.ByteBuffer=t,a.Long=t.Long||null,a.VERSION="5.0.1",a.WIRE_TYPES={},a.WIRE_TYPES.VARINT=0,a.WIRE_TYPES.BITS64=1,a.WIRE_TYPES.LDELIM=2,a.WIRE_TYPES.STARTGROUP=3,a.WIRE_TYPES.ENDGROUP=4,a.WIRE_TYPES.BITS32=5,a.PACKABLE_WIRE_TYPES=[a.WIRE_TYPES.VARINT,a.WIRE_TYPES.BITS64,a.WIRE_TYPES.BITS32],a.TYPES={int32:{name:"int32",wireType:a.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:a.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:a.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:a.WIRE_TYPES.VARINT,defaultValue:a.Long?a.Long.ZERO:void 0},uint64:{name:"uint64",wireType:a.WIRE_TYPES.VARINT,defaultValue:a.Long?a.Long.UZERO:void 0},sint64:{name:"sint64",wireType:a.WIRE_TYPES.VARINT,defaultValue:a.Long?a.Long.ZERO:void 0},bool:{name:"bool",wireType:a.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:a.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:a.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:a.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:a.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:a.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:a.WIRE_TYPES.BITS64,defaultValue:a.Long?a.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:a.WIRE_TYPES.BITS64,defaultValue:a.Long?a.Long.ZERO:void 0},float:{name:"float",wireType:a.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:a.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:a.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:a.WIRE_TYPES.STARTGROUP,defaultValue:null}},a.MAP_KEY_TYPES=[a.TYPES.int32,a.TYPES.sint32,a.TYPES.sfixed32,a.TYPES.uint32,a.TYPES.fixed32,a.TYPES.int64,a.TYPES.sint64,a.TYPES.sfixed64,a.TYPES.uint64,a.TYPES.fixed64,a.TYPES.bool,a.TYPES.string,a.TYPES.bytes],a.ID_MIN=1,a.ID_MAX=536870911,a.convertFieldsToCamelCase=!1,a.populateAccessors=!0,a.populateDefaults=!0,a.Util=((n={}).IS_NODE=!("object"!==(void 0===e?"undefined":y()(e))||"[object process]"!=e+""||e.browser),n.XHR=function(){for(var e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=null,i=0;i<e.length;i++){try{t=e[i]()}catch(e){continue}break}if(!t)throw Error("XMLHttpRequest is not supported");return t},n.fetch=function(e,t){if(t&&"function"!=typeof t&&(t=null),n.IS_NODE){var r=i(186);if(t)r.readFile(e,(function(e,i){t(e?null:""+i)}));else try{return r.readFileSync(e)}catch(e){return null}}else{var o=n.XHR();if(o.open("GET",e,!!t),o.setRequestHeader("Accept","text/plain"),"function"==typeof o.overrideMimeType&&o.overrideMimeType("text/plain"),!t)return o.send(null),200==o.status||0==o.status&&"string"==typeof o.responseText?o.responseText:null;o.onreadystatechange=function(){4==o.readyState&&(200==o.status||0==o.status&&"string"==typeof o.responseText?t(o.responseText):t(null))},4!=o.readyState&&o.send(null)}},n.toCamelCase=function(e){return e.replace(/_([a-zA-Z])/g,(function(e,t){return t.toUpperCase()}))},n),a.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},a.DotProto=function(e,t){function i(e,i){var r=-1,o=1;if("-"==e.charAt(0)&&(o=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))r=m()(e);else if(t.NUMBER_HEX.test(e))r=m()(e.substring(2),16);else{if(!t.NUMBER_OCT.test(e))throw Error("illegal id value: "+(0>o?"-":"")+e);r=m()(e.substring(1),8)}if(r=o*r|0,!i&&0>r)throw Error("illegal id value: "+(0>o?"-":"")+e);return r}function r(e){var i=1;if("-"==e.charAt(0)&&(i=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))return i*m()(e,10);if(t.NUMBER_HEX.test(e))return i*m()(e.substring(2),16);if(t.NUMBER_OCT.test(e))return i*m()(e.substring(1),8);if("inf"===e)return 1/0*i;if("nan"===e)return NaN;if(t.NUMBER_FLT.test(e))return i*f()(e);throw Error("illegal number value: "+(0>i?"-":"")+e)}function o(e,t,i){void 0===e[t]?e[t]=i:(g()(e[t])||(e[t]=[e[t]]),e[t].push(i))}var n={},s=function(e){this.source=e+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null};(a=s.prototype)._readString=function(){var e='"'===this._stringOpen?t.STRING_DQ:t.STRING_SQ;e.lastIndex=this.index-1;var i=e.exec(this.source);if(!i)throw Error("unterminated string");return this.index=e.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,i[1]},a.next=function(){if(0<this.stack.length)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var e,i;do{for(e=!1;t.WHITESPACE.test(i=this.source.charAt(this.index));)if("\n"===i&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,e=!0}else{if("*"!==(i=this.source.charAt(this.index)))return"/";do{if("\n"===i&&++this.line,++this.index===this.source.length)return null;e=i,i=this.source.charAt(this.index)}while("*"!==e||"/"!==i);++this.index,e=!0}}while(e);if(this.index===this.source.length)return null;if(i=this.index,t.DELIM.lastIndex=0,!t.DELIM.test(this.source.charAt(i++)))for(;i<this.source.length&&!t.DELIM.test(this.source.charAt(i));)++i;return'"'!==(i=this.source.substring(this.index,this.index=i))&&"'"!==i||(this._stringOpen=i),i},a.peek=function(){if(0===this.stack.length){var e=this.next();if(null===e)return null;this.stack.push(e)}return this.stack[0]},a.skip=function(e){var t=this.next();if(t!==e)throw Error("illegal '"+t+"', '"+e+"' expected")},a.omit=function(e){return this.peek()===e&&(this.next(),!0)},a.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},n.Tokenizer=s;var a,l=function(e){this.tn=new s(e),this.proto3=!1};return(a=l.prototype).parse=function(){var e,i,r={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},o=!0;try{for(;e=this.tn.next();)switch(e){case"package":if(!o||null!==r.package)throw Error("unexpected 'package'");if(e=this.tn.next(),!t.TYPEREF.test(e))throw Error("illegal package name: "+e);this.tn.skip(";"),r.package=e;break;case"import":if(!o)throw Error("unexpected 'import'");("public"===(e=this.tn.peek())||(i="weak"===e))&&this.tn.next(),e=this._readString(),this.tn.skip(";"),i||r.imports.push(e);break;case"syntax":if(!o)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(r.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(r,null),o=!1;break;case"enum":this._parseEnum(r),o=!1;break;case"option":this._parseOption(r);break;case"service":this._parseService(r);break;case"extend":this._parseExtend(r);break;default:throw Error("unexpected '"+e+"'")}}catch(e){throw e.message="Parse error at line "+this.tn.line+": "+e.message,e}return delete r.name,r},l.parse=function(e){return new l(e).parse()},a._readString=function(){var e,t="";do{if("'"!==(e=this.tn.next())&&'"'!==e)throw Error("illegal string delimiter: "+e);t+=this.tn.next(),this.tn.skip(e),e=this.tn.peek()}while('"'===e||'"'===e);return t},a._readValue=function(e){var i=this.tn.peek();if('"'===i||"'"===i)return this._readString();if(this.tn.next(),t.NUMBER.test(i))return r(i);if(t.BOOL.test(i))return"true"===i.toLowerCase();if(e&&t.TYPEREF.test(i))return i;throw Error("illegal value: "+i)},a._parseOption=function(e,i){var r=this.tn.next(),o=!1;if("("===r&&(o=!0,r=this.tn.next()),!t.TYPEREF.test(r))throw Error("illegal option name: "+r);var n=r;o&&(this.tn.skip(")"),n="("+n+")",r=this.tn.peek(),t.FQTYPEREF.test(r)&&(n+=r,this.tn.next())),this.tn.skip("="),this._parseOptionValue(e,n),i||this.tn.skip(";")},a._parseOptionValue=function(e,i){var r=this.tn.peek();if("{"!==r)o(e.options,i,this._readValue(!0));else for(this.tn.skip("{");"}"!==(r=this.tn.next());){if(!t.NAME.test(r))throw Error("illegal option name: "+i+"."+r);this.tn.omit(":")?o(e.options,i+"."+r,this._readValue(!0)):this._parseOptionValue(e,i+"."+r)}},a._parseService=function(e){var i=this.tn.next();if(!t.NAME.test(i))throw Error("illegal service name at line "+this.tn.line+": "+i);var r={name:i,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(i=this.tn.next());)if("option"===i)this._parseOption(r);else{if("rpc"!==i)throw Error("illegal service token: "+i);this._parseServiceRPC(r)}this.tn.omit(";"),e.services.push(r)},a._parseServiceRPC=function(e){var i=this.tn.next();if(!t.NAME.test(i))throw Error("illegal rpc service method name: "+i);var r=i,o={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),"stream"===(i=this.tn.next()).toLowerCase()&&(o.request_stream=!0,i=this.tn.next()),!t.TYPEREF.test(i))throw Error("illegal rpc service request type: "+i);if(o.request=i,this.tn.skip(")"),"returns"!==(i=this.tn.next()).toLowerCase())throw Error("illegal rpc service request type delimiter: "+i);if(this.tn.skip("("),"stream"===(i=this.tn.next()).toLowerCase()&&(o.response_stream=!0,i=this.tn.next()),o.response=i,this.tn.skip(")"),"{"===(i=this.tn.peek())){for(this.tn.next();"}"!==(i=this.tn.next());){if("option"!==i)throw Error("illegal rpc service token: "+i);this._parseOption(o)}this.tn.omit(";")}else this.tn.skip(";");void 0===e.rpc&&(e.rpc={}),e.rpc[r]=o},a._parseMessage=function(e,r){var o=!!r,n=this.tn.next(),s={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!t.NAME.test(n))throw Error("illegal "+(o?"group":"message")+" name: "+n);for(s.name=n,o&&(this.tn.skip("="),r.id=i(this.tn.next()),s.isGroup=!0),"["===(n=this.tn.peek())&&r&&this._parseFieldOptions(r),this.tn.skip("{");"}"!==(n=this.tn.next());)if(t.RULE.test(n))this._parseMessageField(s,n);else if("oneof"===n)this._parseMessageOneOf(s);else if("enum"===n)this._parseEnum(s);else if("message"===n)this._parseMessage(s);else if("option"===n)this._parseOption(s);else if("service"===n)this._parseService(s);else if("extensions"===n)s.hasOwnProperty("extensions")?s.extensions=s.extensions.concat(this._parseExtensionRanges()):s.extensions=this._parseExtensionRanges();else if("reserved"===n)this._parseIgnored();else if("extend"===n)this._parseExtend(s);else{if(!t.TYPEREF.test(n))throw Error("illegal message token: "+n);if(!this.proto3)throw Error("illegal field rule: "+n);this._parseMessageField(s,"optional",n)}return this.tn.omit(";"),e.messages.push(s),s},a._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},a._parseMessageField=function(e,r,o){if(!t.RULE.test(r))throw Error("illegal message field rule: "+r);var n={rule:r,type:"",name:"",options:{},id:0};if("map"===r){if(o)throw Error("illegal type: "+o);if(this.tn.skip("<"),r=this.tn.next(),!t.TYPE.test(r)&&!t.TYPEREF.test(r))throw Error("illegal message field type: "+r);if(n.keytype=r,this.tn.skip(","),r=this.tn.next(),!t.TYPE.test(r)&&!t.TYPEREF.test(r))throw Error("illegal message field: "+r);if(n.type=r,this.tn.skip(">"),r=this.tn.next(),!t.NAME.test(r))throw Error("illegal message field name: "+r);n.name=r,this.tn.skip("="),n.id=i(this.tn.next()),"["===(r=this.tn.peek())&&this._parseFieldOptions(n),this.tn.skip(";")}else if("group"===(o=void 0!==o?o:this.tn.next())){if(r=this._parseMessage(e,n),!/^[A-Z]/.test(r.name))throw Error("illegal group name: "+r.name);n.type=r.name,n.name=r.name.toLowerCase(),this.tn.omit(";")}else{if(!t.TYPE.test(o)&&!t.TYPEREF.test(o))throw Error("illegal message field type: "+o);if(n.type=o,r=this.tn.next(),!t.NAME.test(r))throw Error("illegal message field name: "+r);n.name=r,this.tn.skip("="),n.id=i(this.tn.next()),"["===(r=this.tn.peek())&&this._parseFieldOptions(n),this.tn.skip(";")}return e.fields.push(n),n},a._parseMessageOneOf=function(e){var i=this.tn.next();if(!t.NAME.test(i))throw Error("illegal oneof name: "+i);var r=i,o=[];for(this.tn.skip("{");"}"!==(i=this.tn.next());)(i=this._parseMessageField(e,"optional",i)).oneof=r,o.push(i.id);this.tn.omit(";"),e.oneofs[r]=o},a._parseFieldOptions=function(e){this.tn.skip("[");for(var t=!0;"]"!==this.tn.peek();)t||this.tn.skip(","),this._parseOption(e,!0),t=!1;this.tn.next()},a._parseEnum=function(e){var r={name:"",values:[],options:{}},o=this.tn.next();if(!t.NAME.test(o))throw Error("illegal name: "+o);for(r.name=o,this.tn.skip("{");"}"!==(o=this.tn.next());)if("option"===o)this._parseOption(r);else{if(!t.NAME.test(o))throw Error("illegal name: "+o);this.tn.skip("=");var n={name:o,id:i(this.tn.next(),!0)};"["===(o=this.tn.peek())&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),r.values.push(n)}this.tn.omit(";"),e.enums.push(r)},a._parseExtensionRanges=function(){var t,i,o=[];do{for(i=[];;){switch(t=this.tn.next()){case"min":t=e.ID_MIN;break;case"max":t=e.ID_MAX;break;default:t=r(t)}if(i.push(t),2===i.length)break;if("to"!==this.tn.peek()){i.push(t);break}this.tn.next()}o.push(i)}while(this.tn.omit(","));return this.tn.skip(";"),o},a._parseExtend=function(e){var i=this.tn.next();if(!t.TYPEREF.test(i))throw Error("illegal extend reference: "+i);var r={ref:i,fields:[]};for(this.tn.skip("{");"}"!==(i=this.tn.next());)if(t.RULE.test(i))this._parseMessageField(r,i);else{if(!t.TYPEREF.test(i))throw Error("illegal extend token: "+i);if(!this.proto3)throw Error("illegal field rule: "+i);this._parseMessageField(r,"optional",i)}return this.tn.omit(";"),e.messages.push(r),r},a.toString=function(){return"Parser at line "+this.tn.line},n.Parser=l,n}(a,a.Lang),a.Reflect=function(e){function i(t,i){if(t&&"number"==typeof t.low&&"number"==typeof t.high&&"boolean"==typeof t.unsigned&&t.low==t.low&&t.high==t.high)return new e.Long(t.low,t.high,void 0===i?t.unsigned:i);if("string"==typeof t)return e.Long.fromString(t,i||!1,10);if("number"==typeof t)return e.Long.fromNumber(t,i||!1);throw Error("not convertible to Long")}function r(t,i){var o=7&(n=i.readVarint32()),n=n>>>3;switch(o){case e.WIRE_TYPES.VARINT:do{n=i.readUint8()}while(128==(128&n));break;case e.WIRE_TYPES.BITS64:i.offset+=8;break;case e.WIRE_TYPES.LDELIM:n=i.readVarint32(),i.offset+=n;break;case e.WIRE_TYPES.STARTGROUP:r(n,i);break;case e.WIRE_TYPES.ENDGROUP:if(n===t)return!1;throw Error("Illegal GROUPEND after unknown group: "+n+" ("+t+" expected)");case e.WIRE_TYPES.BITS32:i.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+t+": "+o)}return!0}var n={},a=function(e,t,i){this.builder=e,this.parent=t,this.name=i};(u=a.prototype).fqn=function(){for(var e=this.name,t=this;;){if(null==(t=t.parent))break;e=t.name+"."+e}return e},u.toString=function(e){return(e?this.className+" ":"")+this.fqn()},u.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},n.T=a;var u,c=function(e,t,i,r,o){a.call(this,e,t,i),this.className="Namespace",this.children=[],this.options=r||{},this.syntax=o||"proto2"};(u=c.prototype=h()(a.prototype)).getChildren=function(e){if(null==(e=e||null))return this.children.slice();for(var t=[],i=0,r=this.children.length;i<r;++i)this.children[i]instanceof e&&t.push(this.children[i]);return t},u.addChild=function(e){var t;if(t=this.getChild(e.name))if(t instanceof d.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName))t.name=t.originalName;else{if(!(e instanceof d.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+e.name);e.name=e.originalName}this.children.push(e)},u.getChild=function(e){for(var t="number"==typeof e?"id":"name",i=0,r=this.children.length;i<r;++i)if(this.children[i][t]===e)return this.children[i];return null},u.resolve=function(e,t){var i="string"==typeof e?e.split("."):e,r=this,o=0;if(""===i[o]){for(;null!==r.parent;)r=r.parent;o++}do{do{if(!(r instanceof n.Namespace)){r=null;break}if(!((r=r.getChild(i[o]))&&r instanceof n.T)||t&&!(r instanceof n.Namespace)){r=null;break}o++}while(o<i.length);if(null!=r)break;if(null!==this.parent)return this.parent.resolve(e,t)}while(null!=r);return r},u.qn=function(e){var t=[],i=e;do{t.unshift(i.name),i=i.parent}while(null!==i);for(i=1;i<=t.length;i++){var r=t.slice(t.length-i);if(e===this.resolve(r,e instanceof n.Namespace))return r.join(".")}return e.fqn()},u.build=function(){for(var e,t={},i=this.children,r=0,o=i.length;r<o;++r)(e=i[r])instanceof c&&(t[e.name]=e.build());return l.a&&l()(t,"$options",{value:this.buildOpt()}),t},u.buildOpt=function(){for(var e={},t=s()(this.options),i=0,r=t.length;i<r;++i)e[t[i]]=this.options[t[i]];return e},u.getOption=function(e){return void 0===e?this.options:void 0!==this.options[e]?this.options[e]:null},n.Namespace=c;var p=function(t,i,r,o,n){if(this.type=t,this.resolvedType=i,this.isMapKey=r,this.syntax=o,this.name=n,r&&0>e.MAP_KEY_TYPES.indexOf(t))throw Error("Invalid map key type: "+t.name)},f=p.prototype;p.defaultFieldValue=function(i){if("string"==typeof i&&(i=e.TYPES[i]),void 0===i.defaultValue)throw Error("default value for type "+i.name+" is not supported");return i==e.TYPES.bytes?new t(0):i.defaultValue},f.toString=function(){return(this.name||"")+(this.isMapKey?"map":"value")+" element"},f.verifyValue=function(r){function o(e,t){throw Error("Illegal value for "+n.toString(!0)+" of type "+n.type.name+": "+e+" ("+t+")")}var n=this;switch(this.type){case e.TYPES.int32:case e.TYPES.sint32:case e.TYPES.sfixed32:return("number"!=typeof r||r==r&&0!=r%1)&&o(y()(r),"not an integer"),4294967295<r?0|r:r;case e.TYPES.uint32:case e.TYPES.fixed32:return("number"!=typeof r||r==r&&0!=r%1)&&o(y()(r),"not an integer"),0>r?r>>>0:r;case e.TYPES.int64:case e.TYPES.sint64:case e.TYPES.sfixed64:if(e.Long)try{return i(r,!1)}catch(e){o(y()(r),e.message)}else o(y()(r),"requires Long.js");case e.TYPES.uint64:case e.TYPES.fixed64:if(e.Long)try{return i(r,!0)}catch(e){o(y()(r),e.message)}else o(y()(r),"requires Long.js");case e.TYPES.bool:return"boolean"!=typeof r&&o(y()(r),"not a boolean"),r;case e.TYPES.float:case e.TYPES.double:return"number"!=typeof r&&o(y()(r),"not a number"),r;case e.TYPES.string:return"string"==typeof r||r&&r instanceof String||o(y()(r),"not a string"),""+r;case e.TYPES.bytes:return t.isByteBuffer(r)?r:t.wrap(r,"base64");case e.TYPES.enum:for(var s=this.resolvedType.getChildren(e.Reflect.Enum.Value),a=0;a<s.length;a++)if(s[a].name==r||s[a].id==r)return s[a].id;if("proto3"===this.syntax)return("number"!=typeof r||r==r&&0!=r%1)&&o(y()(r),"not an integer"),(4294967295<r||0>r)&&o(y()(r),"not in range for uint32"),r;o(r,"not a valid enum value");case e.TYPES.group:case e.TYPES.message:if(r&&"object"===y()(r)||o(y()(r),"object expected"),r instanceof this.resolvedType.clazz)return r;if(r instanceof e.Builder.Message){s={};for(a in r)r.hasOwnProperty(a)&&(s[a]=r[a]);r=s}return new this.resolvedType.clazz(r)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+r+" (undefined type "+this.type+")")},f.calculateLength=function(i,r){if(null===r)return 0;var o;switch(this.type){case e.TYPES.int32:return 0>r?t.calculateVarint64(r):t.calculateVarint32(r);case e.TYPES.uint32:return t.calculateVarint32(r);case e.TYPES.sint32:return t.calculateVarint32(t.zigZagEncode32(r));case e.TYPES.fixed32:case e.TYPES.sfixed32:case e.TYPES.float:return 4;case e.TYPES.int64:case e.TYPES.uint64:return t.calculateVarint64(r);case e.TYPES.sint64:return t.calculateVarint64(t.zigZagEncode64(r));case e.TYPES.fixed64:case e.TYPES.sfixed64:return 8;case e.TYPES.bool:return 1;case e.TYPES.enum:return t.calculateVarint32(r);case e.TYPES.double:return 8;case e.TYPES.string:return o=t.calculateUTF8Bytes(r),t.calculateVarint32(o)+o;case e.TYPES.bytes:if(0>r.remaining())throw Error("Illegal value for "+this.toString(!0)+": "+r.remaining()+" bytes remaining");return t.calculateVarint32(r.remaining())+r.remaining();case e.TYPES.message:return o=this.resolvedType.calculate(r),t.calculateVarint32(o)+o;case e.TYPES.group:return(o=this.resolvedType.calculate(r))+t.calculateVarint32(i<<3|e.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+r+" (unknown type)")},f.encodeValue=function(i,r,o){if(null===r)return o;switch(this.type){case e.TYPES.int32:0>r?o.writeVarint64(r):o.writeVarint32(r);break;case e.TYPES.uint32:o.writeVarint32(r);break;case e.TYPES.sint32:o.writeVarint32ZigZag(r);break;case e.TYPES.fixed32:o.writeUint32(r);break;case e.TYPES.sfixed32:o.writeInt32(r);break;case e.TYPES.int64:case e.TYPES.uint64:o.writeVarint64(r);break;case e.TYPES.sint64:o.writeVarint64ZigZag(r);break;case e.TYPES.fixed64:o.writeUint64(r);break;case e.TYPES.sfixed64:o.writeInt64(r);break;case e.TYPES.bool:"string"==typeof r?o.writeVarint32("false"===r.toLowerCase()?0:!!r):o.writeVarint32(r?1:0);break;case e.TYPES.enum:o.writeVarint32(r);break;case e.TYPES.float:o.writeFloat32(r);break;case e.TYPES.double:o.writeFloat64(r);break;case e.TYPES.string:o.writeVString(r);break;case e.TYPES.bytes:if(0>r.remaining())throw Error("Illegal value for "+this.toString(!0)+": "+r.remaining()+" bytes remaining");i=r.offset,o.writeVarint32(r.remaining()),o.append(r),r.offset=i;break;case e.TYPES.message:i=(new t).LE(),this.resolvedType.encode(r,i),o.writeVarint32(i.offset),o.append(i.flip());break;case e.TYPES.group:this.resolvedType.encode(r,o),o.writeVarint32(i<<3|e.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+r+" (unknown type)")}return o},f.decode=function(t,i,r){if(i!=this.type.wireType)throw Error("Unexpected wire type for element");switch(this.type){case e.TYPES.int32:return 0|t.readVarint32();case e.TYPES.uint32:return t.readVarint32()>>>0;case e.TYPES.sint32:return 0|t.readVarint32ZigZag();case e.TYPES.fixed32:return t.readUint32()>>>0;case e.TYPES.sfixed32:return 0|t.readInt32();case e.TYPES.int64:return t.readVarint64();case e.TYPES.uint64:return t.readVarint64().toUnsigned();case e.TYPES.sint64:return t.readVarint64ZigZag();case e.TYPES.fixed64:return t.readUint64();case e.TYPES.sfixed64:return t.readInt64();case e.TYPES.bool:return!!t.readVarint32();case e.TYPES.enum:return t.readVarint32();case e.TYPES.float:return t.readFloat();case e.TYPES.double:return t.readDouble();case e.TYPES.string:return t.readVString();case e.TYPES.bytes:if(r=t.readVarint32(),t.remaining()<r)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+r+" required but got only "+t.remaining());return(i=t.clone()).limit=i.offset+r,t.offset+=r,i;case e.TYPES.message:return r=t.readVarint32(),this.resolvedType.decode(t,r);case e.TYPES.group:return this.resolvedType.decode(t,-1,r)}throw Error("[INTERNAL] Illegal decode type")},f.valueFromString=function(i){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case e.TYPES.int32:case e.TYPES.sint32:case e.TYPES.sfixed32:case e.TYPES.uint32:case e.TYPES.fixed32:return this.verifyValue(m()(i));case e.TYPES.int64:case e.TYPES.sint64:case e.TYPES.sfixed64:case e.TYPES.uint64:case e.TYPES.fixed64:return this.verifyValue(i);case e.TYPES.bool:return"true"===i;case e.TYPES.string:return this.verifyValue(i);case e.TYPES.bytes:return t.fromBinary(i)}},f.valueToString=function(t){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===e.TYPES.bytes?t.toString("binary"):t.toString()},n.Element=p;var d=function(e,t,i,r,o,n){c.call(this,e,t,i,r,n),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!o,this._fieldsByName=this._fieldsById=this._fields=null};(f=d.prototype=h()(c.prototype)).build=function(i){if(this.clazz&&!i)return this.clazz;i=function(e,i){function r(i,o,n,s){if(null===i||"object"!==y()(i)){if(s&&s instanceof e.Reflect.Enum)if(null!==(h=e.Reflect.Enum.getName(s.object,i)))return h;return i}if(t.isByteBuffer(i))return o?i.toBase64():i.toBuffer();if(e.Long.isLong(i))return n?i.toString():e.Long.fromValue(i);var a;if(g()(i))return a=[],i.forEach((function(e,t){a[t]=r(e,o,n,s)})),a;if(a={},i instanceof e.Map){for(var l=(h=i.entries()).next();!l.done;l=h.next())a[i.keyElem.valueToString(l.value[0])]=r(l.value[1],o,n,i.valueElem.resolvedType);return a}var u,h=i.$type;l=void 0;for(u in i)i.hasOwnProperty(u)&&(h&&(l=h.getChild(u))?a[u]=r(i[u],o,n,l.resolvedType):a[u]=r(i[u],o,n));return a}var n=i.getChildren(e.Reflect.Message.Field),s=i.getChildren(e.Reflect.Message.OneOf),a=function r(o,a){e.Builder.Message.call(this);for(var l=0,u=s.length;l<u;++l)this[s[l].name]=null;for(l=0,u=n.length;l<u;++l){var h=n[l];this[h.name]=h.repeated?[]:h.map?new e.Map(h):null,!h.required&&"proto3"!==i.syntax||null===h.defaultValue||(this[h.name]=h.defaultValue)}if(0<arguments.length)if(1!==arguments.length||null===o||"object"!==y()(o)||!("function"!=typeof o.encode||o instanceof r)||g()(o)||o instanceof e.Map||t.isByteBuffer(o)||o instanceof ArrayBuffer||e.Long&&o instanceof e.Long)for(l=0,u=arguments.length;l<u;++l)void 0!==(h=arguments[l])&&this.$set(n[l].name,h);else this.$set(o)},u=a.prototype=h()(e.Builder.Message.prototype);u.add=function(t,r,o){var n=i._fieldsByName[t];if(!o){if(!n)throw Error(this+"#"+t+" is undefined");if(!(n instanceof e.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+n.toString(!0));if(!n.repeated)throw Error(this+"#"+t+" is not a repeated field");r=n.verifyValue(r,!0)}return null===this[t]&&(this[t]=[]),this[t].push(r),this},u.$add=u.add,u.set=function(t,r,o){if(t&&"object"===y()(t)){for(var n in o=r,t)t.hasOwnProperty(n)&&void 0!==(r=t[n])&&this.$set(n,r,o);return this}if(n=i._fieldsByName[t],o)this[t]=r;else{if(!n)throw Error(this+"#"+t+" is not a field: undefined");if(!(n instanceof e.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+n.toString(!0));this[n.name]=r=n.verifyValue(r)}return n&&n.oneof&&(o=this[n.oneof.name],null!==r?(null!==o&&o!==n.name&&(this[o]=null),this[n.oneof.name]=n.name):o===t&&(this[n.oneof.name]=null)),this},u.$set=u.set,u.get=function(t,r){if(r)return this[t];var o=i._fieldsByName[t];if(!(o&&o instanceof e.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: undefined");if(!(o instanceof e.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+o.toString(!0));return this[o.name]},u.$get=u.get;for(var c=0;c<n.length;c++){var p=n[c];p instanceof e.Reflect.Message.ExtensionField||i.builder.options.populateAccessors&&function(e){var t=(t=e.originalName.replace(/(_[a-zA-Z])/g,(function(e){return e.toUpperCase().replace("_","")}))).substring(0,1).toUpperCase()+t.substring(1),r=e.originalName.replace(/([A-Z])/g,(function(e){return"_"+e})),o=function(t,i){return this[e.name]=i?t:e.verifyValue(t),this},n=function(){return this[e.name]};null===i.getChild("set"+t)&&(u["set"+t]=o),null===i.getChild("set_"+r)&&(u["set_"+r]=o),null===i.getChild("get"+t)&&(u["get"+t]=n),null===i.getChild("get_"+r)&&(u["get_"+r]=n)}(p)}return u.encode=function(e,r){"boolean"==typeof e&&(r=e,e=void 0);var o=!1;e||(e=new t,o=!0);var n=e.littleEndian;try{return i.encode(this,e.LE(),r),(o?e.flip():e).LE(n)}catch(t){throw e.LE(n),t}},a.encode=function(e,t,i){return new a(e).encode(t,i)},u.calculate=function(){return i.calculate(this)},u.encodeDelimited=function(e,r){var o=!1;e||(e=new t,o=!0);var n=(new t).LE();return i.encode(this,n,r).flip(),e.writeVarint32(n.remaining()),e.append(n),o?e.flip():e},u.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},u.toArrayBuffer=u.encodeAB,u.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},u.toBuffer=u.encodeNB,u.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},u.toBase64=u.encode64,u.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},u.toHex=u.encodeHex,u.toRaw=function(e,t){return r(this,!!e,!!t,this.$type)},u.encodeJSON=function(){return o()(r(this,!0,!0,this.$type))},a.decode=function(e,r,o){"string"==typeof r&&(o=r,r=-1),"string"==typeof e?e=t.wrap(e,o||"base64"):t.isByteBuffer(e)||(e=t.wrap(e)),o=e.littleEndian;try{var n=i.decode(e.LE(),r);return e.LE(o),n}catch(t){throw e.LE(o),t}},a.decodeDelimited=function(e,r){if("string"==typeof e?e=t.wrap(e,r||"base64"):t.isByteBuffer(e)||(e=t.wrap(e)),1>e.remaining())return null;var o=e.offset,n=e.readVarint32();if(e.remaining()<n)return e.offset=o,null;try{var s=i.decode(e.slice(e.offset,e.offset+n).LE());return e.offset+=n,s}catch(t){throw e.offset+=n,t}},a.decode64=function(e){return a.decode(e,"base64")},a.decodeHex=function(e){return a.decode(e,"hex")},a.decodeJSON=function(e){return new a(JSON.parse(e))},u.toString=function(){return i.toString()},l.a&&(l()(a,"$options",{value:i.buildOpt()}),l()(u,"$options",{value:a.$options}),l()(a,"$type",{value:i}),l()(u,"$type",{value:i})),a}(e,this),this._fields=[],this._fieldsById={},this._fieldsByName={};for(var r,n=0,s=this.children.length;n<s;n++)if((r=this.children[n])instanceof v||r instanceof d||r instanceof _){if(i.hasOwnProperty(r.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+r.toString(!0)+" cannot override static property '"+r.name+"'");i[r.name]=r.build()}else if(r instanceof d.Field)r.build(),this._fields.push(r),this._fieldsById[r.id]=r,this._fieldsByName[r.name]=r;else if(!(r instanceof d.OneOf||r instanceof A))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[n].toString(!0));return this.clazz=i},f.encode=function(e,t,i){for(var r,o,n=null,s=0,a=this._fields.length;s<a;++s)o=e[(r=this._fields[s]).name],r.required&&null===o?null===n&&(n=r):r.encode(i?o:r.verifyValue(o),t,e);if(null!==n)throw(e=Error("Missing at least one required field for "+this.toString(!0)+": "+n)).encoded=t,e;return t},f.calculate=function(e){for(var t,i,r=0,o=0,n=this._fields.length;o<n;++o){if(i=e[(t=this._fields[o]).name],t.required&&null===i)throw Error("Missing at least one required field for "+this.toString(!0)+": "+t);r+=t.calculate(i,e)}return r},f.decode=function(t,i,o){"number"!=typeof i&&(i=-1);for(var n,s,a,l=t.offset,u=new this.clazz;t.offset<l+i||-1===i&&0<t.remaining();){if(a=(n=t.readVarint32())>>>3,(s=7&n)===e.WIRE_TYPES.ENDGROUP){if(a!==o)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+a+" ("+(o?o+" expected":"not a group")+")");break}if(n=this._fieldsById[a])n.repeated&&!n.options.packed?u[n.name].push(n.decode(s,t)):n.map?(s=n.decode(s,t),u[n.name].set(s[0],s[1])):(u[n.name]=n.decode(s,t),n.oneof&&(null!==(s=u[n.oneof.name])&&s!==n.name&&(u[s]=null),u[n.oneof.name]=n.name));else switch(s){case e.WIRE_TYPES.VARINT:t.readVarint32();break;case e.WIRE_TYPES.BITS32:t.offset+=4;break;case e.WIRE_TYPES.BITS64:t.offset+=8;break;case e.WIRE_TYPES.LDELIM:n=t.readVarint32(),t.offset+=n;break;case e.WIRE_TYPES.STARTGROUP:for(;r(a,t););break;default:throw Error("Illegal wire type for unknown field "+a+" in "+this.toString(!0)+"#decode: "+s)}}for(t=0,i=this._fields.length;t<i;++t)if(null===u[(n=this._fields[t]).name])if("proto3"===this.syntax)u[n.name]=n.defaultValue;else{if(n.required)throw(t=Error("Missing at least one required field for "+this.toString(!0)+": "+n.name)).decoded=u,t;e.populateDefaults&&null!==n.defaultValue&&(u[n.name]=n.defaultValue)}return u},n.Message=d;var C=function(t,i,r,o,n,s,l,u,h,c){a.call(this,t,i,s),this.className="Message.Field",this.required="required"===r,this.repeated="repeated"===r,this.map="map"===r,this.keyType=o||null,this.type=n,this.resolvedType=null,this.id=l,this.options=u||{},this.defaultValue=null,this.oneof=h||null,this.syntax=c||"proto2",this.originalName=this.name,this.keyElement=this.element=null,!this.builder.options.convertFieldsToCamelCase||this instanceof d.ExtensionField||(this.name=e.Util.toCamelCase(this.name))};(f=C.prototype=h()(a.prototype)).build=function(){this.element=new p(this.type,this.resolvedType,!1,this.syntax,this.name),this.map&&(this.keyElement=new p(this.keyType,void 0,!0,this.syntax,this.name)),"proto3"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=p.defaultFieldValue(this.type)},f.verifyValue=function(t,i){function r(e,t){throw Error("Illegal value for "+n.toString(!0)+" of type "+n.type.name+": "+e+" ("+t+")")}i=i||!1;var o,n=this;if(null===t)return this.required&&r(y()(t),"required"),"proto3"===this.syntax&&this.type!==e.TYPES.message&&r(y()(t),"proto3 field without field presence cannot be null"),null;if(this.repeated&&!i){g()(t)||(t=[t]);var s=[];for(o=0;o<t.length;o++)s.push(this.element.verifyValue(t[o]));return s}return this.map&&!i?t instanceof e.Map?t:(t instanceof Object||r(y()(t),"expected ProtoBuf.Map or raw object for map field"),new e.Map(this,t)):(!this.repeated&&g()(t)&&r(y()(t),"no array expected"),this.element.verifyValue(t))},f.hasWirePresence=function(t,i){if("proto3"!==this.syntax)return null!==t;if(this.oneof&&i[this.oneof.name]===this.name)return!0;switch(this.type){case e.TYPES.int32:case e.TYPES.sint32:case e.TYPES.sfixed32:case e.TYPES.uint32:case e.TYPES.fixed32:return 0!==t;case e.TYPES.int64:case e.TYPES.sint64:case e.TYPES.sfixed64:case e.TYPES.uint64:case e.TYPES.fixed64:return 0!==t.low||0!==t.high;case e.TYPES.bool:return t;case e.TYPES.float:case e.TYPES.double:return 0!==t;case e.TYPES.string:return 0<t.length;case e.TYPES.bytes:return 0<t.remaining();case e.TYPES.enum:return 0!==t;case e.TYPES.message:return null!==t;default:return!0}},f.encode=function(i,r,o){if(null===this.type||"object"!==y()(this.type))throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===i||this.repeated&&0==i.length)return r;try{var n;if(this.repeated)if(this.options.packed&&0<=e.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){r.writeVarint32(this.id<<3|e.WIRE_TYPES.LDELIM),r.ensureCapacity(r.offset+=1);var s=r.offset;for(n=0;n<i.length;n++)this.element.encodeValue(this.id,i[n],r);var a=r.offset-s,l=t.calculateVarint32(a);if(1<l){var u=r.slice(s,r.offset);s=s+(l-1);r.offset=s,r.append(u)}r.writeVarint32(a,s-l)}else for(n=0;n<i.length;n++)r.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,i[n],r);else this.map?i.forEach((function(i,o,n){n=t.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,o)+t.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,i),r.writeVarint32(this.id<<3|e.WIRE_TYPES.LDELIM),r.writeVarint32(n),r.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,o,r),r.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,i,r)}),this):this.hasWirePresence(i,o)&&(r.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,i,r))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+i+" ("+e+")")}return r},f.calculate=function(i,r){if(i=this.verifyValue(i),null===this.type||"object"!==y()(this.type))throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===i||this.repeated&&0==i.length)return 0;var o=0;try{var n,s;if(this.repeated)if(this.options.packed&&0<=e.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){for(o+=t.calculateVarint32(this.id<<3|e.WIRE_TYPES.LDELIM),n=s=0;n<i.length;n++)s+=this.element.calculateLength(this.id,i[n]);o+=t.calculateVarint32(s),o+=s}else for(n=0;n<i.length;n++)o+=t.calculateVarint32(this.id<<3|this.type.wireType),o+=this.element.calculateLength(this.id,i[n]);else this.map?i.forEach((function(i,r,n){i=t.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,r)+t.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,i),o+=t.calculateVarint32(this.id<<3|e.WIRE_TYPES.LDELIM),o+=t.calculateVarint32(i),o+=i}),this):this.hasWirePresence(i,r)&&(o+=t.calculateVarint32(this.id<<3|this.type.wireType),o+=this.element.calculateLength(this.id,i))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+i+" ("+e+")")}return o},f.decode=function(t,i,r){if(!(!this.map&&t==this.type.wireType||!r&&this.repeated&&this.options.packed&&t==e.WIRE_TYPES.LDELIM||this.map&&t==e.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+t+" ("+this.type.wireType+" expected)");if(t==e.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&0<=e.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)&&!r){for(t=i.readVarint32(),t=i.offset+t,r=[];i.offset<t;)r.push(this.decode(this.type.wireType,i,!0));return r}if(this.map){var o=p.defaultFieldValue(this.keyType);if(r=p.defaultFieldValue(this.type),t=i.readVarint32(),i.remaining()<t)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+t+" required but got only "+i.remaining());var n=i.clone();for(n.limit=n.offset+t,i.offset+=t;0<n.remaining();)if(t=7&(i=n.readVarint32()),1===(i>>>=3))o=this.keyElement.decode(n,t,i);else{if(2!==i)throw Error("Unexpected tag in map field key/value submessage");r=this.element.decode(n,t,i)}return[o,r]}return this.element.decode(i,t,this.id)},n.Message.Field=C,(f=function(e,t,i,r,o,n,s){C.call(this,e,t,i,null,r,o,n,s)}).prototype=h()(C.prototype),n.Message.ExtensionField=f,n.Message.OneOf=function(e,t,i){a.call(this,e,t,i),this.fields=[]};var v=function(e,t,i,r,o){c.call(this,e,t,i,r,o),this.className="Enum",this.object=null};v.getName=function(e,t){for(var i,r=s()(e),o=0;o<r.length;++o)if(e[i=r[o]]===t)return i;return null},(v.prototype=h()(c.prototype)).build=function(t){if(this.object&&!t)return this.object;t=new e.Builder.Enum;for(var i=this.getChildren(v.Value),r=0,o=i.length;r<o;++r)t[i[r].name]=i[r].id;return l.a&&l()(t,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=t},n.Enum=v,(f=function(e,t,i,r){a.call(this,e,t,i),this.className="Enum.Value",this.id=r}).prototype=h()(a.prototype),n.Enum.Value=f;var A=function(e,t,i,r){a.call(this,e,t,i),this.field=r};A.prototype=h()(a.prototype),n.Extension=A;var _=function(e,t,i,r){c.call(this,e,t,i,r),this.className="Service",this.clazz=null};(_.prototype=h()(c.prototype)).build=function(i){return this.clazz&&!i?this.clazz:this.clazz=function(e,i){for(var r=function(t){e.Builder.Service.call(this),this.rpcImpl=t||function(e,t,i){setTimeout(i.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},o=r.prototype=h()(e.Builder.Service.prototype),n=i.getChildren(e.Reflect.Service.RPCMethod),s=0;s<n.length;s++)!function(e){o[e.name]=function(r,o){try{try{r=e.resolvedRequestType.clazz.decode(t.wrap(r))}catch(e){if(!(e instanceof TypeError))throw e}if(null===r||"object"!==y()(r))throw Error("Illegal arguments");r instanceof e.resolvedRequestType.clazz||(r=new e.resolvedRequestType.clazz(r)),this.rpcImpl(e.fqn(),r,(function(t,r){if(t)o(t);else{null===r&&(r="");try{r=e.resolvedResponseType.clazz.decode(r)}catch(e){}r&&r instanceof e.resolvedResponseType.clazz?o(null,r):o(Error("Illegal response type received in service method "+i.name+"#"+e.name))}}))}catch(e){setTimeout(o.bind(this,e),0)}},r[e.name]=function(t,i,o){new r(t)[e.name](i,o)},l.a&&(l()(r[e.name],"$options",{value:e.buildOpt()}),l()(o[e.name],"$options",{value:r[e.name].$options}))}(n[s]);return l.a&&(l()(r,"$options",{value:i.buildOpt()}),l()(o,"$options",{value:r.$options}),l()(r,"$type",{value:i}),l()(o,"$type",{value:i})),r}(e,this)},n.Service=_;var I=function(e,t,i,r){a.call(this,e,t,i),this.className="Service.Method",this.options=r||{}};return(I.prototype=h()(a.prototype)).buildOpt=u.buildOpt,n.Service.Method=I,(u=function(e,t,i,r,o,n,s,a){I.call(this,e,t,i,a),this.className="Service.RPCMethod",this.requestName=r,this.responseName=o,this.requestStream=n,this.responseStream=s,this.resolvedResponseType=this.resolvedRequestType=null}).prototype=h()(I.prototype),n.Service.RPCMethod=u,n}(a),a.Builder=function(e,t,r){var n=function(e){this.ptr=this.ns=new r.Namespace(this,null,""),this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=e||{}},a=n.prototype;return n.isMessage=function(e){return"string"==typeof e.name&&void 0===e.values&&void 0===e.rpc},n.isMessageField=function(e){return"string"==typeof e.rule&&"string"==typeof e.name&&"string"==typeof e.type&&void 0!==e.id},n.isEnum=function(e){return!("string"!=typeof e.name||void 0===e.values||!g()(e.values)||0===e.values.length)},n.isService=function(e){return!("string"!=typeof e.name||"object"!==y()(e.rpc)||!e.rpc)},n.isExtend=function(e){return"string"==typeof e.ref},a.reset=function(){return this.ptr=this.ns,this},a.define=function(e){if("string"!=typeof e||!t.TYPEREF.test(e))throw Error("illegal namespace: "+e);return e.split(".").forEach((function(e){var t=this.ptr.getChild(e);null===t&&this.ptr.addChild(t=new r.Namespace(this,this.ptr,e)),this.ptr=t}),this),this},a.create=function(t){if(!t)return this;if(g()(t)){if(0===t.length)return this;t=t.slice()}else t=[t];for(var i=[t];0<i.length;){if(t=i.pop(),!g()(t))throw Error("not a valid namespace: "+o()(t));for(;0<t.length;){var a=t.shift();if(n.isMessage(a)){var l=new r.Message(this,this.ptr,a.name,a.options,a.isGroup,a.syntax),u={};a.oneofs&&s()(a.oneofs).forEach((function(e){l.addChild(u[e]=new r.Message.OneOf(this,l,e))}),this),a.fields&&a.fields.forEach((function(e){if(null!==l.getChild(0|e.id))throw Error("duplicate or invalid field id in "+l.name+": "+e.id);if(e.options&&"object"!==y()(e.options))throw Error("illegal field options in "+l.name+"#"+e.name);var t=null;if("string"==typeof e.oneof&&!(t=u[e.oneof]))throw Error("illegal oneof in "+l.name+"#"+e.name+": "+e.oneof);e=new r.Message.Field(this,l,e.rule,e.keytype,e.type,e.name,e.id,e.options,t,a.syntax),t&&t.fields.push(e),l.addChild(e)}),this);var h=[];if(a.enums&&a.enums.forEach((function(e){h.push(e)})),a.messages&&a.messages.forEach((function(e){h.push(e)})),a.services&&a.services.forEach((function(e){h.push(e)})),a.extensions&&(l.extensions="number"==typeof a.extensions[0]?[a.extensions]:a.extensions),this.ptr.addChild(l),0<h.length){i.push(t),t=h,h=null,this.ptr=l,l=null;continue}h=null}else if(n.isEnum(a))l=new r.Enum(this,this.ptr,a.name,a.options,a.syntax),a.values.forEach((function(e){l.addChild(new r.Enum.Value(this,l,e.name,e.id))}),this),this.ptr.addChild(l);else if(n.isService(a))l=new r.Service(this,this.ptr,a.name,a.options),s()(a.rpc).forEach((function(e){var t=a.rpc[e];l.addChild(new r.Service.RPCMethod(this,l,e,t.request,t.response,!!t.request_stream,!!t.response_stream,t.options))}),this),this.ptr.addChild(l);else{if(!n.isExtend(a))throw Error("not a valid definition: "+o()(a));if(l=this.ptr.resolve(a.ref,!0))a.fields.forEach((function(t){if(null!==l.getChild(0|t.id))throw Error("duplicate extended field id in "+l.name+": "+t.id);if(l.extensions){var i=!1;if(l.extensions.forEach((function(e){t.id>=e[0]&&t.id<=e[1]&&(i=!0)})),!i)throw Error("illegal extended field id in "+l.name+": "+t.id+" (not within valid ranges)")}var o=t.name;this.options.convertFieldsToCamelCase&&(o=e.Util.toCamelCase(o));o=new r.Message.ExtensionField(this,l,t.rule,t.type,this.ptr.fqn()+"."+o,t.id,t.options);var n=new r.Extension(this,this.ptr,t.name,o);o.extension=n,this.ptr.addChild(n),l.addChild(o)}),this);else if(!/\.?google\.protobuf\./.test(a.ref))throw Error("extended message "+a.ref+" is not defined")}l=a=null}t=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},a.import=function(t,r){var o="/";if("string"==typeof r){if(e.Util.IS_NODE&&(r=i(118).resolve(r)),!0===this.files[r])return this.reset();this.files[r]=!0}else if("object"===y()(r)){var n=r.root;if(e.Util.IS_NODE&&(n=i(118).resolve(n)),(0<=n.indexOf("\\")||0<=r.file.indexOf("\\"))&&(o="\\"),n=n+o+r.file,!0===this.files[n])return this.reset();this.files[n]=!0}if(t.imports&&0<t.imports.length){var a=!1;"object"===y()(r)?(this.importRoot=r.root,a=!0,n=this.importRoot,r=r.file,(0<=n.indexOf("\\")||0<=r.indexOf("\\"))&&(o="\\")):"string"==typeof r?this.importRoot?n=this.importRoot:0<=r.indexOf("/")?""===(n=r.replace(/\/[^\/]*$/,""))&&(n="/"):0<=r.indexOf("\\")?(n=r.replace(/\\[^\\]*$/,""),o="\\"):n=".":n=null;for(var l=0;l<t.imports.length;l++)if("string"==typeof t.imports[l]){if(!n)throw Error("cannot determine import root");var u=t.imports[l];if("google/protobuf/descriptor.proto"!==u&&(u=n+o+u,!0!==this.files[u])){/\.proto$/i.test(u)&&!e.DotProto&&(u=u.replace(/\.proto$/,".json"));var h=e.Util.fetch(u);if(null===h)throw Error("failed to import '"+u+"' in '"+r+"': file not found");/\.json$/i.test(u)?this.import(JSON.parse(h+""),u):this.import(e.DotProto.Parser.parse(h),u)}}else r?/\.(\w+)$/.test(r)?this.import(t.imports[l],r.replace(/^(.+)\.(\w+)$/,(function(e,t,i){return t+"_import"+l+"."+i}))):this.import(t.imports[l],r+"_import"+l):this.import(t.imports[l]);a&&(this.importRoot=null)}t.package&&this.define(t.package),t.syntax&&function e(t){t.messages&&t.messages.forEach((function(i){i.syntax=t.syntax,e(i)})),t.enums&&t.enums.forEach((function(e){e.syntax=t.syntax}))}(t);var c=this.ptr;return t.options&&s()(t.options).forEach((function(e){c.options[e]=t.options[e]})),t.messages&&(this.create(t.messages),this.ptr=c),t.enums&&(this.create(t.enums),this.ptr=c),t.services&&(this.create(t.services),this.ptr=c),t.extends&&this.create(t.extends),this.reset()},a.resolveAll=function(){var i;if(null==this.ptr||"object"===y()(this.ptr.type))return this;if(this.ptr instanceof r.Namespace)this.ptr.children.forEach((function(e){this.ptr=e,this.resolveAll()}),this);else if(this.ptr instanceof r.Message.Field){if(t.TYPE.test(this.ptr.type))this.ptr.type=e.TYPES[this.ptr.type];else{if(!t.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(!(i=(this.ptr instanceof r.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=i,i instanceof r.Enum){if(this.ptr.type=e.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==i.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(i instanceof r.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=i.isGroup?e.TYPES.group:e.TYPES.message}}if(this.ptr.map){if(!t.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=e.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof e.Reflect.Service.Method){if(!(this.ptr instanceof e.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(!((i=this.ptr.parent.resolve(this.ptr.requestName,!0))&&i instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=i,!((i=this.ptr.parent.resolve(this.ptr.responseName,!0))&&i instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=i}else if(!(this.ptr instanceof e.Reflect.Message.OneOf||this.ptr instanceof e.Reflect.Extension||this.ptr instanceof e.Reflect.Enum.Value))throw Error("illegal object in namespace: "+y()(this.ptr)+": "+this.ptr);return this.reset()},a.build=function(e){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!e)return this.result;e="string"==typeof e?e.split("."):e;for(var t=this.result,i=0;i<e.length;i++){if(!t[e[i]]){t=null;break}t=t[e[i]]}return t},a.lookup=function(e,t){return e?this.ns.resolve(e,t):this.ns},a.toString=function(){return"Builder"},n.Message=function(){},n.Enum=function(){},n.Service=function(){},n}(a,a.Lang,a.Reflect),a.Map=function(e,t){function i(e){var t=0;return{next:function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}}var r=function(e,i){if(!e.map)throw Error("field is not a map");if(this.field=e,this.keyElem=new t.Element(e.keyType,null,!0,e.syntax),this.valueElem=new t.Element(e.type,e.resolvedType,!1,e.syntax),this.map={},l()(this,"size",{get:function(){return s()(this.map).length}}),i)for(var r=s()(i),o=0;o<r.length;o++){var n=this.keyElem.valueFromString(r[o]),a=this.valueElem.verifyValue(i[r[o]]);this.map[this.keyElem.valueToString(n)]={key:n,value:a}}},o=r.prototype;return o.clear=function(){this.map={}},o.delete=function(e){var t=(e=this.keyElem.valueToString(this.keyElem.verifyValue(e)))in this.map;return delete this.map[e],t},o.entries=function(){for(var e,t=[],r=s()(this.map),o=0;o<r.length;o++)t.push([(e=this.map[r[o]]).key,e.value]);return i(t)},o.keys=function(){for(var e=[],t=s()(this.map),r=0;r<t.length;r++)e.push(this.map[t[r]].key);return i(e)},o.values=function(){for(var e=[],t=s()(this.map),r=0;r<t.length;r++)e.push(this.map[t[r]].value);return i(e)},o.forEach=function(e,t){for(var i,r=s()(this.map),o=0;o<r.length;o++)e.call(t,(i=this.map[r[o]]).value,i.key,this)},o.set=function(e,t){var i=this.keyElem.verifyValue(e),r=this.valueElem.verifyValue(t);return this.map[this.keyElem.valueToString(i)]={key:i,value:r},this},o.get=function(e){return(e=this.keyElem.valueToString(this.keyElem.verifyValue(e)))in this.map?this.map[e].value:void 0},o.has=function(e){return this.keyElem.valueToString(this.keyElem.verifyValue(e))in this.map},r}(0,a.Reflect),a.loadProto=function(e,t,i){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(i=t,t=void 0),a.loadJson(a.DotProto.Parser.parse(e),t,i)},a.protoFromString=a.loadProto,a.loadProtoFile=function(e,t,i){if(t&&"object"===y()(t)?(i=t,t=null):t&&"function"==typeof t||(t=null),t)return a.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,(function(r){if(null===r)t(Error("Failed to fetch file"));else try{t(null,a.loadProto(r,i,e))}catch(e){t(e)}}));var r=a.Util.fetch("object"===y()(e)?e.root+"/"+e.file:e);return null===r?null:a.loadProto(r,i,e)},a.protoFromFile=a.loadProtoFile,a.newBuilder=function(e){return void 0===(e=e||{}).convertFieldsToCamelCase&&(e.convertFieldsToCamelCase=a.convertFieldsToCamelCase),void 0===e.populateAccessors&&(e.populateAccessors=a.populateAccessors),new a.Builder(e)},a.loadJson=function(e,t,i){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(i=t,t=null),t&&"object"===y()(t)||(t=a.newBuilder()),"string"==typeof e&&(e=JSON.parse(e)),t.import(e,i),t.resolveAll(),t},a.loadJsonFile=function(e,t,i){if(t&&"object"===y()(t)?(i=t,t=null):t&&"function"==typeof t||(t=null),t)return a.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,(function(r){if(null===r)t(Error("Failed to fetch file"));else try{t(null,a.loadJson(JSON.parse(r),i,e))}catch(e){t(e)}}));var r=a.Util.fetch("object"===y()(e)?e.root+"/"+e.file:e);return null===r?null:a.loadJson(JSON.parse(r),i,e)},a}))}).call(this,i(91),i(92)(e))},function(e,t,i){var r=i(3),o=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return o.stringify.apply(o,arguments)}},function(e,t,i){var r=i(5)("unscopables"),o=Array.prototype;null==o[r]&&i(17)(o,r,{}),e.exports=function(e){o[r][e]=!0}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,i){"use strict";var r=i(44),o=i(22),n=i(19),s=i(17),a=i(32),l=i(144),u=i(67),h=i(100),c=i(5)("iterator"),g=!([].keys&&"next"in[].keys()),p=function(){return this};e.exports=function(e,t,i,f,d,m,C){l(i,t,f);var y,v,A,_=function(e){if(!g&&e in G)return G[e];switch(e){case"keys":case"values":return function(){return new i(this,e)}}return function(){return new i(this,e)}},I=t+" Iterator",b="values"==d,w=!1,G=e.prototype,E=G[c]||G["@@iterator"]||d&&G[d],S=E||_(d),P=d?b?_("entries"):S:void 0,T="Array"==t&&G.entries||E;if(T&&(A=h(T.call(new e)))!==Object.prototype&&A.next&&(u(A,I,!0),r||"function"==typeof A[c]||s(A,c,p)),b&&E&&"values"!==E.name&&(w=!0,S=function(){return E.call(this)}),r&&!C||!g&&!w&&G[c]||s(G,c,S),a[t]=S,a[I]=p,d)if(y={values:b?S:_("values"),keys:m?S:_("keys"),entries:P},C)for(v in y)v in G||n(G,v,y[v]);else o(o.P+o.F*(g||w),t,y);return y}},function(e,t,i){e.exports=i(63)("native-function-to-string",Function.toString)},function(e,t,i){"use strict";var r=i(64),o=i(46),n=i(67),s={};i(17)(s,i(5)("iterator"),(function(){return this})),e.exports=function(e,t,i){e.prototype=r(s,{next:o(1,i)}),n(e,t+" Iterator")}},function(e,t,i){var r=i(18),o=i(15),n=i(97);e.exports=i(11)?Object.defineProperties:function(e,t){o(e);for(var i,s=n(t),a=s.length,l=0;a>l;)r.f(e,i=s[l++],t[i]);return e}},function(e,t,i){var r=i(10).document;e.exports=r&&r.documentElement},function(e,t,i){i(148),e.exports=i(3).Object.keys},function(e,t,i){var r=i(68),o=i(51);i(152)("keys",(function(){return function(e){return o(r(e))}}))},function(e,t,i){var r=i(39);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,i){var r=i(34),o=i(102),n=i(151);e.exports=function(e){return function(t,i,s){var a,l=r(t),u=o(l.length),h=n(s,u);if(e&&i!=i){for(;u>h;)if((a=l[h++])!=a)return!0}else for(;u>h;h++)if((e||h in l)&&l[h]===i)return e||h||0;return!e&&-1}}},function(e,t,i){var r=i(69),o=Math.max,n=Math.min;e.exports=function(e,t){return(e=r(e))<0?o(e+t,0):n(e,t)}},function(e,t,i){var r=i(8),o=i(3),n=i(35);e.exports=function(e,t){var i=(o.Object||{})[e]||Object[e],s={};s[e]=t(i),r(r.S+r.F*n((function(){i(1)})),"Object",s)}},function(e,t,i){i(154);var r=i(3).Object;e.exports=function(e,t,i){return r.defineProperty(e,t,i)}},function(e,t,i){var r=i(8);r(r.S+r.F*!i(20),"Object",{defineProperty:i(23).f})},function(e,t,i){var r=i(27),o=i(25);e.exports=function(e){return function(t,i){var n,s,a=String(o(t)),l=r(i),u=a.length;return l<0||l>=u?e?"":void 0:(n=a.charCodeAt(l))<55296||n>56319||l+1===u||(s=a.charCodeAt(l+1))<56320||s>57343?e?a.charAt(l):n:e?a.slice(l,l+2):s-56320+(n-55296<<10)+65536}}},function(e,t,i){"use strict";var r=i(78);i(22)({target:"RegExp",proto:!0,forced:r!==/./.exec},{exec:r})},function(e,t,i){i(158);var r=i(3).Object;e.exports=function(e,t){return r.create(e,t)}},function(e,t,i){var r=i(8);r(r.S,"Object",{create:i(79)})},function(e,t,i){i(11)&&"g"!=/./g.flags&&i(18).f(RegExp.prototype,"flags",{configurable:!0,get:i(58)})},function(e,t,i){i(161),e.exports=i(3).Array.isArray},function(e,t,i){var r=i(8);r(r.S,"Array",{isArray:i(107)})},function(e,t,i){i(163),e.exports=i(3).parseFloat},function(e,t,i){var r=i(8),o=i(164);r(r.G+r.F*(parseFloat!=o),{parseFloat:o})},function(e,t,i){var r=i(6).parseFloat,o=i(108).trim;e.exports=1/r(i(83)+"-0")!=-1/0?function(e){var t=o(String(e),3),i=r(t);return 0===i&&"-"==t.charAt(0)?-0:i}:r},function(e,t,i){i(166),e.exports=i(3).parseInt},function(e,t,i){var r=i(8),o=i(167);r(r.G+r.F*(parseInt!=o),{parseInt:o})},function(e,t,i){var r=i(6).parseInt,o=i(108).trim,n=i(83),s=/^[-+]?0[xX]/;e.exports=8!==r(n+"08")||22!==r(n+"0x16")?function(e,t){var i=o(String(e),3);return r(i,t>>>0||(s.test(i)?16:10))}:r},function(e,t,i){e.exports=i(169)},function(e,t,i){i(109),i(112),e.exports=i(85).f("iterator")},function(e,t,i){var r=i(69),o=i(50);e.exports=function(e){return function(t,i){var n,s,a=String(o(t)),l=r(i),u=a.length;return l<0||l>=u?e?"":void 0:(n=a.charCodeAt(l))<55296||n>56319||l+1===u||(s=a.charCodeAt(l+1))<56320||s>57343?e?a.charAt(l):n:e?a.slice(l,l+2):s-56320+(n-55296<<10)+65536}}},function(e,t,i){"use strict";var r=i(79),o=i(55),n=i(60),s={};i(29)(s,i(12)("iterator"),(function(){return this})),e.exports=function(e,t,i){e.prototype=r(s,{next:o(1,i)}),n(e,t+" Iterator")}},function(e,t,i){var r=i(28),o=i(68),n=i(70)("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=o(e),r(e,n)?e[n]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},function(e,t,i){"use strict";var r=i(174),o=i(175),n=i(41),s=i(34);e.exports=i(110)(Array,"Array",(function(e,t){this._t=s(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,i=this._i++;return!e||i>=e.length?(this._t=void 0,o(1)):o(0,"keys"==t?i:"values"==t?e[i]:[i,e[i]])}),"values"),n.Arguments=n.Array,r("keys"),r("values"),r("entries")},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,i){e.exports=i(177)},function(e,t,i){i(178),i(115),i(183),i(184),e.exports=i(3).Symbol},function(e,t,i){"use strict";var r=i(6),o=i(28),n=i(20),s=i(8),a=i(111),l=i(179).KEY,u=i(35),h=i(71),c=i(60),g=i(52),p=i(12),f=i(85),d=i(86),m=i(180),C=i(107),y=i(24),v=i(30),A=i(68),_=i(34),I=i(74),b=i(55),w=i(79),G=i(181),E=i(182),S=i(113),P=i(23),T=i(51),x=E.f,N=P.f,L=G.f,M=r.Symbol,R=r.JSON,O=R&&R.stringify,F=p("_hidden"),D=p("toPrimitive"),k={}.propertyIsEnumerable,U=h("symbol-registry"),B=h("symbols"),W=h("op-symbols"),V=Object.prototype,j="function"==typeof M&&!!S.f,H=r.QObject,z=!H||!H.prototype||!H.prototype.findChild,q=n&&u((function(){return 7!=w(N({},"a",{get:function(){return N(this,"a",{value:7}).a}})).a}))?function(e,t,i){var r=x(V,t);r&&delete V[t],N(e,t,i),r&&e!==V&&N(V,t,r)}:N,X=function(e){var t=B[e]=w(M.prototype);return t._k=e,t},Y=j&&"symbol"==typeof M.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof M},K=function(e,t,i){return e===V&&K(W,t,i),y(e),t=I(t,!0),y(i),o(B,t)?(i.enumerable?(o(e,F)&&e[F][t]&&(e[F][t]=!1),i=w(i,{enumerable:b(0,!1)})):(o(e,F)||N(e,F,b(1,{})),e[F][t]=!0),q(e,t,i)):N(e,t,i)},Q=function(e,t){y(e);for(var i,r=m(t=_(t)),o=0,n=r.length;n>o;)K(e,i=r[o++],t[i]);return e},Z=function(e){var t=k.call(this,e=I(e,!0));return!(this===V&&o(B,e)&&!o(W,e))&&(!(t||!o(this,e)||!o(B,e)||o(this,F)&&this[F][e])||t)},J=function(e,t){if(e=_(e),t=I(t,!0),e!==V||!o(B,t)||o(W,t)){var i=x(e,t);return!i||!o(B,t)||o(e,F)&&e[F][t]||(i.enumerable=!0),i}},$=function(e){for(var t,i=L(_(e)),r=[],n=0;i.length>n;)o(B,t=i[n++])||t==F||t==l||r.push(t);return r},ee=function(e){for(var t,i=e===V,r=L(i?W:_(e)),n=[],s=0;r.length>s;)!o(B,t=r[s++])||i&&!o(V,t)||n.push(B[t]);return n};j||(a((M=function(){if(this instanceof M)throw TypeError("Symbol is not a constructor!");var e=g(arguments.length>0?arguments[0]:void 0),t=function(i){this===V&&t.call(W,i),o(this,F)&&o(this[F],e)&&(this[F][e]=!1),q(this,e,b(1,i))};return n&&z&&q(V,e,{configurable:!0,set:t}),X(e)}).prototype,"toString",(function(){return this._k})),E.f=J,P.f=K,i(114).f=G.f=$,i(87).f=Z,S.f=ee,n&&!i(40)&&a(V,"propertyIsEnumerable",Z,!0),f.f=function(e){return X(p(e))}),s(s.G+s.W+s.F*!j,{Symbol:M});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ie=0;te.length>ie;)p(te[ie++]);for(var re=T(p.store),oe=0;re.length>oe;)d(re[oe++]);s(s.S+s.F*!j,"Symbol",{for:function(e){return o(U,e+="")?U[e]:U[e]=M(e)},keyFor:function(e){if(!Y(e))throw TypeError(e+" is not a symbol!");for(var t in U)if(U[t]===e)return t},useSetter:function(){z=!0},useSimple:function(){z=!1}}),s(s.S+s.F*!j,"Object",{create:function(e,t){return void 0===t?w(e):Q(w(e),t)},defineProperty:K,defineProperties:Q,getOwnPropertyDescriptor:J,getOwnPropertyNames:$,getOwnPropertySymbols:ee});var ne=u((function(){S.f(1)}));s(s.S+s.F*ne,"Object",{getOwnPropertySymbols:function(e){return S.f(A(e))}}),R&&s(s.S+s.F*(!j||u((function(){var e=M();return"[null]"!=O([e])||"{}"!=O({a:e})||"{}"!=O(Object(e))}))),"JSON",{stringify:function(e){for(var t,i,r=[e],o=1;arguments.length>o;)r.push(arguments[o++]);if(i=t=r[1],(v(t)||void 0!==e)&&!Y(e))return C(t)||(t=function(e,t){if("function"==typeof i&&(t=i.call(this,e,t)),!Y(t))return t}),r[1]=t,O.apply(R,r)}}),M.prototype[D]||i(29)(M.prototype,D,M.prototype.valueOf),c(M,"Symbol"),c(Math,"Math",!0),c(r.JSON,"JSON",!0)},function(e,t,i){var r=i(52)("meta"),o=i(30),n=i(28),s=i(23).f,a=0,l=Object.isExtensible||function(){return!0},u=!i(35)((function(){return l(Object.preventExtensions({}))})),h=function(e){s(e,r,{value:{i:"O"+ ++a,w:{}}})},c=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!n(e,r)){if(!l(e))return"F";if(!t)return"E";h(e)}return e[r].i},getWeak:function(e,t){if(!n(e,r)){if(!l(e))return!0;if(!t)return!1;h(e)}return e[r].w},onFreeze:function(e){return u&&c.NEED&&l(e)&&!n(e,r)&&h(e),e}}},function(e,t,i){var r=i(51),o=i(113),n=i(87);e.exports=function(e){var t=r(e),i=o.f;if(i)for(var s,a=i(e),l=n.f,u=0;a.length>u;)l.call(e,s=a[u++])&&t.push(s);return t}},function(e,t,i){var r=i(34),o=i(114).f,n={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"[object Window]"==n.call(e)?function(e){try{return o(e)}catch(e){return s.slice()}}(e):o(r(e))}},function(e,t,i){var r=i(87),o=i(55),n=i(34),s=i(74),a=i(28),l=i(103),u=Object.getOwnPropertyDescriptor;t.f=i(20)?u:function(e,t){if(e=n(e),t=s(t,!0),l)try{return u(e,t)}catch(e){}if(a(e,t))return o(!r.f.call(e,t),e[t])}},function(e,t,i){i(86)("asyncIterator")},function(e,t,i){i(86)("observable")},function(e,t,i){var r,o,n;
/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */o=[],void 0===(n="function"==typeof(r=function(){"use strict";function e(e,t,i){this.low=0|e,this.high=0|t,this.unsigned=!!i}function t(e){return!0===(e&&e.__isLong__)}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),e.isLong=t;var i={},r={};function o(e,t){var o,n,a;return t?(a=0<=(e>>>=0)&&e<256)&&(n=r[e])?n:(o=s(e,(0|e)<0?-1:0,!0),a&&(r[e]=o),o):(a=-128<=(e|=0)&&e<128)&&(n=i[e])?n:(o=s(e,e<0?-1:0,!1),a&&(i[e]=o),o)}function n(e,t){if(isNaN(e)||!isFinite(e))return t?d:f;if(t){if(e<0)return d;if(e>=c)return A}else{if(e<=-g)return _;if(e+1>=g)return v}return e<0?n(-e,t).neg():s(e%h|0,e/h|0,t)}function s(t,i,r){return new e(t,i,r)}e.fromInt=o,e.fromNumber=n,e.fromBits=s;var a=Math.pow;function l(e,t,i){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return f;if("number"==typeof t?(i=t,t=!1):t=!!t,(i=i||10)<2||36<i)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return l(e.substring(1),t,i).neg();for(var o=n(a(i,8)),s=f,u=0;u<e.length;u+=8){var h=Math.min(8,e.length-u),c=parseInt(e.substring(u,u+h),i);if(h<8){var g=n(a(i,h));s=s.mul(g).add(n(c))}else s=(s=s.mul(o)).add(n(c))}return s.unsigned=t,s}function u(t){return t instanceof e?t:"number"==typeof t?n(t):"string"==typeof t?l(t):s(t.low,t.high,t.unsigned)}e.fromString=l,e.fromValue=u;var h=4294967296,c=h*h,g=c/2,p=o(1<<24),f=o(0);e.ZERO=f;var d=o(0,!0);e.UZERO=d;var m=o(1);e.ONE=m;var C=o(1,!0);e.UONE=C;var y=o(-1);e.NEG_ONE=y;var v=s(-1,2147483647,!1);e.MAX_VALUE=v;var A=s(-1,-1,!0);e.MAX_UNSIGNED_VALUE=A;var _=s(0,-2147483648,!1);e.MIN_VALUE=_;var I=e.prototype;return I.toInt=function(){return this.unsigned?this.low>>>0:this.low},I.toNumber=function(){return this.unsigned?(this.high>>>0)*h+(this.low>>>0):this.high*h+(this.low>>>0)},I.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(_)){var t=n(e),i=this.div(t),r=i.mul(t).sub(this);return i.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var o=n(a(e,6),this.unsigned),s=this,l="";;){var u=s.div(o),h=(s.sub(u.mul(o)).toInt()>>>0).toString(e);if((s=u).isZero())return h+l;for(;h.length<6;)h="0"+h;l=""+h+l}},I.getHighBits=function(){return this.high},I.getHighBitsUnsigned=function(){return this.high>>>0},I.getLowBits=function(){return this.low},I.getLowBitsUnsigned=function(){return this.low>>>0},I.getNumBitsAbs=function(){if(this.isNegative())return this.eq(_)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},I.isZero=function(){return 0===this.high&&0===this.low},I.isNegative=function(){return!this.unsigned&&this.high<0},I.isPositive=function(){return this.unsigned||this.high>=0},I.isOdd=function(){return 1==(1&this.low)},I.isEven=function(){return 0==(1&this.low)},I.equals=function(e){return t(e)||(e=u(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},I.eq=I.equals,I.notEquals=function(e){return!this.eq(e)},I.neq=I.notEquals,I.lessThan=function(e){return this.comp(e)<0},I.lt=I.lessThan,I.lessThanOrEqual=function(e){return this.comp(e)<=0},I.lte=I.lessThanOrEqual,I.greaterThan=function(e){return this.comp(e)>0},I.gt=I.greaterThan,I.greaterThanOrEqual=function(e){return this.comp(e)>=0},I.gte=I.greaterThanOrEqual,I.compare=function(e){if(t(e)||(e=u(e)),this.eq(e))return 0;var i=this.isNegative(),r=e.isNegative();return i&&!r?-1:!i&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},I.comp=I.compare,I.negate=function(){return!this.unsigned&&this.eq(_)?_:this.not().add(m)},I.neg=I.negate,I.add=function(e){t(e)||(e=u(e));var i=this.high>>>16,r=65535&this.high,o=this.low>>>16,n=65535&this.low,a=e.high>>>16,l=65535&e.high,h=e.low>>>16,c=0,g=0,p=0,f=0;return p+=(f+=n+(65535&e.low))>>>16,g+=(p+=o+h)>>>16,c+=(g+=r+l)>>>16,c+=i+a,s((p&=65535)<<16|(f&=65535),(c&=65535)<<16|(g&=65535),this.unsigned)},I.subtract=function(e){return t(e)||(e=u(e)),this.add(e.neg())},I.sub=I.subtract,I.multiply=function(e){if(this.isZero())return f;if(t(e)||(e=u(e)),e.isZero())return f;if(this.eq(_))return e.isOdd()?_:f;if(e.eq(_))return this.isOdd()?_:f;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(p)&&e.lt(p))return n(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,r=65535&this.high,o=this.low>>>16,a=65535&this.low,l=e.high>>>16,h=65535&e.high,c=e.low>>>16,g=65535&e.low,d=0,m=0,C=0,y=0;return C+=(y+=a*g)>>>16,m+=(C+=o*g)>>>16,C&=65535,m+=(C+=a*c)>>>16,d+=(m+=r*g)>>>16,m&=65535,d+=(m+=o*c)>>>16,m&=65535,d+=(m+=a*h)>>>16,d+=i*g+r*c+o*h+a*l,s((C&=65535)<<16|(y&=65535),(d&=65535)<<16|(m&=65535),this.unsigned)},I.mul=I.multiply,I.divide=function(e){if(t(e)||(e=u(e)),e.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?d:f;var i,r,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return d;if(e.gt(this.shru(1)))return C;o=d}else{if(this.eq(_))return e.eq(m)||e.eq(y)?_:e.eq(_)?m:(i=this.shr(1).div(e).shl(1)).eq(f)?e.isNegative()?m:y:(r=this.sub(e.mul(i)),o=i.add(r.div(e)));if(e.eq(_))return this.unsigned?d:f;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=f}for(r=this;r.gte(e);){i=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(i)/Math.LN2),l=s<=48?1:a(2,s-48),h=n(i),c=h.mul(e);c.isNegative()||c.gt(r);)c=(h=n(i-=l,this.unsigned)).mul(e);h.isZero()&&(h=m),o=o.add(h),r=r.sub(c)}return o},I.div=I.divide,I.modulo=function(e){return t(e)||(e=u(e)),this.sub(this.div(e).mul(e))},I.mod=I.modulo,I.not=function(){return s(~this.low,~this.high,this.unsigned)},I.and=function(e){return t(e)||(e=u(e)),s(this.low&e.low,this.high&e.high,this.unsigned)},I.or=function(e){return t(e)||(e=u(e)),s(this.low|e.low,this.high|e.high,this.unsigned)},I.xor=function(e){return t(e)||(e=u(e)),s(this.low^e.low,this.high^e.high,this.unsigned)},I.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?s(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):s(0,this.low<<e-32,this.unsigned)},I.shl=I.shiftLeft,I.shiftRight=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?s(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):s(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},I.shr=I.shiftRight,I.shiftRightUnsigned=function(e){if(t(e)&&(e=e.toInt()),0==(e&=63))return this;var i=this.high;return e<32?s(this.low>>>e|i<<32-e,i>>>e,this.unsigned):s(32===e?i:i>>>e-32,0,this.unsigned)},I.shru=I.shiftRightUnsigned,I.toSigned=function(){return this.unsigned?s(this.low,this.high,!1):this},I.toUnsigned=function(){return this.unsigned?this:s(this.low,this.high,!0)},I.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},I.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24&255,255&e,e>>>8&255,e>>>16&255,e>>>24&255]},I.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t]},e})?r.apply(t,o):r)||(e.exports=n)},function(e,t){},function(e,t,i){i(42)("Uint32",4,(function(e){return function(t,i,r){return e(this,t,i,r)}}))},function(e,t,i){"use strict";var r=i(10),o=i(11),n=i(44),s=i(119),a=i(17),l=i(120),u=i(16),h=i(121),c=i(27),g=i(14),p=i(122),f=i(61).f,d=i(18).f,m=i(123),C=i(67),y=r.ArrayBuffer,v=r.DataView,A=r.Math,_=r.RangeError,I=r.Infinity,b=y,w=A.abs,G=A.pow,E=A.floor,S=A.log,P=A.LN2,T=o?"_b":"buffer",x=o?"_l":"byteLength",N=o?"_o":"byteOffset";function L(e,t,i){var r,o,n,s=new Array(i),a=8*i-t-1,l=(1<<a)-1,u=l>>1,h=23===t?G(2,-24)-G(2,-77):0,c=0,g=e<0||0===e&&1/e<0?1:0;for((e=w(e))!=e||e===I?(o=e!=e?1:0,r=l):(r=E(S(e)/P),e*(n=G(2,-r))<1&&(r--,n*=2),(e+=r+u>=1?h/n:h*G(2,1-u))*n>=2&&(r++,n/=2),r+u>=l?(o=0,r=l):r+u>=1?(o=(e*n-1)*G(2,t),r+=u):(o=e*G(2,u-1)*G(2,t),r=0));t>=8;s[c++]=255&o,o/=256,t-=8);for(r=r<<t|o,a+=t;a>0;s[c++]=255&r,r/=256,a-=8);return s[--c]|=128*g,s}function M(e,t,i){var r,o=8*i-t-1,n=(1<<o)-1,s=n>>1,a=o-7,l=i-1,u=e[l--],h=127&u;for(u>>=7;a>0;h=256*h+e[l],l--,a-=8);for(r=h&(1<<-a)-1,h>>=-a,a+=t;a>0;r=256*r+e[l],l--,a-=8);if(0===h)h=1-s;else{if(h===n)return r?NaN:u?-I:I;r+=G(2,t),h-=s}return(u?-1:1)*r*G(2,h-t)}function R(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function O(e){return[255&e]}function F(e){return[255&e,e>>8&255]}function D(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function k(e){return L(e,52,8)}function U(e){return L(e,23,4)}function B(e,t,i){d(e.prototype,t,{get:function(){return this[i]}})}function W(e,t,i,r){var o=p(+i);if(o+t>e[x])throw _("Wrong index!");var n=e[T]._b,s=o+e[N],a=n.slice(s,s+t);return r?a:a.reverse()}function V(e,t,i,r,o,n){var s=p(+i);if(s+t>e[x])throw _("Wrong index!");for(var a=e[T]._b,l=s+e[N],u=r(+o),h=0;h<t;h++)a[l+h]=u[n?h:t-h-1]}if(s.ABV){if(!u((function(){y(1)}))||!u((function(){new y(-1)}))||u((function(){return new y,new y(1.5),new y(NaN),"ArrayBuffer"!=y.name}))){for(var j,H=(y=function(e){return h(this,y),new b(p(e))}).prototype=b.prototype,z=f(b),q=0;z.length>q;)(j=z[q++])in y||a(y,j,b[j]);n||(H.constructor=y)}var X=new v(new y(2)),Y=v.prototype.setInt8;X.setInt8(0,2147483648),X.setInt8(1,2147483649),!X.getInt8(0)&&X.getInt8(1)||l(v.prototype,{setInt8:function(e,t){Y.call(this,e,t<<24>>24)},setUint8:function(e,t){Y.call(this,e,t<<24>>24)}},!0)}else y=function(e){h(this,y,"ArrayBuffer");var t=p(e);this._b=m.call(new Array(t),0),this[x]=t},v=function(e,t,i){h(this,v,"DataView"),h(e,y,"DataView");var r=e[x],o=c(t);if(o<0||o>r)throw _("Wrong offset!");if(o+(i=void 0===i?r-o:g(i))>r)throw _("Wrong length!");this[T]=e,this[N]=o,this[x]=i},o&&(B(y,"byteLength","_l"),B(v,"buffer","_b"),B(v,"byteLength","_l"),B(v,"byteOffset","_o")),l(v.prototype,{getInt8:function(e){return W(this,1,e)[0]<<24>>24},getUint8:function(e){return W(this,1,e)[0]},getInt16:function(e){var t=W(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=W(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return R(W(this,4,e,arguments[1]))},getUint32:function(e){return R(W(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return M(W(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return M(W(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){V(this,1,e,O,t)},setUint8:function(e,t){V(this,1,e,O,t)},setInt16:function(e,t){V(this,2,e,F,t,arguments[2])},setUint16:function(e,t){V(this,2,e,F,t,arguments[2])},setInt32:function(e,t){V(this,4,e,D,t,arguments[2])},setUint32:function(e,t){V(this,4,e,D,t,arguments[2])},setFloat32:function(e,t){V(this,4,e,U,t,arguments[2])},setFloat64:function(e,t){V(this,8,e,k,t,arguments[2])}});C(y,"ArrayBuffer"),C(v,"DataView"),a(v.prototype,s.VIEW,!0),t.ArrayBuffer=y,t.DataView=v},function(e,t,i){var r=i(32),o=i(5)("iterator"),n=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||n[o]===e)}},function(e,t,i){var r=i(57),o=i(5)("iterator"),n=i(32);e.exports=i(43).getIteratorMethod=function(e){if(null!=e)return e[o]||e["@@iterator"]||n[r(e)]}},function(e,t,i){var r=i(48),o=i(95),n=i(33),s=i(14),a=i(192);e.exports=function(e,t){var i=1==e,l=2==e,u=3==e,h=4==e,c=6==e,g=5==e||c,p=t||a;return function(t,a,f){for(var d,m,C=n(t),y=o(C),v=r(a,f,3),A=s(y.length),_=0,I=i?p(t,A):l?p(t,0):void 0;A>_;_++)if((g||_ in y)&&(m=v(d=y[_],_,C),e))if(i)I[_]=m;else if(m)switch(e){case 3:return!0;case 5:return d;case 6:return _;case 2:I.push(d)}else if(h)return!1;return c?-1:u||h?h:I}}},function(e,t,i){var r=i(193);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,i){var r=i(21),o=i(194),n=i(5)("species");e.exports=function(e){var t;return o(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!o(t.prototype)||(t=void 0),r(t)&&null===(t=t[n])&&(t=void 0)),void 0===t?Array:t}},function(e,t,i){var r=i(38);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,i){var r=i(5)("iterator"),o=!1;try{var n=[7][r]();n.return=function(){o=!0},Array.from(n,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!o)return!1;var i=!1;try{var n=[7],s=n[r]();s.next=function(){return{done:i=!0}},n[r]=function(){return s},e(n)}catch(e){}return i}},function(e,t,i){"use strict";var r=i(33),o=i(49),n=i(14);e.exports=[].copyWithin||function(e,t){var i=r(this),s=n(i.length),a=o(e,s),l=o(t,s),u=arguments.length>2?arguments[2]:void 0,h=Math.min((void 0===u?s:o(u,s))-l,s-a),c=1;for(l<a&&a<l+h&&(c=-1,l+=h-1,a+=h-1);h-- >0;)l in i?i[a]=i[l]:delete i[a],a+=c,l+=c;return i}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,i){i(42)("Uint16",2,(function(e){return function(t,i,r){return e(this,t,i,r)}}))},function(e,t,i){"use strict";i(200)("bold",(function(e){return function(){return e(this,"b","","")}}))},function(e,t,i){var r=i(22),o=i(16),n=i(25),s=/"/g,a=function(e,t,i,r){var o=String(n(e)),a="<"+t;return""!==i&&(a+=" "+i+'="'+String(r).replace(s,"&quot;")+'"'),a+">"+o+"</"+t+">"};e.exports=function(e,t){var i={};i[e]=t(a),r(r.P+r.F*o((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3})),"String",i)}},function(e,t,i){i(202);var r=i(3).Object;e.exports=function(e,t){return r.defineProperties(e,t)}},function(e,t,i){var r=i(8);r(r.S+r.F*!i(20),"Object",{defineProperties:i(105)})},function(e,t,i){i(42)("Uint8",1,(function(e){return function(t,i,r){return e(this,t,i,r)}}),!0)},function(e,t,i){i(42)("Uint8",1,(function(e){return function(t,i,r){return e(this,t,i,r)}}))},function(e,t,i){var r=i(22);r(r.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},function(e,t,i){i(207),e.exports=i(3).Date.now},function(e,t,i){var r=i(8);r(r.S,"Date",{now:function(){return(new Date).getTime()}})},function(e,t,i){i(115),i(109),i(112),i(209),i(221),i(222),e.exports=i(3).Promise},function(e,t,i){"use strict";var r,o,n,s,a=i(40),l=i(6),u=i(53),h=i(125),c=i(8),g=i(30),p=i(54),f=i(210),d=i(211),m=i(126),C=i(127).set,y=i(216)(),v=i(89),A=i(128),_=i(217),I=i(129),b=l.TypeError,w=l.process,G=w&&w.versions,E=G&&G.v8||"",S=l.Promise,P="process"==h(w),T=function(){},x=o=v.f,N=!!function(){try{var e=S.resolve(1),t=(e.constructor={})[i(12)("species")]=function(e){e(T,T)};return(P||"function"==typeof PromiseRejectionEvent)&&e.then(T)instanceof t&&0!==E.indexOf("6.6")&&-1===_.indexOf("Chrome/66")}catch(e){}}(),L=function(e){var t;return!(!g(e)||"function"!=typeof(t=e.then))&&t},M=function(e,t){if(!e._n){e._n=!0;var i=e._c;y((function(){for(var r=e._v,o=1==e._s,n=0,s=function(t){var i,n,s,a=o?t.ok:t.fail,l=t.resolve,u=t.reject,h=t.domain;try{a?(o||(2==e._h&&F(e),e._h=1),!0===a?i=r:(h&&h.enter(),i=a(r),h&&(h.exit(),s=!0)),i===t.promise?u(b("Promise-chain cycle")):(n=L(i))?n.call(i,l,u):l(i)):u(r)}catch(e){h&&!s&&h.exit(),u(e)}};i.length>n;)s(i[n++]);e._c=[],e._n=!1,t&&!e._h&&R(e)}))}},R=function(e){C.call(l,(function(){var t,i,r,o=e._v,n=O(e);if(n&&(t=A((function(){P?w.emit("unhandledRejection",o,e):(i=l.onunhandledrejection)?i({promise:e,reason:o}):(r=l.console)&&r.error&&r.error("Unhandled promise rejection",o)})),e._h=P||O(e)?2:1),e._a=void 0,n&&t.e)throw t.v}))},O=function(e){return 1!==e._h&&0===(e._a||e._c).length},F=function(e){C.call(l,(function(){var t;P?w.emit("rejectionHandled",e):(t=l.onrejectionhandled)&&t({promise:e,reason:e._v})}))},D=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),M(t,!0))},k=function(e){var t,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===e)throw b("Promise can't be resolved itself");(t=L(e))?y((function(){var r={_w:i,_d:!1};try{t.call(e,u(k,r,1),u(D,r,1))}catch(e){D.call(r,e)}})):(i._v=e,i._s=1,M(i,!1))}catch(e){D.call({_w:i,_d:!1},e)}}};N||(S=function(e){f(this,S,"Promise","_h"),p(e),r.call(this);try{e(u(k,this,1),u(D,this,1))}catch(e){D.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=i(218)(S.prototype,{then:function(e,t){var i=x(m(this,S));return i.ok="function"!=typeof e||e,i.fail="function"==typeof t&&t,i.domain=P?w.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&M(this,!1),i.promise},catch:function(e){return this.then(void 0,e)}}),n=function(){var e=new r;this.promise=e,this.resolve=u(k,e,1),this.reject=u(D,e,1)},v.f=x=function(e){return e===S||e===s?new n(e):o(e)}),c(c.G+c.W+c.F*!N,{Promise:S}),i(60)(S,"Promise"),i(219)("Promise"),s=i(3).Promise,c(c.S+c.F*!N,"Promise",{reject:function(e){var t=x(this);return(0,t.reject)(e),t.promise}}),c(c.S+c.F*(a||!N),"Promise",{resolve:function(e){return I(a&&this===s?S:this,e)}}),c(c.S+c.F*!(N&&i(220)((function(e){S.all(e).catch(T)}))),"Promise",{all:function(e){var t=this,i=x(t),r=i.resolve,o=i.reject,n=A((function(){var i=[],n=0,s=1;d(e,!1,(function(e){var a=n++,l=!1;i.push(void 0),s++,t.resolve(e).then((function(e){l||(l=!0,i[a]=e,--s||r(i))}),o)})),--s||r(i)}));return n.e&&o(n.v),i.promise},race:function(e){var t=this,i=x(t),r=i.reject,o=A((function(){d(e,!1,(function(e){t.resolve(e).then(i.resolve,r)}))}));return o.e&&r(o.v),i.promise}})},function(e,t){e.exports=function(e,t,i,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(i+": incorrect invocation!");return e}},function(e,t,i){var r=i(53),o=i(212),n=i(213),s=i(24),a=i(102),l=i(214),u={},h={};(t=e.exports=function(e,t,i,c,g){var p,f,d,m,C=g?function(){return e}:l(e),y=r(i,c,t?2:1),v=0;if("function"!=typeof C)throw TypeError(e+" is not iterable!");if(n(C)){for(p=a(e.length);p>v;v++)if((m=t?y(s(f=e[v])[0],f[1]):y(e[v]))===u||m===h)return m}else for(d=C.call(e);!(f=d.next()).done;)if((m=o(d,y,f.value,t))===u||m===h)return m}).BREAK=u,t.RETURN=h},function(e,t,i){var r=i(24);e.exports=function(e,t,i,o){try{return o?t(r(i)[0],i[1]):t(i)}catch(t){var n=e.return;throw void 0!==n&&r(n.call(e)),t}}},function(e,t,i){var r=i(41),o=i(12)("iterator"),n=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||n[o]===e)}},function(e,t,i){var r=i(125),o=i(12)("iterator"),n=i(41);e.exports=i(3).getIteratorMethod=function(e){if(null!=e)return e[o]||e["@@iterator"]||n[r(e)]}},function(e,t){e.exports=function(e,t,i){var r=void 0===i;switch(t.length){case 0:return r?e():e.call(i);case 1:return r?e(t[0]):e.call(i,t[0]);case 2:return r?e(t[0],t[1]):e.call(i,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(i,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(i,t[0],t[1],t[2],t[3])}return e.apply(i,t)}},function(e,t,i){var r=i(6),o=i(127).set,n=r.MutationObserver||r.WebKitMutationObserver,s=r.process,a=r.Promise,l="process"==i(39)(s);e.exports=function(){var e,t,i,u=function(){var r,o;for(l&&(r=s.domain)&&r.exit();e;){o=e.fn,e=e.next;try{o()}catch(r){throw e?i():t=void 0,r}}t=void 0,r&&r.enter()};if(l)i=function(){s.nextTick(u)};else if(!n||r.navigator&&r.navigator.standalone)if(a&&a.resolve){var h=a.resolve(void 0);i=function(){h.then(u)}}else i=function(){o.call(r,u)};else{var c=!0,g=document.createTextNode("");new n(u).observe(g,{characterData:!0}),i=function(){g.data=c=!c}}return function(r){var o={fn:r,next:void 0};t&&(t.next=o),e||(e=o,i()),t=o}}},function(e,t,i){var r=i(6).navigator;e.exports=r&&r.userAgent||""},function(e,t,i){var r=i(29);e.exports=function(e,t,i){for(var o in t)i&&e[o]?e[o]=t[o]:r(e,o,t[o]);return e}},function(e,t,i){"use strict";var r=i(6),o=i(3),n=i(23),s=i(20),a=i(12)("species");e.exports=function(e){var t="function"==typeof o[e]?o[e]:r[e];s&&t&&!t[a]&&n.f(t,a,{configurable:!0,get:function(){return this}})}},function(e,t,i){var r=i(12)("iterator"),o=!1;try{var n=[7][r]();n.return=function(){o=!0},Array.from(n,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!o)return!1;var i=!1;try{var n=[7],s=n[r]();s.next=function(){return{done:i=!0}},n[r]=function(){return s},e(n)}catch(e){}return i}},function(e,t,i){"use strict";var r=i(8),o=i(3),n=i(6),s=i(126),a=i(129);r(r.P+r.R,"Promise",{finally:function(e){var t=s(this,o.Promise||n.Promise),i="function"==typeof e;return this.then(i?function(i){return a(t,e()).then((function(){return i}))}:e,i?function(i){return a(t,e()).then((function(){throw i}))}:e)}})},function(e,t,i){"use strict";var r=i(8),o=i(89),n=i(128);r(r.S,"Promise",{try:function(e){var t=o.f(this),i=n(e);return(i.e?t.reject:t.resolve)(i.v),t.promise}})},function(e,t,i){i(42)("Float32",4,(function(e){return function(t,i,r){return e(this,t,i,r)}}))},function(e,t,i){var r=i(21),o=i(15),n=function(e,t){if(o(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=i(48)(Function.call,i(88).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,i){return n(e,i),t?e.__proto__=i:r(e,i),e}}({},!1):void 0),check:n}},function(e,t,i){var r=i(22),o=i(25),n=i(16),s=i(226),a="["+s+"]",l=RegExp("^"+a+a+"*"),u=RegExp(a+a+"*$"),h=function(e,t,i){var o={},a=n((function(){return!!s[e]()||"​"!="​"[e]()})),l=o[e]=a?t(c):s[e];i&&(o[i]=l),r(r.P+r.F*a,"String",o)},c=h.trim=function(e,t){return e=String(o(e)),1&t&&(e=e.replace(l,"")),2&t&&(e=e.replace(u,"")),e};e.exports=h},function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(module,__webpack_exports__,__webpack_require__){"use strict";(function(module,global){var core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(62),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(36),core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_1__),_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(31),_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(80),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_3__),_babel_runtime_corejs2_core_js_array_is_array__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(9),_babel_runtime_corejs2_core_js_array_is_array__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_array_is_array__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es6_string_ends_with__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(229),core_js_modules_es6_string_ends_with__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es6_string_ends_with__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es6_string_starts_with__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(230),core_js_modules_es6_string_starts_with__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es6_string_starts_with__WEBPACK_IMPORTED_MODULE_6__),_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(0),_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(133),core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(231),core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_9__),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(84),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_10__),_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(2),_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11__),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(1),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12__),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(81),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_13__),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(82),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_14__),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(75),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_15__),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(130),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_16__),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(131),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_17__),require,require,e;window.GeoGlobe=window.GeoGlobe||{},window.GeoGlobe.Class=window.GeoGlobe.Class||{},window.GeoGlobe.LngLatBounds=window.GeoGlobe.LngLatBounds||{},window.GeoGlobe.LngLat=window.GeoGlobe.LngLat||{},window.GeoGlobe.Filter=window.GeoGlobe.Filter||{},window.GeoGlobe.Format=window.GeoGlobe.Format||{},window.GeoGlobe.Protocol=window.GeoGlobe.Protocol||{},window.GeoGlobe.Query=window.GeoGlobe.Query||{},window.GeoGlobe.Service=window.GeoGlobe.Service||{},window.GeoGlobe.Analysis=window.GeoGlobe.Analysis||{},GeoGlobe.getScriptLocation=function(e){for(var t="",i=new RegExp("(^|(.*?\\/))("+e+")(\\?|$)"),r=document.getElementsByTagName("script"),o=0,n=r.length;o<n;o++){var s=r[o].getAttribute("src");if(s){var a=s.match(i);if(a){t=a[1];break}}}return t},GeoGlobe.createNS=function(e){for(var t=e.split("."),i=window,r=0;r<t.length;r++)i[t[r]]||(i[t[r]]={}),i=i[t[r]]},GeoGlobe.Class=function(){var e=arguments.length,t=arguments[0],i=arguments[e-1],r="function"==typeof i.initialize?i.initialize:function(){t.prototype.initialize.apply(this,arguments)};return e>1?[r,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),i):r.prototype=i,r},GeoGlobe.Class4OL=function(){var e=arguments.length,t=arguments[0],i=arguments[e-1],r="function"==typeof i.initialize?i.initialize:function(){t.prototype.initialize.apply(this,arguments)};if(e>1){var o=[r,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),i);GeoGlobe.inherit.apply(null,o)}else r.prototype=i;return r},GeoGlobe.inherit=function(e,t){var i,r,o,n=function(){};for(n.prototype=t.prototype,e.prototype=new n,i=2,r=arguments.length;i<r;i++)"function"==typeof(o=arguments[i])&&(o=o.prototype),GeoGlobe.Util.extend(e.prototype,o)},GeoGlobe.Util=GeoGlobe.Util||{},GeoGlobe.Util.extend=function(e,t){if(e=e||{},t){for(var i in t){var r=t[i];void 0!==r&&(e[i]=r)}!("function"==typeof window.Event&&t instanceof window.Event)&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&(e.toString=t.toString)}return e},GeoGlobe.Util.deepExtend=function(e){for(var t=1;t<arguments.length;t++)for(var i in arguments[t])if(arguments[t].hasOwnProperty(i))switch(GeoGlobe.Util.getType(arguments[t][i])){case"array":e.hasOwnProperty(i)&&"array"===GeoGlobe.Util.getType(e[i])?GeoGlobe.Util.deepExtend(e[i],arguments[t][i]):e[i]=GeoGlobe.Util.deepExtend([],arguments[t][i]);break;case"object":e.hasOwnProperty(i)&&"object"===GeoGlobe.Util.getType(e[i])?GeoGlobe.Util.deepExtend(e[i],arguments[t][i]):e[i]=GeoGlobe.Util.deepExtend({},arguments[t][i]);break;default:e[i]=arguments[t][i]}return e},GeoGlobe.Util=GeoGlobe.Util||{},GeoGlobe.Util.getElement=function(){for(var e=[],t=0,i=arguments.length;t<i;t++){var r=arguments[t];if("string"==typeof r&&(r=document.getElementById(r)),1==arguments.length)return r;e.push(r)}return e},GeoGlobe.Util.isElement=function(e){return!(!e||1!==e.nodeType)},GeoGlobe.Util.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},GeoGlobe.Util.removeItem=function(e,t){for(var i=e.length-1;i>=0;i--)e[i]==t&&e.splice(i,1);return e},GeoGlobe.Util.indexOf=function(e,t){if("function"==typeof e.indexOf)return e.indexOf(t);for(var i=0,r=e.length;i<r;i++)if(e[i]==t)return i;return-1},GeoGlobe.Util.dotless=/\./g,GeoGlobe.IMAGE_RELOAD_ATTEMPTS=0,GeoGlobe.Util.alphaHackNeeded=null,GeoGlobe.Util.alphaHack=function(){if(null==GeoGlobe.Util.alphaHackNeeded){var e=navigator.appVersion.split("MSIE"),t=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e[1]),i=!1;try{i=!!document.body.filters}catch(e){}GeoGlobe.Util.alphaHackNeeded=i&&t>=5.5&&t<7}return GeoGlobe.Util.alphaHackNeeded},GeoGlobe.Util.upperCaseObject=function(e){var t={};for(var i in e)t[i.toUpperCase()]=e[i];return t},GeoGlobe.Util.applyDefaults=function(e,t){e=e||{};var i="function"==typeof window.Event&&t instanceof window.Event;for(var r in t)(void 0===e[r]||!i&&t.hasOwnProperty&&t.hasOwnProperty(r)&&!e.hasOwnProperty(r))&&(e[r]=t[r]);return!i&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")&&(e.toString=t.toString),e},GeoGlobe.Util.getParameterString=function(e){var t=[];for(var i in e){var r=e[i];if(null!=r&&"function"!=typeof r){var o;if("object"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11___default()(r)&&r.constructor==Array){for(var n,s=[],a=0,l=r.length;a<l;a++)n=r[a],s.push(encodeURIComponent(null==n?"":n));o=s.join(",")}else o=encodeURIComponent(r);t.push(encodeURIComponent(i)+"="+o)}}return t.join("&")},GeoGlobe.Util.urlAppend=function(e,t){var i=e;if(t){var r=(e+" ").split(/[?&]/);i+=" "===r.pop()?t:r.length?"&"+t:"?"+t}return i},GeoGlobe.Util.getImagesLocation=function(){return GeoGlobe.ImgPath||GeoGlobe._getScriptLocation()+"img/"},GeoGlobe.Util.getImageLocation=function(e){return GeoGlobe.Util.getImagesLocation()+e},GeoGlobe.Util.Try=function(){for(var e=null,t=0,i=arguments.length;t<i;t++){var r=arguments[t];try{e=r();break}catch(e){}}return e},GeoGlobe.Util.getXmlNodeValue=function(e){var t=null;return GeoGlobe.Util.Try((function(){(t=e.text)||(t=e.textContent),t||(t=e.firstChild.nodeValue)}),(function(){t=e.textContent})),t},GeoGlobe.Util.mouseLeft=function(e,t){for(var i=e.relatedTarget?e.relatedTarget:e.toElement;i!=t&&null!=i;)i=i.parentNode;return i!=t},GeoGlobe.Util.DEFAULT_PRECISION=14,GeoGlobe.Util.toFloat=function(e,t){return null==t&&(t=GeoGlobe.Util.DEFAULT_PRECISION),"number"!=typeof e&&(e=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e)),0===t?e:_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e.toPrecision(t))},GeoGlobe.Util.rad=function(e){return e*Math.PI/180},GeoGlobe.Util.deg=function(e){return 180*e/Math.PI},GeoGlobe.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},GeoGlobe.Util.distVincenty=function(e,t){for(var i=GeoGlobe.Util.VincentyConstants,r=i.a,o=i.b,n=i.f,s=GeoGlobe.Util.rad(t.lng-e.lng),a=Math.atan((1-n)*Math.tan(GeoGlobe.Util.rad(e.lat))),l=Math.atan((1-n)*Math.tan(GeoGlobe.Util.rad(t.lat))),u=Math.sin(a),h=Math.cos(a),c=Math.sin(l),g=Math.cos(l),p=s,f=2*Math.PI,d=20;Math.abs(p-f)>1e-12&&--d>0;){var m=Math.sin(p),C=Math.cos(p),y=Math.sqrt(g*m*(g*m)+(h*c-u*g*C)*(h*c-u*g*C));if(0==y)return 0;var v=u*c+h*g*C,A=Math.atan2(y,v),_=Math.asin(h*g*m/y),I=Math.cos(_)*Math.cos(_),b=v-2*u*c/I,w=n/16*I*(4+n*(4-3*I));f=p,p=s+(1-w)*n*Math.sin(_)*(A+w*y*(b+w*v*(2*b*b-1)))}if(0==d)return NaN;var G=I*(r*r-o*o)/(o*o),E=G/1024*(256+G*(G*(74-47*G)-128));return(o*(1+G/16384*(4096+G*(G*(320-175*G)-768)))*(A-E*y*(b+E/4*(v*(2*b*b-1)-E/6*b*(4*y*y-3)*(4*b*b-3))))).toFixed(3)/1e3},GeoGlobe.Util.destinationVincenty=function(e,t,i){for(var r=GeoGlobe.Util,o=r.VincentyConstants,n=o.a,s=o.b,a=o.f,l=e.lng,u=e.lat,h=i,c=r.rad(t),g=Math.sin(c),p=Math.cos(c),f=(1-a)*Math.tan(r.rad(u)),d=1/Math.sqrt(1+f*f),m=f*d,C=Math.atan2(f,p),y=d*g,v=1-y*y,A=v*(n*n-s*s)/(s*s),_=1+A/16384*(4096+A*(A*(320-175*A)-768)),I=A/1024*(256+A*(A*(74-47*A)-128)),b=h/(s*_),w=2*Math.PI;Math.abs(b-w)>1e-12;){var G=Math.cos(2*C+b),E=Math.sin(b),S=Math.cos(b);w=b,b=h/(s*_)+I*E*(G+I/4*(S*(2*G*G-1)-I/6*G*(4*E*E-3)*(4*G*G-3)))}var P=m*E-d*S*p,T=Math.atan2(m*S+d*E*p,(1-a)*Math.sqrt(y*y+P*P)),x=a/16*v*(4+a*(4-3*v)),N=Math.atan2(E*g,d*S-m*E*p)-(1-x)*a*y*(b+x*E*(G+x*S*(2*G*G-1)));return Math.atan2(y,-P),new GeoGlobe.LngLat(l+r.deg(N),r.deg(T))},GeoGlobe.Util.getParameters=function(e,t){t=t||{},e=null==e?window.location.href:e;var i="";if(GeoGlobe.String.contains(e,"?")){var r=e.indexOf("?")+1,o=GeoGlobe.String.contains(e,"#")?e.indexOf("#"):e.length;i=e.substring(r,o)}for(var n={},s=i.split(/[&;]/),a=0,l=s.length;a<l;++a){var u=s[a].split("=");if(u[0]){var h=u[0];try{h=decodeURIComponent(h)}catch(e){h=unescape(h)}var c=(u[1]||"").replace(/\+/g," ");try{c=decodeURIComponent(c)}catch(e){c=unescape(c)}!1!==t.splitArgs&&(c=c.split(",")),1==c.length&&(c=c[0]),n[h]=c}}return n},GeoGlobe.Util.lastSeqID=0,GeoGlobe.Util.createUniqueID=function(e){return e=null==e?"id_":e.replace(GeoGlobe.Util.dotless,"_"),GeoGlobe.Util.lastSeqID+=1,e+GeoGlobe.Util.lastSeqID},GeoGlobe.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:1/.0254,km:39370,dd:4374754,yd:36},GeoGlobe.INCHES_PER_UNIT.in=GeoGlobe.INCHES_PER_UNIT.inches,GeoGlobe.INCHES_PER_UNIT.degrees=GeoGlobe.INCHES_PER_UNIT.dd,GeoGlobe.INCHES_PER_UNIT.nmi=1852*GeoGlobe.INCHES_PER_UNIT.m,GeoGlobe.METERS_PER_INCH=.0254000508001016,GeoGlobe.Util.extend(GeoGlobe.INCHES_PER_UNIT,{Inch:GeoGlobe.INCHES_PER_UNIT.inches,Meter:1/GeoGlobe.METERS_PER_INCH,Foot:.3048006096012192/GeoGlobe.METERS_PER_INCH,IFoot:.3048/GeoGlobe.METERS_PER_INCH,ClarkeFoot:.3047972651151/GeoGlobe.METERS_PER_INCH,SearsFoot:.30479947153867626/GeoGlobe.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/GeoGlobe.METERS_PER_INCH,IInch:.0254/GeoGlobe.METERS_PER_INCH,MicroInch:254e-7/GeoGlobe.METERS_PER_INCH,Mil:2.54e-8/GeoGlobe.METERS_PER_INCH,Centimeter:.01/GeoGlobe.METERS_PER_INCH,Kilometer:1e3/GeoGlobe.METERS_PER_INCH,Yard:.9144018288036576/GeoGlobe.METERS_PER_INCH,SearsYard:.914398414616029/GeoGlobe.METERS_PER_INCH,IndianYard:.9143985307444408/GeoGlobe.METERS_PER_INCH,IndianYd37:.91439523/GeoGlobe.METERS_PER_INCH,IndianYd62:.9143988/GeoGlobe.METERS_PER_INCH,IndianYd75:.9143985/GeoGlobe.METERS_PER_INCH,IndianFoot:.30479951/GeoGlobe.METERS_PER_INCH,IndianFt37:.30479841/GeoGlobe.METERS_PER_INCH,IndianFt62:.3047996/GeoGlobe.METERS_PER_INCH,IndianFt75:.3047995/GeoGlobe.METERS_PER_INCH,Mile:1609.3472186944373/GeoGlobe.METERS_PER_INCH,IYard:.9144/GeoGlobe.METERS_PER_INCH,IMile:1609.344/GeoGlobe.METERS_PER_INCH,NautM:1852/GeoGlobe.METERS_PER_INCH,"Lat-66":110943.31648893273/GeoGlobe.METERS_PER_INCH,"Lat-83":110946.25736872235/GeoGlobe.METERS_PER_INCH,Decimeter:.1/GeoGlobe.METERS_PER_INCH,Millimeter:.001/GeoGlobe.METERS_PER_INCH,Dekameter:10/GeoGlobe.METERS_PER_INCH,Decameter:10/GeoGlobe.METERS_PER_INCH,Hectometer:100/GeoGlobe.METERS_PER_INCH,GermanMeter:1.0000135965/GeoGlobe.METERS_PER_INCH,CaGrid:.999738/GeoGlobe.METERS_PER_INCH,ClarkeChain:20.1166194976/GeoGlobe.METERS_PER_INCH,GunterChain:20.11684023368047/GeoGlobe.METERS_PER_INCH,BenoitChain:20.116782494375872/GeoGlobe.METERS_PER_INCH,SearsChain:20.11676512155/GeoGlobe.METERS_PER_INCH,ClarkeLink:.201166194976/GeoGlobe.METERS_PER_INCH,GunterLink:.2011684023368047/GeoGlobe.METERS_PER_INCH,BenoitLink:.20116782494375873/GeoGlobe.METERS_PER_INCH,SearsLink:.2011676512155/GeoGlobe.METERS_PER_INCH,Rod:5.02921005842012/GeoGlobe.METERS_PER_INCH,IntnlChain:20.1168/GeoGlobe.METERS_PER_INCH,IntnlLink:.201168/GeoGlobe.METERS_PER_INCH,Perch:5.02921005842012/GeoGlobe.METERS_PER_INCH,Pole:5.02921005842012/GeoGlobe.METERS_PER_INCH,Furlong:201.1684023368046/GeoGlobe.METERS_PER_INCH,Rood:3.778266898/GeoGlobe.METERS_PER_INCH,CapeFoot:.3047972615/GeoGlobe.METERS_PER_INCH,Brealey:375/GeoGlobe.METERS_PER_INCH,ModAmFt:.304812252984506/GeoGlobe.METERS_PER_INCH,Fathom:1.8288/GeoGlobe.METERS_PER_INCH,"NautM-UK":1853.184/GeoGlobe.METERS_PER_INCH,"50kilometers":5e4/GeoGlobe.METERS_PER_INCH,"150kilometers":15e4/GeoGlobe.METERS_PER_INCH}),GeoGlobe.Util.extend(GeoGlobe.INCHES_PER_UNIT,{mm:GeoGlobe.INCHES_PER_UNIT.Meter/1e3,cm:GeoGlobe.INCHES_PER_UNIT.Meter/100,dm:100*GeoGlobe.INCHES_PER_UNIT.Meter,km:1e3*GeoGlobe.INCHES_PER_UNIT.Meter,kmi:GeoGlobe.INCHES_PER_UNIT.nmi,fath:GeoGlobe.INCHES_PER_UNIT.Fathom,ch:GeoGlobe.INCHES_PER_UNIT.IntnlChain,link:GeoGlobe.INCHES_PER_UNIT.IntnlLink,"us-in":GeoGlobe.INCHES_PER_UNIT.inches,"us-ft":GeoGlobe.INCHES_PER_UNIT.Foot,"us-yd":GeoGlobe.INCHES_PER_UNIT.Yard,"us-ch":GeoGlobe.INCHES_PER_UNIT.GunterChain,"us-mi":GeoGlobe.INCHES_PER_UNIT.Mile,"ind-yd":GeoGlobe.INCHES_PER_UNIT.IndianYd37,"ind-ft":GeoGlobe.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/GeoGlobe.METERS_PER_INCH}),GeoGlobe.DOTS_PER_INCH=96,GeoGlobe.Util.normalizeScale=function(e){return e>1?1/e:e},GeoGlobe.Util.getResolutionFromScale=function(e,t){var i;return e&&(null==t&&(t="degrees"),i=1/(GeoGlobe.Util.normalizeScale(e)*GeoGlobe.INCHES_PER_UNIT[t]*GeoGlobe.DOTS_PER_INCH)),i},GeoGlobe.Util.getScaleFromResolution=function(e,t){return null==t&&(t="degrees"),e*GeoGlobe.INCHES_PER_UNIT[t]*GeoGlobe.DOTS_PER_INCH},GeoGlobe.Util.pagePosition=function(e){var t=[0,0],i=GeoGlobe.Util.getViewportElement();if(!e||e==window||e==i)return t;var r,o=GeoGlobe.IS_GECKO&&document.getBoxObjectFor&&"absolute"==GeoGlobe.Element.getStyle(e,"position")&&(""==e.style.top||""==e.style.left),n=null;if(e.getBoundingClientRect){r=e.getBoundingClientRect();var s=window.pageYOffset||i.scrollTop,a=window.pageXOffset||i.scrollLeft;t[0]=r.left+a,t[1]=r.top+s}else if(document.getBoxObjectFor&&!o){r=document.getBoxObjectFor(e);var l=document.getBoxObjectFor(i);t[0]=r.screenX-l.screenX,t[1]=r.screenY-l.screenY}else{if(t[0]=e.offsetLeft,t[1]=e.offsetTop,(n=e.offsetParent)!=e)for(;n;)t[0]+=n.offsetLeft,t[1]+=n.offsetTop,n=n.offsetParent;var u=GeoGlobe.BROWSER_NAME;for(("opera"==u||"safari"==u&&"absolute"==GeoGlobe.Element.getStyle(e,"position"))&&(t[1]-=document.body.offsetTop),n=e.offsetParent;n&&n!=document.body;)t[0]-=n.scrollLeft,"opera"==u&&"TR"==n.tagName||(t[1]-=n.scrollTop),n=n.offsetParent}return t},GeoGlobe.Util.getViewportElement=function(){var e=arguments.callee.viewportElement;return null==e&&(e="msie"==GeoGlobe.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=e),e},GeoGlobe.Util.isEquivalentUrl=function(e,t,i){i=i||{},GeoGlobe.Util.applyDefaults(i,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});var r=GeoGlobe.Util.createUrlObject(e,i),o=GeoGlobe.Util.createUrlObject(t,i);for(var n in r)if("args"!==n&&r[n]!=o[n])return!1;for(var n in r.args){if(r.args[n]!=o.args[n])return!1;delete o.args[n]}for(var n in o.args)return!1;return!0},GeoGlobe.Util.createUrlObject=function(e,t){if(t=t||{},!/^\w+:\/\//.test(e)){var i=window.location,r=i.port?":"+i.port:"",o=i.protocol+"//"+i.host.split(":").shift()+r;if(0===e.indexOf("/"))e=o+e;else{var n=i.pathname.split("/");n.pop(),e=o+n.join("/")+"/"+e}}t.ignoreCase&&(e=e.toLowerCase());var s=document.createElement("a");s.href=e;var a={};a.host=s.host.split(":").shift(),a.protocol=s.protocol,t.ignorePort80?a.port="80"==s.port||"0"==s.port?"":s.port:a.port=""==s.port||"0"==s.port?"80":s.port,a.hash=t.ignoreHash||"#"===s.hash?"":s.hash;var l=s.search;if(!l){var u=e.indexOf("?");l=-1!=u?e.substr(u):""}return a.args=GeoGlobe.Util.getParameters(l,{splitArgs:t.splitArgs}),a.pathname="/"==s.pathname.charAt(0)?s.pathname:"/"+s.pathname,a},GeoGlobe.Util.removeTail=function(e){var t=e.indexOf("?"),i=e.indexOf("#");return-1==t?-1!=i?e.substr(0,i):e:-1!=i?e.substr(0,Math.min(t,i)):e.substr(0,t)},GeoGlobe.IS_GECKO=(e=navigator.userAgent.toLowerCase(),-1==e.indexOf("webkit")&&-1!=e.indexOf("gecko")),GeoGlobe.CANVAS_SUPPORTED=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}(),GeoGlobe.BROWSER_NAME=function(){var e="",t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("opera")?e="opera":-1!=t.indexOf("msie")?e="msie":-1!=t.indexOf("safari")?e="safari":-1!=t.indexOf("mozilla")&&(e=-1!=t.indexOf("firefox")?"firefox":"mozilla"),e}(),GeoGlobe.Util.getBrowserName=function(){return GeoGlobe.BROWSER_NAME},GeoGlobe.Util.getScrollbarWidth=function(){var e=GeoGlobe.Util._scrollbarWidth;if(null==e){var t,i,r=null,o=null;(r=document.createElement("div")).style.position="absolute",r.style.top="-1000px",r.style.left="-1000px",r.style.width="100px",r.style.height="50px",r.style.overflow="hidden",(o=document.createElement("div")).style.width="100%",o.style.height="200px",r.appendChild(o),document.body.appendChild(r),t=o.offsetWidth,r.style.overflow="scroll",i=o.offsetWidth,document.body.removeChild(document.body.lastChild),GeoGlobe.Util._scrollbarWidth=t-i,e=GeoGlobe.Util._scrollbarWidth}return e},GeoGlobe.Util.randomStr=function(e){for(var t="",i=[],r=0;r<e;r++){var o=Math.ceil(25*Math.random());i.push(String.fromCharCode(97+o))}for(r=0;r<e;r++)t+=i[r];return t},GeoGlobe.Util.globalEval=function(e){e&&GeoGlobe.String.trim(e)&&(window.execScript||function(e){window.eval.call(window,e)})(e)},GeoGlobe.Util.getResolutionFromScale_DPI=function(e,t,i){var r;return e&&(null==t&&(t="degrees"),r=1/(GeoGlobe.Util.normalizeScale(e)*GeoGlobe.INCHES_PER_UNIT[t]*i)),r},GeoGlobe.Util.getScaleFromResolution_DPI=function(e,t,i){return null==t&&(t="degrees"),e*GeoGlobe.INCHES_PER_UNIT[t]*i},GeoGlobe.Util.getMapLevelFormResolution=function(e,t){if(!t)return 0;var i,r,o=Number.POSITIVE_INFINITY,n=e.getResolutions();for(i=0,len=n.length;i<len&&!((r=Math.abs(n[i]-t))>o);i++)o=r;return Math.max(0,i-1)},GeoGlobe.Util.getMapLevelFormScale=function(e,t,i,r){i=i||"degrees",r=r||96;var o=GeoGlobe.Util.getResolutionFromScale_DPI(t,i,r);return GeoGlobe.Util.getMapLevelFormResolution(e,o)},GeoGlobe.Util.delayFun=function(e,t,i){var r;return function(){var o=this,n=arguments,s=i&&!r;clearTimeout(r),r=setTimeout((function(){r=null,i||e.apply(o,n)}),t),s&&e.apply(o,n)}},GeoGlobe.Util.clone=function(e){if("object"!=_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11___default()(e))return e;if(null==e)return e;var t=e.constructor==Array?[]:{};for(var i in e)t[i]=GeoGlobe.Util.clone(e[i]);return t},GeoGlobe.Util.getType=function(e){var t=Object.prototype.toString;return e instanceof Element?"element":{"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Undefined]":"undefined","[object Null]":"null","[object Object]":"object"}[t.call(e)]},GeoGlobe.Util.formatNumberToThousands=function(e,t,i){e=e.toString().replace(/\$|\,/g,""),isNaN(e)&&(e="0");var r=e===(e=Math.abs(e)),o=(e=Math.floor(e*Math.pow(10,t)+.50000000001))%Math.pow(10,t);for(e=Math.floor(e/Math.pow(10,t)).toString(),o=o.toString();o.length<t;)o="0"+o;if(i)for(var n=0;n<Math.floor((e.length-(1+n))/3);n++)e=e.substring(0,e.length-(4*n+3))+","+e.substring(e.length-(4*n+3));return t>0?(r?"":"-")+e+"."+o:(r?"":"-")+e},GeoGlobe.Util.getFormattedString=function(e,t){var i=t;if((i=(i=i.replace(/{a}/g,e.a)).replace(/{b}/g,e.b)).contains("{c"))for(var r=i.split("{c"),o=0,n=0;n<r.length-1;n++)o=r[n+1].split("}")[0],i=i.replace(new RegExp("{c"+o+"}","g"),GeoGlobe.Util.formatNumberToThousands(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e.c),""===o?2:o,!0));return i},GeoGlobe.Util.getGradientImageData=function(e){var t=document.createElement("canvas"),i=t.getContext("2d");t.width=1,t.height=256;var r=i.createLinearGradient(0,0,0,256);for(var o in e)e.hasOwnProperty(o)&&r.addColorStop(o,e[o]);return i.fillStyle=r,i.fillRect(0,0,1,256),i.getImageData(0,0,1,256).data},GeoGlobe.Util.getRgbColor=function(e){if((e=e.toLowerCase())&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)){if(4===e.length){for(var t="#",i=1;i<4;i+=1)t+=e.slice(i,i+1).concat(e.slice(i,i+1));e=t}for(t=[],i=1;i<7;i+=2)t.push(_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()("0x"+e.slice(i,i+2)));return"rgb("+t.join(",")+")"}return e.startsWith("rgba")||e.startsWith("hsla")?e.substring(0,3)+e.substring(4,e.lastIndexOf(","))+")":e.startsWith("rgb")||e.startsWith("hsl")?e:""},GeoGlobe.Util.getShadeColor=function(e,t){e=(e=GeoGlobe.Util.getHexColor(e)).substr(1);var i=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e,16),r=Math.round(2.55*t),o=(i>>16)+r,n=(i>>8&255)+r,s=(255&i)+r;return"#"+(16777216+65536*(o<255?o<1?0:o:255)+256*(n<255?n<1?0:n:255)+(s<255?s<1?0:s:255)).toString(16).slice(1)},GeoGlobe.Util.getHexColor=function(e){if(e=e.toLowerCase(),/^(rgb|rgba)/.test(e)){for(var t=e.split("(")[1].split(")")[0].split(","),i="#",r=0;r<3;r++){var o=Number(t[r]).toString(16);"0"===o&&(o+=o),1===o.length&&(o="0"+o),i+=o}return 7!==i.length&&(i=e),i}if(!/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(e))return e;var n=e.replace(/#/,"").split("");if(6===n.length)return e;if(3===n.length){var s="#";for(r=0;r<n.length;r+=1)s+=n[r]+n[r];return s}},GeoGlobe.Util.transferToLonLat=function(e){return-238107693.23182276===e[1]?[e[0]/20037508.34*180,-90]:[e[0]/20037508.34*180,180/Math.PI*(2*Math.atan(Math.exp(e[1]/20037508.34*180*Math.PI/180))-Math.PI/2)]},GeoGlobe.Util.transferToMercator=function(e){return-90===e[1]?[20037508.34*e[0]/180,-238107693.23182276]:[20037508.34*e[0]/180,Math.log(Math.tan((90+e[1])*Math.PI/360))/(Math.PI/180)*20037508.34/180]},GeoGlobe.ProjAxisOrder={AXIS_ORDER_EN:!0,AXIS_ORDER_NE:!1},GeoGlobe.ProjAxisOrder.AxisOrder={"EPSG:900913":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,WGS84:GeoGlobe.ProjAxisOrder.AXIS_ORDER_NE,"IGNF:WGS84G":GeoGlobe.ProjAxisOrder.AXIS_ORDER_NE,"EPSG:4326":GeoGlobe.ProjAxisOrder.AXIS_ORDER_NE,"EPSG:4490":GeoGlobe.ProjAxisOrder.AXIS_ORDER_NE,"EPSG:4269":GeoGlobe.ProjAxisOrder.AXIS_ORDER_NE,"EPSG:2361":GeoGlobe.ProjAxisOrder.AXIS_ORDER_NE,"EPSG:27700":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:904490":GeoGlobe.ProjAxisOrder.AXIS_ORDER_NE,"EPSG:4171":GeoGlobe.ProjAxisOrder.AXIS_ORDER_NE,"EPSG:32637":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:32638":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:32639":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:32640":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:32641":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:28991":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:28992":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:31300":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:31370":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:2176":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:2177":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:2178":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:2179":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:2180":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:2154":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:3346":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:3857":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:2065":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN},GeoGlobe.SpatialReference=GeoGlobe.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(e,t){GeoGlobe.Util.extend(this,t),this.projCode=e,"object"==("undefined"==typeof Proj4js?"undefined":_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11___default()(Proj4js))&&(this.proj=new Proj4js.Proj(e))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(e){var t=e,i=!1;if(t)if(t instanceof GeoGlobe.SpatialReference||(t=new GeoGlobe.SpatialReference(t)),"object"==("undefined"==typeof Proj4js?"undefined":_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11___default()(Proj4js))&&this.proj.defData&&t.proj.defData)i=this.proj.defData.replace(this.titleRegEx,"")==t.proj.defData.replace(this.titleRegEx,"");else if(t.getCode){var r=this.getCode(),o=t.getCode();i=r==o||!!GeoGlobe.SpatialReference.transforms[r]&&GeoGlobe.SpatialReference.transforms[r][o]===GeoGlobe.SpatialReference.nullTransform}return i},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"GeoGlobe.SpatialReference"}),GeoGlobe.SpatialReference.transforms={},GeoGlobe.SpatialReference.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}},GeoGlobe.SpatialReference.addTransform=function(e,t,i){if(i===GeoGlobe.SpatialReference.nullTransform){var r=GeoGlobe.SpatialReference.defaults[e];r&&!GeoGlobe.SpatialReference.defaults[t]&&(GeoGlobe.SpatialReference.defaults[t]=r)}GeoGlobe.SpatialReference.transforms[e]||(GeoGlobe.SpatialReference.transforms[e]={}),GeoGlobe.SpatialReference.transforms[e][t]=i},GeoGlobe.SpatialReference.transform=function(e,t,i){if(t&&i)if(t instanceof GeoGlobe.SpatialReference||(t=new GeoGlobe.SpatialReference(t)),i instanceof GeoGlobe.SpatialReference||(i=new GeoGlobe.SpatialReference(i)),t.proj&&i.proj)e=Proj4js.transform(t.proj,i.proj,e);else{var r=t.getCode(),o=i.getCode(),n=GeoGlobe.SpatialReference.transforms;n[r]&&n[r][o]&&n[r][o](e)}return e},GeoGlobe.SpatialReference.nullTransform=function(e){return e},function(){var e=20037508.34;function t(t){return t.x=180*t.x/e,t.y=180/Math.PI*(2*Math.atan(Math.exp(t.y/e*Math.PI))-Math.PI/2),t}function i(t){t.x=t.x*e/180;var i=Math.log(Math.tan((90+t.y)*Math.PI/360))/Math.PI*e;return t.y=Math.max(-20037508.34,Math.min(i,20037508.34)),t}function r(e,r){var o,n,s,a,l,u=GeoGlobe.SpatialReference.addTransform,h=GeoGlobe.SpatialReference.nullTransform;for(o=0,n=r.length;o<n;++o)for(u(e,s=r[o],i),u(s,e,t),l=o+1;l<n;++l)u(s,a=r[l],h),u(a,s,h)}var o,n=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],s=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(o=n.length-1;o>=0;--o)r(n[o],s);for(o=s.length-1;o>=0;--o)r(s[o],n)}(),GeoGlobe.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(e){alert(e)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"GeoGlobe.Console"},function(){for(var e=document.getElementsByTagName("script"),t=0,i=e.length;t<i;++t)if(-1!=e[t].src.indexOf("firebug.js")&&console){GeoGlobe.Util.extend(GeoGlobe.Console,console);break}}(),GeoGlobe.ProxyHost="",GeoGlobe.Request||(GeoGlobe.Request={}),GeoGlobe.Util.extend(GeoGlobe.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:GeoGlobe.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,makeSameOrigin:function(e,t){var i=0!==e.indexOf("http"),r=!i&&e.match(this.URL_SPLIT_REGEX);if(r){var o=window.location;i=r[1]==o.protocol&&r[3]==o.hostname;var n=r[4],s=o.port;(80!=n&&""!=n||"80"!=s&&""!=s)&&(i=i&&n==s)}return i||t&&(e="function"==typeof t?t(e):e.indexOf("cts?")>=0?t+e:t+encodeURIComponent(e)),e},issue:function(e){var t=GeoGlobe.Util.extend(this.DEFAULT_CONFIG,{proxy:GeoGlobe.ProxyHost});(e=e||{}).headers=e.headers||{},(e=GeoGlobe.Util.applyDefaults(e,t)).headers=GeoGlobe.Util.applyDefaults(e.headers,t.headers);var i,r=!1;for(i in e.headers)e.headers.hasOwnProperty(i)&&"x-requested-with"===i.toLowerCase()&&(r=!0);!1===r&&(e.headers["X-Requested-With"]="XMLHttpRequest");var o=new GeoGlobe.Request.XMLHttpRequest;e.url=encodeURI(e.url);var n=GeoGlobe.Util.urlAppend(e.url,GeoGlobe.Util.getParameterString(e.params||{}));for(var s in n=GeoGlobe.Request.makeSameOrigin(n,e.proxy),o.open(e.method,n,e.async,e.user,e.password),e.headers)o.setRequestHeader(s,e.headers[s]);var a=this;return o.onreadystatechange=function(){o.readyState==GeoGlobe.Request.XMLHttpRequest.DONE&&a.runCallbacks({request:o,config:e,requestUrl:n})},!1===e.async?o.send(e.data):window.setTimeout((function(){0!==o.readyState&&o.send(e.data)}),0),o},runCallbacks:function(e){var t,i,r=e.request,o=e.config,n=o.scope?GeoGlobe.Function.bind(o.callback,o.scope):o.callback;o.success&&(t=o.scope?GeoGlobe.Function.bind(o.success,o.scope):o.success),o.failure&&(i=o.scope?GeoGlobe.Function.bind(o.failure,o.scope):o.failure),"file:"==GeoGlobe.Util.createUrlObject(o.url).protocol&&r.responseText&&(r.status=200),n(r),(!r.status||r.status>=200&&r.status<300)&&t&&t(r),r.status&&(r.status<200||r.status>=300)&&i&&i(r)},GET:function(e){return e=GeoGlobe.Util.extend(e,{method:"GET"}),GeoGlobe.Request.issue(e)},POST:function(e){return(e=GeoGlobe.Util.extend(e,{method:"POST"})).headers=e.headers?e.headers:{},"CONTENT-TYPE"in GeoGlobe.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),GeoGlobe.Request.issue(e)},PUT:function(e){return(e=GeoGlobe.Util.extend(e,{method:"PUT"})).headers=e.headers?e.headers:{},"CONTENT-TYPE"in GeoGlobe.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),GeoGlobe.Request.issue(e)},DELETE:function(e){return e=GeoGlobe.Util.extend(e,{method:"DELETE"}),GeoGlobe.Request.issue(e)},HEAD:function(e){return e=GeoGlobe.Util.extend(e,{method:"HEAD"}),GeoGlobe.Request.issue(e)},OPTIONS:function(e){return e=GeoGlobe.Util.extend(e,{method:"OPTIONS"}),GeoGlobe.Request.issue(e)}}),GeoGlobe.nullHandler=function(e){GeoGlobe.Console.userError(GeoGlobe.i18n("unhandledRequest",{statusText:e.statusText}))},GeoGlobe.loadURL=function(e,t,i,r,o){"string"==typeof t&&(t=GeoGlobe.Util.getParameters(t));var n=r||GeoGlobe.nullHandler,s=o||GeoGlobe.nullHandler;return GeoGlobe.Request.GET({url:e,params:t,success:n,failure:s,scope:i})},GeoGlobe.Request.setProxyHost=function(e){GeoGlobe.ProxyHost=e},GeoGlobe.Request.getProxyHost=function(){return GeoGlobe.ProxyHost},GeoGlobe.appendToProxy=function(e){var t=e.split("?"),i=GeoGlobe.ProxyHost+encodeURI(encodeURI(t[0]));return 2===t.length&&(i+="?"+t[1]),i},GeoGlobe.loadScript=function(e){GeoGlobe.Request.GET({url:e,async:!1,headers:{Accept:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript, */*; q=0.01"},success:function(e){GeoGlobe.Util.globalEval(e.responseText)},failure:function(t){alert("加载:"+e+" 失败。")}})},function(){var e=window.XMLHttpRequest,t=!!window.controllers,i=window.document.all&&!window.opera,r=i&&window.navigator.userAgent.match(/MSIE 7.0/);function o(){this._object=e&&!r?new e:new window.ActiveXObject("Microsoft.XMLHTTP"),this._listeners=[]}function n(){return new o}function s(e){n.onreadystatechange&&n.onreadystatechange.apply(e),e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function a(e){try{e.responseText=e._object.responseText}catch(e){}try{e.responseXML=(r=(t=e._object).responseXML,o=t.responseText,i&&o&&r&&!r.documentElement&&t.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&((r=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,r.validateOnParse=!1,r.loadXML(o)),r&&(i&&0!=r.parseError||!r.documentElement||r.documentElement&&"parsererror"==r.documentElement.tagName)?null:r)}catch(e){}var t,r,o;try{e.status=e._object.status}catch(e){}try{e.statusText=e._object.statusText}catch(e){}}function l(e){e._object.onreadystatechange=new window.Function}n.prototype=o.prototype,t&&e.wrapped&&(n.wrapped=e.wrapped),n.UNSENT=0,n.OPENED=1,n.HEADERS_RECEIVED=2,n.LOADING=3,n.DONE=4,n.prototype.readyState=n.UNSENT,n.prototype.responseText="",n.prototype.responseXML=null,n.prototype.status=0,n.prototype.statusText="",n.prototype.priority="NORMAL",n.prototype.onreadystatechange=null,n.onreadystatechange=null,n.onopen=null,n.onsend=null,n.onabort=null,n.prototype.open=function(e,r,o,u,h){delete this._headers,arguments.length<3&&(o=!0),this._async=o;var c,g=this,p=this.readyState;i&&o&&(c=function(){p!=n.DONE&&(l(g),g.abort())},window.attachEvent("onunload",c)),n.onopen&&n.onopen.apply(this,arguments),arguments.length>4?this._object.open(e,r,o,u,h):arguments.length>3?this._object.open(e,r,o,u):this._object.open(e,r,o);try{this._object.responseType="msxml-document"}catch(e){}this.readyState=n.OPENED,s(this),this._object.onreadystatechange=function(){t&&!o||(g.readyState=g._object.readyState,a(g),g._aborted?g.readyState=n.UNSENT:(g.readyState==n.DONE&&(delete g._data,l(g),i&&o&&window.detachEvent("onunload",c)),p!=g.readyState&&s(g),p=g.readyState))}},n.prototype.send=function(e){n.onsend&&n.onsend.apply(this,arguments),arguments.length||(e=null),e&&e.nodeType&&(e=window.XMLSerializer?(new window.XMLSerializer).serializeToString(e):e.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=e,function(e){if(e._object.send(e._data),t&&!e._async)for(e.readyState=n.OPENED,a(e);e.readyState<n.DONE;)if(e.readyState++,s(e),e._aborted)return}(this)},n.prototype.abort=function(){n.onabort&&n.onabort.apply(this,arguments),this.readyState>n.UNSENT&&(this._aborted=!0),this._object.abort(),l(this),this.readyState=n.UNSENT,delete this._data},n.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},n.prototype.getResponseHeader=function(e){return this._object.getResponseHeader(e)},n.prototype.setRequestHeader=function(e,t){return this._headers||(this._headers={}),this._headers[e]=t,this._object.setRequestHeader(e,t)},n.prototype.addEventListener=function(e,t,i){for(var r,o=0;r=this._listeners[o];o++)if(r[0]==e&&r[1]==t&&r[2]==i)return;this._listeners.push([e,t,i])},n.prototype.removeEventListener=function(e,t,i){for(var r,o=0;(r=this._listeners[o])&&(r[0]!=e||r[1]!=t||r[2]!=i);o++);r&&this._listeners.splice(o,1)},n.prototype.dispatchEvent=function(e){var t={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==t.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[t]);for(var i,r=0;i=this._listeners[r];r++)i[0]!=t.type||i[2]||(i[1].handleEvent||i[1]).apply(this,[t])},n.prototype.toString=function(){return"[object XMLHttpRequest]"},n.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(e,t){t||(t=[]),e.__func=this,e.__func(t[0],t[1],t[2],t[3],t[4]),delete e.__func}),GeoGlobe.Request||(GeoGlobe.Request={}),GeoGlobe.Request.XMLHttpRequest=n}(),GeoGlobe.Lang={code:null,defaultCode:"zh-CN",getCode:function(){return GeoGlobe.Lang.code||GeoGlobe.Lang.setCode(),GeoGlobe.Lang.code},setCode:function(e){var t;e||(e="msie"==GeoGlobe.BROWSER_NAME?navigator.userLanguage:navigator.language);var i=e.split("-");if(i[0]=i[0].toLowerCase(),"object"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11___default()(GeoGlobe.Lang[i[0]])&&(t=i[0]),i[1]){var r=i[0]+"-"+i[1].toUpperCase();"object"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11___default()(GeoGlobe.Lang[r])&&(t=r)}t||(GeoGlobe.Console.warn("Failed to find GeoGlobe.Lang."+i.join("-")+" dictionary, falling back to default language"),t=GeoGlobe.Lang.defaultCode),GeoGlobe.Lang.code=t},translate:function(e,t){var i=GeoGlobe.Lang[GeoGlobe.Lang.getCode()],r=i&&i[e];return r||(r=e),t&&(r=GeoGlobe.String.format(r,t)),r}},GeoGlobe.i18n=GeoGlobe.Lang.translate,GeoGlobe.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",end:""},GeoGlobe.Lang["zh-CN"]={unhandledRequest:"未处理的请求，返回值为 ${statusText}",end:""},GeoGlobe.String={startsWith:function(e,t){return 0==e.indexOf(t)},contains:function(e,t){return-1!=e.indexOf(t)},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(e){for(var t=e.split("-"),i=t[0],r=1,o=t.length;r<o;r++){var n=t[r];i+=n.charAt(0).toUpperCase()+n.substring(1)}return i},format:function(e,t,i){return t||(t=window),e.replace(GeoGlobe.String.tokenRegEx,(function(e,r){for(var o,n=r.split(/\.+/),s=0;s<n.length&&(0==s&&(o=t),void 0!==o);s++)o=o[n[s]];return"function"==typeof o&&(o=i?o.apply(null,i):o()),void 0===o?"undefined":o}))},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(e){return GeoGlobe.String.numberRegEx.test(e)},numericIf:function(e,t){var i=e;return!0===t&&null!=e&&e.replace&&(e=e.replace(/^\s*|\s*$/g,"")),GeoGlobe.String.isNumeric(e)?_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e):i}},GeoGlobe.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,t){var i=0;return t>0&&(i=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e.toPrecision(t))),i},format:function(e,t,i,r){t=void 0!==t?t:0,i=void 0!==i?i:GeoGlobe.Number.thousandsSeparator,r=void 0!==r?r:GeoGlobe.Number.decimalSeparator,null!=t&&(e=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e.toFixed(t)));var o=e.toString().split(".");1==o.length&&null==t&&(t=0);var n,s=o[0];if(i)for(var a=/(-?[0-9]+)([0-9]{3})/;a.test(s);)s=s.replace(a,"$1"+i+"$2");if(0==t)n=s;else{var l=o.length>1?o[1]:"0";null!=t&&(l+=new Array(t-l.length+1).join("0")),n=s+r+l}return n},zeroPad:function(e,t,i){for(var r=e.toString(i||10);r.length<t;)r="0"+r;return r}},GeoGlobe.Function={bind:function(e,t){var i=Array.prototype.slice.apply(arguments,[2]);return function(){var r=i.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,r)}},bindAsEventListener:function(e,t){return function(i){return e.call(t,i||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},GeoGlobe.Array={filter:function(e,t,i){var r=[];if(Array.prototype.filter)r=e.filter(t,i);else{var o=e.length;if("function"!=typeof t)throw new TypeError;for(var n=0;n<o;n++)if(n in e){var s=e[n];t.call(i,s,n,e)&&r.push(s)}}return r}},String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var i=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>i.length)&&(t=i.length),t-=e.length;var r=i.lastIndexOf(e,t);return-1!==r&&r===t}),GeoGlobe.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:"toISOString"in Date.prototype?function(e){return e.toISOString()}:function(e){return isNaN(e.getTime())?"Invalid Date":e.getUTCFullYear()+"-"+GeoGlobe.Number.zeroPad(e.getUTCMonth()+1,2)+"-"+GeoGlobe.Number.zeroPad(e.getUTCDate(),2)+"T"+GeoGlobe.Number.zeroPad(e.getUTCHours(),2)+":"+GeoGlobe.Number.zeroPad(e.getUTCMinutes(),2)+":"+GeoGlobe.Number.zeroPad(e.getUTCSeconds(),2)+"."+GeoGlobe.Number.zeroPad(e.getUTCMilliseconds(),3)+"Z"},parse:function(e){var t,i=e.match(this.dateRegEx);if(i&&(i[1]||i[7])){var r=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[1],10)||0,o=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[2],10)-1||0,n=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[3],10)||1;t=new Date(Date.UTC(r,o,n));var s=i[7];if(s){var a=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[4],10),l=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[5],10),u=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(i[6]),h=0|u,c=Math.round(1e3*(u-h));if(t.setUTCHours(a,l,h,c),"Z"!==s){var g=-1e3*(60*_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(s,10)*60+60*(_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[8],10)||0));t=new Date(t.getTime()+g)}}}else t=new Date("invalid");return t}},function(e){"object"==("undefined"==typeof exports?"undefined":_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11___default()(exports))&&void 0!==module?module.exports=e():"function"==typeof define&&__webpack_require__(117)?define([],e):("undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:this)._GeoGlobe=e()}((function(){return function e(t,i,r){function o(s,a){if(!i[s]){if(!t[s]){if(!a&&("function"==typeof require&&require))return require(s,!0);if(n)return n(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[s]={exports:{}};t[s][0].call(u.exports,(function(e){return o(t[s][1][e]||e)}),u,u.exports,e,t,i,r)}return i[s].exports}for(var n="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,i){var r=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");this.lng=+e,this.lat=+t};r.prototype.wrap=function(){return new r((i=((this.lng-(e=-180))%(t=180-e)+t)%t+e)===e?180:i,this.lat);var e,t,i},r.prototype.toArray=function(){return[this.lng,this.lat]},r.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},r.prototype.toBounds=function(t){var i=360*t/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new(e("./lng_lat_bounds"))(new r(this.lng-o,this.lat-i),new r(this.lng+o,this.lat+i))},r.convert=function(e){if(e instanceof r)return e;if(_babel_runtime_corejs2_core_js_array_is_array__WEBPACK_IMPORTED_MODULE_4___default()(e)&&2===e.length)return new r(Number(e[0]),Number(e[1]));if(!_babel_runtime_corejs2_core_js_array_is_array__WEBPACK_IMPORTED_MODULE_4___default()(e)&&"object"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11___default()(e)&&null!==e)return new r(Number(e.lng),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")},t.exports=r},{"./lng_lat_bounds":2}],2:[function(e,t,i){var r=e("./lng_lat"),o=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};o.prototype.setNorthEast=function(e){return this._ne=e instanceof r?new r(e.lng,e.lat):r.convert(e),this},o.prototype.setSouthWest=function(e){return this._sw=e instanceof r?new r(e.lng,e.lat):r.convert(e),this},o.prototype.extend=function(e){var t,i,n=this._sw,s=this._ne;if(e instanceof r)t=e,i=e;else{if(!(e instanceof o))return _babel_runtime_corejs2_core_js_array_is_array__WEBPACK_IMPORTED_MODULE_4___default()(e)?e.every(_babel_runtime_corejs2_core_js_array_is_array__WEBPACK_IMPORTED_MODULE_4___default.a)?this.extend(o.convert(e)):this.extend(r.convert(e)):this;if(t=e._sw,i=e._ne,!t||!i)return this}return n||s?(n.lng=Math.min(t.lng,n.lng),n.lat=Math.min(t.lat,n.lat),s.lng=Math.max(i.lng,s.lng),s.lat=Math.max(i.lat,s.lat)):(this._sw=new r(t.lng,t.lat),this._ne=new r(i.lng,i.lat)),this},o.prototype.getCenter=function(){return new r((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},o.prototype.getSouthWest=function(){return this._sw},o.prototype.getNorthEast=function(){return this._ne},o.prototype.getNorthWest=function(){return new r(this.getWest(),this.getNorth())},o.prototype.getSouthEast=function(){return new r(this.getEast(),this.getSouth())},o.prototype.getWest=function(){return this._sw.lng},o.prototype.getSouth=function(){return this._sw.lat},o.prototype.getEast=function(){return this._ne.lng},o.prototype.getNorth=function(){return this._ne.lat},o.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},o.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},o.convert=function(e){return!e||e instanceof o?e:new o(e)},t.exports=o},{"./lng_lat":1}],3:[function(e,t,i){var r=e("./geo/lng_lat"),o=e("./geo/lng_lat_bounds");t.exports={LngLat:r,LngLatBounds:o}},{"./geo/lng_lat":1,"./geo/lng_lat_bounds":2}]},{},[3])(3)})),window.GeoGlobe.Util.extend(window.GeoGlobe,window._GeoGlobe),GeoGlobe.LngLat.prototype.CLASS_NAME="GeoGlobe.LngLat",GeoGlobe.LngLatBounds.prototype.clone=function(){return new GeoGlobe.LngLatBounds(this._sw,this._ne)},GeoGlobe.LngLatBounds.prototype.contains=function(e,t,i){return null==i&&(i=!0),null!=e&&null!=t&&(e=GeoGlobe.Util.toFloat(e),t=GeoGlobe.Util.toFloat(t),i?e>=this._sw.lng&&e<=this._ne.lng&&t>=this._sw.lat&&t<=this._ne.lat:e>this._sw.lng&&e<this._ne.lng&&t>this._sw.lat&&t<this._ne.lat)},GeoGlobe.LngLatBounds.prototype.getWidth=function(){return this._ne.lng-this._sw.lng},GeoGlobe.LngLatBounds.prototype.containsLonLat=function(e,t){"boolean"==typeof t&&(t={inclusive:t}),t=t||{};var i=this.contains(e.lng,e.lat,t.inclusive),r=t.worldBounds;if(r&&!i){var o=r.getWidth(),n=(r._sw.lng+r._ne.lng)/2,s=Math.round((e.lng-n)/o);i=this.containsLonLat({lng:e.lng-s*o,lat:e.lat},{inclusive:t.inclusive})}return i},GeoGlobe.LngLatBounds.prototype.equals=function(e){var t=!1;return null!=e&&(t=this._sw.lng==e._sw.lng&&this._ne.lng==e._ne.lng&&this._ne.lat==e._ne.lat&&this._sw.lat==e._sw.lat),t},GeoGlobe.LngLatBounds.prototype.toBBOX=function(e,t){null==e&&(e=6);var i=Math.pow(10,e),r=Math.round(this._sw.lng*i)/i,o=Math.round(this._sw.lat*i)/i,n=Math.round(this._ne.lng*i)/i,s=Math.round(this._ne.lat*i)/i;return!0===t?o+","+r+","+s+","+n:r+","+o+","+n+","+s},GeoGlobe.LngLatBounds.prototype.toGeometry=function(){return new GeoGlobe.Geometry.Polygon([new GeoGlobe.Geometry.LinearRing([new GeoGlobe.Geometry.Point(this._sw.lng,this._sw.lat),new GeoGlobe.Geometry.Point(this._ne.lng,this._sw.lat),new GeoGlobe.Geometry.Point(this._ne.lng,this._ne.lat),new GeoGlobe.Geometry.Point(this._sw.lng,this._ne.lat)])])},GeoGlobe.LngLatBounds.prototype.getCenterLonLat=function(){return this.centerLonLat||(this.centerLonLat=new GeoGlobe.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)),this.centerLonLat},GeoGlobe.LngLatBounds.prototype.CLASS_NAME="GeoGlobe.LngLatBounds",GeoGlobe.LngLatBounds.fromString=function(e,t){var i=e.split(",");return GeoGlobe.LngLatBounds.fromArray(i,t)},GeoGlobe.LngLatBounds.fromArray=function(e,t){return!0===t?new GeoGlobe.LngLatBounds(new GeoGlobe.LngLat(e[1],e[0]),new GeoGlobe.LngLat(e[3],e[2])):new GeoGlobe.LngLatBounds(new GeoGlobe.LngLat(e[0],e[1]),new GeoGlobe.LngLat(e[2],e[3]))},GeoGlobe.Geometry=GeoGlobe.Class4OL({id:null,parent:null,bounds:null,initialize:function(){this.id=GeoGlobe.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null,this.bounds=null},clone:function(){return new GeoGlobe.Geometry},setBounds:function(e){e&&(this.bounds=e.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(e){this.getBounds()?this.bounds.extend(e):this.setBounds(e)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(e,t){},getVertices:function(e){},atPoint:function(e,t,i){var r=!1;if(null!=this.getBounds()&&null!=e){var o=null!=t?t:0,n=null!=i?i:0,s=new GeoGlobe.LngLat(this.bounds._sw.lng-o,this.bounds._sw.lat-n),a=new GeoGlobe.LngLat(this.bounds._ne.lng+o,this.bounds._ne.lat+n);r=new GeoGlobe.LngLatBounds(s,a).containsLonLat(e)}return r},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return GeoGlobe.Format&&GeoGlobe.Format.WKT?GeoGlobe.Format.WKT.prototype.write(new GeoGlobe.Feature(this)):Object.prototype.toString.call(this)},CLASS_NAME:"GeoGlobe.Geometry"}),GeoGlobe.Geometry.fromWKT=function(e){var t;if(GeoGlobe.Format&&GeoGlobe.Format.WKT){var i=GeoGlobe.Geometry.fromWKT.format;i||(i=new GeoGlobe.Format.WKT,GeoGlobe.Geometry.fromWKT.format=i);var r=i.read(e);if(r instanceof GeoGlobe.Feature)t=r.geometry;else if(GeoGlobe.Util.isArray(r)){for(var o=r.length,n=new Array(o),s=0;s<o;++s)n[s]=r[s].geometry;t=new GeoGlobe.Geometry.Collection(n)}}return t},GeoGlobe.Geometry.segmentsIntersect=function(e,t,i){var r=i&&i.point,o=i&&i.tolerance,n=!1,s=e.x1-t.x1,a=e.y1-t.y1,l=e.x2-e.x1,u=e.y2-e.y1,h=t.y2-t.y1,c=t.x2-t.x1,g=h*l-c*u,p=c*a-h*s,f=l*a-u*s;if(0==g)0==p&&0==f&&(n=!0);else{var d=p/g,m=f/g;if(d>=0&&d<=1&&m>=0&&m<=1)if(r){var C=e.x1+d*l,y=e.y1+d*u;n=new GeoGlobe.Geometry.Point(C,y)}else n=!0}if(o)if(n){if(r){var v,A=[e,t];e:for(var _=0;_<2;++_){v=A[_];for(var I=1;I<3;++I)if(C=v["x"+I],y=v["y"+I],Math.sqrt(Math.pow(C-n.x,2)+Math.pow(y-n.y,2))<o){n.x=C,n.y=y;break e}}}}else{var b,w,G;A=[e,t];e:for(_=0;_<2;++_)for(b=A[_],w=A[(_+1)%2],I=1;I<3;++I)if(G={x:b["x"+I],y:b["y"+I]},GeoGlobe.Geometry.distanceToSegment(G,w).distance<o){n=!r||new GeoGlobe.Geometry.Point(G.x,G.y);break e}}return n},GeoGlobe.Geometry.distanceToSegment=function(e,t){var i=GeoGlobe.Geometry.distanceSquaredToSegment(e,t);return i.distance=Math.sqrt(i.distance),i},GeoGlobe.Geometry.distanceSquaredToSegment=function(e,t){var i,r,o=e.x,n=e.y,s=t.x1,a=t.y1,l=t.x2,u=t.y2,h=l-s,c=u-a,g=0==h&&0==c?0:(h*(o-s)+c*(n-a))/(Math.pow(h,2)+Math.pow(c,2));return g<=0?(i=s,r=a):g>=1?(i=l,r=u):(i=s+g*h,r=a+g*c),{distance:Math.pow(i-o,2)+Math.pow(r-n,2),x:i,y:r,along:g}},GeoGlobe.Geometry.fromGeoJson=function(e){var t;if(GeoGlobe.Format&&GeoGlobe.Format.GeoJSON){format=new GeoGlobe.Format.GeoJSON;var i=null;try{i=format.parseGeometry(geojson)}catch(e){console.log(e)}t=i}return t},GeoGlobe.Geometry.Collection=GeoGlobe.Class4OL(GeoGlobe.Geometry,{components:null,componentTypes:null,initialize:function(e){GeoGlobe.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=e&&this.addComponents(e)},destroy:function(){this.components.length=0,this.components=null,GeoGlobe.Geometry.prototype.destroy.apply(this,arguments)},clone:function clone(){for(var geometry=eval("new "+this.CLASS_NAME+"()"),i=0,len=this.components.length;i<len;i++)geometry.addComponent(this.components[i].clone());return GeoGlobe.Util.applyDefaults(geometry,this),geometry},getComponentsString:function(){for(var e=[],t=0,i=this.components.length;t<i;t++)e.push(this.components[t].toShortString());return e.join(",")},calculateBounds:function(){this.bounds=null;var e=new GeoGlobe.LngLatBounds,t=this.components;if(t)for(var i=0,r=t.length;i<r;i++)e.extend(t[i].getBounds());null!=e._sw&&null!=e._sw&&null!=e._ne&&null!=e._ne&&null!=e._sw.lng&&null!=e._sw.lat&&null!=e._ne.lng&&null!=e._ne.lat&&this.setBounds(e)},addComponents:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;t<i;t++)this.addComponent(e[t])},addComponent:function(e,t){var i=!1;if(e&&(null==this.componentTypes||GeoGlobe.Util.indexOf(this.componentTypes,e.CLASS_NAME)>-1)){if(null!=t&&t<this.components.length){var r=this.components.slice(0,t),o=this.components.slice(t,this.components.length);r.push(e),this.components=r.concat(o)}else this.components.push(e);e.parent=this,this.clearBounds(),i=!0}return i},removeComponents:function(e){var t=!1;GeoGlobe.Util.isArray(e)||(e=[e]);for(var i=e.length-1;i>=0;--i)t=this.removeComponent(e[i])||t;return t},removeComponent:function(e){return GeoGlobe.Util.removeItem(this.components,e),this.clearBounds(),!0},getLength:function(){for(var e=0,t=0,i=this.components.length;t<i;t++)e+=this.components[t].getLength();return e},getArea:function(){for(var e=0,t=0,i=this.components.length;t<i;t++)e+=this.components[t].getArea();return e},getGeodesicArea:function(e){for(var t=0,i=0,r=this.components.length;i<r;i++)t+=this.components[i].getGeodesicArea(e);return t},getCentroid:function(e){if(!e)return this.components.length&&this.components[0].getCentroid();var t=this.components.length;if(!t)return!1;for(var i,r=[],o=[],n=0,s=Number.MAX_VALUE,a=0;a<t;++a){var l=(i=this.components[a]).getArea(),u=i.getCentroid(!0);isNaN(l)||isNaN(u.x)||isNaN(u.y)||(r.push(l),n+=l,s=l<s&&l>0?l:s,o.push(u))}if(t=r.length,0===n){for(a=0;a<t;++a)r[a]=1;n=r.length}else{for(a=0;a<t;++a)r[a]/=s;n/=s}var h=0,c=0;for(a=0;a<t;++a)u=o[a],l=r[a],h+=u.x*l,c+=u.y*l;return new GeoGlobe.Geometry.Point(h/n,c/n)},getGeodesicLength:function(e){for(var t=0,i=0,r=this.components.length;i<r;i++)t+=this.components[i].getGeodesicLength(e);return t},move:function(e,t){for(var i=0,r=this.components.length;i<r;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,r=this.components.length;i<r;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var r=0;r<this.components.length;++r)this.components[r].resize(e,t,i);return this},distanceTo:function(e,t){for(var i,r,o,n=!(t&&!1===t.edge)&&t&&t.details,s=Number.POSITIVE_INFINITY,a=0,l=this.components.length;a<l&&(i=this.components[a].distanceTo(e,t),!((o=n?i.distance:i)<s&&(r=i,0==(s=o))));++a);return r},equals:function(e){var t=!0;if(e&&e.CLASS_NAME&&this.CLASS_NAME==e.CLASS_NAME)if(GeoGlobe.Util.isArray(e.components)&&e.components.length==this.components.length){for(var i=0,r=this.components.length;i<r;++i)if(!this.components[i].equals(e.components[i])){t=!1;break}}else t=!1;else t=!1;return t},transform:function(e,t){if(e&&t){for(var i=0,r=this.components.length;i<r;i++)this.components[i].transform(e,t);this.bounds=null}return this},intersects:function(e){for(var t=!1,i=0,r=this.components.length;i<r&&!(t=e.intersects(this.components[i]));++i);return t},getVertices:function(e){for(var t=[],i=0,r=this.components.length;i<r;++i)Array.prototype.push.apply(t,this.components[i].getVertices(e));return t},CLASS_NAME:"GeoGlobe.Geometry.Collection"}),GeoGlobe.Geometry.Point=GeoGlobe.Class4OL(GeoGlobe.Geometry,{x:null,y:null,initialize:function(e,t){GeoGlobe.Geometry.prototype.initialize.apply(this,arguments),this.x=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e),this.y=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(t)},clone:function(e){return null==e&&(e=new GeoGlobe.Geometry.Point(this.x,this.y)),GeoGlobe.Util.applyDefaults(e,this),e},calculateBounds:function(){var e=new GeoGlobe.LngLat(this.x,this.y),t=new GeoGlobe.LngLat(this.x,this.y);this.bounds=new GeoGlobe.LngLatBounds(e,t)},distanceTo:function(e,t){var i,r,o,n,s,a,l=!(t&&!1===t.edge)&&t&&t.details;return e instanceof GeoGlobe.Geometry.Point?(r=this.x,o=this.y,n=e.x,s=e.y,i=Math.sqrt(Math.pow(r-n,2)+Math.pow(o-s,2)),a=l?{x0:r,y0:o,x1:n,y1:s,distance:i}:i):(a=e.distanceTo(this,t),l&&(a={x0:a.x1,y0:a.y1,x1:a.x0,y1:a.y0,distance:a.distance})),a},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},toShortString:function(){return this.x+", "+this.y},move:function(e,t){this.x=this.x+e,this.y=this.y+t,this.clearBounds()},rotate:function(e,t){e*=Math.PI/180;var i=this.distanceTo(t),r=e+Math.atan2(this.y-t.y,this.x-t.x);this.x=t.x+i*Math.cos(r),this.y=t.y+i*Math.sin(r),this.clearBounds()},getCentroid:function(){return new GeoGlobe.Geometry.Point(this.x,this.y)},resize:function(e,t,i){return i=null==i?1:i,this.x=t.x+e*i*(this.x-t.x),this.y=t.y+e*(this.y-t.y),this.clearBounds(),this},intersects:function(e){return"GeoGlobe.Geometry.Point"==e.CLASS_NAME?this.equals(e):e.intersects(this)},transform:function(e,t){return e&&t&&(GeoGlobe.SpatialReference.transform(this,e,t),this.bounds=null),this},getVertices:function(e){return[this]},CLASS_NAME:"GeoGlobe.Geometry.Point"}),GeoGlobe.Geometry.MultiPoint=GeoGlobe.Class4OL(GeoGlobe.Geometry.Collection,{componentTypes:["GeoGlobe.Geometry.Point"],addPoint:function(e,t){this.addComponent(e,t)},removePoint:function(e){this.removeComponent(e)},CLASS_NAME:"GeoGlobe.Geometry.MultiPoint"}),GeoGlobe.Geometry.Curve=GeoGlobe.Class4OL(GeoGlobe.Geometry.MultiPoint,{componentTypes:["GeoGlobe.Geometry.Point"],getLength:function(){var e=0;if(this.components&&this.components.length>1)for(var t=1,i=this.components.length;t<i;t++)e+=this.components[t-1].distanceTo(this.components[t]);return e},getGeodesicLength:function(e){var t=this;if(e){var i=new GeoGlobe.SpatialReference("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}var r=0;if(t.components&&t.components.length>1)for(var o,n,s=1,a=t.components.length;s<a;s++)o=t.components[s-1],n=t.components[s],r+=GeoGlobe.Util.distVincenty({lng:o.x,lat:o.y},{lng:n.x,lat:n.y});return 1e3*r},CLASS_NAME:"GeoGlobe.Geometry.Curve"}),GeoGlobe.Geometry.LineString=GeoGlobe.Class4OL(GeoGlobe.Geometry.Curve,{removeComponent:function(e){var t=this.components&&this.components.length>2;return t&&GeoGlobe.Geometry.Collection.prototype.removeComponent.apply(this,arguments),t},intersects:function(e){var t=!1,i=e.CLASS_NAME;if("GeoGlobe.Geometry.LineString"==i||"GeoGlobe.Geometry.LinearRing"==i||"GeoGlobe.Geometry.Point"==i){var r,o,n,s,a,l,u,h,c,g=this.getSortedSegments();r="GeoGlobe.Geometry.Point"==i?[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]:e.getSortedSegments();e:for(var p=0,f=g.length;p<f;++p){n=(o=g[p]).x1,s=o.x2,a=o.y1,l=o.y2;for(var d=0,m=r.length;d<m&&!((u=r[d]).x1>s);++d)if(!(u.x2<n)&&(h=u.y1,c=u.y2,!(Math.min(h,c)>Math.max(a,l))&&!(Math.max(h,c)<Math.min(a,l))&&GeoGlobe.Geometry.segmentsIntersect(o,u))){t=!0;break e}}}else t=e.intersects(this);return t},getSortedSegments:function(){for(var e,t,i=this.components.length-1,r=new Array(i),o=0;o<i;++o)e=this.components[o],t=this.components[o+1],e.x<t.x?r[o]={x1:e.x,y1:e.y,x2:t.x,y2:t.y}:r[o]={x1:t.x,y1:t.y,x2:e.x,y2:e.y};return r.sort((function(e,t){return e.x1-t.x1}))},splitWithSegment:function(e,t){for(var i,r,o,n,s=!(t&&!1===t.edge),a=t&&t.tolerance,l=[],u=this.getVertices(),h=[],c=[],g=!1,p={point:!0,tolerance:a},f=null,d=0,m=u.length-2;d<=m;++d)if(i=u[d],h.push(i.clone()),r=u[d+1],n={x1:i.x,y1:i.y,x2:r.x,y2:r.y},(o=GeoGlobe.Geometry.segmentsIntersect(e,n,p))instanceof GeoGlobe.Geometry.Point&&(o.x===e.x1&&o.y===e.y1||o.x===e.x2&&o.y===e.y2||o.equals(i)||o.equals(r)||s)){if(o.equals(c[c.length-1])||c.push(o.clone()),0===d&&o.equals(i))continue;if(o.equals(r))continue;g=!0,o.equals(i)||h.push(o),l.push(new GeoGlobe.Geometry.LineString(h)),h=[o.clone()]}if(g&&(h.push(r.clone()),l.push(new GeoGlobe.Geometry.LineString(h))),c.length>0){var C=e.x1<e.x2?1:-1,y=e.y1<e.y2?1:-1;f={lines:l,points:c.sort((function(e,t){return C*e.x-C*t.x||y*e.y-y*t.y}))}}return f},split:function(e,t){var i,r,o,n,s=null,a=t&&t.mutual;if(e instanceof GeoGlobe.Geometry.LineString){var l,u,h,c,g,p,f=this.getVertices(),d=[];o=[];for(var m=0,C=f.length-2;m<=C;++m){l=f[m],u=f[m+1],h={x1:l.x,y1:l.y,x2:u.x,y2:u.y},n=n||[e],a&&d.push(l.clone());for(var y=0;y<n.length;++y)if((c=n[y].splitWithSegment(h,t))&&((g=c.lines).length>0&&(g.unshift(y,1),Array.prototype.splice.apply(n,g),y+=g.length-2),a))for(var v=0,A=c.points.length;v<A;++v)(p=c.points[v]).equals(l)||(d.push(p),o.push(new GeoGlobe.Geometry.LineString(d)),d=p.equals(u)?[]:[p.clone()])}a&&o.length>0&&d.length>0&&(d.push(u.clone()),o.push(new GeoGlobe.Geometry.LineString(d)))}else s=e.splitWith(this,t);return n&&n.length>1?r=!0:n=[],o&&o.length>1?i=!0:o=[],(r||i)&&(s=a?[o,n]:n),s},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){return!0===e?[this.components[0],this.components[this.components.length-1]]:!1===e?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(e,t){var i,r=!(t&&!1===t.edge)&&t&&t.details,o={},n=Number.POSITIVE_INFINITY;if(e instanceof GeoGlobe.Geometry.Point){for(var s,a=this.getSortedSegments(),l=e.x,u=e.y,h=0,c=a.length;h<c;++h)if(s=a[h],(i=GeoGlobe.Geometry.distanceToSegment(e,s)).distance<n){if(o=i,0===(n=i.distance))break}else if(s.x2>l&&(u>s.y1&&u<s.y2||u<s.y1&&u>s.y2))break;o=r?{distance:o.distance,x0:o.x,y0:o.y,x1:l,y1:u}:o.distance}else if(e instanceof GeoGlobe.Geometry.LineString){var g,p,f,d,m,C=this.getSortedSegments(),y=e.getSortedSegments(),v=y.length,A={point:!0};e:for(h=0,c=C.length;h<c;++h){d=(g=C[h]).x1,m=g.y1;for(var _=0;_<v;++_){if(p=y[_],f=GeoGlobe.Geometry.segmentsIntersect(g,p,A)){n=0,o={distance:0,x0:f.x,y0:f.y,x1:f.x,y1:f.y};break e}(i=GeoGlobe.Geometry.distanceToSegment({x:d,y:m},p)).distance<n&&(o={distance:n=i.distance,x0:d,y0:m,x1:i.x,y1:i.y})}}if(r||(o=o.distance),0!==n&&g){i=e.distanceTo(new GeoGlobe.Geometry.Point(g.x2,g.y2),t);var I=r?i.distance:i;I<n&&(o=r?{distance:n,x0:i.x1,y0:i.y1,x1:i.x0,y1:i.y0}:I)}}else o=e.distanceTo(this,t),r&&(o={distance:o.distance,x0:o.x1,y0:o.y1,x1:o.x0,y1:o.y0});return o},simplify:function(e){if(this&&null!==this){var t=this.getVertices();if(t.length<3)return this;var i=function(e,t,i){return Math.abs(.5*(e.x*t.y+t.x*i.y+i.x*e.y-t.x*e.y-i.x*t.y-e.x*i.y))/Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))*2},r=t.length-1,o=[];for(o.push(0),o.push(r);t[0].equals(t[r]);)r--,o.push(r);!function e(t,r,n,s){for(var a,l=0,u=0,h=r;h<n;h++)(a=i(t[r],t[n],t[h]))>l&&(l=a,u=h);l>s&&u!=r&&(o.push(u),e(t,r,u,s),e(t,u,n,s))}(t,0,r,e);var n=[];o.sort((function(e,t){return e-t}));for(var s=0;s<o.length;s++)n.push(t[o[s]]);return new GeoGlobe.Geometry.LineString(n)}return this},CLASS_NAME:"GeoGlobe.Geometry.LineString"}),GeoGlobe.Geometry.LineString.createCurveLine=function(e){for(var t=[],i=0;i<e.length-1;i++){var r=GeoGlobe.Geometry.LineString.getCurveCoordinatesByTwoPoints(e[i],e[i+1]);r&&r.length>0&&(t=t.concat(r))}return new GeoGlobe.Geometry.LineString(t)},GeoGlobe.Geometry.LineString.getCurveCoordinatesByTwoPoints=function(e,t){if(!(e&&t&&e instanceof GeoGlobe.Geometry.Point&&t instanceof GeoGlobe.Geometry.Point))return null;var i=function(e){return 1-2*e+e*e},r=function(e){return 2*e-2*e*e},o=function(e){return e*e};curveCoordinates=[];var n,s,a,l,u,h,c=0,g=0;if(void 0!==t){var p=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e.y),f=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(t.y),d=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e.x),m=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(t.x);for(m>d&&_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(m-d)>180&&d<0&&(d=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(360+d)),d>m&&_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(d-m)>180&&m<0&&(m=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(360+m)),h=0,f==p?(n=0,s=d-m):m==d?(n=Math.PI/2,s=p-f):(n=Math.atan((f-p)/(m-d)),s=(f-p)/Math.sin(n)),0==h&&(h=n+Math.PI/5),u=(a=s/2)*Math.cos(h)+d,l=a*Math.sin(h)+p,c=0;c<31;c++)curveCoordinates.push(new GeoGlobe.Geometry.Point(d*i(g)+u*r(g)+m*o(g),p*i(g)+l*r(g)+f*o(g))),g+=1/30;return curveCoordinates}"undefined"!=typeof curveCoordinates&&(curveCoordinates=[])},GeoGlobe.Geometry.LinearRing=GeoGlobe.Class4OL(GeoGlobe.Geometry.LineString,{componentTypes:["GeoGlobe.Geometry.Point"],addComponent:function(e,t){var i=!1,r=this.components.pop();null==t&&e.equals(r)||(i=GeoGlobe.Geometry.Collection.prototype.addComponent.apply(this,arguments));var o=this.components[0];return GeoGlobe.Geometry.Collection.prototype.addComponent.apply(this,[o]),i},removeComponent:function(e){var t=this.components&&this.components.length>3;if(t){this.components.pop(),GeoGlobe.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var i=this.components[0];GeoGlobe.Geometry.Collection.prototype.addComponent.apply(this,[i])}return t},move:function(e,t){for(var i=0,r=this.components.length;i<r-1;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,r=this.components.length;i<r-1;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var r=0,o=this.components.length;r<o-1;++r)this.components[r].resize(e,t,i);return this},transform:function(e,t){if(e&&t){for(var i=0,r=this.components.length;i<r-1;i++)this.components[i].transform(e,t);this.bounds=null}return this},getCentroid:function(){if(this.components){var e=this.components.length;if(e>0&&e<=2)return this.components[0].clone();if(e>2){var t=0,i=0,r=this.components[0].x,o=this.components[0].y,n=-1*this.getArea();if(0!=n){for(var s=0;s<e-1;s++){var a=this.components[s],l=this.components[s+1];t+=(a.x+l.x-2*r)*((a.x-r)*(l.y-o)-(l.x-r)*(a.y-o)),i+=(a.y+l.y-2*o)*((a.x-r)*(l.y-o)-(l.x-r)*(a.y-o))}var u=r+t/(6*n),h=o+i/(6*n)}else{for(s=0;s<e-1;s++)t+=this.components[s].x,i+=this.components[s].y;u=t/(e-1),h=i/(e-1)}return new GeoGlobe.Geometry.Point(u,h)}return null}},getArea:function(){var e=0;if(this.components&&this.components.length>2){for(var t=0,i=0,r=this.components.length;i<r-1;i++){var o=this.components[i],n=this.components[i+1];t+=(o.x+n.x)*(n.y-o.y)}e=-t/2}return e},getGeodesicArea:function(e){var t=this;if(e){var i=new GeoGlobe.SpatialReference("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}var r=0,o=t.components&&t.components.length;if(o>2){for(var n,s,a=0;a<o-1;a++)n=t.components[a],s=t.components[a+1],r+=GeoGlobe.Util.rad(s.x-n.x)*(2+Math.sin(GeoGlobe.Util.rad(n.y))+Math.sin(GeoGlobe.Util.rad(s.y)));r=6378137*r*6378137/2}return r},containsPoint:function(e){for(var t,i,r,o,n,s,a,l,u,h=GeoGlobe.Number.limitSigDigs,c=h(e.x,14),g=h(e.y,14),p=this.components.length-1,f=0,d=0;d<p;++d)if(r=h((t=this.components[d]).x,14),o=h(t.y,14),n=h((i=this.components[d+1]).x,14),o!=(s=h(i.y,14))){if((a=h(((l=n)-r)/((u=s)-o)*(g-u)+l,14))==c&&(o<s&&g>=o&&g<=s||o>s&&g<=o&&g>=s)){f=-1;break}a<=c||r!=n&&(a<Math.min(r,n)||a>Math.max(r,n))||(o<s&&g>=o&&g<s||o>s&&g<o&&g>=s)&&++f}else if(g==o&&(r<=n&&c>=r&&c<=n||r>=n&&c<=r&&c>=n)){f=-1;break}return-1==f?1:!!(1&f)},intersects:function(e){var t=!1;if("GeoGlobe.Geometry.Point"==e.CLASS_NAME)t=this.containsPoint(e);else if("GeoGlobe.Geometry.LineString"==e.CLASS_NAME)t=e.intersects(this);else if("GeoGlobe.Geometry.LinearRing"==e.CLASS_NAME)t=GeoGlobe.Geometry.LineString.prototype.intersects.apply(this,[e]);else for(var i=0,r=e.components.length;i<r&&!(t=e.components[i].intersects(this));++i);return t},getVertices:function(e){return!0===e?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"GeoGlobe.Geometry.LinearRing"}),GeoGlobe.Geometry.Polygon=GeoGlobe.Class4OL(GeoGlobe.Geometry.Collection,{componentTypes:["GeoGlobe.Geometry.LinearRing"],getArea:function(){var e=0;if(this.components&&this.components.length>0){e+=Math.abs(this.components[0].getArea());for(var t=1,i=this.components.length;t<i;t++)e-=Math.abs(this.components[t].getArea())}return e},getGeodesicArea:function(e){var t=0;if(this.components&&this.components.length>0){t+=Math.abs(this.components[0].getGeodesicArea(e));for(var i=1,r=this.components.length;i<r;i++)t-=Math.abs(this.components[i].getGeodesicArea(e))}return t},containsPoint:function(e){var t=this.components.length,i=!1;if(t>0&&1!==(i=this.components[0].containsPoint(e))&&i&&t>1)for(var r,o=1;o<t;++o)if(r=this.components[o].containsPoint(e)){i=1===r&&1;break}return i},intersects:function(e){var t,i,r=!1;if("GeoGlobe.Geometry.Point"==e.CLASS_NAME)r=this.containsPoint(e);else if("GeoGlobe.Geometry.LineString"==e.CLASS_NAME||"GeoGlobe.Geometry.LinearRing"==e.CLASS_NAME){for(t=0,i=this.components.length;t<i&&!(r=e.intersects(this.components[t]));++t);if(!r)for(t=0,i=e.components.length;t<i&&!(r=this.containsPoint(e.components[t]));++t);}else for(t=0,i=e.components.length;t<i&&!(r=this.intersects(e.components[t]));++t);if(!r&&"GeoGlobe.Geometry.Polygon"==e.CLASS_NAME){var o=this.components[0];for(t=0,i=o.components.length;t<i&&!(r=e.containsPoint(o.components[t]));++t);}return r},distanceTo:function(e,t){return t&&!1===t.edge&&this.intersects(e)?0:GeoGlobe.Geometry.Collection.prototype.distanceTo.apply(this,[e,t])},CLASS_NAME:"GeoGlobe.Geometry.Polygon"}),GeoGlobe.Geometry.Polygon.createRegularPolygon=function(e,t,i,r){var o,n,s,a=Math.PI*(1/i-.5);r&&(a+=r/180*Math.PI);for(var l=[],u=0;u<i;++u)o=a+2*u*Math.PI/i,n=e.x+t*Math.cos(o),s=e.y+t*Math.sin(o),l.push(new GeoGlobe.Geometry.Point(n,s));var h=new GeoGlobe.Geometry.LinearRing(l);return new GeoGlobe.Geometry.Polygon([h])},GeoGlobe.Geometry.MultiLineString=GeoGlobe.Class4OL(GeoGlobe.Geometry.Collection,{componentTypes:["GeoGlobe.Geometry.LineString"],split:function(e,t){for(var i,r,o,n,s,a=null,l=t&&t.mutual,u=[],h=[e],c=0,g=this.components.length;c<g;++c){r=this.components[c],n=!1;for(var p=0;p<h.length;++p)if(i=r.split(h[p],t)){if(l){for(var f=0,d=(o=i[0]).length;f<d;++f)0===f&&u.length?u[u.length-1].addComponent(o[f]):u.push(new GeoGlobe.Geometry.MultiLineString([o[f]]));n=!0,i=i[1]}if(i.length){i.unshift(p,1),Array.prototype.splice.apply(h,i);break}}n||(u.length?u[u.length-1].addComponent(r.clone()):u=[new GeoGlobe.Geometry.MultiLineString(r.clone())])}return u&&u.length>1?n=!0:u=[],h&&h.length>1?s=!0:h=[],(n||s)&&(a=l?[u,h]:h),a},splitWith:function(e,t){var i,r,o,n,s,a,l,u=null,h=t&&t.mutual;if(e instanceof GeoGlobe.Geometry.LineString){l=[],a=[e];for(var c=0,g=this.components.length;c<g;++c){s=!1,r=this.components[c];for(var p=0;p<a.length;++p)if(i=a[p].split(r,t)){h&&((o=i[0]).length&&(o.unshift(p,1),Array.prototype.splice.apply(a,o),p+=o.length-2),0===(i=i[1]).length&&(i=[r.clone()]));for(var f=0,d=i.length;f<d;++f)0===f&&l.length?l[l.length-1].addComponent(i[f]):l.push(new GeoGlobe.Geometry.MultiLineString([i[f]]));s=!0}s||(l.length?l[l.length-1].addComponent(r.clone()):l=[new GeoGlobe.Geometry.MultiLineString([r.clone()])])}}else u=e.split(this);return a&&a.length>1?n=!0:a=[],l&&l.length>1?s=!0:l=[],(n||s)&&(u=h?[a,l]:l),u},CLASS_NAME:"GeoGlobe.Geometry.MultiLineString"}),GeoGlobe.Geometry.MultiPolygon=GeoGlobe.Class4OL(GeoGlobe.Geometry.Collection,{componentTypes:["GeoGlobe.Geometry.Polygon"],CLASS_NAME:"GeoGlobe.Geometry.MultiPolygon"}),GeoGlobe.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},GeoGlobe.Feature=GeoGlobe.Class4OL({id:null,fid:null,lonlat:null,geometry:null,attributes:null,data:null,bounds:null,state:null,url:null,modified:null,initialize:function(e,t){this.data=null!=t?t:{},this.id=GeoGlobe.Util.createUniqueID(this.CLASS_NAME+"_"),this.lonlat=null,this.geometry=e||null,this.state=null,this.attributes={},t&&(this.attributes=GeoGlobe.Util.extend(this.attributes,t))},destroy:function(){this.geometry=null,this.modified=null,this.id=null,this.lonlat=null,this.data=null},clone:function(){return new GeoGlobe.Feature(this.geometry?this.geometry.clone():null,this.attributes)},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(e,t,i){var r=!1;return this.geometry&&(r=this.geometry.atPoint(e,t,i)),r},destroyPopup:function(){},toState:function(e){if(e==GeoGlobe.State.UPDATE)switch(this.state){case GeoGlobe.State.UNKNOWN:case GeoGlobe.State.DELETE:this.state=e;break;case GeoGlobe.State.UPDATE:case GeoGlobe.State.INSERT:}else if(e==GeoGlobe.State.INSERT)switch(this.state){case GeoGlobe.State.UNKNOWN:break;default:this.state=e}else if(e==GeoGlobe.State.DELETE)switch(this.state){case GeoGlobe.State.INSERT:case GeoGlobe.State.DELETE:break;case GeoGlobe.State.UNKNOWN:case GeoGlobe.State.UPDATE:this.state=e}else e==GeoGlobe.State.UNKNOWN&&(this.state=e)},CLASS_NAME:"GeoGlobe.Feature"}),GeoGlobe.Feature.getBoundsByFeatures=function(e){for(var t=e.length,i=new Array(t),r=0;r<t;++r)i[r]=e[r].geometry;var o=new GeoGlobe.Geometry.Collection(i);return o.calculateBounds(),o.bounds},GeoGlobe.Feature.fromGeoJson=function(e){if(GeoGlobe.Format&&GeoGlobe.Format.GeoJSON){format=new GeoGlobe.Format.GeoJSON;var t=format.read(e)}return t},GeoGlobe.Filter=GeoGlobe.Class4OL({initialize:function(e){GeoGlobe.Util.extend(this,e)},destroy:function(){},evaluate:function(e){return!0},clone:function(){return null},toString:function(){return GeoGlobe.Format&&GeoGlobe.Format.CQL?GeoGlobe.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"GeoGlobe.Filter"}),GeoGlobe.Filter.FeatureId=GeoGlobe.Class4OL(GeoGlobe.Filter,{fids:null,type:"FID",initialize:function(e){this.fids=[],GeoGlobe.Filter.prototype.initialize.apply(this,[e])},evaluate:function(e){for(var t=0,i=this.fids.length;t<i;t++)if((e.fid||e.id)==this.fids[t])return!0;return!1},clone:function(){var e=new GeoGlobe.Filter.FeatureId;return GeoGlobe.Util.extend(e,this),e.fids=this.fids.slice(),e},CLASS_NAME:"GeoGlobe.Filter.FeatureId"}),GeoGlobe.Filter.Logical=GeoGlobe.Class4OL(GeoGlobe.Filter,{filters:null,type:null,initialize:function(e){this.filters=[],GeoGlobe.Filter.prototype.initialize.apply(this,[e])},destroy:function(){this.filters=null,GeoGlobe.Filter.prototype.destroy.apply(this)},evaluate:function(e){var t,i;switch(this.type){case GeoGlobe.Filter.Logical.AND:for(t=0,i=this.filters.length;t<i;t++)if(0==this.filters[t].evaluate(e))return!1;return!0;case GeoGlobe.Filter.Logical.OR:for(t=0,i=this.filters.length;t<i;t++)if(1==this.filters[t].evaluate(e))return!0;return!1;case GeoGlobe.Filter.Logical.NOT:return!this.filters[0].evaluate(e)}},clone:function(){for(var e=[],t=0,i=this.filters.length;t<i;++t)e.push(this.filters[t].clone());return new GeoGlobe.Filter.Logical({type:this.type,filters:e})},CLASS_NAME:"GeoGlobe.Filter.Logical"}),GeoGlobe.Filter.Logical.AND="&&",GeoGlobe.Filter.Logical.OR="||",GeoGlobe.Filter.Logical.NOT="!",GeoGlobe.Filter.Comparison=GeoGlobe.Class4OL(GeoGlobe.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(e){GeoGlobe.Filter.prototype.initialize.apply(this,[e]),this.type===GeoGlobe.Filter.Comparison.LIKE&&void 0===e.matchCase&&(this.matchCase=null)},evaluate:function(e){e instanceof GeoGlobe.Feature&&(e=e.attributes);var t,i=!1,r=e[this.property];if(void 0===r)return!1;switch(this.type){case GeoGlobe.Filter.Comparison.EQUAL_TO:t=this.value,i=this.matchCase||"string"!=typeof r||"string"!=typeof t?r==t:r.toUpperCase()==t.toUpperCase();break;case GeoGlobe.Filter.Comparison.NOT_EQUAL_TO:t=this.value,i=this.matchCase||"string"!=typeof r||"string"!=typeof t?r!=t:r.toUpperCase()!=t.toUpperCase();break;case GeoGlobe.Filter.Comparison.LESS_THAN:i=r<this.value;break;case GeoGlobe.Filter.Comparison.GREATER_THAN:i=r>this.value;break;case GeoGlobe.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:i=r<=this.value;break;case GeoGlobe.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:i=r>=this.value;break;case GeoGlobe.Filter.Comparison.BETWEEN:i=r>=this.lowerBoundary&&r<=this.upperBoundary;break;case GeoGlobe.Filter.Comparison.LIKE:i=new RegExp(this.value,"gi").test(r);break;case GeoGlobe.Filter.Comparison.IS_NULL:i=null===r}return i},value2regex:function(e,t,i){if("."==e)throw new Error("'.' is an unsupported wildCard character for GeoGlobe.Filter.Comparison");return e=e||"*",t=t||".",i=i||"!",this.value=this.value.replace(new RegExp("\\"+i+"(.|$)","g"),"\\$1"),this.value=this.value.replace(new RegExp("\\"+t,"g"),"."),this.value=this.value.replace(new RegExp("\\"+e,"g"),".*"),this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+e),this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+t),this.value},regex2value:function(){var e=this.value;return(e=(e=(e=(e=e.replace(/!/g,"!!")).replace(/(\\)?\\\./g,(function(e,t){return t?e:"!."}))).replace(/(\\)?\\\*/g,(function(e,t){return t?e:"!*"}))).replace(/\\\\/g,"\\")).replace(/\.\*/g,"*")},clone:function(){return GeoGlobe.Util.extend(new GeoGlobe.Filter.Comparison,this)},CLASS_NAME:"GeoGlobe.Filter.Comparison"}),GeoGlobe.Filter.Comparison.EQUAL_TO="==",GeoGlobe.Filter.Comparison.NOT_EQUAL_TO="!=",GeoGlobe.Filter.Comparison.LESS_THAN="<",GeoGlobe.Filter.Comparison.GREATER_THAN=">",GeoGlobe.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=",GeoGlobe.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=",GeoGlobe.Filter.Comparison.BETWEEN="..",GeoGlobe.Filter.Comparison.LIKE="~",GeoGlobe.Filter.Comparison.IS_NULL="NULL",GeoGlobe.Filter.Spatial=GeoGlobe.Class4OL(GeoGlobe.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(e){var t=!1;switch(this.type){case GeoGlobe.Filter.Spatial.BBOX:case GeoGlobe.Filter.Spatial.INTERSECTS:if(e.geometry){var i=this.value;"GeoGlobe.LngLatBounds"==this.value.CLASS_NAME&&(i=this.value.toGeometry()),e.geometry.intersects(i)&&(t=!0)}break;default:throw new Error("evaluate is not implemented for this filter type.")}return t},clone:function(){var e=GeoGlobe.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new GeoGlobe.Filter.Spatial(e)},CLASS_NAME:"GeoGlobe.Filter.Spatial"}),GeoGlobe.Filter.Spatial.BBOX="BBOX",GeoGlobe.Filter.Spatial.INTERSECTS="INTERSECTS",GeoGlobe.Filter.Spatial.DWITHIN="DWITHIN",GeoGlobe.Filter.Spatial.WITHIN="WITHIN",GeoGlobe.Filter.Spatial.CONTAINS="CONTAINS",GeoGlobe.Filter.Function=GeoGlobe.Class4OL(GeoGlobe.Filter,{name:null,params:null,CLASS_NAME:"GeoGlobe.Filter.Function"}),GeoGlobe.Protocol=GeoGlobe.Class4OL({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(e){e=e||{},GeoGlobe.Util.extend(this,e),this.options=e},mergeWithDefaultFilter:function(e){return e&&this.defaultFilter?new GeoGlobe.Filter.Logical({type:GeoGlobe.Filter.Logical.AND,filters:[this.defaultFilter,e]}):e||this.defaultFilter||void 0},destroy:function(){this.options=null,this.format=null},read:function(e){(e=e||{}).filter=this.mergeWithDefaultFilter(e.filter)},create:function(){},update:function(){},delete:function(){},commit:function(){},abort:function(e){},createCallback:function(e,t,i){return GeoGlobe.Function.bind((function(){e.apply(this,[t,i])}),this)},CLASS_NAME:"GeoGlobe.Protocol"}),GeoGlobe.Protocol.Response=GeoGlobe.Class4OL({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(e){GeoGlobe.Util.extend(this,e)},success:function(){return this.code>0},CLASS_NAME:"GeoGlobe.Protocol.Response"}),GeoGlobe.Protocol.Response.SUCCESS=1,GeoGlobe.Protocol.Response.FAILURE=0,GeoGlobe.Protocol.HTTP=GeoGlobe.Class4OL(GeoGlobe.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(e){if(e=e||{},this.params={},this.headers={},GeoGlobe.Protocol.prototype.initialize.apply(this,arguments),!this.filterToParams&&GeoGlobe.Format.QueryStringFilter){var t=new GeoGlobe.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,i){return t.write(e,i)}}},destroy:function(){this.params=null,this.headers=null,GeoGlobe.Protocol.prototype.destroy.apply(this)},read:function(e){GeoGlobe.Protocol.prototype.read.apply(this,arguments),(e=e||{}).params=GeoGlobe.Util.applyDefaults(e.params,this.options.params),(e=GeoGlobe.Util.applyDefaults(e,this.options)).filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=void 0!==e.readWithPOST?e.readWithPOST:this.readWithPOST,i=new GeoGlobe.Protocol.Response({requestType:"read"});if(t){var r=e.headers||{};r["Content-Type"]="application/x-www-form-urlencoded",i.priv=GeoGlobe.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,i,e),data:GeoGlobe.Util.getParameterString(e.params),headers:r})}else i.priv=GeoGlobe.Request.GET({url:e.url,callback:this.createCallback(this.handleRead,i,e),params:e.params,headers:e.headers});return i},handleRead:function(e,t){this.handleResponse(e,t)},create:function(e,t){t=GeoGlobe.Util.applyDefaults(t,this.options);var i=new GeoGlobe.Protocol.Response({reqFeatures:e,requestType:"create"});return i.priv=GeoGlobe.Request.POST({url:t.url,callback:this.createCallback(this.handleCreate,i,t),headers:t.headers,data:this.format.write(e)}),i},handleCreate:function(e,t){this.handleResponse(e,t)},update:function(e,t){var i=(t=t||{}).url||e.url||this.options.url+"/"+e.fid;t=GeoGlobe.Util.applyDefaults(t,this.options);var r=new GeoGlobe.Protocol.Response({reqFeatures:e,requestType:"update"}),o=this.updateWithPOST?"POST":"PUT";return r.priv=GeoGlobe.Request[o]({url:i,callback:this.createCallback(this.handleUpdate,r,t),headers:t.headers,data:this.format.write(e)}),r},handleUpdate:function(e,t){this.handleResponse(e,t)},delete:function(e,t){var i=(t=t||{}).url||e.url||this.options.url+"/"+e.fid;t=GeoGlobe.Util.applyDefaults(t,this.options);var r=new GeoGlobe.Protocol.Response({reqFeatures:e,requestType:"delete"}),o=this.deleteWithPOST?"POST":"DELETE",n={url:i,callback:this.createCallback(this.handleDelete,r,t),headers:t.headers};return this.deleteWithPOST&&(n.data=this.format.write(e)),r.priv=GeoGlobe.Request[o](n),r},handleDelete:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){var i=e.priv;t.callback&&(i.status>=200&&i.status<300?("delete"!=e.requestType&&(e.features=this.parseFeatures(i)),e.code=GeoGlobe.Protocol.Response.SUCCESS):e.code=GeoGlobe.Protocol.Response.FAILURE,t.callback.call(t.scope,e))},parseFeatures:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),!t||t.length<=0?null:this.format.read(t)},commit:function(e,t){t=GeoGlobe.Util.applyDefaults(t,this.options);var i=[],r=0,o={};o[GeoGlobe.State.INSERT]=[],o[GeoGlobe.State.UPDATE]=[],o[GeoGlobe.State.DELETE]=[];for(var n,s,a=[],l=0,u=e.length;l<u;++l)(s=o[(n=e[l]).state])&&(s.push(n),a.push(n));var h=(o[GeoGlobe.State.INSERT].length>0?1:0)+o[GeoGlobe.State.UPDATE].length+o[GeoGlobe.State.DELETE].length,c=!0,g=new GeoGlobe.Protocol.Response({reqFeatures:a});function p(e){this.callUserCallback(e,t),c=c&&e.success(),++r>=h&&t.callback&&(g.code=c?GeoGlobe.Protocol.Response.SUCCESS:GeoGlobe.Protocol.Response.FAILURE,t.callback.apply(t.scope,[g]))}var f=o[GeoGlobe.State.INSERT];for(f.length>0&&i.push(this.create(f,GeoGlobe.Util.applyDefaults({callback:function(e){for(var t=e.features?e.features.length:0,i=new Array(t),r=0;r<t;++r)i[r]=e.features[r].fid;g.insertIds=i,p.apply(this,[e])},scope:this},t.create))),l=(f=o[GeoGlobe.State.UPDATE]).length-1;l>=0;--l)i.push(this.update(f[l],GeoGlobe.Util.applyDefaults({callback:p,scope:this},t.update)));for(l=(f=o[GeoGlobe.State.DELETE]).length-1;l>=0;--l)i.push(this.delete(f[l],GeoGlobe.Util.applyDefaults({callback:p,scope:this},t.delete)));return i},abort:function(e){e&&e.priv.abort()},callUserCallback:function(e,t){var i=t[e.requestType];i&&i.callback&&i.callback.call(i.scope,e)},CLASS_NAME:"GeoGlobe.Protocol.HTTP"}),GeoGlobe.Protocol.WFS=function(e){e=GeoGlobe.Util.applyDefaults(e,GeoGlobe.Protocol.WFS.DEFAULTS);var t=GeoGlobe.Protocol.WFS["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFS version: "+e.version;return new t(e)},GeoGlobe.Protocol.WFS.DEFAULTS={version:"1.0.0"},GeoGlobe.Protocol.WFS.v1=GeoGlobe.Class4OL(GeoGlobe.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(e){GeoGlobe.Protocol.prototype.initialize.apply(this,[e]),e.format||(this.format=GeoGlobe.Format.WFST(GeoGlobe.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))),!e.geometryName&&_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(this.format.version)>1&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,GeoGlobe.Protocol.prototype.destroy.apply(this)},read:function(e){GeoGlobe.Protocol.prototype.read.apply(this,arguments),e=GeoGlobe.Util.extend({},e),GeoGlobe.Util.applyDefaults(e,this.options||{});var t=new GeoGlobe.Protocol.Response({requestType:"read"}),i=GeoGlobe.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",e)]);return t.priv=GeoGlobe.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),params:e.params,headers:e.headers,data:i}),t},setFeatureType:function(e){this.featureType=e,this.format.featureType=e},setGeometryName:function(e){this.geometryName=e,this.format.geometryName=e},handleRead:function(e,t){if(t=GeoGlobe.Util.extend({},t),GeoGlobe.Util.applyDefaults(t,this.options),t.callback){var i=e.priv;if(i.status>=200&&i.status<300){var r=this.parseResponse(i,t.readOptions);r&&!1!==r.success?(t.readOptions&&"object"==t.readOptions.output?GeoGlobe.Util.extend(e,r):e.features=r,e.code=GeoGlobe.Protocol.Response.SUCCESS):(e.code=GeoGlobe.Protocol.Response.FAILURE,e.error=r)}else e.code=GeoGlobe.Protocol.Response.FAILURE;t.callback.call(t.scope,e)}},parseResponse:function(e,t){var i=e.responseXML;if(i&&i.documentElement||(i=e.responseText),!i||i.length<=0)return null;var r=null;try{r=null!==this.readFormat?this.readFormat.read(i):this.format.read(i,t)}catch(e){var o="程序运行异常："+e.name+"，"+e.message;alert(o)}if(!this.featureNS){var n=this.readFormat||this.format;this.featureNS=n.featureNS,n.autoConfig=!1,this.geometryName||this.setGeometryName(n.geometryName)}return r},commit:function(e,t){t=GeoGlobe.Util.extend({},t),GeoGlobe.Util.applyDefaults(t,this.options);var i=new GeoGlobe.Protocol.Response({requestType:"commit",reqFeatures:e});return i.priv=GeoGlobe.Request.POST({url:t.url,headers:t.headers,data:this.format.write(e,t),callback:this.createCallback(this.handleCommit,i,t)}),i},handleCommit:function(e,t){if(t.callback){var i=e.priv,r=i.responseXML;r&&r.documentElement||(r=i.responseText);var o=this.format.read(r)||{};e.insertIds=o.insertIds||[],o.success?e.code=GeoGlobe.Protocol.Response.SUCCESS:(e.code=GeoGlobe.Protocol.Response.FAILURE,e.error=o),t.callback.call(t.scope,e)}},filterDelete:function(e,t){t=GeoGlobe.Util.extend({},t),GeoGlobe.Util.applyDefaults(t,this.options),new GeoGlobe.Protocol.Response({requestType:"commit"});var i=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}}),r=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(t.featureNS?this.featurePrefix+":":"")+t.featureType}});t.featureNS&&r.setAttribute("xmlns:"+this.featurePrefix,t.featureNS);var o=this.format.writeNode("ogc:Filter",e);r.appendChild(o),i.appendChild(r);var n=GeoGlobe.Format.XML.prototype.write.apply(this.format,[i]);return GeoGlobe.Request.POST({url:this.url,callback:t.callback||function(){},data:n})},abort:function(e){e&&e.priv.abort()},CLASS_NAME:"GeoGlobe.Protocol.WFS.v1"}),GeoGlobe.Protocol.WFS.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"GeoGlobe.Protocol.WFS.v1_0_0"}),GeoGlobe.Protocol.WFS.v1_1_0=GeoGlobe.Class4OL(GeoGlobe.Protocol.WFS.v1,{version:"1.1.0",initialize:function(e){GeoGlobe.Protocol.WFS.v1.prototype.initialize.apply(this,arguments),this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new GeoGlobe.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new GeoGlobe.Format.GeoJSON))},CLASS_NAME:"GeoGlobe.Protocol.WFS.v1_1_0"}),GeoGlobe.Protocol.CSW=function(e){e=GeoGlobe.Util.applyDefaults(e,GeoGlobe.Protocol.CSW.DEFAULTS);var t=GeoGlobe.Protocol.CSW["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported CSW version: "+e.version;return new t(e)},GeoGlobe.Protocol.CSW.DEFAULTS={version:"2.0.2"},GeoGlobe.Protocol.CSW.v2_0_2=GeoGlobe.Class4OL(GeoGlobe.Protocol,{formatOptions:null,initialize:function(e){GeoGlobe.Protocol.prototype.initialize.apply(this,[e]),e.format||(this.format=new GeoGlobe.Format.CSWGetRecords.v2_0_2(GeoGlobe.Util.extend({},this.formatOptions)))},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,GeoGlobe.Protocol.prototype.destroy.apply(this)},read:function(e){e=GeoGlobe.Util.extend({},e),GeoGlobe.Util.applyDefaults(e,this.options||{});var t=new GeoGlobe.Protocol.Response({requestType:"read"}),i=this.format.write(e.params||e);return t.priv=GeoGlobe.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),params:e.params,headers:e.headers,data:i}),t},handleRead:function(e,t){if(t.callback){var i=e.priv;i.status>=200&&i.status<300?(e.data=this.parseData(i),e.code=GeoGlobe.Protocol.Response.SUCCESS):e.code=GeoGlobe.Protocol.Response.FAILURE,t.callback.call(t.scope,e)}},parseData:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),!t||t.length<=0?null:this.format.read(t)},CLASS_NAME:"GeoGlobe.Protocol.CSW.v2_0_2"}),GeoGlobe.Protocol.Script=GeoGlobe.Class4OL(GeoGlobe.Protocol,{url:null,params:null,callback:null,callbackTemplate:"GeoGlobe.Protocol.Script.registry.${id}",callbackKey:"callback",callbackPrefix:"",scope:null,format:null,pendingRequests:null,srsInBBOX:!1,initialize:function(e){if(e=e||{},this.params={},this.pendingRequests={},GeoGlobe.Protocol.prototype.initialize.apply(this,arguments),this.format||(this.format=new GeoGlobe.Format.GeoJSON),!this.filterToParams&&GeoGlobe.Format.QueryStringFilter){var t=new GeoGlobe.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,i){return t.write(e,i)}}},read:function(e){GeoGlobe.Protocol.prototype.read.apply(this,arguments),(e=GeoGlobe.Util.applyDefaults(e,this.options)).params=GeoGlobe.Util.applyDefaults(e.params,this.options.params),e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=new GeoGlobe.Protocol.Response({requestType:"read"}),i=this.createRequest(e.url,e.params,GeoGlobe.Function.bind((function(i){t.data=i,this.handleRead(t,e)}),this));return t.priv=i,t},createRequest:function(e,t,i){var r=GeoGlobe.Protocol.Script.register(i),o=GeoGlobe.String.format(this.callbackTemplate,{id:r});(t=GeoGlobe.Util.extend({},t))[this.callbackKey]=this.callbackPrefix+o,e=GeoGlobe.Util.urlAppend(e,GeoGlobe.Util.getParameterString(t));var n=document.createElement("script");return n.type="text/javascript",n.src=e,n.id="GeoGlobe_Protocol_Script_"+r,this.pendingRequests[n.id]=n,document.getElementsByTagName("head")[0].appendChild(n),n},destroyRequest:function(e){GeoGlobe.Protocol.Script.unregister(e.id.split("_").pop()),delete this.pendingRequests[e.id],e.parentNode&&e.parentNode.removeChild(e)},handleRead:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){t.callback&&(e.data?(e.features=this.parseFeatures(e.data),e.code=GeoGlobe.Protocol.Response.SUCCESS):e.code=GeoGlobe.Protocol.Response.FAILURE,this.destroyRequest(e.priv),t.callback.call(t.scope,e))},parseFeatures:function(e){return this.format.read(e)},abort:function(e){if(e)this.destroyRequest(e.priv);else for(var t in this.pendingRequests)this.destroyRequest(this.pendingRequests[t])},destroy:function(){this.abort(),delete this.params,delete this.format,GeoGlobe.Protocol.prototype.destroy.apply(this)},CLASS_NAME:"GeoGlobe.Protocol.Script"}),function(){var e=GeoGlobe.Protocol.Script,t=0;e.registry={},e.register=function(i){var r="c"+ ++t;return e.registry[r]=function(){i.apply(this,arguments)},r},e.unregister=function(t){delete e.registry[t]}}(),GeoGlobe.Format=GeoGlobe.Class4OL({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(e){GeoGlobe.Util.extend(this,e),this.options=e},destroy:function(){},read:function(e){throw new Error("Read not implemented.")},write:function(e){throw new Error("Write not implemented.")},CLASS_NAME:"GeoGlobe.Format"}),GeoGlobe.Format.XML=GeoGlobe.Class4OL(GeoGlobe.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(e){for(var t in window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),GeoGlobe.Format.prototype.initialize.apply(this,[e]),this.namespaces=GeoGlobe.Util.extend({},this.namespaces),this.namespaceAlias={},this.namespaces)this.namespaceAlias[this.namespaces[t]]=t},destroy:function(){this.xmldom=null,GeoGlobe.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(e,t){this.namespaces[e]=t,this.namespaceAlias[t]=e},read:function(e){var t=e.indexOf("<");t>0&&(e=e.substring(t));var i=GeoGlobe.Util.Try(GeoGlobe.Function.bind((function(){var t;return(t=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom).loadXML(e),t}),this),(function(){return(new DOMParser).parseFromString(e,"text/xml")}),(function(){var t=new XMLHttpRequest;return t.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1),t.overrideMimeType&&t.overrideMimeType("text/xml"),t.send(null),t.responseXML}));return this.keepData&&(this.data=i),i},write:function(e){var t;if(e.xml)t=e.xml;else{var i=new XMLSerializer;if(1==e.nodeType){var r=document.implementation.createDocument("","",null);r.importNode&&(e=r.importNode(e,!0)),r.appendChild(e),t=i.serializeToString(r)}else t=i.serializeToString(e)}return t},createElementNS:function(e,t){return this.xmldom?"string"==typeof e?this.xmldom.createNode(1,t,e):this.xmldom.createNode(1,t,""):document.createElementNS(e,t)},createDocumentFragment:function(){return this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment()},createTextNode:function(e){return"string"!=typeof e&&(e=String(e)),this.xmldom?this.xmldom.createTextNode(e):document.createTextNode(e)},getElementsByTagNameNS:function(e,t,i){var r=[];if(e.getElementsByTagNameNS)r=e.getElementsByTagNameNS(t,i);else for(var o,n,s=e.getElementsByTagName("*"),a=0,l=s.length;a<l;++a)n=(o=s[a]).prefix?o.prefix+":"+i:i,"*"!=i&&n!=o.nodeName||"*"!=t&&t!=o.namespaceURI||r.push(o);return r},getAttributeNodeNS:function(e,t,i){var r=null;if(e.getAttributeNodeNS)r=e.getAttributeNodeNS(t,i);else for(var o,n=e.attributes,s=0,a=n.length;s<a;++s)if((o=n[s]).namespaceURI==t&&(o.prefix?o.prefix+":"+i:i)==o.nodeName){r=o;break}return r},getAttributeNS:function(e,t,i){var r="";if(e.getAttributeNS)r=e.getAttributeNS(t,i)||"";else{var o=this.getAttributeNodeNS(e,t,i);o&&(r=o.nodeValue)}return r},getChildValue:function(e,t){var i=t||"";if(e)for(var r=e.firstChild;r;r=r.nextSibling)switch(r.nodeType){case 3:case 4:i+=r.nodeValue}return i},isSimpleContent:function(e){for(var t=!0,i=e.firstChild;i;i=i.nextSibling)if(1===i.nodeType){t=!1;break}return t},contentType:function(e){for(var t=!1,i=!1,r=GeoGlobe.Format.XML.CONTENT_TYPE.EMPTY,o=e.firstChild;o;o=o.nextSibling){switch(o.nodeType){case 1:i=!0;break;case 8:break;default:t=!0}if(i&&t)break}if(i&&t)r=GeoGlobe.Format.XML.CONTENT_TYPE.MIXED;else{if(i)return GeoGlobe.Format.XML.CONTENT_TYPE.COMPLEX;if(t)return GeoGlobe.Format.XML.CONTENT_TYPE.SIMPLE}return r},hasAttributeNS:function(e,t,i){return e.hasAttributeNS?e.hasAttributeNS(t,i):!!this.getAttributeNodeNS(e,t,i)},setAttributeNS:function(e,t,i,r){if(e.setAttributeNS)e.setAttributeNS(t,i,r);else{if(!this.xmldom)throw"setAttributeNS not implemented";if(t){var o=e.ownerDocument.createNode(2,i,t);o.nodeValue=r,e.setAttributeNode(o)}else e.setAttribute(i,r)}},createElementNSPlus:function(e,t){var i=(t=t||{}).uri||this.namespaces[t.prefix];if(!i){var r=e.indexOf(":");i=this.namespaces[e.substring(0,r)]}i||(i=this.namespaces[this.defaultPrefix]);var o=this.createElementNS(i,e);t.attributes&&this.setAttributes(o,t.attributes);var n=t.value;return null!=n&&o.appendChild(this.createTextNode(n)),o},setAttributes:function(e,t){var i,r;for(var o in t)null!=t[o]&&t[o].toString&&(i=t[o].toString(),r=this.namespaces[o.substring(0,o.indexOf(":"))]||null,this.setAttributeNS(e,r,o,i))},readNode:function(e,t){t||(t={});var i=this.readers[e.namespaceURI?this.namespaceAlias[e.namespaceURI]:this.defaultPrefix];if(i){var r=i[e.localName||e.nodeName.split(":").pop()]||i["*"];r&&r.apply(this,[e,t])}return t},readChildNodes:function(e,t){t||(t={});for(var i,r=e.childNodes,o=0,n=r.length;o<n;++o)1==(i=r[o]).nodeType&&this.readNode(i,t);return t},writeNode:function(e,t,i){var r,o,n=e.indexOf(":");n>0?(r=e.substring(0,n),o=e.substring(n+1)):(r=i?this.namespaceAlias[i.namespaceURI]:this.defaultPrefix,o=e);var s=this.writers[r][o].apply(this,[t]);return i&&i.appendChild(s),s},getChildEl:function(e,t,i){return e&&this.getThisOrNextEl(e.firstChild,t,i)},getNextEl:function(e,t,i){return e&&this.getThisOrNextEl(e.nextSibling,t,i)},getThisOrNextEl:function(e,t,i){e:for(var r=e;r;r=r.nextSibling)switch(r.nodeType){case 1:if(!(t&&t!==(r.localName||r.nodeName.split(":").pop())||i&&i!==r.namespaceURI))break e;r=null;break e;case 3:if(/^\s*$/.test(r.nodeValue))break;case 4:case 6:case 12:case 10:case 11:r=null;break e}return r||null},lookupNamespaceURI:function(e,t){var i=null;if(e)if(e.lookupNamespaceURI)i=e.lookupNamespaceURI(t);else e:switch(e.nodeType){case 1:if(null!==e.namespaceURI&&e.prefix===t){i=e.namespaceURI;break e}var r=e.attributes.length;if(r)for(var o,n=0;n<r;++n){if("xmlns"===(o=e.attributes[n]).prefix&&o.name==="xmlns:"+t){i=o.value||null;break e}if("xmlns"===o.name&&null===t){i=o.value||null;break e}}i=this.lookupNamespaceURI(e.parentNode,t);break e;case 2:i=this.lookupNamespaceURI(e.ownerElement,t);break e;case 9:i=this.lookupNamespaceURI(e.documentElement,t);break e;case 6:case 12:case 10:case 11:break e;default:i=this.lookupNamespaceURI(e.parentNode,t)}return i},getXMLDoc:function(){return GeoGlobe.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?GeoGlobe.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"))),GeoGlobe.Format.XML.document||this.xmldom},CLASS_NAME:"GeoGlobe.Format.XML"}),GeoGlobe.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3},GeoGlobe.Format.XML.lookupNamespaceURI=GeoGlobe.Function.bind(GeoGlobe.Format.XML.prototype.lookupNamespaceURI,GeoGlobe.Format.XML.prototype),GeoGlobe.Format.XML.document=null,GeoGlobe.Format.XML.VersionedOGC=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(e){GeoGlobe.Format.XML.prototype.initialize.apply(this,[e]);var t=this.CLASS_NAME;this.name=t.substring(t.lastIndexOf(".")+1)},getVersion:function(e,t){var i;return e?(i=this.version)||(i=e.getAttribute("version"))||(i=this.defaultVersion):i=t&&t.version||this.version||this.defaultVersion,i},getParser:function(e){e=e||this.defaultVersion;var t=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=e){var i=GeoGlobe.Format[this.name]["v"+e.replace(/\./g,"_")+t];if(!i&&(""!==t&&this.allowFallback&&(t="",i=GeoGlobe.Format[this.name]["v"+e.replace(/\./g,"_")]),!i))throw"Can't find a "+this.name+" parser for version "+e+t;this.parser=new i(this.options)}return this.parser},write:function(e,t){var i=this.getVersion(null,t);this.parser=this.getParser(i);var r=this.parser.write(e,t);return!1===this.stringifyOutput?r:GeoGlobe.Format.XML.prototype.write.apply(this,[r])},read:function(e,t){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e]));var i=e.documentElement,r=this.getVersion(i);this.parser=this.getParser(r);var o=this.parser.read(e,t),n=this.parser.errorProperty||null;if(null!==n&&void 0===o[n]){var s=new GeoGlobe.Format.OGCExceptionReport;o.error=s.read(e)}return o.version=r,o},CLASS_NAME:"GeoGlobe.Format.XML.VersionedOGC"}),GeoGlobe.Format.GML=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},GeoGlobe.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e]));for(var t=this.getElementsByTagNameNS(e.documentElement,this.gmlns,this.featureName),i=[],r=0;r<t.length;r++){var o=this.parseFeature(t[r]);o&&i.push(o)}return i},parseFeature:function(e){for(var t,i,r,o,n,s=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],a=0;a<s.length;++a)if(t=s[a],(i=this.getElementsByTagNameNS(e,this.gmlns,t)).length>0){if(!(o=this.parseGeometry[t.toLowerCase()]))throw new TypeError("Unsupported geometry type: "+t);r=o.apply(this,[i[0]]),this.internalProjection&&this.externalProjection&&r.transform(this.externalProjection,this.internalProjection);break}var l,u=this.getElementsByTagNameNS(e,this.gmlns,"Box");for(a=0;a<u.length;++a){var h=u[a],c=this.parseGeometry.box.apply(this,[h]),g=h.parentNode;"boundedBy"===(g.localName||g.nodeName.split(":").pop())?n=c:r=c.toGeometry()}this.extractAttributes&&(l=this.parseAttributes(e));var p=new GeoGlobe.Feature(r,l);p.bounds=n,p.gml={featureType:e.firstChild.nodeName.split(":")[1],featureNS:e.firstChild.namespaceURI,featureNSPrefix:e.firstChild.prefix};for(var f,d=e.firstChild;d&&(1!=d.nodeType||!(f=d.getAttribute("fid")||d.getAttribute("id")));)d=d.nextSibling;return p.fid=f,p},parseGeometry:{point:function(e){var t,i=[];if((t=this.getElementsByTagNameNS(e,this.gmlns,"pos")).length>0&&(i=t[0].firstChild.nodeValue.replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace)),0==i.length&&(t=this.getElementsByTagNameNS(e,this.gmlns,"coordinates")).length>0&&(i=t[0].firstChild.nodeValue.replace(this.regExes.removeSpace,"").split(",")),0==i.length&&(t=this.getElementsByTagNameNS(e,this.gmlns,"coord")).length>0){var r=this.getElementsByTagNameNS(t[0],this.gmlns,"X"),o=this.getElementsByTagNameNS(t[0],this.gmlns,"Y");r.length>0&&o.length>0&&(i=[r[0].firstChild.nodeValue,o[0].firstChild.nodeValue])}return 2==i.length&&(i[2]=null),this.xy?new GeoGlobe.Geometry.Point(i[0],i[1],i[2]):new GeoGlobe.Geometry.Point(i[1],i[0],i[2])},multipoint:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Point"),i=[];if(t.length>0)for(var r,o=0;o<t.length;++o)(r=this.parseGeometry.point.apply(this,[t[o]]))&&i.push(r);return new GeoGlobe.Geometry.MultiPoint(i)},linestring:function(e,t){var i,r=[],o=[];if((i=this.getElementsByTagNameNS(e,this.gmlns,"posList")).length>0){r=this.getChildValue(i[0]).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace);for(var n,s,a,l,u=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[0].getAttribute("dimension")),h=0;h<r.length/u;++h)s=r[n=h*u],a=r[n+1],l=2==u?null:r[n+2],this.xy?o.push(new GeoGlobe.Geometry.Point(s,a,l)):o.push(new GeoGlobe.Geometry.Point(a,s,l))}if(0==r.length&&(i=this.getElementsByTagNameNS(e,this.gmlns,"coordinates")).length>0){var c=this.getChildValue(i[0]).replace(this.regExes.trimSpace,"").replace(this.regExes.trimComma,",").split(this.regExes.splitSpace);for(h=0;h<c.length;++h)2==(r=c[h].split(",")).length&&(r[2]=null),this.xy?o.push(new GeoGlobe.Geometry.Point(r[0],r[1],r[2])):o.push(new GeoGlobe.Geometry.Point(r[1],r[0],r[2]))}var g=null;return 0!=o.length&&(g=t?new GeoGlobe.Geometry.LinearRing(o):new GeoGlobe.Geometry.LineString(o)),g},multilinestring:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LineString"),i=[];if(t.length>0)for(var r,o=0;o<t.length;++o)(r=this.parseGeometry.linestring.apply(this,[t[o]]))&&i.push(r);return new GeoGlobe.Geometry.MultiLineString(i)},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LinearRing"),i=[];if(t.length>0)for(var r,o=0;o<t.length;++o)(r=this.parseGeometry.linestring.apply(this,[t[o],!0]))&&i.push(r);return new GeoGlobe.Geometry.Polygon(i)},multipolygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Polygon"),i=[];if(t.length>0)for(var r,o=0;o<t.length;++o)(r=this.parseGeometry.polygon.apply(this,[t[o]]))&&i.push(r);return new GeoGlobe.Geometry.MultiPolygon(i)},envelope:function(e){var t,i=[],r=this.getElementsByTagNameNS(e,this.gmlns,"lowerCorner");if(r.length>0){var o=[];if(r.length>0&&(o=r[0].firstChild.nodeValue.replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace)),2==o.length&&(o[2]=null),this.xy)var n=new GeoGlobe.Geometry.Point(o[0],o[1],o[2]);else n=new GeoGlobe.Geometry.Point(o[1],o[0],o[2])}var s=this.getElementsByTagNameNS(e,this.gmlns,"upperCorner");if(s.length>0)if(o=[],s.length>0&&(o=s[0].firstChild.nodeValue.replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace)),2==o.length&&(o[2]=null),this.xy)var a=new GeoGlobe.Geometry.Point(o[0],o[1],o[2]);else a=new GeoGlobe.Geometry.Point(o[1],o[0],o[2]);if(n&&a){i.push(new GeoGlobe.Geometry.Point(n.x,n.y)),i.push(new GeoGlobe.Geometry.Point(a.x,n.y)),i.push(new GeoGlobe.Geometry.Point(a.x,a.y)),i.push(new GeoGlobe.Geometry.Point(n.x,a.y)),i.push(new GeoGlobe.Geometry.Point(n.x,n.y));var l=new GeoGlobe.Geometry.LinearRing(i);t=new GeoGlobe.Geometry.Polygon([l])}return t},box:function(e){var t,i=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),r=null,o=null;if(i.length>0&&2==(t=i[0].firstChild.nodeValue.split(" ")).length&&(r=t[0].split(","),o=t[1].split(",")),null!==r&&null!==o){var n=new GeoGlobe.LngLat(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(r[0]),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(r[1])),s=new GeoGlobe.LngLat(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(o[0]),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(o[1]));return new GeoGlobe.LngLatBounds(n,s)}}},parseAttributes:function(e){for(var t,i,r,o,n,s,a,l={},u=e.firstChild;u;){if(1==u.nodeType){for(t=u.childNodes,i=0;i<t.length;++i)1==(r=t[i]).nodeType&&(1==(o=r.childNodes).length?3!=(n=o[0]).nodeType&&4!=n.nodeType||(s=r.prefix?r.nodeName.split(":")[1]:r.nodeName,a=n.nodeValue.replace(this.regExes.trimSpace,""),l[s]=a):l[r.nodeName.split(":").pop()]=null);break}u=u.nextSibling}return l},write:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),i=0;i<e.length;i++)t.appendChild(this.createFeatureXML(e[i]));return GeoGlobe.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=e.geometry,i=this.buildGeometryNode(t),r=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);r.appendChild(i);var o=this.createElementNS(this.gmlns,"gml:"+this.featureName),n=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName),s=e.fid||e.id;for(var a in n.setAttribute("fid",s),n.appendChild(r),e.attributes){var l=this.createTextNode(e.attributes[a]),u=a.substring(a.lastIndexOf(":")+1),h=this.createElementNS(this.featureNS,this.featurePrefix+":"+u);h.appendChild(l),n.appendChild(h)}return o.appendChild(n),o},buildGeometryNode:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone()).transform(this.internalProjection,this.externalProjection);var t=e.CLASS_NAME,i=t.substring(t.lastIndexOf(".")+1);return this.buildGeometry[i.toLowerCase()].apply(this,[e])},buildGeometry:{point:function(e){var t=this.createElementNS(this.gmlns,"gml:Point");return t.appendChild(this.buildCoordinatesNode(e)),t},multipoint:function(e){for(var t,i,r=this.createElementNS(this.gmlns,"gml:MultiPoint"),o=e.components,n=0;n<o.length;n++)t=this.createElementNS(this.gmlns,"gml:pointMember"),i=this.buildGeometry.point.apply(this,[o[n]]),t.appendChild(i),r.appendChild(t);return r},linestring:function(e){var t=this.createElementNS(this.gmlns,"gml:LineString");return t.appendChild(this.buildCoordinatesNode(e)),t},multilinestring:function(e){for(var t,i,r=this.createElementNS(this.gmlns,"gml:MultiLineString"),o=e.components,n=0;n<o.length;++n)t=this.createElementNS(this.gmlns,"gml:lineStringMember"),i=this.buildGeometry.linestring.apply(this,[o[n]]),t.appendChild(i),r.appendChild(t);return r},linearring:function(e){var t=this.createElementNS(this.gmlns,"gml:LinearRing");return t.appendChild(this.buildCoordinatesNode(e)),t},polygon:function(e){for(var t,i,r,o=this.createElementNS(this.gmlns,"gml:Polygon"),n=e.components,s=0;s<n.length;++s)r=0==s?"outerBoundaryIs":"innerBoundaryIs",t=this.createElementNS(this.gmlns,"gml:"+r),i=this.buildGeometry.linearring.apply(this,[n[s]]),t.appendChild(i),o.appendChild(t);return o},multipolygon:function(e){for(var t,i,r=this.createElementNS(this.gmlns,"gml:MultiPolygon"),o=e.components,n=0;n<o.length;++n)t=this.createElementNS(this.gmlns,"gml:polygonMember"),i=this.buildGeometry.polygon.apply(this,[o[n]]),t.appendChild(i),r.appendChild(t);return r},lnglatbounds:function(e){var t=this.createElementNS(this.gmlns,"gml:Box");return t.appendChild(this.buildCoordinatesNode(e)),t}},buildCoordinatesNode:function(e){var t=this.createElementNS(this.gmlns,"gml:coordinates");t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," ");var i=[];if(e instanceof GeoGlobe.LngLatBounds)i.push(e.getWest()+","+e.getSouth()),i.push(e.getEast()+","+e.getNorth());else for(var r=e.components?e.components:[e],o=0;o<r.length;o++)i.push(r[o].x+","+r[o].y);var n=this.createTextNode(i.join(" "));return t.appendChild(n),t},CLASS_NAME:"GeoGlobe.Format.GML"}),GeoGlobe.Format.GML||(GeoGlobe.Format.GML={}),GeoGlobe.Format.GML.Base=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(e){GeoGlobe.Format.XML.prototype.initialize.apply(this,[e]),this.setGeometryTypes(),e&&e.featureNS&&this.setNamespace("feature",e.featureNS),this.singleFeatureType=!e||"string"==typeof e.featureType},read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t,i=[];if(this.readNode(e,{features:i},!0),0==i.length)if((t=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember")).length)for(var r=0,o=t.length;r<o;++r)this.readNode(t[r],{features:i},!0);else(t=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMembers")).length&&this.readNode(t[0],{features:i},!0);return i},readNode:function(e,t,i){return!0===i&&!0===this.autoConfig&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null),this.featureNS||e.prefix in this.namespaces||e.parentNode.namespaceURI!=this.namespaces.gml||!this.regExes.featureMember.test(e.parentNode.nodeName)||(this.featureType=e.nodeName.split(":").pop(),this.setNamespace("feature",e.namespaceURI),this.featureNS=e.namespaceURI,this.autoConfig=!0),GeoGlobe.Format.XML.prototype.readNode.apply(this,[e,t])},readers:{gml:{_inherit:function(e,t,i){},featureMember:function(e,t){this.readChildNodes(e,t)},featureMembers:function(e,t){this.readChildNodes(e,t)},name:function(e,t){t.name=this.getChildValue(e)},boundedBy:function(e,t){var i={};this.readChildNodes(e,i),i.components&&i.components.length>0&&(t.bounds=i.components[0])},Point:function(e,t){var i={points:[]};this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(i.points[0])},coordinates:function(e,t){for(var i,r=this.getChildValue(e).replace(this.regExes.trimSpace,""),o=(r=r.replace(this.regExes.trimComma,",")).split(this.regExes.splitSpace),n=o.length,s=new Array(n),a=0;a<n;++a)i=o[a].split(","),this.xy?s[a]=new GeoGlobe.Geometry.Point(i[0],i[1],i[2]):s[a]=new GeoGlobe.Geometry.Point(i[1],i[0],i[2]);t.points=s},coord:function(e,t){var i={};this.readChildNodes(e,i),t.points||(t.points=[]),t.points.push(new GeoGlobe.Geometry.Point(i.x,i.y,i.z))},X:function(e,t){t.x=this.getChildValue(e)},Y:function(e,t){t.y=this.getChildValue(e)},Z:function(e,t){t.z=this.getChildValue(e)},MultiPoint:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new GeoGlobe.Geometry.MultiPoint(i.components)]},pointMember:function(e,t){this.readChildNodes(e,t)},LineString:function(e,t){var i={};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(new GeoGlobe.Geometry.LineString(i.points))},MultiLineString:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new GeoGlobe.Geometry.MultiLineString(i.components)]},lineStringMember:function(e,t){this.readChildNodes(e,t)},Polygon:function(e,t){var i={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),i.inner.unshift(i.outer),t.components||(t.components=[]),t.components.push(new GeoGlobe.Geometry.Polygon(i.inner))},LinearRing:function(e,t){var i={};this.readers.gml._inherit.apply(this,[e,i]),this.readChildNodes(e,i),t.components=[new GeoGlobe.Geometry.LinearRing(i.points)]},MultiPolygon:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new GeoGlobe.Geometry.MultiPolygon(i.components)]},polygonMember:function(e,t){this.readChildNodes(e,t)},GeometryCollection:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new GeoGlobe.Geometry.Collection(i.components)]},geometryMember:function(e,t){this.readChildNodes(e,t)}},feature:{"*":function(e,t){var i,r=e.localName||e.nodeName.split(":").pop();if(t.features)if(this.singleFeatureType||-1===GeoGlobe.Util.indexOf(this.featureType,r)){if(r===this.featureType)i="_typeName";else if(GeoGlobe.Util.isArray(this.featureType_))for(var o=0;o<this.featureType_.length;o++)if(this.featureType_[o]===r){i="_typeName";break}}else i="_typeName";else 0==e.childNodes.length||1==e.childNodes.length&&3==e.firstChild.nodeType?this.extractAttributes&&(i="_attribute"):i="_geometry";i&&this.readers.feature[i].apply(this,[e,t])},_typeName:function(e,t){var i={components:[],attributes:{}};this.readChildNodes(e,i),i.name&&(i.attributes.name=i.name);var r=new GeoGlobe.Feature(i.components[0],i.attributes);this.singleFeatureType||(r.type=e.nodeName.split(":").pop(),r.namespace=e.namespaceURI);var o=e.getAttribute("fid")||this.getAttributeNS(e,this.namespaces.gml,"id");o&&(r.fid=o),this.internalProjection&&this.externalProjection&&r.geometry&&r.geometry.transform(this.externalProjection,this.internalProjection),i.bounds&&(r.bounds=i.bounds),t.features.push(r)},_geometry:function(e,t){this.geometryName||(this.geometryName=e.nodeName.split(":").pop()),this.readChildNodes(e,t)},_attribute:function(e,t){var i=e.localName||e.nodeName.split(":").pop(),r=this.getChildValue(e);t.attributes[i]=r}},wfs:{FeatureCollection:function(e,t){this.readChildNodes(e,t)}}},write:function(e){var t;t=GeoGlobe.Util.isArray(e)?"featureMembers":"featureMember";var i=this.writeNode("gml:"+t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),GeoGlobe.Format.XML.prototype.write.apply(this,[i])},writers:{gml:{featureMember:function(e){var t=this.createElementNSPlus("gml:featureMember");return this.writeNode("feature:_typeName",e,t),t},MultiPoint:function(e){for(var t=this.createElementNSPlus("gml:MultiPoint"),i=e.components||[e],r=0,o=i.length;r<o;++r)this.writeNode("pointMember",i[r],t);return t},pointMember:function(e){var t=this.createElementNSPlus("gml:pointMember");return this.writeNode("Point",e,t),t},MultiLineString:function(e){for(var t=this.createElementNSPlus("gml:MultiLineString"),i=e.components||[e],r=0,o=i.length;r<o;++r)this.writeNode("lineStringMember",i[r],t);return t},lineStringMember:function(e){var t=this.createElementNSPlus("gml:lineStringMember");return this.writeNode("LineString",e,t),t},MultiPolygon:function(e){for(var t=this.createElementNSPlus("gml:MultiPolygon"),i=e.components||[e],r=0,o=i.length;r<o;++r)this.writeNode("polygonMember",i[r],t);return t},polygonMember:function(e){var t=this.createElementNSPlus("gml:polygonMember");return this.writeNode("Polygon",e,t),t},GeometryCollection:function(e){for(var t=this.createElementNSPlus("gml:GeometryCollection"),i=0,r=e.components.length;i<r;++i)this.writeNode("geometryMember",e.components[i],t);return t},geometryMember:function(e){var t=this.createElementNSPlus("gml:geometryMember"),i=this.writeNode("feature:_geometry",e);return t.appendChild(i.firstChild),t}},feature:{_typeName:function(e){var t=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:e.fid}});for(var i in e.geometry&&this.writeNode("feature:_geometry",e.geometry,t),e.attributes){var r=e.attributes[i];null!=r&&this.writeNode("feature:_attribute",{name:i,value:r},t)}return t},_geometry:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone().transform(this.internalProjection,this.externalProjection));var t=this.createElementNSPlus("feature:"+this.geometryName),i=this.geometryTypes[e.CLASS_NAME],r=this.writeNode("gml:"+i,e,t);return this.srsName&&r.setAttribute("srsName",this.srsName),t},_attribute:function(e){return this.createElementNSPlus("feature:"+e.name,{value:e.value})}},wfs:{FeatureCollection:function(e){for(var t=this.createElementNSPlus("wfs:FeatureCollection"),i=0,r=e.length;i<r;++i)this.writeNode("gml:featureMember",e[i],t);return t}}},setGeometryTypes:function(){this.geometryTypes={"GeoGlobe.Geometry.Point":"Point","GeoGlobe.Geometry.MultiPoint":"MultiPoint","GeoGlobe.Geometry.LineString":"LineString","GeoGlobe.Geometry.MultiLineString":"MultiLineString","GeoGlobe.Geometry.Polygon":"Polygon","GeoGlobe.Geometry.MultiPolygon":"MultiPolygon","GeoGlobe.Geometry.Collection":"GeometryCollection"}},setFeatureType_:function(e){this.featureType_=e},CLASS_NAME:"GeoGlobe.Format.GML.Base"}),GeoGlobe.Format.GML.v2=GeoGlobe.Class4OL(GeoGlobe.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(e){GeoGlobe.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:GeoGlobe.Util.applyDefaults({outerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i),t.outer=i.components[0]},innerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i),t.inner.push(i.components[0])},Box:function(e,t){var i={};this.readChildNodes(e,i),t.components||(t.components=[]);var r=i.points[0],o=i.points[1],n=new GeoGlobe.LngLat(r.x,r.y),s=new GeoGlobe.LngLat(o.x,o.y);t.components.push(new GeoGlobe.LngLatBounds(n,s))}},GeoGlobe.Format.GML.Base.prototype.readers.gml),feature:GeoGlobe.Format.GML.Base.prototype.readers.feature,wfs:GeoGlobe.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=GeoGlobe.Util.isArray(e)?"wfs:FeatureCollection":"gml:featureMember";var i=this.writeNode(t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),GeoGlobe.Format.XML.prototype.write.apply(this,[i])},writers:{gml:GeoGlobe.Util.applyDefaults({Point:function(e){var t=this.createElementNSPlus("gml:Point");return this.writeNode("coordinates",[e],t),t},coordinates:function(e){for(var t,i=e.length,r=new Array(i),o=0;o<i;++o)t=e[o],this.xy?r[o]=t.x+","+t.y:r[o]=t.y+","+t.x,null!=t.z&&(r[o]+=","+t.z);return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==i?r[0]:r.join(" ")})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");return this.writeNode("coordinates",e.components,t),t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",e.components[0],t);for(var i=1;i<e.components.length;++i)this.writeNode("innerBoundaryIs",e.components[i],t);return t},outerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:outerBoundaryIs");return this.writeNode("LinearRing",e,t),t},innerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:innerBoundaryIs");return this.writeNode("LinearRing",e,t),t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");return this.writeNode("coordinates",e.components,t),t},Box:function(e){var t=this.createElementNSPlus("gml:Box");return this.writeNode("coordinates",[{x:e._sw.lng,y:e._sw.lat},{x:e._ne.lng,y:e._ne.lat}],t),this.srsName&&t.setAttribute("srsName",this.srsName),t}},GeoGlobe.Format.GML.Base.prototype.writers.gml),feature:GeoGlobe.Format.GML.Base.prototype.writers.feature,wfs:GeoGlobe.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"GeoGlobe.Format.GML.v2"}),GeoGlobe.Format.GML.v3=GeoGlobe.Class4OL(GeoGlobe.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(e){GeoGlobe.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:GeoGlobe.Util.applyDefaults({_inherit:function(e,t,i){var r=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("srsDimension"),10)||i&&i.srsDimension;r&&(t.srsDimension=r)},featureMembers:function(e,t){this.readChildNodes(e,t)},Curve:function(e,t){var i={points:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(new GeoGlobe.Geometry.LineString(i.points))},segments:function(e,t){this.readChildNodes(e,t)},LineStringSegment:function(e,t){var i={};this.readChildNodes(e,i),i.points&&Array.prototype.push.apply(t.points,i.points)},pos:function(e,t){var i,r=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace);i=this.xy?new GeoGlobe.Geometry.Point(r[0],r[1],r[2]):new GeoGlobe.Geometry.Point(r[1],r[0],r[2]),t.points=[i]},posList:function(e,t){for(var i,r,o,n=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace),s=t.srsDimension||_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("srsDimension")||e.getAttribute("dimension"),10)||2,a=n.length/s,l=new Array(a),u=0,h=n.length;u<h;u+=s)i=n[u],r=n[u+1],o=2==s?void 0:n[u+2],this.xy?l[u/s]=new GeoGlobe.Geometry.Point(i,r,o):l[u/s]=new GeoGlobe.Geometry.Point(r,i,o);t.points=l},Surface:function(e,t){this.readChildNodes(e,t)},patches:function(e,t){this.readChildNodes(e,t)},PolygonPatch:function(e,t){this.readers.gml.Polygon.apply(this,[e,t])},exterior:function(e,t){var i={};this.readChildNodes(e,i),t.outer=i.components[0]},interior:function(e,t){var i={};this.readChildNodes(e,i),t.inner.push(i.components[0])},MultiCurve:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),i.components.length>0&&(t.components=[new GeoGlobe.Geometry.MultiLineString(i.components)])},curveMember:function(e,t){this.readChildNodes(e,t)},MultiSurface:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),i.components.length>0&&(t.components=[new GeoGlobe.Geometry.MultiPolygon(i.components)])},surfaceMember:function(e,t){this.readChildNodes(e,t)},surfaceMembers:function(e,t){this.readChildNodes(e,t)},pointMembers:function(e,t){this.readChildNodes(e,t)},lineStringMembers:function(e,t){this.readChildNodes(e,t)},polygonMembers:function(e,t){this.readChildNodes(e,t)},geometryMembers:function(e,t){this.readChildNodes(e,t)},Envelope:function(e,t){var i={points:new Array(2)};this.readChildNodes(e,i),t.components||(t.components=[]);var r=i.points[0],o=i.points[1],n=new GeoGlobe.LngLat(r.x,r.y),s=new GeoGlobe.LngLat(o.x,o.y);t.components.push(new GeoGlobe.LngLatBounds(n,s))},lowerCorner:function(e,t){var i={};this.readers.gml.pos.apply(this,[e,i]),t.points[0]=i.points[0]},upperCorner:function(e,t){var i={};this.readers.gml.pos.apply(this,[e,i]),t.points[1]=i.points[0]}},GeoGlobe.Format.GML.Base.prototype.readers.gml),feature:GeoGlobe.Format.GML.Base.prototype.readers.feature,wfs:GeoGlobe.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=GeoGlobe.Util.isArray(e)?"featureMembers":"featureMember";var i=this.writeNode("gml:"+t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),GeoGlobe.Format.XML.prototype.write.apply(this,[i])},writers:{gml:GeoGlobe.Util.applyDefaults({featureMembers:function(e){for(var t=this.createElementNSPlus("gml:featureMembers"),i=0,r=e.length;i<r;++i)this.writeNode("feature:_typeName",e[i],t);return t},Point:function(e){var t=this.createElementNSPlus("gml:Point");return this.writeNode("pos",e,t),t},pos:function(e){var t=this.xy?e.x+" "+e.y:e.y+" "+e.x;return this.createElementNSPlus("gml:pos",{value:t})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");return this.writeNode("posList",e.components,t),t},Curve:function(e){var t=this.createElementNSPlus("gml:Curve");return this.writeNode("segments",e,t),t},segments:function(e){var t=this.createElementNSPlus("gml:segments");return this.writeNode("LineStringSegment",e,t),t},LineStringSegment:function(e){var t=this.createElementNSPlus("gml:LineStringSegment");return this.writeNode("posList",e.components,t),t},posList:function(e){for(var t,i=e.length,r=new Array(i),o=0;o<i;++o)t=e[o],this.xy?r[o]=t.x+" "+t.y:r[o]=t.y+" "+t.x;return this.createElementNSPlus("gml:posList",{value:r.join(" ")})},Surface:function(e){var t=this.createElementNSPlus("gml:Surface");return this.writeNode("patches",e,t),t},patches:function(e){var t=this.createElementNSPlus("gml:patches");return this.writeNode("PolygonPatch",e,t),t},PolygonPatch:function(e){var t=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",e.components[0],t);for(var i=1,r=e.components.length;i<r;++i)this.writeNode("interior",e.components[i],t);return t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",e.components[0],t);for(var i=1,r=e.components.length;i<r;++i)this.writeNode("interior",e.components[i],t);return t},exterior:function(e){var t=this.createElementNSPlus("gml:exterior");return this.writeNode("LinearRing",e,t),t},interior:function(e){var t=this.createElementNSPlus("gml:interior");return this.writeNode("LinearRing",e,t),t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");return this.writeNode("posList",e.components,t),t},MultiCurve:function(e){for(var t=this.createElementNSPlus("gml:MultiCurve"),i=e.components||[e],r=0,o=i.length;r<o;++r)this.writeNode("curveMember",i[r],t);return t},curveMember:function(e){var t=this.createElementNSPlus("gml:curveMember");return this.curve?this.writeNode("Curve",e,t):this.writeNode("LineString",e,t),t},MultiSurface:function(e){for(var t=this.createElementNSPlus("gml:MultiSurface"),i=e.components||[e],r=0,o=i.length;r<o;++r)this.writeNode("surfaceMember",i[r],t);return t},surfaceMember:function(e){var t=this.createElementNSPlus("gml:surfaceMember");return this.surface?this.writeNode("Surface",e,t):this.writeNode("Polygon",e,t),t},Envelope:function(e){var t=this.createElementNSPlus("gml:Envelope");return this.writeNode("lowerCorner",e,t),this.writeNode("upperCorner",e,t),this.srsName&&t.setAttribute("srsName",this.srsName),t},lowerCorner:function(e){var t=this.xy?e._sw.lng+" "+e._sw.lat:e._sw.lat+" "+e._sw.lng;return this.createElementNSPlus("gml:lowerCorner",{value:t})},upperCorner:function(e){var t=this.xy?e._ne.lng+" "+e._ne.lat:e._ne.lat+" "+e._ne.lng;return this.createElementNSPlus("gml:upperCorner",{value:t})}},GeoGlobe.Format.GML.Base.prototype.writers.gml),feature:GeoGlobe.Format.GML.Base.prototype.writers.feature,wfs:GeoGlobe.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"GeoGlobe.Geometry.Point":"Point","GeoGlobe.Geometry.MultiPoint":"MultiPoint","GeoGlobe.Geometry.LineString":!0===this.curve?"Curve":"LineString","GeoGlobe.Geometry.MultiLineString":!1===this.multiCurve?"MultiLineString":"MultiCurve","GeoGlobe.Geometry.Polygon":!0===this.surface?"Surface":"Polygon","GeoGlobe.Geometry.MultiPolygon":!1===this.multiSurface?"MultiPolygon":"MultiSurface","GeoGlobe.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"GeoGlobe.Format.GML.v3"}),GeoGlobe.Format.KML=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"GeoGlobe export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g},this.externalProjection=new GeoGlobe.SpatialReference("EPSG:4326"),GeoGlobe.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){this.features=[],this.styles={},this.fetched={};var t={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(e,t)},parseData:function(e,t){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e]));for(var i=["Link","NetworkLink","Style","StyleMap","Placemark"],r=0,o=i.length;r<o;++r){var n=i[r],s=this.getElementsByTagNameNS(e,"*",n);if(0!=s.length)switch(n.toLowerCase()){case"link":case"networklink":this.parseLinks(s,t);break;case"style":this.extractStyles&&this.parseStyles(s,t);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(s,t);break;case"placemark":this.parseFeatures(s,t)}}return this.features},parseLinks:function(e,t){if(t.depth>=this.maxDepth)return!1;var i=GeoGlobe.Util.extend({},t);i.depth++;for(var r=0,o=e.length;r<o;r++){var n=this.parseProperty(e[r],"*","href");if(n&&!this.fetched[n]){this.fetched[n]=!0;var s=this.fetchLink(n);s&&this.parseData(s,i)}}},fetchLink:function(e){var t=GeoGlobe.Request.GET({url:e,async:!1});if(t)return t.responseText},parseStyles:function(e,t){for(var i=0,r=e.length;i<r;i++){var o=this.parseStyle(e[i]);if(o){var n=(t.styleBaseUrl||"")+"#"+o.id;this.styles[n]=o}}},parseKmlColor:function(e){var t=null;if(e){var i=e.match(this.regExes.kmlColor);i&&(t={color:"#"+i[4]+i[3]+i[2],opacity:_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[1],16)/255})}return t},parseStyle:function(e){for(var t,i,r={},o=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],n=0,s=o.length;n<s;++n)if(t=o[n],i=this.getElementsByTagNameNS(e,"*",t)[0])switch(t.toLowerCase()){case"linestyle":var a=this.parseProperty(i,"*","color");(w=this.parseKmlColor(a))&&(r.strokeColor=w.color,r.strokeOpacity=w.opacity),(u=this.parseProperty(i,"*","width"))&&(r.strokeWidth=u);break;case"polystyle":a=this.parseProperty(i,"*","color"),(w=this.parseKmlColor(a))&&(r.fillOpacity=w.opacity,r.fillColor=w.color),"0"==this.parseProperty(i,"*","fill")&&(r.fillColor="none"),"0"==this.parseProperty(i,"*","outline")&&(r.strokeWidth="0");break;case"iconstyle":var l=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(this.parseProperty(i,"*","scale")||1),u=32*l,h=32*l,c=this.getElementsByTagNameNS(i,"*","Icon")[0];if(c){var g=this.parseProperty(c,"*","href");if(g){var p=this.parseProperty(c,"*","w"),f=this.parseProperty(c,"*","h");!GeoGlobe.String.startsWith(g,"http://maps.google.com/mapfiles/kml")||p||f||(p=64,f=64,l/=2),p=p||f,f=f||p,p&&(u=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(p)*l),f&&(h=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(f)*l);var d=g.match(this.regExes.kmlIconPalette);if(d){var m=d[1],C=d[2],y=this.parseProperty(c,"*","x");g="http://maps.google.com/mapfiles/kml/pal"+m+"/icon"+(8*((A=this.parseProperty(c,"*","y"))?7-A/32:7)+(y?y/32:0))+C}r.graphicOpacity=1,r.externalGraphic=g}}var v=this.getElementsByTagNameNS(i,"*","hotSpot")[0];if(v){y=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(v.getAttribute("x"));var A=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(v.getAttribute("y")),_=v.getAttribute("xunits");"pixels"==_?r.graphicXOffset=-y*l:"insetPixels"==_?r.graphicXOffset=y*l-u:"fraction"==_&&(r.graphicXOffset=-u*y);var I=v.getAttribute("yunits");"pixels"==I?r.graphicYOffset=A*l-h+1:"insetPixels"==I?r.graphicYOffset=-A*l+1:"fraction"==I&&(r.graphicYOffset=-h*(1-A)+1)}r.graphicWidth=u,r.graphicHeight=h;break;case"balloonstyle":var b=GeoGlobe.Util.getXmlNodeValue(i);b&&(r.balloonStyle=b.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":var w;a=this.parseProperty(i,"*","color"),(w=this.parseKmlColor(a))&&(r.fontColor=w.color,r.fontOpacity=w.opacity)}!r.strokeColor&&r.fillColor&&(r.strokeColor=r.fillColor);var G=e.getAttribute("id");return G&&r&&(r.id=G),r},parseStyleMaps:function(e,t){for(var i=0,r=e.length;i<r;i++)for(var o=e[i],n=this.getElementsByTagNameNS(o,"*","Pair"),s=o.getAttribute("id"),a=0,l=n.length;a<l;a++){var u=n[a],h=this.parseProperty(u,"*","key"),c=this.parseProperty(u,"*","styleUrl");c&&"normal"==h&&(this.styles[(t.styleBaseUrl||"")+"#"+s]=this.styles[(t.styleBaseUrl||"")+c])}},parseFeatures:function(e,t){for(var i=[],r=0,o=e.length;r<o;r++){var n=e[r],s=this.parseFeature.apply(this,[n]);if(!s)throw"Bad Placemark: "+r;if(this.extractStyles&&s.attributes&&s.attributes.styleUrl&&(s.style=this.getStyle(s.attributes.styleUrl,t)),this.extractStyles){var a=this.getElementsByTagNameNS(n,"*","Style")[0];if(a){var l=this.parseStyle(a);l&&(s.style=GeoGlobe.Util.extend(s.style,l))}}if(this.extractTracks){var u=this.getElementsByTagNameNS(n,this.namespaces.gx,"Track");if(u&&u.length>0){var h=u[0],c={features:[],feature:s};this.readNode(h,c),c.features.length>0&&i.push.apply(i,c.features)}}else i.push(s)}this.features=this.features.concat(i)},readers:{kml:{when:function(e,t){t.whens.push(GeoGlobe.Date.parse(this.getChildValue(e)))},_trackPointAttribute:function(e,t){var i=e.nodeName.split(":").pop();t.attributes[i].push(this.getChildValue(e))}},gx:{Track:function(e,t){var i={whens:[],points:[],angles:[]};if(this.trackAttributes){i.attributes={};for(var r=0,o=this.trackAttributes.length;r<o;++r)c=this.trackAttributes[r],i.attributes[c]=[],c in this.readers.kml||(this.readers.kml[c]=this.readers.kml._trackPointAttribute)}if(this.readChildNodes(e,i),i.whens.length!==i.points.length)throw new Error("gx:Track with unequal number of when ("+i.whens.length+") and gx:coord ("+i.points.length+") elements.");var n,s,a,l=i.angles.length>0;if(l&&i.whens.length!==i.angles.length)throw new Error("gx:Track with unequal number of when ("+i.whens.length+") and gx:angles ("+i.angles.length+") elements.");for(r=0,o=i.whens.length;r<o;++r){if((n=t.feature.clone()).fid=t.feature.fid||t.feature.id,s=i.points[r],n.geometry=s,"z"in s&&(n.attributes.altitude=s.z),this.internalProjection&&this.externalProjection&&n.geometry.transform(this.externalProjection,this.internalProjection),this.trackAttributes)for(var u=0,h=this.trackAttributes.length;u<h;++u){var c=this.trackAttributes[u];n.attributes[c]=i.attributes[c][r]}n.attributes.when=i.whens[r],n.attributes.trackId=t.feature.id,l&&(a=i.angles[r],n.attributes.heading=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(a[0]),n.attributes.tilt=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(a[1]),n.attributes.roll=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(a[2])),t.features.push(n)}},coord:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(/\s+/),r=new GeoGlobe.Geometry.Point(i[0],i[1]);i.length>2&&(r.z=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(i[2])),t.points.push(r)},angles:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(/\s+/);t.angles.push(i)}}},parseFeature:function(e){for(var t,i,r,o,n=["MultiGeometry","Polygon","LineString","Point"],s=0,a=n.length;s<a;++s)if(t=n[s],this.internalns=e.namespaceURI?e.namespaceURI:this.kmlns,(i=this.getElementsByTagNameNS(e,this.internalns,t)).length>0){var l;if(!(l=this.parseGeometry[t.toLowerCase()]))throw new TypeError("Unsupported geometry type: "+t);r=l.apply(this,[i[0]]),this.internalProjection&&this.externalProjection&&r.transform(this.externalProjection,this.internalProjection);break}this.extractAttributes&&(o=this.parseAttributes(e));var u=new GeoGlobe.Feature(r,o),h=e.getAttribute("id")||e.getAttribute("name");return null!=h&&(u.fid=h),u},getStyle:function(e,t){var i=GeoGlobe.Util.removeTail(e),r=GeoGlobe.Util.extend({},t);if(r.depth++,r.styleBaseUrl=i,!this.styles[e]&&!GeoGlobe.String.startsWith(e,"#")&&r.depth<=this.maxDepth&&!this.fetched[i]){var o=this.fetchLink(i);o&&this.parseData(o,r)}return GeoGlobe.Util.extend({},this.styles[e])},parseGeometry:{point:function(e){var t=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),i=[];if(t.length>0){var r=t[0].firstChild.nodeValue;i=(r=r.replace(this.regExes.removeSpace,"")).split(",")}if(!(i.length>1))throw"Bad coordinate string: "+r;return 2==i.length&&(i[2]=null),new GeoGlobe.Geometry.Point(i[0],i[1],i[2])},linestring:function(e,t){var i=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),r=null;if(i.length>0){for(var o,n=this.getChildValue(i[0]),s=(n=(n=n.replace(this.regExes.trimSpace,"")).replace(this.regExes.trimComma,",")).split(this.regExes.splitSpace),a=s.length,l=new Array(a),u=0;u<a;++u){if(!((o=s[u].split(",")).length>1))throw"Bad LineString point coordinates: "+s[u];2==o.length&&(o[2]=null),l[u]=new GeoGlobe.Geometry.Point(o[0],o[1],o[2])}if(!a)throw"Bad LineString coordinates: "+n;r=t?new GeoGlobe.Geometry.LinearRing(l):new GeoGlobe.Geometry.LineString(l)}return r},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.internalns,"LinearRing"),i=t.length,r=new Array(i);if(i>0)for(var o,n=0,s=t.length;n<s;++n){if(!(o=this.parseGeometry.linestring.apply(this,[t[n],!0])))throw"Bad LinearRing geometry: "+n;r[n]=o}return new GeoGlobe.Geometry.Polygon(r)},multigeometry:function(e){for(var t,i=[],r=e.childNodes,o=0,n=r.length;o<n;++o)if(1==(t=r[o]).nodeType){var s,a=t.prefix?t.nodeName.split(":")[1]:t.nodeName;(s=this.parseGeometry[a.toLowerCase()])&&i.push(s.apply(this,[t]))}return new GeoGlobe.Geometry.Collection(i)}},parseAttributes:function(e){var t,i,r={},o=e.getElementsByTagName("ExtendedData");o.length&&(r=this.parseExtendedData(o[0]));for(var n=e.childNodes,s=0,a=n.length;s<a;++s)if(1==(t=n[s]).nodeType&&(i=t.childNodes).length>=1&&i.length<=3){var l;switch(i.length){case 1:l=i[0];break;case 2:var u=i[0],h=i[1];l=3==u.nodeType||4==u.nodeType?u:h;break;case 3:default:l=i[1]}if(3==l.nodeType||4==l.nodeType){var c=t.prefix?t.nodeName.split(":")[1]:t.nodeName,g=GeoGlobe.Util.getXmlNodeValue(l);g&&(g=g.replace(this.regExes.trimSpace,""),r[c]=g)}}return r},parseExtendedData:function(e){var t,i,r,o,n={},s=e.getElementsByTagName("Data");for(t=0,i=s.length;t<i;t++){o=(r=s[t]).getAttribute("name");var a={},l=r.getElementsByTagName("value");if(l.length&&(a.value=this.getChildValue(l[0])),this.kvpAttributes)n[o]=a.value;else{var u=r.getElementsByTagName("displayName");u.length&&(a.displayName=this.getChildValue(u[0])),n[o]=a}}var h=e.getElementsByTagName("SimpleData");for(t=0,i=h.length;t<i;t++)a={},o=(r=h[t]).getAttribute("name"),a.value=this.getChildValue(r),this.kvpAttributes?n[o]=a.value:(a.displayName=o,n[o]=a);return n},parseProperty:function(e,t,i){var r,o=this.getElementsByTagNameNS(e,t,i);try{r=GeoGlobe.Util.getXmlNodeValue(o[0])}catch(e){r=null}return r},write:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS(this.kmlns,"kml"),i=this.createFolderXML(),r=0,o=e.length;r<o;++r)i.appendChild(this.createPlacemarkXML(e[r]));return t.appendChild(i),GeoGlobe.Format.XML.prototype.write.apply(this,[t])},createFolderXML:function(){var e=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var t=this.createElementNS(this.kmlns,"name"),i=this.createTextNode(this.foldersName);t.appendChild(i),e.appendChild(t)}if(this.foldersDesc){var r=this.createElementNS(this.kmlns,"description"),o=this.createTextNode(this.foldersDesc);r.appendChild(o),e.appendChild(r)}return e},createPlacemarkXML:function(e){var t=this.createElementNS(this.kmlns,"name"),i=e.style&&e.style.label?e.style.label:e.id,r=e.attributes.name||i;t.appendChild(this.createTextNode(r));var o=this.createElementNS(this.kmlns,"description"),n=e.attributes.description||this.placemarksDesc;o.appendChild(this.createTextNode(n));var s=this.createElementNS(this.kmlns,"Placemark");null!=e.fid&&s.setAttribute("id",e.fid),s.appendChild(t),s.appendChild(o);var a=this.buildGeometryNode(e.geometry);if(s.appendChild(a),e.attributes){var l=this.buildExtendedData(e.attributes);l&&s.appendChild(l)}return s},buildGeometryNode:function(e){var t=e.CLASS_NAME,i=t.substring(t.lastIndexOf(".")+1),r=this.buildGeometry[i.toLowerCase()],o=null;return r&&(o=r.apply(this,[e])),o},buildGeometry:{point:function(e){var t=this.createElementNS(this.kmlns,"Point");return t.appendChild(this.buildCoordinatesNode(e)),t},multipoint:function(e){return this.buildGeometry.collection.apply(this,[e])},linestring:function(e){var t=this.createElementNS(this.kmlns,"LineString");return t.appendChild(this.buildCoordinatesNode(e)),t},multilinestring:function(e){return this.buildGeometry.collection.apply(this,[e])},linearring:function(e){var t=this.createElementNS(this.kmlns,"LinearRing");return t.appendChild(this.buildCoordinatesNode(e)),t},polygon:function(e){for(var t,i,r,o=this.createElementNS(this.kmlns,"Polygon"),n=e.components,s=0,a=n.length;s<a;++s)r=0==s?"outerBoundaryIs":"innerBoundaryIs",t=this.createElementNS(this.kmlns,r),i=this.buildGeometry.linearring.apply(this,[n[s]]),t.appendChild(i),o.appendChild(t);return o},multipolygon:function(e){return this.buildGeometry.collection.apply(this,[e])},collection:function(e){for(var t,i=this.createElementNS(this.kmlns,"MultiGeometry"),r=0,o=e.components.length;r<o;++r)(t=this.buildGeometryNode.apply(this,[e.components[r]]))&&i.appendChild(t);return i}},buildCoordinatesNode:function(e){var t,i=this.createElementNS(this.kmlns,"coordinates"),r=e.components;if(r){for(var o,n=r.length,s=new Array(n),a=0;a<n;++a)o=r[a],s[a]=this.buildCoordinates(o);t=s.join(" ")}else t=this.buildCoordinates(e);var l=this.createTextNode(t);return i.appendChild(l),i},buildCoordinates:function(e){return this.internalProjection&&this.externalProjection&&(e=e.clone()).transform(this.internalProjection,this.externalProjection),e.x+","+e.y},buildExtendedData:function(e){var t=this.createElementNS(this.kmlns,"ExtendedData");for(var i in e)if(e[i]&&"name"!=i&&"description"!=i&&"styleUrl"!=i){var r=this.createElementNS(this.kmlns,"Data");r.setAttribute("name",i);var o=this.createElementNS(this.kmlns,"value");if("object"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11___default()(e[i])){if(e[i].value&&o.appendChild(this.createTextNode(e[i].value)),e[i].displayName){var n=this.createElementNS(this.kmlns,"displayName");n.appendChild(this.getXMLDoc().createCDATASection(e[i].displayName)),r.appendChild(n)}}else o.appendChild(this.createTextNode(e[i]));r.appendChild(o),t.appendChild(r)}return this.isSimpleContent(t)?null:t},CLASS_NAME:"GeoGlobe.Format.KML"}),GeoGlobe.Format.OWSCommon=GeoGlobe.Class4OL(GeoGlobe.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(e,t){var i=this.version;if(!i){var r=e.getAttribute("xmlns:ows");r&&"1.1"===r.substring(r.lastIndexOf("/")+1)&&(i="1.1.0"),i||(i=this.defaultVersion)}return i},CLASS_NAME:"GeoGlobe.Format.OWSCommon"}),GeoGlobe.Format.OWSCommon.v1=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e,t){t=GeoGlobe.Util.applyDefaults(t,this.options);var i={};return this.readChildNodes(e,i),i},readers:{ows:{Exception:function(e,t){var i={code:e.getAttribute("exceptionCode"),locator:e.getAttribute("locator"),texts:[]};t.exceptions.push(i),this.readChildNodes(e,i)},ExceptionText:function(e,t){var i=this.getChildValue(e);t.texts.push(i)},ServiceIdentification:function(e,t){t.serviceIdentification={},this.readChildNodes(e,t.serviceIdentification)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t.abstract=this.getChildValue(e)},Keywords:function(e,t){t.keywords={},this.readChildNodes(e,t.keywords)},Keyword:function(e,t){t[this.getChildValue(e)]=!0},ServiceType:function(e,t){t.serviceType={codeSpace:e.getAttribute("codeSpace"),value:this.getChildValue(e)}},ServiceTypeVersion:function(e,t){t.serviceTypeVersion=this.getChildValue(e)},Fees:function(e,t){t.fees=this.getChildValue(e)},AccessConstraints:function(e,t){t.accessConstraints=this.getChildValue(e)},ServiceProvider:function(e,t){t.serviceProvider={},this.readChildNodes(e,t.serviceProvider)},ProviderName:function(e,t){t.providerName=this.getChildValue(e)},ProviderSite:function(e,t){t.providerSite=this.getAttributeNS(e,this.namespaces.xlink,"href")},ServiceContact:function(e,t){t.serviceContact={},this.readChildNodes(e,t.serviceContact)},IndividualName:function(e,t){t.individualName=this.getChildValue(e)},PositionName:function(e,t){t.positionName=this.getChildValue(e)},ContactInfo:function(e,t){t.contactInfo={},this.readChildNodes(e,t.contactInfo)},Phone:function(e,t){t.phone={},this.readChildNodes(e,t.phone)},Voice:function(e,t){t.voice=this.getChildValue(e)},Address:function(e,t){t.address={},this.readChildNodes(e,t.address)},DeliveryPoint:function(e,t){t.deliveryPoint=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},AdministrativeArea:function(e,t){t.administrativeArea=this.getChildValue(e)},PostalCode:function(e,t){t.postalCode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ElectronicMailAddress:function(e,t){t.electronicMailAddress=this.getChildValue(e)},Role:function(e,t){t.role=this.getChildValue(e)},OperationsMetadata:function(e,t){t.operationsMetadata={},this.readChildNodes(e,t.operationsMetadata)},Operation:function(e,t){var i=e.getAttribute("name");t[i]={},this.readChildNodes(e,t[i])},DCP:function(e,t){t.dcp={},this.readChildNodes(e,t.dcp)},HTTP:function(e,t){t.http={},this.readChildNodes(e,t.http)},Get:function(e,t){t.get||(t.get=[]);var i={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,i),t.get.push(i)},Post:function(e,t){t.post||(t.post=[]);var i={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,i),t.post.push(i)},Parameter:function(e,t){t.parameters||(t.parameters={});var i=e.getAttribute("name");t.parameters[i]={},this.readChildNodes(e,t.parameters[i])},Constraint:function(e,t){t.constraints||(t.constraints={});var i=e.getAttribute("name");t.constraints[i]={},this.readChildNodes(e,t.constraints[i])},Value:function(e,t){t[this.getChildValue(e)]=!0},OutputFormat:function(e,t){t.formats.push({value:this.getChildValue(e)}),this.readChildNodes(e,t)},WGS84BoundingBox:function(e,t){var i={};i.crs=e.getAttribute("crs"),t.BoundingBox?t.BoundingBox.push(i):(t.projection=i.crs,i=t),this.readChildNodes(e,i)},BoundingBox:function(e,t){this.readers.ows.WGS84BoundingBox.apply(this,[e,t])},LowerCorner:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,""),r=(i=i.replace(this.regExes.trimComma,",")).split(this.regExes.splitSpace);t.left=r[0],t.bottom=r[1]},UpperCorner:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,""),r=(i=i.replace(this.regExes.trimComma,",")).split(this.regExes.splitSpace);t.right=r[0],t.top=r[1],t.bounds=new GeoGlobe.LngLatBounds(new GeoGlobe.LngLat(t.left,t.bottom),new GeoGlobe.LngLat(t.right,t.top)),delete t.left,delete t.bottom,delete t.right,delete t.top},Language:function(e,t){t.language=this.getChildValue(e)}}},writers:{ows:{BoundingBox:function(e,t){var i=this.createElementNSPlus(t||"ows:BoundingBox",{attributes:{crs:e.projection}});return this.writeNode("ows:LowerCorner",e,i),this.writeNode("ows:UpperCorner",e,i),i},LowerCorner:function(e){return this.createElementNSPlus("ows:LowerCorner",{value:e.bounds._sw.lng+" "+e.bounds._sw.lat})},UpperCorner:function(e){return this.createElementNSPlus("ows:UpperCorner",{value:e.bounds._ne.lng+" "+e.bounds._ne.lat})},Identifier:function(e){return this.createElementNSPlus("ows:Identifier",{value:e})},Title:function(e){return this.createElementNSPlus("ows:Title",{value:e})},Abstract:function(e){return this.createElementNSPlus("ows:Abstract",{value:e})},OutputFormat:function(e){return this.createElementNSPlus("ows:OutputFormat",{value:e})}}},CLASS_NAME:"GeoGlobe.Format.OWSCommon.v1"}),GeoGlobe.Format.OWSCommon.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:GeoGlobe.Util.applyDefaults({ExceptionReport:function(e,t){t.success=!1,t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("language"),exceptions:[]},this.readChildNodes(e,t.exceptionReport)}},GeoGlobe.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:GeoGlobe.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"GeoGlobe.Format.OWSCommon.v1_0_0"}),GeoGlobe.Format.OWSCommon.v1_1_0=GeoGlobe.Class4OL(GeoGlobe.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:GeoGlobe.Util.applyDefaults({ExceptionReport:function(e,t){t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("xml:lang"),exceptions:[]},this.readChildNodes(e,t.exceptionReport)},AllowedValues:function(e,t){t.allowedValues={},this.readChildNodes(e,t.allowedValues)},AnyValue:function(e,t){t.anyValue=!0},DataType:function(e,t){t.dataType=this.getChildValue(e)},Range:function(e,t){t.range={},this.readChildNodes(e,t.range)},MinimumValue:function(e,t){t.minValue=this.getChildValue(e)},MaximumValue:function(e,t){t.maxValue=this.getChildValue(e)},Identifier:function(e,t){t.identifier=this.getChildValue(e)},SupportedCRS:function(e,t){t.supportedCRS=this.getChildValue(e)}},GeoGlobe.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:GeoGlobe.Util.applyDefaults({Range:function(e){var t=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":e.closure}});return this.writeNode("ows:MinimumValue",e.minValue,t),this.writeNode("ows:MaximumValue",e.maxValue,t),t},MinimumValue:function(e){return this.createElementNSPlus("ows:MinimumValue",{value:e})},MaximumValue:function(e){return this.createElementNSPlus("ows:MaximumValue",{value:e})},Value:function(e){return this.createElementNSPlus("ows:Value",{value:e})}},GeoGlobe.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"GeoGlobe.Format.OWSCommon.v1_1_0"}),GeoGlobe.Format.WFSCapabilities=GeoGlobe.Class4OL(GeoGlobe.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",CLASS_NAME:"GeoGlobe.Format.WFSCapabilities"}),GeoGlobe.Format.WFSCapabilities.v1=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{wfs:"http://www.opengis.net/wfs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},errorProperty:"featureTypeList",defaultPrefix:"wfs",read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{wfs:{WFS_Capabilities:function(e,t){this.readChildNodes(e,t)},FeatureTypeList:function(e,t){t.featureTypeList={featureTypes:[]},this.readChildNodes(e,t.featureTypeList)},FeatureType:function(e,t){var i={};this.readChildNodes(e,i),t.featureTypes.push(i)},Name:function(e,t){var i=this.getChildValue(e);if(i){var r=i.split(":");t.name=r.pop(),r.length>0&&(t.featureNS=this.lookupNamespaceURI(e,r[0]))}},Title:function(e,t){var i=this.getChildValue(e);i&&(t.title=i)},Abstract:function(e,t){var i=this.getChildValue(e);i&&(t.abstract=i)}}},CLASS_NAME:"GeoGlobe.Format.WFSCapabilities.v1"}),GeoGlobe.Format.WFSCapabilities.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Format.WFSCapabilities.v1,{readers:{wfs:GeoGlobe.Util.applyDefaults({Service:function(e,t){t.service={},this.readChildNodes(e,t.service)},Fees:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.fees=i)},AccessConstraints:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.accessConstraints=i)},OnlineResource:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.onlineResource=i)},Keywords:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.keywords=i.split(", "))},Capability:function(e,t){t.capability={},this.readChildNodes(e,t.capability)},Request:function(e,t){t.request={},this.readChildNodes(e,t.request)},GetFeature:function(e,t){t.getfeature={href:{},formats:[]},this.readChildNodes(e,t.getfeature)},ResultFormat:function(e,t){for(var i,r=e.childNodes,o=0;o<r.length;o++)1==(i=r[o]).nodeType&&t.formats.push(i.nodeName)},DCPType:function(e,t){this.readChildNodes(e,t)},HTTP:function(e,t){this.readChildNodes(e,t.href)},Get:function(e,t){t.get=e.getAttribute("onlineResource")},Post:function(e,t){t.post=e.getAttribute("onlineResource")},SRS:function(e,t){var i=this.getChildValue(e);i&&(t.srs=i)},LatLongBoundingBox:function(e,t){var i=e.getAttribute("minx"),r=e.getAttribute("miny"),o=e.getAttribute("maxx"),n=e.getAttribute("maxy");t.bbox=i+","+r+","+o+","+n},TemporalFeatureLayer:function(e,t){t.temporalFeatureLayers=[];var i={};this.readChildNodes(e,i),t.temporalFeatureLayers.push(i)},Extent:function(e,t){t.defaultTime=e.getAttribute("default");var i=this.getChildValue(e).split("/");t.time=i},Dimension:function(e,t){t.defaultTime=e.getAttribute("default");var i=this.getChildValue(e).split("/");t.time=i}},GeoGlobe.Format.WFSCapabilities.v1.prototype.readers.wfs)},CLASS_NAME:"GeoGlobe.Format.WFSCapabilities.v1_0_0"}),GeoGlobe.Format.WFSCapabilities.v1_1_0=GeoGlobe.Class4OL(GeoGlobe.Format.WFSCapabilities.v1,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},readers:{wfs:GeoGlobe.Util.applyDefaults({DefaultSRS:function(e,t){var i=this.getChildValue(e);i&&(t.srs=i)},WGS84BoundingBox:function(e,t){var i=e.getElementsByTagName("ows:LowerCorner"),r=this.getChildValue(i[0]).split(" "),o=e.getElementsByTagName("ows:UpperCorner"),n=this.getChildValue(o[0]).split(" ");t.bbox=r[0]+","+r[1]+","+n[0]+","+n[1]},TemporalFeatureLayer:function(e,t){t.temporalFeatureLayers=[];var i={};this.readChildNodes(e,i),t.temporalFeatureLayers.push(i)},Extent:function(e,t){t.defaultTime=e.getAttribute("default");var i=this.getChildValue(e).split("/");t.time=i},Dimension:function(e,t){t.defaultTime=e.getAttribute("default");var i=this.getChildValue(e).split("/");t.time=i}},GeoGlobe.Format.WFSCapabilities.v1.prototype.readers.wfs),ows:GeoGlobe.Format.OWSCommon.v1.prototype.readers.ows},CLASS_NAME:"GeoGlobe.Format.WFSCapabilities.v1_1_0"}),GeoGlobe.Format.WFSDescribeFeatureType=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g},namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(e,t){var i,r,o=[],n={},s={complexTypes:o,customTypes:n};this.readChildNodes(e,s);var a,l,u,h,c=e.attributes;for(i=0,r=c.length;i<r;++i)0===(l=(a=c[i]).name).indexOf("xmlns")?this.setNamespace(l.split(":")[1]||"",a.value):t[l]=a.value;for(t.featureTypes=o,t.targetPrefix=this.namespaceAlias[t.targetNamespace],i=0,r=o.length;i<r;++i)h=n[(u=o[i]).typeName],n[u.typeName]&&(u.typeName=h.name)},complexType:function(e,t){var i={typeName:e.getAttribute("name")};this.readChildNodes(e,i),t.complexTypes.push(i)},complexContent:function(e,t){this.readChildNodes(e,t)},extension:function(e,t){this.readChildNodes(e,t)},sequence:function(e,t){var i={elements:[]};this.readChildNodes(e,i),t.properties=i.elements},element:function(e,t){var i;if(t.elements){for(var r,o={},n=e.attributes,s=0,a=n.length;s<a;++s)o[(r=n[s]).name]=r.value;(i=o.type||o.ref)||(i={},this.readChildNodes(e,i),o.restriction=i,o.type=i.base);var l=i.base||i;o.localType=l.split(":").pop(),t.elements.push(o),this.readChildNodes(e,o)}if(t.complexTypes){var u=(i=e.getAttribute("type")).split(":").pop();t.customTypes[u]={name:e.getAttribute("name"),type:i}}},annotation:function(e,t){t.annotation={},this.readChildNodes(e,t.annotation)},appinfo:function(e,t){t.appinfo||(t.appinfo=[]),t.appinfo.push(this.getChildValue(e))},documentation:function(e,t){t.documentation||(t.documentation=[]);var i=this.getChildValue(e);t.documentation.push({lang:e.getAttribute("xml:lang"),textContent:i.replace(this.regExes.trimSpace,"")})},simpleType:function(e,t){this.readChildNodes(e,t)},restriction:function(e,t){t.base=e.getAttribute("base"),this.readRestriction(e,t)}}},readRestriction:function(e,t){for(var i,r,o,n=e.childNodes,s=0,a=n.length;s<a;++s)1==(i=n[s]).nodeType&&(r=i.nodeName.split(":").pop(),o=i.getAttribute("value"),t[r]?("string"==typeof t[r]&&(t[r]=[t[r]]),t[r].push(o)):t[r]=o)},read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};if("ExceptionReport"===e.nodeName.split(":").pop()){var i=new GeoGlobe.Format.OGCExceptionReport;t.error=i.read(e)}else this.readNode(e,t);return t},CLASS_NAME:"GeoGlobe.Format.WFSDescribeFeatureType"}),GeoGlobe.Format.WKT=GeoGlobe.Class4OL(GeoGlobe.Format,{initialize:function(e){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},GeoGlobe.Format.prototype.initialize.apply(this,[e])},read:function(e){var t,i,r;e=e.replace(/[\n\r]/g," ");var o=this.regExes.typeStr.exec(e);if(o&&(i=o[1].toLowerCase(),r=o[2],this.parse[i]&&(t=this.parse[i].apply(this,[r])),this.internalProjection&&this.externalProjection))if(t&&"GeoGlobe.Feature"==t.CLASS_NAME)t.geometry.transform(this.externalProjection,this.internalProjection);else if(t&&"geometrycollection"!=i&&"object"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11___default()(t))for(var n=0,s=t.length;n<s;n++)t[n].geometry.transform(this.externalProjection,this.internalProjection);return t},write:function(e){var t,i,r;e.constructor==Array?(t=e,r=!0):(t=[e],r=!1);var o=[];r&&o.push("GEOMETRYCOLLECTION(");for(var n=0,s=t.length;n<s;++n)r&&n>0&&o.push(","),i=t[n].geometry,o.push(this.extractGeometry(i));return r&&o.push(")"),o.join("")},extractGeometry:function(e){var t=e.CLASS_NAME.split(".")[2].toLowerCase();return this.extract[t]?(this.internalProjection&&this.externalProjection&&(e=e.clone()).transform(this.internalProjection,this.externalProjection),("collection"==t?"GEOMETRYCOLLECTION":t.toUpperCase())+"("+this.extract[t].apply(this,[e])+")"):null},extract:{point:function(e){return e.x+" "+e.y},multipoint:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push("("+this.extract.point.apply(this,[e.components[i]])+")");return t.join(",")},linestring:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t.join(",")},multilinestring:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")");return t.join(",")},polygon:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")");return t.join(",")},multipolygon:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push("("+this.extract.polygon.apply(this,[e.components[i]])+")");return t.join(",")},collection:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extractGeometry.apply(this,[e.components[i]]));return t.join(",")}},parse:{point:function(e){var t=GeoGlobe.String.trim(e).split(this.regExes.spaces);return new GeoGlobe.Feature(new GeoGlobe.Geometry.Point(t[0],t[1]))},multipoint:function(e){for(var t,i=GeoGlobe.String.trim(e).split(","),r=[],o=0,n=i.length;o<n;++o)t=i[o].replace(this.regExes.trimParens,"$1"),r.push(this.parse.point.apply(this,[t]).geometry);return new GeoGlobe.Feature(new GeoGlobe.Geometry.MultiPoint(r))},linestring:function(e){for(var t=GeoGlobe.String.trim(e).split(","),i=[],r=0,o=t.length;r<o;++r)i.push(this.parse.point.apply(this,[t[r]]).geometry);return new GeoGlobe.Feature(new GeoGlobe.Geometry.LineString(i))},multilinestring:function(e){for(var t,i=GeoGlobe.String.trim(e).split(this.regExes.parenComma),r=[],o=0,n=i.length;o<n;++o)t=i[o].replace(this.regExes.trimParens,"$1"),r.push(this.parse.linestring.apply(this,[t]).geometry);return new GeoGlobe.Feature(new GeoGlobe.Geometry.MultiLineString(r))},polygon:function(e){for(var t,i,r,o=GeoGlobe.String.trim(e).split(this.regExes.parenComma),n=[],s=0,a=o.length;s<a;++s)t=o[s].replace(this.regExes.trimParens,"$1"),i=this.parse.linestring.apply(this,[t]).geometry,r=new GeoGlobe.Geometry.LinearRing(i.components),n.push(r);return new GeoGlobe.Feature(new GeoGlobe.Geometry.Polygon(n))},multipolygon:function(e){for(var t,i=GeoGlobe.String.trim(e).split(this.regExes.doubleParenComma),r=[],o=0,n=i.length;o<n;++o)t=i[o].replace(this.regExes.trimParens,"$1"),r.push(this.parse.polygon.apply(this,[t]).geometry);return new GeoGlobe.Feature(new GeoGlobe.Geometry.MultiPolygon(r))},geometrycollection:function(e){e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var t=GeoGlobe.String.trim(e).split("|"),i=[],r=0,o=t.length;r<o;++r)i.push(GeoGlobe.Format.WKT.prototype.read.apply(this,[t[r]]));return i}},CLASS_NAME:"GeoGlobe.Format.WKT"}),GeoGlobe.Format.CQL=function(){var e,t={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,IS_NULL:/^IS NULL/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('([^']|'')*'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(e){var t=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(e);if(t){var i=e.length,r=e.indexOf("(",t[0].length);if(r>-1)for(var o=1;r<i&&o>0;)switch(r++,e.charAt(r)){case"(":o++;break;case")":o--}return[e.substr(0,r+1)]}},END:/^$/},i={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA","IS_NULL"],BETWEEN:["VALUE"],IS_NULL:["END"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},r={"=":GeoGlobe.Filter.Comparison.EQUAL_TO,"<>":GeoGlobe.Filter.Comparison.NOT_EQUAL_TO,"<":GeoGlobe.Filter.Comparison.LESS_THAN,"<=":GeoGlobe.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":GeoGlobe.Filter.Comparison.GREATER_THAN,">=":GeoGlobe.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:GeoGlobe.Filter.Comparison.LIKE,BETWEEN:GeoGlobe.Filter.Comparison.BETWEEN,"IS NULL":GeoGlobe.Filter.Comparison.IS_NULL},o={},n={AND:GeoGlobe.Filter.Logical.AND,OR:GeoGlobe.Filter.Logical.OR},s={},a={RPAREN:3,LOGICAL:2,COMPARISON:1};for(e in r)r.hasOwnProperty(e)&&(o[r[e]]=e);for(e in n)n.hasOwnProperty(e)&&(s[n[e]]=e);function l(e,i){var r,o,n,s,a=i.length;for(r=0;r<a;r++){o=i[r];var l=(n=e,(s=t[o])instanceof RegExp?s.exec(n):s(n));if(l){var u=l[0];return{type:o,text:u,remainder:e.substr(u.length).replace(/^\s*/,"")}}}var h="ERROR: In parsing: ["+e+"], expected one of: ";for(r=0;r<a;r++)h+="\n    "+(o=i[r])+": "+t[o];throw new Error(h)}return GeoGlobe.Class4OL(GeoGlobe.Format,{read:function(e){var t=function(e){for(var t=[],i=[];e.length;){var o=e.shift();switch(o.type){case"PROPERTY":case"GEOMETRY":case"VALUE":i.push(o);break;case"COMPARISON":case"BETWEEN":case"IS_NULL":case"LOGICAL":for(var s=a[o.type];t.length>0&&a[t[t.length-1].type]<=s;)i.push(t.pop());t.push(o);break;case"SPATIAL":case"NOT":case"LPAREN":t.push(o);break;case"RPAREN":for(;t.length>0&&"LPAREN"!=t[t.length-1].type;)i.push(t.pop());t.pop(),t.length>0&&"SPATIAL"==t[t.length-1].type&&i.push(t.pop());case"COMMA":case"END":break;default:throw new Error("Unknown token type "+o.type)}}for(;t.length>0;)i.push(t.pop());var l=function e(){var t=i.pop();switch(t.type){case"LOGICAL":var o=e(),s=e();return new GeoGlobe.Filter.Logical({filters:[s,o],type:n[t.text.toUpperCase()]});case"NOT":var a=e();return new GeoGlobe.Filter.Logical({filters:[a],type:GeoGlobe.Filter.Logical.NOT});case"BETWEEN":var l,u;return i.pop(),u=e(),l=e(),c=e(),new GeoGlobe.Filter.Comparison({property:c,lowerBoundary:l,upperBoundary:u,type:GeoGlobe.Filter.Comparison.BETWEEN});case"COMPARISON":var h=e(),c=e();return new GeoGlobe.Filter.Comparison({property:c,value:h,type:r[t.text.toUpperCase()]});case"IS_NULL":return c=e(),new GeoGlobe.Filter.Comparison({property:c,type:r[t.text.toUpperCase()]});case"VALUE":var g=t.text.match(/^'(.*)'$/);return g?g[1].replace(/''/g,"'"):Number(t.text);case"SPATIAL":switch(t.text.toUpperCase()){case"BBOX":var p=e(),f=e(),d=e(),m=e(),C=e();return new GeoGlobe.Filter.Spatial({type:GeoGlobe.Filter.Spatial.BBOX,property:C,value:GeoGlobe.LngLatBounds.fromArray([m,d,f,p])});case"INTERSECTS":return h=e(),c=e(),new GeoGlobe.Filter.Spatial({type:GeoGlobe.Filter.Spatial.INTERSECTS,property:c,value:h});case"WITHIN":return h=e(),c=e(),new GeoGlobe.Filter.Spatial({type:GeoGlobe.Filter.Spatial.WITHIN,property:c,value:h});case"CONTAINS":return h=e(),c=e(),new GeoGlobe.Filter.Spatial({type:GeoGlobe.Filter.Spatial.CONTAINS,property:c,value:h});case"DWITHIN":var y=e();return h=e(),c=e(),new GeoGlobe.Filter.Spatial({type:GeoGlobe.Filter.Spatial.DWITHIN,value:h,property:c,distance:Number(y)})}case"GEOMETRY":return GeoGlobe.Geometry.fromWKT(t.text);default:return t.text}}();if(i.length>0){for(var u="Remaining tokens after building AST: \n",h=i.length-1;h>=0;h--)u+=i[h].type+": "+i[h].text+"\n";throw new Error(u)}return l}(function(e){var t,r=[],o=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do{if(e=(t=l(e,o)).remainder,o=i[t.type],"END"!=t.type&&!o)throw new Error("No follows list for "+t.type);r.push(t)}while("END"!=t.type);return r}(e));return this.keepData&&(this.data=t),t},write:function(e){if(e instanceof GeoGlobe.Geometry)return e.toString();switch(e.CLASS_NAME){case"GeoGlobe.Filter.Spatial":switch(e.type){case GeoGlobe.Filter.Spatial.BBOX:return"BBOX("+e.property+","+e.value.toBBOX()+")";case GeoGlobe.Filter.Spatial.DWITHIN:return"DWITHIN("+e.property+", "+this.write(e.value)+", "+e.distance+")";case GeoGlobe.Filter.Spatial.WITHIN:return"WITHIN("+e.property+", "+this.write(e.value)+")";case GeoGlobe.Filter.Spatial.INTERSECTS:return"INTERSECTS("+e.property+", "+this.write(e.value)+")";case GeoGlobe.Filter.Spatial.CONTAINS:return"CONTAINS("+e.property+", "+this.write(e.value)+")";default:throw new Error("Unknown spatial filter type: "+e.type)}case"GeoGlobe.Filter.Logical":if(e.type==GeoGlobe.Filter.Logical.NOT)return"NOT ("+this.write(e.filters[0])+")";for(var t="(",i=!0,r=0;r<e.filters.length;r++)i?i=!1:t+=") "+s[e.type]+" (",t+=this.write(e.filters[r]);return t+")";case"GeoGlobe.Filter.Comparison":return e.type==GeoGlobe.Filter.Comparison.BETWEEN?e.property+" BETWEEN "+this.write(e.lowerBoundary)+" AND "+this.write(e.upperBoundary):null!==e.value?e.property+" "+o[e.type]+" "+this.write(e.value):e.property+" "+o[e.type];case void 0:if("string"==typeof e)return"'"+e.replace(/'/g,"''")+"'";if("number"==typeof e)return String(e);default:throw new Error("Can't encode: "+e.CLASS_NAME+" "+e)}},CLASS_NAME:"GeoGlobe.Format.CQL"})}(),GeoGlobe.Format.Filter=GeoGlobe.Class4OL(GeoGlobe.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"GeoGlobe.Format.Filter"}),GeoGlobe.Format.Filter.v1=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(e){GeoGlobe.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){var t={};return this.readers.ogc.Filter.apply(this,[e,t]),t.filter},readers:{ogc:{_expression:function(e){for(var t,i="",r=e.firstChild;r;r=r.nextSibling)switch(r.nodeType){case 1:(t=this.readNode(r)).property?i+="${"+t.property+"}":void 0!==t.value&&(i+=t.value);break;case 3:case 4:i+=r.nodeValue}return i},Filter:function(e,t){var i={fids:[],filters:[]};this.readChildNodes(e,i),i.fids.length>0?t.filter=new GeoGlobe.Filter.FeatureId({fids:i.fids}):i.filters.length>0&&(t.filter=i.filters[0])},FeatureId:function(e,t){var i=e.getAttribute("fid");i&&t.fids.push(i)},And:function(e,t){var i=new GeoGlobe.Filter.Logical({type:GeoGlobe.Filter.Logical.AND});this.readChildNodes(e,i),t.filters.push(i)},Or:function(e,t){var i=new GeoGlobe.Filter.Logical({type:GeoGlobe.Filter.Logical.OR});this.readChildNodes(e,i),t.filters.push(i)},Not:function(e,t){var i=new GeoGlobe.Filter.Logical({type:GeoGlobe.Filter.Logical.NOT});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThan:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.LESS_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThan:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.GREATER_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThanOrEqualTo:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThanOrEqualTo:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsBetween:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.BETWEEN});this.readChildNodes(e,i),t.filters.push(i)},Literal:function(e,t){t.value=GeoGlobe.String.numericIf(this.getChildValue(e),!0)},PropertyName:function(e,t){t.property=this.getChildValue(e)},LowerBoundary:function(e,t){t.lowerBoundary=GeoGlobe.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},UpperBoundary:function(e,t){t.upperBoundary=GeoGlobe.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},Intersects:function(e,t){this.readSpatial(e,t,GeoGlobe.Filter.Spatial.INTERSECTS)},Within:function(e,t){this.readSpatial(e,t,GeoGlobe.Filter.Spatial.WITHIN)},Contains:function(e,t){this.readSpatial(e,t,GeoGlobe.Filter.Spatial.CONTAINS)},DWithin:function(e,t){this.readSpatial(e,t,GeoGlobe.Filter.Spatial.DWITHIN)},Distance:function(e,t){t.distance=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e)),t.distanceUnits=e.getAttribute("units")},Function:function(e,t){},PropertyIsNull:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.IS_NULL});this.readChildNodes(e,i),t.filters.push(i)}}},readSpatial:function(e,t,i){var r=new GeoGlobe.Filter.Spatial({type:i});this.readChildNodes(e,r),r.value=r.components[0],delete r.components,t.filters.push(r)},encodeLiteral:function(e){return e instanceof Date&&(e=GeoGlobe.Date.toISOString(e)),e},writeOgcExpression:function(e,t){return e instanceof GeoGlobe.Filter.Function?this.writeNode("Function",e,t):this.writeNode("Literal",e,t),t},write:function(e){return this.writers.ogc.Filter.apply(this,[e])},writers:{ogc:{Filter:function(e){var t=this.createElementNSPlus("ogc:Filter");return this.writeNode(this.getFilterType(e),e,t),t},_featureIds:function(e){for(var t=this.createDocumentFragment(),i=0,r=e.fids.length;i<r;++i)this.writeNode("ogc:FeatureId",e.fids[i],t);return t},FeatureId:function(e){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:e}})},And:function(e){for(var t,i=this.createElementNSPlus("ogc:And"),r=0,o=e.filters.length;r<o;++r)t=e.filters[r],this.writeNode(this.getFilterType(t),t,i);return i},Or:function(e){for(var t,i=this.createElementNSPlus("ogc:Or"),r=0,o=e.filters.length;r<o;++r)t=e.filters[r],this.writeNode(this.getFilterType(t),t,i);return i},Not:function(e){var t=this.createElementNSPlus("ogc:Not"),i=e.filters[0];return this.writeNode(this.getFilterType(i),i,t),t},PropertyIsLessThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThan");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThan");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLessThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsBetween:function(e){var t=this.createElementNSPlus("ogc:PropertyIsBetween");return this.writeNode("PropertyName",e,t),this.writeNode("LowerBoundary",e,t),this.writeNode("UpperBoundary",e,t),t},PropertyName:function(e){return this.createElementNSPlus("ogc:PropertyName",{value:e.property})},Literal:function(e){var t=this.encodeLiteral||GeoGlobe.Format.Filter.v1.prototype.encodeLiteral;return this.createElementNSPlus("ogc:Literal",{value:t(e)})},LowerBoundary:function(e){var t=this.createElementNSPlus("ogc:LowerBoundary");return this.writeOgcExpression(e.lowerBoundary,t),t},UpperBoundary:function(e){var t=this.createElementNSPlus("ogc:UpperBoundary");return this.writeNode("Literal",e.upperBoundary,t),t},INTERSECTS:function(e){return this.writeSpatial(e,"Intersects")},WITHIN:function(e){return this.writeSpatial(e,"Within")},CONTAINS:function(e){return this.writeSpatial(e,"Contains")},DWITHIN:function(e){var t=this.writeSpatial(e,"DWithin");return this.writeNode("Distance",e,t),t},Distance:function(e){return this.createElementNSPlus("ogc:Distance",{attributes:{units:e.distanceUnits},value:e.distance})},Function:function(e){for(var t=this.createElementNSPlus("ogc:Function",{attributes:{name:e.name}}),i=e.params,r=0,o=i.length;r<o;r++)this.writeOgcExpression(i[r],t);return t},PropertyIsNull:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNull");return this.writeNode("PropertyName",e,t),t},SortBy:function(e){for(var t=this.createElementNSPlus("ogc:SortBy"),i=0,r=e.length;i<r;i++)this.writeNode("ogc:SortProperty",e[i],t);return t},SortProperty:function(e){var t=this.createElementNSPlus("ogc:SortProperty");return this.writeNode("ogc:PropertyName",e,t),this.writeNode("ogc:SortOrder","DESC"==e.order?"DESC":"ASC",t),t},SortOrder:function(e){return this.createElementNSPlus("ogc:SortOrder",{value:e})}}},getFilterType:function(e){var t=this.filterMap[e.type];if(!t)throw"Filter writing not supported for rule type: "+e.type;return t},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"},CLASS_NAME:"GeoGlobe.Format.Filter.v1"}),GeoGlobe.Format.Filter.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Format.GML.v2,GeoGlobe.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(e){GeoGlobe.Format.GML.v2.prototype.initialize.apply(this,[e])},readers:{ogc:GeoGlobe.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsNotEqualTo:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLike:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.LIKE});this.readChildNodes(e,i);var r=e.getAttribute("wildCard"),o=e.getAttribute("singleChar"),n=e.getAttribute("escape");i.value2regex(r,o,n),t.filters.push(i)}},GeoGlobe.Format.Filter.v1.prototype.readers.ogc),gml:GeoGlobe.Format.GML.v2.prototype.readers.gml,feature:GeoGlobe.Format.GML.v2.prototype.readers.feature},writers:{ogc:GeoGlobe.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});return this.writeNode("PropertyName",e,t),this.writeNode("Literal",e.regex2value(),t),t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var i=this.writeNode("gml:Box",e.value,t);return e.projection&&i.setAttribute("srsName",e.projection),t}},GeoGlobe.Format.Filter.v1.prototype.writers.ogc),gml:GeoGlobe.Format.GML.v2.prototype.writers.gml,feature:GeoGlobe.Format.GML.v2.prototype.writers.feature},writeSpatial:function(e,t){var i,r=this.createElementNSPlus("ogc:"+t);return this.writeNode("PropertyName",e,r),e.value instanceof GeoGlobe.Filter.Function?this.writeNode("Function",e.value,r):(i=e.value instanceof GeoGlobe.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Box",e.value),e.projection&&i.setAttribute("srsName",e.projection),r.appendChild(i)),r},CLASS_NAME:"GeoGlobe.Format.Filter.v1_0_0"}),GeoGlobe.Format.Filter.v1_1_0=GeoGlobe.Class4OL(GeoGlobe.Format.GML.v3,GeoGlobe.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(e){GeoGlobe.Format.GML.v3.prototype.initialize.apply(this,[e])},readers:{ogc:GeoGlobe.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=e.getAttribute("matchCase"),r=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.EQUAL_TO,matchCase:!("false"===i||"0"===i)});this.readChildNodes(e,r),t.filters.push(r)},PropertyIsNotEqualTo:function(e,t){var i=e.getAttribute("matchCase"),r=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===i||"0"===i)});this.readChildNodes(e,r),t.filters.push(r)},PropertyIsLike:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.LIKE});this.readChildNodes(e,i);var r=e.getAttribute("wildCard"),o=e.getAttribute("singleChar"),n=e.getAttribute("escapeChar");i.value2regex(r,o,n),t.filters.push(i)}},GeoGlobe.Format.Filter.v1.prototype.readers.ogc),gml:GeoGlobe.Format.GML.v3.prototype.readers.gml,feature:GeoGlobe.Format.GML.v3.prototype.readers.feature},writers:{ogc:GeoGlobe.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:e.matchCase}});return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:e.matchCase}});return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:e.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});return this.writeNode("PropertyName",e,t),this.writeNode("Literal",e.regex2value(),t),t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var i=this.writeNode("gml:Envelope",e.value);return e.projection&&i.setAttribute("srsName",e.projection),t.appendChild(i),t},SortBy:function(e){for(var t=this.createElementNSPlus("ogc:SortBy"),i=0,r=e.length;i<r;i++)this.writeNode("ogc:SortProperty",e[i],t);return t},SortProperty:function(e){var t=this.createElementNSPlus("ogc:SortProperty");return this.writeNode("ogc:PropertyName",e,t),this.writeNode("ogc:SortOrder","DESC"==e.order?"DESC":"ASC",t),t},SortOrder:function(e){return this.createElementNSPlus("ogc:SortOrder",{value:e})}},GeoGlobe.Format.Filter.v1.prototype.writers.ogc),gml:GeoGlobe.Format.GML.v3.prototype.writers.gml,feature:GeoGlobe.Format.GML.v3.prototype.writers.feature},writeSpatial:function(e,t){var i,r=this.createElementNSPlus("ogc:"+t);return this.writeNode("PropertyName",e,r),e.value instanceof GeoGlobe.Filter.Function?this.writeNode("Function",e.value,r):(i=e.value instanceof GeoGlobe.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Envelope",e.value),e.projection&&i.setAttribute("srsName",e.projection),r.appendChild(i)),r},CLASS_NAME:"GeoGlobe.Format.Filter.v1_1_0"}),GeoGlobe.Format.WFST=function(e){e=GeoGlobe.Util.applyDefaults(e,GeoGlobe.Format.WFST.DEFAULTS);var t=GeoGlobe.Format.WFST["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFST version: "+e.version;return new t(e)},GeoGlobe.Format.WFST.DEFAULTS={version:"1.0.0"},GeoGlobe.Format.WFST.v1=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(e){this.stateName={},this.stateName[GeoGlobe.State.INSERT]="wfs:Insert",this.stateName[GeoGlobe.State.UPDATE]="wfs:Update",this.stateName[GeoGlobe.State.DELETE]="wfs:Delete",GeoGlobe.Format.XML.prototype.initialize.apply(this,[e])},getSrsName:function(e,t){var i=t&&t.srsName;return i||(i=e&&e.layer?e.layer.projection.getCode():this.srsName),i},read:function(e,t){t=t||{},GeoGlobe.Util.applyDefaults(t,{output:"features"}),"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var i={};return e&&this.readNode(e,i,!0),i.features&&"features"===t.output&&(i=i.features),i},readers:{wfs:{FeatureCollection:function(e,t){t.features=[],this.readChildNodes(e,t)}}},write:function(e,t){var i=this.writeNode("wfs:Transaction",{features:e,options:t}),r=this.schemaLocationAttr();return r&&this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",r),GeoGlobe.Format.XML.prototype.write.apply(this,[i])},writers:{wfs:{GetFeature:function(e){var t=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,outputFormat:e&&e.outputFormat,maxFeatures:e&&e.maxFeatures,resultType:e&&e.resultType,startPosition:e&&e.startPosition,"xsi:schemaLocation":this.schemaLocationAttr(e)}});if("string"==typeof this.featureType)this.writeNode("Query",e,t);else for(var i=0,r=this.featureType.length;i<r;i++)e.featureType=this.featureType[i],this.writeNode("Query",e,t);return t},Transaction:function(e){var t,i,r=(e=e||{}).options||{},o=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:r.handle}}),n=e.features;if(n){var s,a;for(!0===r.multi&&GeoGlobe.Util.extend(this.geometryTypes,{"GeoGlobe.Geometry.Point":"MultiPoint","GeoGlobe.Geometry.LineString":!0===this.multiCurve?"MultiCurve":"MultiLineString","GeoGlobe.Geometry.Polygon":!0===this.multiSurface?"MultiSurface":"MultiPolygon"}),t=0,i=n.length;t<i;++t)a=n[t],(s=this.stateName[a.state])&&this.writeNode(s,{feature:a,options:r},o);!0===r.multi&&this.setGeometryTypes()}if(r.nativeElements)for(t=0,i=r.nativeElements.length;t<i;++t)this.writeNode("wfs:Native",r.nativeElements[t],o);return o},Native:function(e){return this.createElementNSPlus("wfs:Native",{attributes:{vendorId:e.vendorId,safeToIgnore:e.safeToIgnore},value:e.value})},Insert:function(e){var t=e.feature,i=e.options,r=this.createElementNSPlus("wfs:Insert",{attributes:{handle:i&&i.handle}});return this.srsName=this.getSrsName(t),this.writeNode("feature:_typeName",t,r),r},Update:function(e){var t=e.feature,i=e.options,r=this.createElementNSPlus("wfs:Update",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&r.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var o=t.modified;for(var n in null===this.geometryName||o&&void 0===o.geometry||(this.srsName=this.getSrsName(t),this.writeNode("Property",{name:this.geometryName,value:t.geometry},r)),t.attributes)void 0===t.attributes[n]||o&&o.attributes&&(!o.attributes||void 0===o.attributes[n])||this.writeNode("Property",{name:n,value:t.attributes[n]},r);return this.writeNode("ogc:Filter",new GeoGlobe.Filter.FeatureId({fids:[t.fid]}),r),r},Property:function(e){var t=this.createElementNSPlus("wfs:Property");return this.writeNode("Name",e.name,t),null!==e.value&&this.writeNode("Value",e.value,t),t},Name:function(e){return this.createElementNSPlus("wfs:Name",{value:e})},Value:function(e){var t;if(e instanceof GeoGlobe.Geometry){t=this.createElementNSPlus("wfs:Value");var i=this.writeNode("feature:_geometry",e).firstChild;t.appendChild(i)}else t=this.createElementNSPlus("wfs:Value",{value:e});return t},Delete:function(e){var t=e.feature,i=e.options,r=this.createElementNSPlus("wfs:Delete",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});return this.featureNS&&r.setAttribute("xmlns:"+this.featurePrefix,this.featureNS),this.writeNode("ogc:Filter",new GeoGlobe.Filter.FeatureId({fids:[t.fid]}),r),r}}},schemaLocationAttr:function(e){e=GeoGlobe.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},e);var t=GeoGlobe.Util.extend({},this.schemaLocations);e.schema&&(t[e.featurePrefix]=e.schema);var i,r=[];for(var o in t)(i=this.namespaces[o])&&r.push(i+" "+t[o]);return r.join(" ")||void 0},setFilterProperty:function(e){if(e.filters)for(var t=0,i=e.filters.length;t<i;++t)GeoGlobe.Format.WFST.v1.prototype.setFilterProperty.call(this,e.filters[t]);else e instanceof GeoGlobe.Filter.Spatial&&!e.property&&(e.property=this.geometryName)},CLASS_NAME:"GeoGlobe.Format.WFST.v1"}),GeoGlobe.Format.WFST.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Format.Filter.v1_0_0,GeoGlobe.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(e){GeoGlobe.Format.Filter.v1_0_0.prototype.initialize.apply(this,[e]),GeoGlobe.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t,i){return GeoGlobe.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{wfs:GeoGlobe.Util.applyDefaults({WFS_TransactionResponse:function(e,t){t.insertIds=[],t.success=!1,this.readChildNodes(e,t)},InsertResult:function(e,t){var i={fids:[]};this.readChildNodes(e,i),t.insertIds=t.insertIds.concat(i.fids)},TransactionResult:function(e,t){this.readChildNodes(e,t)},Status:function(e,t){this.readChildNodes(e,t)},SUCCESS:function(e,t){t.success=!0}},GeoGlobe.Format.WFST.v1.prototype.readers.wfs),gml:GeoGlobe.Format.GML.v2.prototype.readers.gml,feature:GeoGlobe.Format.GML.v2.prototype.readers.feature,ogc:GeoGlobe.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:GeoGlobe.Util.applyDefaults({Query:function(e){var t=(e=GeoGlobe.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},e)).featurePrefix,i=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(e.featureNS?t+":":"")+e.featureType,time:e&&e.time,userecent:e&&e.userecent}});if(e.srsNameInQuery&&e.srsName&&i.setAttribute("srsName",e.srsName),e.featureNS&&i.setAttribute("xmlns:"+t,e.featureNS),e.propertyNames)for(var r=0,o=e.propertyNames.length;r<o;r++)this.writeNode("ogc:PropertyName",{property:e.propertyNames[r]},i);return e.filter&&(this.setFilterProperty(e.filter),this.writeNode("ogc:Filter",e.filter,i)),e.sortBy&&this.writeNode("ogc:SortBy",e.sortBy,i),e.groupBy&&this.writeNode("ogc:GroupBy",e.groupBy,i),i}},GeoGlobe.Format.WFST.v1.prototype.writers.wfs),gml:GeoGlobe.Format.GML.v2.prototype.writers.gml,feature:GeoGlobe.Format.GML.v2.prototype.writers.feature,ogc:GeoGlobe.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"GeoGlobe.Format.WFST.v1_0_0"}),GeoGlobe.Format.WFST.v1_1_0=GeoGlobe.Class4OL(GeoGlobe.Format.Filter.v1_1_0,GeoGlobe.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(e){GeoGlobe.Format.Filter.v1_1_0.prototype.initialize.apply(this,[e]),GeoGlobe.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t,i){return GeoGlobe.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:GeoGlobe.Util.applyDefaults({FeatureCollection:function(e,t){t.numberOfFeatures=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("numberOfFeatures")),GeoGlobe.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(e,t){t.insertIds=[],t.success=!1,this.readChildNodes(e,t)},TransactionSummary:function(e,t){t.success=!0},InsertResults:function(e,t){this.readChildNodes(e,t)},Feature:function(e,t){var i={fids:[]};this.readChildNodes(e,i),t.insertIds.push(i.fids[0])}},GeoGlobe.Format.WFST.v1.prototype.readers.wfs),gml:GeoGlobe.Format.GML.v3.prototype.readers.gml,feature:GeoGlobe.Format.GML.v3.prototype.readers.feature,ogc:GeoGlobe.Format.Filter.v1_1_0.prototype.readers.ogc,ows:GeoGlobe.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:GeoGlobe.Util.applyDefaults({GetFeature:function(e){var t=GeoGlobe.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);return e&&this.setAttributes(t,{resultType:e.resultType,startIndex:e.startIndex,count:e.count}),t},Query:function(e){var t=(e=GeoGlobe.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},e)).featurePrefix,i=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(e.featureNS?t+":":"")+e.featureType,srsName:e.srsName,time:e&&e.time,userecent:e&&e.userecent}});if(e.featureNS&&i.setAttribute("xmlns:"+t,e.featureNS),e.propertyNames)for(var r=0,o=e.propertyNames.length;r<o;r++)this.writeNode("wfs:PropertyName",{property:e.propertyNames[r]},i);return e.filter&&(GeoGlobe.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,e.filter),this.writeNode("ogc:Filter",e.filter,i)),e.sortBy&&this.writeNode("ogc:SortBy",e.sortBy,i),e.groupBy&&this.writeNode("ogc:GroupBy",e.groupBy,i),i},PropertyName:function(e){return this.createElementNSPlus("wfs:PropertyName",{value:e.property})}},GeoGlobe.Format.WFST.v1.prototype.writers.wfs),gml:GeoGlobe.Format.GML.v3.prototype.writers.gml,feature:GeoGlobe.Format.GML.v3.prototype.writers.feature,ogc:GeoGlobe.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"GeoGlobe.Format.WFST.v1_1_0"}),GeoGlobe.Format.JSON=GeoGlobe.Class4OL(GeoGlobe.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof _babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_2___default.a),read:function read(json,filter){var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(object=eval("("+json+")"),"function"==typeof filter)){function walk(e,t){if(t&&"object"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11___default()(t))for(var i in t)t.hasOwnProperty(i)&&(t[i]=walk(i,t[i]));return filter(e,t)}object=walk("",object)}}catch(e){}return this.keepData&&(this.data=object),object},write:function(e,t){this.pretty=!!t;var i=null,r=_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11___default()(e);if(this.serialize[r])try{i=!this.pretty&&this.nativeJSON?_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_2___default()(e):this.serialize[r].apply(this,[e])}catch(e){GeoGlobe.Console.error("Trouble serializing: "+e)}return i},writeIndent:function(){var e=[];if(this.pretty)for(var t=0;t<this.level;++t)e.push(this.indent);return e.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(e){if(null==e)return"null";if(e.constructor==Date)return this.serialize.date.apply(this,[e]);if(e.constructor==Array)return this.serialize.array.apply(this,[e]);var t,i,r,o=["{"];this.level+=1;var n=!1;for(t in e)e.hasOwnProperty(t)&&(i=GeoGlobe.Format.JSON.prototype.write.apply(this,[t,this.pretty]),r=GeoGlobe.Format.JSON.prototype.write.apply(this,[e[t],this.pretty]),null!=i&&null!=r&&(n&&o.push(","),o.push(this.writeNewline(),this.writeIndent(),i,":",this.writeSpace(),r),n=!0));return this.level-=1,o.push(this.writeNewline(),this.writeIndent(),"}"),o.join("")},array:function(e){var t,i=["["];this.level+=1;for(var r=0,o=e.length;r<o;++r)null!=(t=GeoGlobe.Format.JSON.prototype.write.apply(this,[e[r],this.pretty]))&&(r>0&&i.push(","),i.push(this.writeNewline(),this.writeIndent(),t));return this.level-=1,i.push(this.writeNewline(),this.writeIndent(),"]"),i.join("")},string:function(e){var t={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(e)?'"'+e.replace(/([\x00-\x1f\\"])/g,(function(e,i){var r=t[i];return r||(r=i.charCodeAt(),"\\u00"+Math.floor(r/16).toString(16)+(r%16).toString(16))}))+'"':'"'+e+'"'},number:function(e){return isFinite(e)?String(e):"null"},boolean:function(e){return String(e)},date:function(e){function t(e){return e<10?"0"+e:e}return'"'+e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+'"'}},CLASS_NAME:"GeoGlobe.Format.JSON"}),GeoGlobe.Format.GeoJSON=GeoGlobe.Class4OL(GeoGlobe.Format.JSON,{ignoreExtraDims:!1,read:function(e,t,i){t=t||"FeatureCollection";var r,o=null;if(r="string"==typeof e?GeoGlobe.Format.JSON.prototype.read.apply(this,[e,i]):e){if("string"!=typeof r.type)GeoGlobe.Console.error("Bad GeoJSON - no type: "+e);else if(this.isValidType(r,t))switch(t){case"Geometry":try{o=this.parseGeometry(r)}catch(e){GeoGlobe.Console.error(e)}break;case"Feature":try{(o=this.parseFeature(r)).type="Feature"}catch(e){GeoGlobe.Console.error(e)}break;case"FeatureCollection":switch(o=[],r.type){case"Feature":try{o.push(this.parseFeature(r))}catch(e){o=null,GeoGlobe.Console.error(e)}break;case"FeatureCollection":for(var n=0,s=r.features.length;n<s;++n)try{o.push(this.parseFeature(r.features[n]))}catch(e){o=null,GeoGlobe.Console.error(e)}break;default:try{var a=this.parseGeometry(r);o.push(new GeoGlobe.Feature(a))}catch(e){o=null,GeoGlobe.Console.error(e)}}}}else GeoGlobe.Console.error("Bad JSON: "+e);return o},isValidType:function(e,t){var i=!1;switch(t){case"Geometry":-1==GeoGlobe.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],e.type)?GeoGlobe.Console.error("Unsupported geometry type: "+e.type):i=!0;break;case"FeatureCollection":i=!0;break;default:e.type==t?i=!0:GeoGlobe.Console.error("Cannot convert types from "+e.type+" to "+t)}return i},parseFeature:function(e){var t,i,r,o;r=e.properties?e.properties:{},o=e.geometry&&e.geometry.bbox||e.bbox;try{i=this.parseGeometry(e.geometry)}catch(e){throw e}return t=new GeoGlobe.Feature(i,r),o&&(t.bounds=GeoGlobe.LngLatBounds.fromArray(o)),e.id&&(t.fid=e.id),t},parseGeometry:function(e){if(null==e)return null;var t,i=!1;if("GeometryCollection"==e.type){if(!GeoGlobe.Util.isArray(e.geometries))throw"GeometryCollection must have geometries array: "+e;for(var r=e.geometries.length,o=new Array(r),n=0;n<r;++n)o[n]=this.parseGeometry.apply(this,[e.geometries[n]]);t=new GeoGlobe.Geometry.Collection(o),i=!0}else{if(!GeoGlobe.Util.isArray(e.coordinates))throw"Geometry must have coordinates array: "+e;if(!this.parseCoords[e.type.toLowerCase()])throw"Unsupported geometry type: "+e.type;try{t=this.parseCoords[e.type.toLowerCase()].apply(this,[e.coordinates])}catch(e){throw e}}return this.internalProjection&&this.externalProjection&&!i&&t.transform(this.externalProjection,this.internalProjection),t},parseCoords:{point:function(e){if(0==this.ignoreExtraDims&&2!=e.length)throw"Only 2D points are supported: "+e;return new GeoGlobe.Geometry.Point(e[0],e[1])},multipoint:function(e){for(var t=[],i=null,r=0,o=e.length;r<o;++r){try{i=this.parseCoords.point.apply(this,[e[r]])}catch(e){throw e}t.push(i)}return new GeoGlobe.Geometry.MultiPoint(t)},linestring:function(e){for(var t=[],i=null,r=0,o=e.length;r<o;++r){try{i=this.parseCoords.point.apply(this,[e[r]])}catch(e){throw e}t.push(i)}return new GeoGlobe.Geometry.LineString(t)},multilinestring:function(e){for(var t=[],i=null,r=0,o=e.length;r<o;++r){try{i=this.parseCoords.linestring.apply(this,[e[r]])}catch(e){throw e}t.push(i)}return new GeoGlobe.Geometry.MultiLineString(t)},polygon:function(e){for(var t,i,r=[],o=0,n=e.length;o<n;++o){try{i=this.parseCoords.linestring.apply(this,[e[o]])}catch(e){throw e}t=new GeoGlobe.Geometry.LinearRing(i.components),r.push(t)}return new GeoGlobe.Geometry.Polygon(r)},multipolygon:function(e){for(var t=[],i=null,r=0,o=e.length;r<o;++r){try{i=this.parseCoords.polygon.apply(this,[e[r]])}catch(e){throw e}t.push(i)}return new GeoGlobe.Geometry.MultiPolygon(t)},box:function(e){if(2!=e.length)throw"GeoJSON box coordinates must have 2 elements";return new GeoGlobe.Geometry.Polygon([new GeoGlobe.Geometry.LinearRing([new GeoGlobe.Geometry.Point(e[0][0],e[0][1]),new GeoGlobe.Geometry.Point(e[1][0],e[0][1]),new GeoGlobe.Geometry.Point(e[1][0],e[1][1]),new GeoGlobe.Geometry.Point(e[0][0],e[1][1]),new GeoGlobe.Geometry.Point(e[0][0],e[0][1])])])}},write:function(e,t){var i={type:null};if(GeoGlobe.Util.isArray(e)){i.type="FeatureCollection";var r=e.length;i.features=new Array(r);for(var o=0;o<r;++o){var n=e[o];if(!n instanceof GeoGlobe.Feature)throw"FeatureCollection only supports collections of features: "+n;i.features[o]=this.extract.feature.apply(this,[n])}}else 0==e.CLASS_NAME.indexOf("GeoGlobe.Geometry")?i=this.extract.geometry.apply(this,[e]):e instanceof GeoGlobe.Feature&&(i=this.extract.feature.apply(this,[e]),e.layer&&e.layer.projection&&(i.crs=this.createCRSObject(e)));return GeoGlobe.Format.JSON.prototype.write.apply(this,[i,t])},createCRSObject:function(e){var t=e.layer.projection.toString(),i={};if(t.match(/epsg:/i)){var r=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(t.substring(t.indexOf(":")+1));i=4326==r?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+r}}}return i},extract:{feature:function(e){var t=this.extract.geometry.apply(this,[e.geometry]),i={type:"Feature",properties:e.attributes,geometry:t};return null!=e.fid&&(i.id=e.fid),i},geometry:function(e){if(null==e)return null;this.internalProjection&&this.externalProjection&&(e=e.clone()).transform(this.internalProjection,this.externalProjection);var t=e.CLASS_NAME.split(".")[2],i=this.extract[t.toLowerCase()].apply(this,[e]);return"Collection"==t?{type:"GeometryCollection",geometries:i}:{type:t,coordinates:i}},point:function(e){return[e.x,e.y]},multipoint:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},linestring:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},multilinestring:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},polygon:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},multipolygon:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.polygon.apply(this,[e.components[i]]));return t},collection:function(e){for(var t=e.components.length,i=new Array(t),r=0;r<t;++r)i[r]=this.extract.geometry.apply(this,[e.components[r]]);return i}},CLASS_NAME:"GeoGlobe.Format.GeoJSON"}),GeoGlobe.Format.WMTS=GeoGlobe.Class4OL({initialize:function(e){GeoGlobe.Util.extend(this,e)},getWMTSCapabilities:function(e){var t=null;return this.getCapabilities(e,(function(e){var i=e.responseXML;i&&i.documentElement||(i=e.responseText);var r=new GeoGlobe.Format.WMTSCapabilities.v1_0_0;t=r.read(i)}),(function(){alert("WMTS服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+e+"\n操作类型：GetCapabilities")})),t},getCapabilities:function(e,t,i){"function"!=typeof i&&(i=function(){alert("WMTS服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+e+"\n操作类型：GetCapabilities")}),GeoGlobe.Request.GET({url:e,params:{REQUEST:"GetCapabilities",SERVICE:"WMTS"},scope:this,async:!1,success:function(e){"function"==typeof t&&t(e)},failure:i})},createLayerOption:function(e,t,i){if(!("layer"in i))throw new Error("Missing property 'layer' in configuration.");for(var r,o=t.contents,n=(o.layers,0),s=o.layers.length;n<s;++n)if(o.layers[n].identifier===i.layer){r=o.layers[n];break}if(!r)throw new Error("Layer not found");var a,l,u=i.format;if(!u&&r.formats&&r.formats.length&&(u=r.formats[0]),i.matrixSet)a=o.tileMatrixSets[i.matrixSet];else if(i.projection){n=0;for(var h=r.tileMatrixSetLinks.length;n<h;n++)if(o.tileMatrixSets[r.tileMatrixSetLinks[n].tileMatrixSet].supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3")===i.projection){a=o.tileMatrixSets[r.tileMatrixSetLinks[n].tileMatrixSet];break}}else r.tileMatrixSetLinks.length>=1&&(a=o.tileMatrixSets[r.tileMatrixSetLinks[0].tileMatrixSet]);if(!a)throw new Error("matrixSet not found");for(n=0,s=r.styles.length;n<s&&!(l=r.styles[n]).isDefault;++n);var c=i.requestEncoding;c||(c="KVP",t.operationsMetadata.GetTile.dcp.http);var g=[],p=i.params||{};delete i.params;for(var f=0,d=r.dimensions.length;f<d;f++){var m=r.dimensions[f];g.push(m.identifier),p.hasOwnProperty(m.identifier)||(p[m.identifier]=m.default)}var C,y,v,A=i.projection||a.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),_=i.units||("EPSG:4326"===A?"degrees":"m"),I=[],b=[],w=r.tileMatrixSetLinks,G=function(e){I.push(28e-5*e/GeoGlobe.METERS_PER_INCH/GeoGlobe.INCHES_PER_UNIT[_]),(!C||C>e)&&(C=e),(!y||y<e)&&(y=e)},E=0;for(h=w.length;E<h;E++)if((v=w[E]).tileMatrixSet===a.identifier){if(v.tileMatrixSetLimits){for(var S,P={},T=0,x=a.matrixIds.length;T<x;T++)P[a.matrixIds[T].identifier]=a.matrixIds[T];for(T=0,x=v.tileMatrixSetLimits.length;T<x;T++)S=P[v.tileMatrixSetLimits[T].tileMatrix],b.push(S),G(S.scaleDenominator)}else for(T=0,x=a.matrixIds.length;T<x;T++)G(a.matrixIds[T].scaleDenominator);break}I.sort((function(e,t){return t-e}));var N,L=this.getParameterString({SERVICE:"WMTS",REQUEST:"GetTile",VERSION:t.version,LAYER:r.identifier,STYLE:l.identifier,TILEMATRIXSET:a.identifier,FORMAT:u,TILEMATRIX:"{z}",TILEROW:"{y}",TILECOL:"{x}"});N=e.endsWith("?")?GeoGlobe.ProxyHost+e+L:GeoGlobe.ProxyHost+e+"?"+L;var M=GeoGlobe.Util.randomStr(10);if(r.bounds)var R=[r.bounds._sw.lng,r.bounds._sw.lat,r.bounds._ne.lng,r.bounds._ne.lat];else r.BoundingBox&&(R=r.BoundingBox[0].bounds.toBBOX());var O=r.tileMatrixSetLinks[0].tileMatrixSet,F=o.tileMatrixSets[O].matrixIds[0].identifier,D={name:r.identifier,srs:A,bbox:R,format:r.formats,zoomoffset:F};return{id:"layer_"+r.identifier+"_"+M,type:"raster",source:{type:"raster",tiles:[N],tileSize:256},metadata:D,paint:{"raster-opacity":1}}},createLayer:function(e,t){var i=this.getWMTSCapabilities(e);if(t)var r={layer:t.layer};else r={layer:i.contents.layers[0].identifier};return this.createLayerOption(e,i,r)},createLayers:function(e){for(var t=this.getWMTSCapabilities(e),i=t.contents.layers,r=[],o=0;o<i.length;o++){var n={layer:i[o].identifier},s=this.createLayerOption(e,t,n);r.push(s)}return r},getParameterString:function(e){var t=[];for(var i in e){var r=e[i];null!=r&&"function"!=typeof r&&t.push(i+"="+r)}return t.join("&")},CLASS_NAME:"GeoGlobe.Format.WMTS"}),GeoGlobe.Format.WMS=GeoGlobe.Class4OL({initialize:function(e){GeoGlobe.Util.extend(this,e)},getWMSCapabilities:function(e){var t=null;return this.getCapabilities(e,(function(e){var i=e.responseXML;i&&i.documentElement||(i=e.responseText);var r=new GeoGlobe.Format.WMSCapabilities.v1_1_1;t=r.read(i)}),(function(){alert("WMS服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+e+"\n操作类型：GetCapabilities")})),t},getCapabilities:function(e,t,i){"function"!=typeof i&&(i=function(){alert("WMS服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+e+"\n操作类型：GetCapabilities")}),GeoGlobe.Request.GET({url:e,params:{REQUEST:"GetCapabilities",SERVICE:"WMS",VERSION:"1.1.1"},scope:this,async:!1,success:function(e){"function"==typeof t&&t(e)},failure:i})},createLayerOption:function createLayerOption(url,capabilities,config){var layer;if(!("layer"in config))throw new Error("Missing property 'layer' in configuration.");for(var contents=capabilities.capability,layers=contents.layers,layerDef,i=0,ii=contents.layers.length;i<ii;++i)if(contents.layers[i].name===config.layer){layerDef=contents.layers[i];break}if(!layerDef)throw new Error("Layer not found");var format=config.format;if(!format&&layerDef.formats&&layerDef.formats.length){for(var f=0;f<layerDef.formats.length;f++)"image/png"==layerDef.formats[f]&&(format=layerDef.formats[f]);"image/png"!=format&&(format=layerDef.formats[0])}var styles=config.styles;!styles&&layerDef.styles&&layerDef.styles.length&&(styles=layerDef.styles[0].name);var srs=eval(layerDef.srs),SRS;for(var o in srs)SRS=o;var wms_url="",transparent=config.transparent;if(config.isTile){var param=this.getParameterString({SERVICE:"WMS",REQUEST:"GetMap",VERSION:"1.1.1",LAYERS:layerDef.name,styles:styles,FORMAT:format,TRANSPARENT:transparent,BBOX:"{bbox-epsg-3857}",WIDTH:"256",HEIGHT:"256",SRS:SRS});wms_url=url.endsWith("?")?url+param:url+"?"+param,wms_url=GeoGlobe.appendToProxy(wms_url);var randomNum=GeoGlobe.Util.randomStr(10),metadata={name:layerDef.name,srs:SRS,bbox:layerDef.bbox,format:format},layerOption={id:"layer_"+layerDef.name+"_"+randomNum,type:"raster",source:{type:"raster",tiles:[wms_url],tileSize:256},metadata:metadata,paint:{"raster-opacity":1}};return layerOption}return layerOption=new GeoGlobe.Layer.WMS({url:url,layer:layerDef.name,format:format,version:"1.1.1",SRS:SRS,styles:styles,bbox:layerDef.bbox,isTile:!1}),layerOption},createLayer:function(e,t,i){this.url=e,i=!(void 0!==i&&!i);var r=!!(t&&void 0===t.transparent||t.transparent),o=this.getWMSCapabilities(e),n={layer:t&&t.layer?t.layer:o.capability.layers[0].name,transparent:r,isTile:i};return this.createLayerOption(e,o,n)},createLayers:function(e,t,i){i=!(void 0!==i&&!i);for(var r=!!(t&&void 0===t.transparent||t.transparent),o=this.getWMSCapabilities(e),n=o.capability.layers,s=[],a=0;a<n.length;a++){var l={layer:n[a].name,transparent:r,isTile:i},u=this.createLayerOption(e,o,l);s.push(u)}return s},getParameterString:function(e){var t=[];for(var i in e){var r=e[i];null!=r&&"function"!=typeof r&&t.push(i+"="+r)}return t.join("&")},CLASS_NAME:"GeoGlobe.Format.WMS"}),GeoGlobe.Format.VTS=GeoGlobe.Class4OL({initialize:function(e){GeoGlobe.Util.extend(this,e)},getVTSCapabilities:function(e){this.url=e;var t=null;return this.getCapabilities(e,(function(e){var i=e.responseXML;i&&i.documentElement||(i=e.responseText);var r=new GeoGlobe.Format.VTSCapabilities.v1_0_0;t=r.read(i)}),(function(){alert("VTS服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+e+"\n操作类型：GetCapabilities")})),t},getCapabilities:function(e,t,i){"function"!=typeof i&&(i=function(){alert("VTS服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+e+"\n操作类型：GetCapabilities")}),GeoGlobe.Request.GET({url:e,params:{REQUEST:"GetCapabilities",SERVICE:"WMTS"},scope:this,async:!1,success:function(e){"function"==typeof t&&t(e)},failure:i})},createLayerOption:function(e,t,i){if(!("layer"in i))throw new Error("Missing property 'layer' in configuration.");for(var r,o=t.contents,n=(o.layers,0),s=o.layers.length;n<s;++n)if(o.layers[n].identifier===i.layer){r=o.layers[n];break}if(!r)throw new Error("Layer not found");var a,l=i.format;if(!l&&r.formats&&r.formats.length&&(l=r.formats[0]),i.matrixSet)a=o.tileMatrixSets[i.matrixSet];else if(i.projection){n=0;for(var u=r.tileMatrixSetLinks.length;n<u;n++)if(o.tileMatrixSets[r.tileMatrixSetLinks[n].tileMatrixSet].supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3")===i.projection){a=o.tileMatrixSets[r.tileMatrixSetLinks[n].tileMatrixSet];break}}else r.tileMatrixSetLinks.length>=1&&(a=o.tileMatrixSets[r.tileMatrixSetLinks[0].tileMatrixSet]);if(!a)throw new Error("matrixSet not found");var h=[];i.styleName&&""!=i.styleName?h[0]=i.styleName:this.GetStyleName((function(e){h=e}));var c=i.requestEncoding;c||(c="KVP",t.operationsMetadata.GetTile.dcp.http);var g=[],p=i.params||{};delete i.params;for(var f=0,d=r.dimensions.length;f<d;f++){var m=r.dimensions[f];g.push(m.identifier),p.hasOwnProperty(m.identifier)||(p[m.identifier]=m.default)}var C,y,v,A=i.projection||a.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),_=i.units||("EPSG:4326"===A?"degrees":"m"),I=[],b=[],w=r.tileMatrixSetLinks,G=function(e){I.push(28e-5*e/GeoGlobe.METERS_PER_INCH/GeoGlobe.INCHES_PER_UNIT[_]),(!C||C>e)&&(C=e),(!y||y<e)&&(y=e)},E=0;for(u=w.length;E<u;E++)if((v=w[E]).tileMatrixSet===a.identifier){if(v.tileMatrixSetLimits){for(var S,P={},T=0,x=a.matrixIds.length;T<x;T++)P[a.matrixIds[T].identifier]=a.matrixIds[T];for(T=0,x=v.tileMatrixSetLimits.length;T<x;T++)S=P[v.tileMatrixSetLimits[T].tileMatrix],b.push(S),G(S.scaleDenominator)}else for(T=0,x=a.matrixIds.length;T<x;T++)G(a.matrixIds[T].scaleDenominator);break}I.sort((function(e,t){return t-e}));var N,L={layers:[],source:{},source_id:"",url:"",url_tmpl:"",layerType:"VTS"},M=this.getParameterString({SERVICE:"WMTS",REQUEST:"GetTile",VERSION:t.version,LAYER:r.identifier,TILEMATRIXSET:a.identifier,FORMAT:"protobuf",TILEMATRIX:"{z}",TILEROW:"{y}",TILECOL:"{x}"});if(L.url=e,N=e.endsWith("?")?GeoGlobe.ProxyHost+e+M:GeoGlobe.ProxyHost+e+"?"+M,L.url_tmpl=N,GeoGlobe.Util.randomStr(10),r.bounds)var R=[r.bounds._sw.lng,r.bounds._sw.lat,r.bounds._ne.lng,r.bounds._ne.lat];else r.BoundingBox&&(R=r.BoundingBox[0].bounds.toBBOX());var O=r.tileMatrixSetLinks[0].tileMatrixSet,F=o.tileMatrixSets[O].matrixIds[0].identifier;return this.GetStyle(h[0],(function(e){if(e.sprite)var t=GeoGlobe.ProxyHost+e.sprite;else t="";if(e.glyphs)var i=GeoGlobe.ProxyHost+e.glyphs;else i="";var o={name:r.identifier,sprite:t,glyphs:i,styleName:e.styleName,srs:A,bbox:R,format:r.formats,zoomoffset:F},n="source_vts_"+GeoGlobe.Util.randomStr(6);if(L.source_id=n,L.source={type:"vector",tiles:[N]},e.styleData)for(var s=0;s<e.styleData.layers.length;s++)e.styleData.layers[s].metadata=o,e.styleData.layers[s].source=n,L.layers[s]=e.styleData.layers[s];else for(s=0;s<e.layers.length;s++)e.layers[s].metadata=o,e.layers[s].source=n,L.layers[s]=e.layers[s]}),(function(){alert("WMTS服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+e+"\n操作类型：GetCapabilities")})),L},createLayer:function(e,t){var i=this.getVTSCapabilities(e);return(t=t||{}).layer=t.layer?t.layer:i.contents.layers[0].identifier,t.styleName=t.styleName?t.styleName:"",this.createLayerOption(e,i,t)},createLayers:function(e){for(var t=this.getVTSCapabilities(e),i=t.contents.layers,r=[],o=0;o<i.length;o++){var n={layer:i[o].identifier},s=this.createLayerOption(e,t,n);r.push(s)}return r},GetStyleName:function(e,t){var i=this.url,r={REQUEST:"GetStyle",SERVICE:"WMTS",VERSION:"1.0.0"};t||(t=function(){this.failFn(r.REQUEST)}),GeoGlobe.Request.GET({url:i,params:r,scope:this,async:!1,success:function(i){var r=i.responseText;if(!r)return t(),!1;var o=(new GeoGlobe.Format.JSON).read(r),n=[];if(o.style)for(var s=0;s<o.style.length;s++)n.push(o.style[s].styleName);else if(o.styleName)for(var a=0;a<o.styleName.length;a++)n.push(o.styleName[a]);e(n)},failure:t})},GetStyle:function(e,t,i){var r=this.url;if(""!=e&&null!=e){var o={REQUEST:"GetStyle",SERVICE:"WMTS",VERSION:"1.0.0",STYLENAME:e};i||(i=function(){this.failFn(o.REQUEST)}),GeoGlobe.Request.GET({url:r,params:o,scope:this,async:!1,success:function(e){var r=e.responseText;if(!r)return i(),!1;var o=(new GeoGlobe.Format.JSON).read(r);t(o)},failure:i})}else alert("请查看样式名称是否存在")},getParameterString:function(e){var t=[];for(var i in e){var r=e[i];null!=r&&"function"!=typeof r&&t.push(i+"="+r)}return t.join("&")},CLASS_NAME:"GeoGlobe.Format.VTS"}),GeoGlobe.Format.WMSCapabilities=GeoGlobe.Class4OL(GeoGlobe.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"GeoGlobe.Format.WMSCapabilities"}),GeoGlobe.Format.WMSCapabilities.v1=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e]));var t=e;e&&9==e.nodeType&&(e=e.documentElement);var i={};if(this.readNode(e,i),void 0===i.service){var r=new GeoGlobe.Format.OGCExceptionReport;i.error=r.read(t)}return i},readers:{wms:{Service:function(e,t){t.service={},this.readChildNodes(e,t.service)},Name:function(e,t){t.name=this.getChildValue(e)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t.abstract=this.getChildValue(e)},BoundingBox:function(e,t){var i={};i.bbox=[_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e.getAttribute("minx")),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e.getAttribute("miny")),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e.getAttribute("maxx")),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e.getAttribute("maxy"))];var r={x:_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e.getAttribute("resx")),y:_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e.getAttribute("resy"))};return isNaN(r.x)&&isNaN(r.y)||(i.res=r),i},OnlineResource:function(e,t){t.href=this.getAttributeNS(e,this.namespaces.xlink,"href")},ContactInformation:function(e,t){t.contactInformation={},this.readChildNodes(e,t.contactInformation)},ContactPersonPrimary:function(e,t){t.personPrimary={},this.readChildNodes(e,t.personPrimary)},ContactPerson:function(e,t){t.person=this.getChildValue(e)},ContactOrganization:function(e,t){t.organization=this.getChildValue(e)},ContactPosition:function(e,t){t.position=this.getChildValue(e)},ContactAddress:function(e,t){t.contactAddress={},this.readChildNodes(e,t.contactAddress)},AddressType:function(e,t){t.type=this.getChildValue(e)},Address:function(e,t){t.address=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},StateOrProvince:function(e,t){t.stateOrProvince=this.getChildValue(e)},PostCode:function(e,t){t.postcode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ContactVoiceTelephone:function(e,t){t.phone=this.getChildValue(e)},ContactFacsimileTelephone:function(e,t){t.fax=this.getChildValue(e)},ContactElectronicMailAddress:function(e,t){t.email=this.getChildValue(e)},Fees:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.fees=i)},AccessConstraints:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.accessConstraints=i)},Capability:function(e,t){t.capability={nestedLayers:[],layers:[]},this.readChildNodes(e,t.capability)},Request:function(e,t){t.request={},this.readChildNodes(e,t.request)},GetCapabilities:function(e,t){t.getcapabilities={formats:[]},this.readChildNodes(e,t.getcapabilities)},Format:function(e,t){GeoGlobe.Util.isArray(t.formats)?t.formats.push(this.getChildValue(e)):t.format=this.getChildValue(e)},DCPType:function(e,t){this.readChildNodes(e,t)},HTTP:function(e,t){this.readChildNodes(e,t)},Get:function(e,t){t.get={},this.readChildNodes(e,t.get),t.href||(t.href=t.get.href)},Post:function(e,t){t.post={},this.readChildNodes(e,t.post),t.href||(t.href=t.get.href)},GetMap:function(e,t){t.getmap={formats:[]},this.readChildNodes(e,t.getmap)},GetFeatureInfo:function(e,t){t.getfeatureinfo={formats:[]},this.readChildNodes(e,t.getfeatureinfo)},Exception:function(e,t){t.exception={formats:[]},this.readChildNodes(e,t.exception)},Layer:function(e,t){var i,r;t.capability?(r=t.capability,i=t):r=t;var o=e.getAttributeNode("queryable"),n=o&&o.specified?e.getAttribute("queryable"):null,s=(o=e.getAttributeNode("cascaded"))&&o.specified?e.getAttribute("cascaded"):null,a=(o=e.getAttributeNode("opaque"))&&o.specified?e.getAttribute("opaque"):null,l=e.getAttribute("noSubsets"),u=e.getAttribute("fixedWidth"),h=e.getAttribute("fixedHeight"),c=i||{},g=GeoGlobe.Util.extend,p={nestedLayers:[],styles:i?[].concat(i.styles):[],srs:i?g({},c.srs):{},metadataURLs:[],bbox:i?g({},c.bbox):{},llbbox:c.llbbox,dimensions:i?g({},c.dimensions):{},authorityURLs:i?g({},c.authorityURLs):{},identifiers:{},keywords:[],queryable:n&&""!==n?"1"===n||"true"===n:c.queryable||!1,cascaded:null!==s?_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(s):c.cascaded||0,opaque:a?"1"===a||"true"===a:c.opaque||!1,noSubsets:null!==l?"1"===l||"true"===l:c.noSubsets||!1,fixedWidth:null!=u?_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(u):c.fixedWidth||0,fixedHeight:null!=h?_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(h):c.fixedHeight||0,minScale:c.minScale,maxScale:c.maxScale,attribution:c.attribution};if(t.nestedLayers.push(p),p.capability=r,this.readChildNodes(e,p),delete p.capability,p.name){var f=p.name.split(":"),d=r.request,m=d.getfeatureinfo;f.length>0&&(p.prefix=f[0]),r.layers.push(p),void 0===p.formats&&(p.formats=d.getmap.formats),void 0===p.infoFormats&&m&&(p.infoFormats=m.formats)}},Attribution:function(e,t){t.attribution={},this.readChildNodes(e,t.attribution)},LogoURL:function(e,t){t.logo={width:e.getAttribute("width"),height:e.getAttribute("height")},this.readChildNodes(e,t.logo)},Style:function(e,t){var i={};t.styles.push(i),this.readChildNodes(e,i)},LegendURL:function(e,t){var i={width:e.getAttribute("width"),height:e.getAttribute("height")};t.legend=i,this.readChildNodes(e,i)},MetadataURL:function(e,t){var i={type:e.getAttribute("type")};t.metadataURLs.push(i),this.readChildNodes(e,i)},DataURL:function(e,t){t.dataURL={},this.readChildNodes(e,t.dataURL)},FeatureListURL:function(e,t){t.featureListURL={},this.readChildNodes(e,t.featureListURL)},AuthorityURL:function(e,t){var i=e.getAttribute("name"),r={};this.readChildNodes(e,r),t.authorityURLs[i]=r.href},Identifier:function(e,t){var i=e.getAttribute("authority");t.identifiers[i]=this.getChildValue(e)},KeywordList:function(e,t){this.readChildNodes(e,t)},SRS:function(e,t){t.srs[this.getChildValue(e)]=!0}}},CLASS_NAME:"GeoGlobe.Format.WMSCapabilities.v1"}),GeoGlobe.Format.WMSCapabilities.v1_1=GeoGlobe.Class4OL(GeoGlobe.Format.WMSCapabilities.v1,{readers:{wms:GeoGlobe.Util.applyDefaults({WMT_MS_Capabilities:function(e,t){this.readChildNodes(e,t)},Keyword:function(e,t){t.keywords&&t.keywords.push(this.getChildValue(e))},DescribeLayer:function(e,t){t.describelayer={formats:[]},this.readChildNodes(e,t.describelayer)},GetLegendGraphic:function(e,t){t.getlegendgraphic={formats:[]},this.readChildNodes(e,t.getlegendgraphic)},GetStyles:function(e,t){t.getstyles={formats:[]},this.readChildNodes(e,t.getstyles)},PutStyles:function(e,t){t.putstyles={formats:[]},this.readChildNodes(e,t.putstyles)},UserDefinedSymbolization:function(e,t){var i={supportSLD:1==_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("SupportSLD")),userLayer:1==_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("UserLayer")),userStyle:1==_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("UserStyle")),remoteWFS:1==_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("RemoteWFS"))};t.userSymbols=i},LatLonBoundingBox:function(e,t){t.llbbox=[_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e.getAttribute("minx")),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e.getAttribute("miny")),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e.getAttribute("maxx")),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(e.getAttribute("maxy"))]},BoundingBox:function(e,t){var i=GeoGlobe.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,t]);i.srs=e.getAttribute("SRS"),t.bbox[i.srs]=i},ScaleHint:function(e,t){var i=e.getAttribute("min"),r=e.getAttribute("max"),o=Math.pow(2,.5),n=GeoGlobe.INCHES_PER_UNIT.m;0!=i&&(t.maxScale=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()((i/o*n*GeoGlobe.DOTS_PER_INCH).toPrecision(13))),r!=Number.POSITIVE_INFINITY&&(t.minScale=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()((r/o*n*GeoGlobe.DOTS_PER_INCH).toPrecision(13)))},Dimension:function(e,t){var i={name:e.getAttribute("name").toLowerCase(),units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol")};t.dimensions[i.name]=i},Extent:function(e,t){var i=e.getAttribute("name").toLowerCase();if(i in t.dimensions){var r=t.dimensions[i];r.nearestVal="1"===e.getAttribute("nearestValue"),r.multipleVal="1"===e.getAttribute("multipleValues"),r.current="1"===e.getAttribute("current"),r.default=e.getAttribute("default")||"";var o=this.getChildValue(e);r.values=o.split(",")}}},GeoGlobe.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"GeoGlobe.Format.WMSCapabilities.v1_1"}),GeoGlobe.Format.WMSCapabilities.v1_1_0=GeoGlobe.Class4OL(GeoGlobe.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:GeoGlobe.Util.applyDefaults({SRS:function(e,t){for(var i=this.getChildValue(e).split(/ +/),r=0,o=i.length;r<o;r++)t.srs[i[r]]=!0}},GeoGlobe.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"GeoGlobe.Format.WMSCapabilities.v1_1_0"}),GeoGlobe.Format.WMSCapabilities.v1_1_1=GeoGlobe.Class4OL(GeoGlobe.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:GeoGlobe.Util.applyDefaults({SRS:function(e,t){t.srs[this.getChildValue(e)]=!0}},GeoGlobe.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"GeoGlobe.Format.WMSCapabilities.v1_1_1"}),GeoGlobe.Format.WMSCapabilities.v1_1_1_WMSC=GeoGlobe.Class4OL(GeoGlobe.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{wms:GeoGlobe.Util.applyDefaults({VendorSpecificCapabilities:function(e,t){t.vendorSpecific={tileSets:[]},this.readChildNodes(e,t.vendorSpecific)},TileSet:function(e,t){var i={srs:{},bbox:{},resolutions:[]};this.readChildNodes(e,i),t.tileSets.push(i)},Resolutions:function(e,t){for(var i=this.getChildValue(e).split(" "),r=0,o=i.length;r<o;r++)""!=i[r]&&t.resolutions.push(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(i[r]))},Width:function(e,t){t.width=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},Height:function(e,t){t.height=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},Layers:function(e,t){t.layers=this.getChildValue(e)},Styles:function(e,t){t.styles=this.getChildValue(e)}},GeoGlobe.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:"GeoGlobe.Format.WMSCapabilities.v1_1_1_WMSC"}),GeoGlobe.Format.WMSCapabilities.v1_3=GeoGlobe.Class4OL(GeoGlobe.Format.WMSCapabilities.v1,{readers:{wms:GeoGlobe.Util.applyDefaults({WMS_Capabilities:function(e,t){this.readChildNodes(e,t)},LayerLimit:function(e,t){t.layerLimit=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MaxWidth:function(e,t){t.maxWidth=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MaxHeight:function(e,t){t.maxHeight=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},BoundingBox:function(e,t){var i=GeoGlobe.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,t]);i.srs=e.getAttribute("CRS"),t.bbox[i.srs]=i},CRS:function(e,t){this.readers.wms.SRS.apply(this,[e,t])},EX_GeographicBoundingBox:function(e,t){t.llbbox=[],this.readChildNodes(e,t.llbbox)},westBoundLongitude:function(e,t){t[0]=this.getChildValue(e)},eastBoundLongitude:function(e,t){t[2]=this.getChildValue(e)},southBoundLatitude:function(e,t){t[1]=this.getChildValue(e)},northBoundLatitude:function(e,t){t[3]=this.getChildValue(e)},MinScaleDenominator:function(e,t){t.maxScale=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(this.getChildValue(e)).toPrecision(16)},MaxScaleDenominator:function(e,t){t.minScale=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(this.getChildValue(e)).toPrecision(16)},Dimension:function(e,t){var i={name:e.getAttribute("name").toLowerCase(),units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol"),nearestVal:"1"===e.getAttribute("nearestValue"),multipleVal:"1"===e.getAttribute("multipleValues"),default:e.getAttribute("default")||"",current:"1"===e.getAttribute("current"),values:this.getChildValue(e).split(",")};t.dimensions[i.name]=i},Keyword:function(e,t){var i={value:this.getChildValue(e),vocabulary:e.getAttribute("vocabulary")};t.keywords&&t.keywords.push(i)}},GeoGlobe.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(e,t){this.readers.wms.UserDefinedSymbolization.apply(this,[e,t]),t.userSymbols.inlineFeature=1==_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("InlineFeature")),t.userSymbols.remoteWCS=1==_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("RemoteWCS"))},DescribeLayer:function(e,t){this.readers.wms.DescribeLayer.apply(this,[e,t])},GetLegendGraphic:function(e,t){this.readers.wms.GetLegendGraphic.apply(this,[e,t])}}},CLASS_NAME:"GeoGlobe.Format.WMSCapabilities.v1_3"}),GeoGlobe.Format.WMSCapabilities.v1_3_0=GeoGlobe.Class4OL(GeoGlobe.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"GeoGlobe.Format.WMSCapabilities.v1_3_0"}),GeoGlobe.Format.WMTSCapabilities=GeoGlobe.Class4OL(GeoGlobe.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(e,t){if(!("layer"in t))throw new Error("Missing property 'layer' in configuration.");for(var i,r=e.contents,o=(r.layers,0),n=r.layers.length;o<n;++o)if(r.layers[o].identifier===t.layer){i=r.layers[o];break}if(!i)throw new Error("Layer not found");var s,a,l=t.format;if(!l&&i.formats&&i.formats.length&&(l=i.formats[0]),t.matrixSet)s=r.tileMatrixSets[t.matrixSet];else if(t.projection){o=0;for(var u=i.tileMatrixSetLinks.length;o<u;o++)if(r.tileMatrixSets[i.tileMatrixSetLinks[o].tileMatrixSet].supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3")===t.projection){s=r.tileMatrixSets[i.tileMatrixSetLinks[o].tileMatrixSet];break}}else i.tileMatrixSetLinks.length>=1&&(s=r.tileMatrixSets[i.tileMatrixSetLinks[0].tileMatrixSet]);if(!s)throw new Error("matrixSet not found");for(o=0,n=i.styles.length;o<n&&!(a=i.styles[o]).isDefault;++o);var h=t.requestEncoding;h||(h="KVP",e.operationsMetadata.GetTile.dcp.http);var c=[],g=t.params||{};delete t.params;for(var p=0,f=i.dimensions.length;p<f;p++){var d=i.dimensions[p];c.push(d.identifier),g.hasOwnProperty(d.identifier)||(g[d.identifier]=d.default)}var m,C,y,v,A=t.projection||s.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),_=t.units||("EPSG:4326"===A?"degrees":"m"),I=[],b=[],w=i.tileMatrixSetLinks,G=function(e){I.push(28e-5*e/GeoGlobe.METERS_PER_INCH/GeoGlobe.INCHES_PER_UNIT[_]),(!m||m>e)&&(m=e),(!C||C<e)&&(C=e)},E=0;for(u=w.length;E<u;E++)if((y=w[E]).tileMatrixSet===s.identifier){if(y.tileMatrixSetLimits){for(var S,P={},T=0,x=s.matrixIds.length;T<x;T++)P[s.matrixIds[T].identifier]=s.matrixIds[T];for(T=0,x=y.tileMatrixSetLimits.length;T<x;T++)S=P[y.tileMatrixSetLimits[T].tileMatrix],b.push(S),G(S.scaleDenominator)}else for(T=0,x=s.matrixIds.length;T<x;T++)G(s.matrixIds[T].scaleDenominator);break}if("REST"===h&&i.resourceUrls){v=[],i.resourceUrls;for(var N,L=0,M=i.resourceUrls.length;L<M;++L)(N=i.resourceUrls[L]).format===l&&"tile"===N.resourceType&&v.push(N.template)}else{var R,O=e.operationsMetadata.GetTile.dcp.http.get;for(v=[],o=0,n=O.length;o<n;o++)(!(R=O[o].constraints)||R&&R.GetEncoding.allowedValues[h])&&v.push(O[o].url)}I.sort((function(e,t){return t-e}));var F,D="SERVICE=WMTS&REQUEST=GetTile&VERSION="+e.version+"&LAYER="+i.identifier+"&STYLE="+a.identifier+"&TILEMATRIXSET="+s.identifier+"&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&FORMAT="+l;F=v[0].endsWith("?")?v[0]+D:v[0]+"?"+D;var k=GeoGlobe.Util.applyDefaults(t,{id:i.identifier,url:[F]}),U={id:k.id,layer:{id:k.id,type:"raster",source:k.id},source:{type:"raster",tiles:k.url,tileSize:256}};return U.matrixSet=s,U.identifier=i.identifier,U.bounds=i.bounds,U},CLASS_NAME:"GeoGlobe.Format.WMTSCapabilities"}),GeoGlobe.Format.WMTSCapabilities.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(e){GeoGlobe.Format.XML.prototype.initialize.apply(this,[e]),this.options=e;var t=GeoGlobe.Util.extend({},GeoGlobe.Format.WMTSCapabilities.prototype.yx);this.yx=GeoGlobe.Util.extend(t,this.yx)},read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t.version=this.version,t},readers:{wmts:{Capabilities:function(e,t){this.readChildNodes(e,t)},Contents:function(e,t){t.contents={},t.contents.layers=[],t.contents.tileMatrixSets={},this.readChildNodes(e,t.contents)},Layer:function(e,t){var i={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[]};this.readChildNodes(e,i),t.layers.push(i)},Style:function(e,t){var i={};i.isDefault="true"===e.getAttribute("isDefault"),this.readChildNodes(e,i),t.styles.push(i)},Format:function(e,t){t.formats.push(this.getChildValue(e))},TileMatrixSetLink:function(e,t){var i={};this.readChildNodes(e,i),t.tileMatrixSetLinks.push(i)},TileMatrixSet:function(e,t){if(t.layers){var i={matrixIds:[]};this.readChildNodes(e,i),t.tileMatrixSets[i.identifier]=i}else t.tileMatrixSet=this.getChildValue(e)},TileMatrixSetLimits:function(e,t){t.tileMatrixSetLimits=[],this.readChildNodes(e,t)},TileMatrixLimits:function(e,t){var i={};this.readChildNodes(e,i),t.tileMatrixSetLimits.push(i)},MinTileRow:function(e,t){t.minTileRow=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MaxTileRow:function(e,t){t.maxTileRow=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MinTileCol:function(e,t){t.minTileCol=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MaxTileCol:function(e,t){t.maxTileCol=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},TileMatrix:function(e,t){if(t.identifier){var i={supportedCRS:t.supportedCRS};this.readChildNodes(e,i),t.matrixIds.push(i)}else t.tileMatrix=this.getChildValue(e)},ScaleDenominator:function(e,t){t.scaleDenominator=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(this.getChildValue(e))},TopLeftCorner:function(e,t){var i,r=this.getChildValue(e).split(" ");if(t.supportedCRS){var o=t.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");i=!!this.yx[o]}t.topLeftCorner=i?new GeoGlobe.LngLat(r[1],r[0]):new GeoGlobe.LngLat(r[0],r[1])},TileWidth:function(e,t){t.tileWidth=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},TileHeight:function(e,t){t.tileHeight=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MatrixWidth:function(e,t){t.matrixWidth=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MatrixHeight:function(e,t){t.matrixHeight=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},ResourceURL:function(e,t){t.resourceUrl=t.resourceUrl||{};var i=e.getAttribute("resourceType");t.resourceUrls||(t.resourceUrls=[]);var r=t.resourceUrl[i]={format:e.getAttribute("format"),template:e.getAttribute("template"),resourceType:i};t.resourceUrls.push(r)},LegendURL:function(e,t){t.legends=t.legends||[];var i={format:e.getAttribute("format"),href:e.getAttribute("xlink:href")},r=e.getAttribute("width"),o=e.getAttribute("height"),n=e.getAttribute("minScaleDenominator"),s=e.getAttribute("maxScaleDenominator");null!==r&&(i.width=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(r)),null!==o&&(i.height=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(o)),null!==n&&(i.minScaleDenominator=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(n)),null!==s&&(i.maxScaleDenominator=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(s)),t.legends.push(i)},InfoFormat:function(e,t){t.infoFormats=t.infoFormats||[],t.infoFormats.push(this.getChildValue(e))},WSDL:function(e,t){t.wsdl={},t.wsdl.href=e.getAttribute("xlink:href")},ServiceMetadataURL:function(e,t){t.serviceMetadataUrl={},t.serviceMetadataUrl.href=e.getAttribute("xlink:href")},Dimension:function(e,t){var i={values:[]};this.readChildNodes(e,i),t.dimensions.push(i)},Default:function(e,t){t.default=this.getChildValue(e)},Value:function(e,t){t.values.push(this.getChildValue(e))}},ows:GeoGlobe.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"GeoGlobe.Format.WMTSCapabilities.v1_0_0"}),GeoGlobe.Format.VTSCapabilities=GeoGlobe.Class4OL(GeoGlobe.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(e,t){if(!("layer"in t))throw new Error("Missing property 'layer' in configuration.");for(var i,r=e.contents,o=(r.layers,0),n=r.layers.length;o<n;++o)if(r.layers[o].identifier===t.layer){i=r.layers[o];break}if(!i)throw new Error("Layer not found");var s,a,l=t.format;if(!l&&i.formats&&i.formats.length&&(l=i.formats[0]),t.matrixSet)s=r.tileMatrixSets[t.matrixSet];else if(t.projection){o=0;for(var u=i.tileMatrixSetLinks.length;o<u;o++)if(r.tileMatrixSets[i.tileMatrixSetLinks[o].tileMatrixSet].supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3")===t.projection){s=r.tileMatrixSets[i.tileMatrixSetLinks[o].tileMatrixSet];break}}else i.tileMatrixSetLinks.length>=1&&(s=r.tileMatrixSets[i.tileMatrixSetLinks[0].tileMatrixSet]);if(!s)throw new Error("matrixSet not found");for(o=0,n=i.styles.length;o<n&&!(a=i.styles[o]).isDefault;++o);var h=t.requestEncoding;h||(h="KVP",e.operationsMetadata.GetTile.dcp.http);var c=[],g=t.params||{};delete t.params;for(var p=0,f=i.dimensions.length;p<f;p++){var d=i.dimensions[p];c.push(d.identifier),g.hasOwnProperty(d.identifier)||(g[d.identifier]=d.default)}var m,C,y,v,A=t.projection||s.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),_=t.units||("EPSG:4326"===A?"degrees":"m"),I=[],b=[],w=i.tileMatrixSetLinks,G=function(e){I.push(28e-5*e/GeoGlobe.METERS_PER_INCH/GeoGlobe.INCHES_PER_UNIT[_]),(!m||m>e)&&(m=e),(!C||C<e)&&(C=e)},E=0;for(u=w.length;E<u;E++)if((y=w[E]).tileMatrixSet===s.identifier){if(y.tileMatrixSetLimits){for(var S,P={},T=0,x=s.matrixIds.length;T<x;T++)P[s.matrixIds[T].identifier]=s.matrixIds[T];for(T=0,x=y.tileMatrixSetLimits.length;T<x;T++)S=P[y.tileMatrixSetLimits[T].tileMatrix],b.push(S),G(S.scaleDenominator)}else for(T=0,x=s.matrixIds.length;T<x;T++)G(s.matrixIds[T].scaleDenominator);break}if("REST"===h&&i.resourceUrls){v=[],i.resourceUrls;for(var N,L=0,M=i.resourceUrls.length;L<M;++L)(N=i.resourceUrls[L]).format===l&&"tile"===N.resourceType&&v.push(N.template)}else{var R,O=e.operationsMetadata.GetTile.dcp.http.get;for(v=[],o=0,n=O.length;o<n;o++)(!(R=O[o].constraints)||R&&R.GetEncoding.allowedValues[h])&&v.push(O[o].url)}I.sort((function(e,t){return t-e}));var F,D="SERVICE=WMTS&REQUEST=GetTile&VERSION="+e.version+"&LAYER="+i.identifier+"&STYLE="+a.identifier+"&TILEMATRIXSET="+s.identifier+"&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&FORMAT="+l;F=v[0].endsWith("?")?v[0]+D:v[0]+"?"+D;var k=GeoGlobe.Util.applyDefaults(t,{id:i.identifier,url:[F]}),U=new GeoGlobe.Layer.VTS(k);return U.matrixSet=s,U.identifier=i.identifier,U.bounds=i.bounds,U},CLASS_NAME:"GeoGlobe.Format.VTSCapabilities"}),GeoGlobe.Format.VTSCapabilities.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(e){GeoGlobe.Format.XML.prototype.initialize.apply(this,[e]),this.options=e;var t=GeoGlobe.Util.extend({},GeoGlobe.Format.VTSCapabilities.prototype.yx);this.yx=GeoGlobe.Util.extend(t,this.yx)},read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t.version=this.version,t},readers:{wmts:{Capabilities:function(e,t){this.readChildNodes(e,t)},Contents:function(e,t){t.contents={},t.contents.layers=[],t.contents.tileMatrixSets={},this.readChildNodes(e,t.contents)},Layer:function(e,t){var i={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[]};this.readChildNodes(e,i),t.layers.push(i)},Style:function(e,t){var i={};i.isDefault="true"===e.getAttribute("isDefault"),this.readChildNodes(e,i),t.styles.push(i)},Format:function(e,t){t.formats.push(this.getChildValue(e))},TileMatrixSetLink:function(e,t){var i={};this.readChildNodes(e,i),t.tileMatrixSetLinks.push(i)},TileMatrixSet:function(e,t){if(t.layers){var i={matrixIds:[]};this.readChildNodes(e,i),t.tileMatrixSets[i.identifier]=i}else t.tileMatrixSet=this.getChildValue(e)},TileMatrixSetLimits:function(e,t){t.tileMatrixSetLimits=[],this.readChildNodes(e,t)},TileMatrixLimits:function(e,t){var i={};this.readChildNodes(e,i),t.tileMatrixSetLimits.push(i)},MinTileRow:function(e,t){t.minTileRow=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MaxTileRow:function(e,t){t.maxTileRow=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MinTileCol:function(e,t){t.minTileCol=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MaxTileCol:function(e,t){t.maxTileCol=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},TileMatrix:function(e,t){if(t.identifier){var i={supportedCRS:t.supportedCRS};this.readChildNodes(e,i),t.matrixIds.push(i)}else t.tileMatrix=this.getChildValue(e)},ScaleDenominator:function(e,t){t.scaleDenominator=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(this.getChildValue(e))},TopLeftCorner:function(e,t){var i,r=this.getChildValue(e).split(" ");if(t.supportedCRS){var o=t.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");i=!!this.yx[o]}t.topLeftCorner=i?new GeoGlobe.LngLat(r[1],r[0]):new GeoGlobe.LngLat(r[0],r[1])},TileWidth:function(e,t){t.tileWidth=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},TileHeight:function(e,t){t.tileHeight=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MatrixWidth:function(e,t){t.matrixWidth=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MatrixHeight:function(e,t){t.matrixHeight=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},ResourceURL:function(e,t){t.resourceUrl=t.resourceUrl||{};var i=e.getAttribute("resourceType");t.resourceUrls||(t.resourceUrls=[]);var r=t.resourceUrl[i]={format:e.getAttribute("format"),template:e.getAttribute("template"),resourceType:i};t.resourceUrls.push(r)},LegendURL:function(e,t){t.legends=t.legends||[];var i={format:e.getAttribute("format"),href:e.getAttribute("xlink:href")},r=e.getAttribute("width"),o=e.getAttribute("height"),n=e.getAttribute("minScaleDenominator"),s=e.getAttribute("maxScaleDenominator");null!==r&&(i.width=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(r)),null!==o&&(i.height=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(o)),null!==n&&(i.minScaleDenominator=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(n)),null!==s&&(i.maxScaleDenominator=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(s)),t.legends.push(i)},InfoFormat:function(e,t){t.infoFormats=t.infoFormats||[],t.infoFormats.push(this.getChildValue(e))},WSDL:function(e,t){t.wsdl={},t.wsdl.href=e.getAttribute("xlink:href")},ServiceMetadataURL:function(e,t){t.serviceMetadataUrl={},t.serviceMetadataUrl.href=e.getAttribute("xlink:href")},Dimension:function(e,t){var i={values:[]};this.readChildNodes(e,i),t.dimensions.push(i)},Default:function(e,t){t.default=this.getChildValue(e)},Value:function(e,t){t.values.push(this.getChildValue(e))}},ows:GeoGlobe.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"GeoGlobe.Format.VTSCapabilities.v1_0_0"}),GeoGlobe.Format.WPSCapabilities=GeoGlobe.Class4OL(GeoGlobe.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"GeoGlobe.Format.WPSCapabilities"}),GeoGlobe.Format.WPSCapabilities.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(e){GeoGlobe.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{wps:{Capabilities:function(e,t){this.readChildNodes(e,t)},ProcessOfferings:function(e,t){t.processOfferings={},this.readChildNodes(e,t.processOfferings)},Process:function(e,t){var i={processVersion:this.getAttributeNS(e,this.namespaces.wps,"processVersion")};this.readChildNodes(e,i),t[i.identifier]=i},Languages:function(e,t){t.languages=[],this.readChildNodes(e,t.languages)},Default:function(e,t){var i={isDefault:!0};this.readChildNodes(e,i),t.push(i)},Supported:function(e,t){var i={};this.readChildNodes(e,i),t.push(i)}},ows:GeoGlobe.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"GeoGlobe.Format.WPSCapabilities.v1_0_0"}),GeoGlobe.Format.WCSGetCoverage=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(e){var t=this.writeNode("wcs:GetCoverage",e);return this.setAttributeNS(t,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),GeoGlobe.Format.XML.prototype.write.apply(this,[t])},writers:{wcs:{GetCoverage:function(e){var t=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:e.version||this.VERSION,service:"WCS"}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("wcs:DomainSubset",e.domainSubset,t),this.writeNode("wcs:Output",e.output,t),t},DomainSubset:function(e){var t=this.createElementNSPlus("wcs:DomainSubset",{});return this.writeNode("ows:BoundingBox",e.boundingBox,t),e.temporalSubset&&this.writeNode("wcs:TemporalSubset",e.temporalSubset,t),t},TemporalSubset:function(e){for(var t=this.createElementNSPlus("wcs:TemporalSubset",{}),i=0,r=e.timePeriods.length;i<r;++i)this.writeNode("wcs:TimePeriod",e.timePeriods[i],t);return t},TimePeriod:function(e){var t=this.createElementNSPlus("wcs:TimePeriod",{});return this.writeNode("wcs:BeginPosition",e.begin,t),this.writeNode("wcs:EndPosition",e.end,t),e.resolution&&this.writeNode("wcs:TimeResolution",e.resolution,t),t},BeginPosition:function(e){return this.createElementNSPlus("wcs:BeginPosition",{value:e})},EndPosition:function(e){return this.createElementNSPlus("wcs:EndPosition",{value:e})},TimeResolution:function(e){return this.createElementNSPlus("wcs:TimeResolution",{value:e})},Output:function(e){var t=this.createElementNSPlus("wcs:Output",{attributes:{format:e.format,store:e.store}});return e.gridCRS&&this.writeNode("wcs:GridCRS",e.gridCRS,t),t},GridCRS:function(e){var t=this.createElementNSPlus("wcs:GridCRS",{});return this.writeNode("wcs:GridBaseCRS",e.baseCRS,t),e.type&&this.writeNode("wcs:GridType",e.type,t),e.origin&&this.writeNode("wcs:GridOrigin",e.origin,t),this.writeNode("wcs:GridOffsets",e.offsets,t),e.CS&&this.writeNode("wcs:GridCS",e.CS,t),t},GridBaseCRS:function(e){return this.createElementNSPlus("wcs:GridBaseCRS",{value:e})},GridOrigin:function(e){return this.createElementNSPlus("wcs:GridOrigin",{value:e})},GridType:function(e){return this.createElementNSPlus("wcs:GridType",{value:e})},GridOffsets:function(e){return this.createElementNSPlus("wcs:GridOffsets",{value:e})},GridCS:function(e){return this.createElementNSPlus("wcs:GridCS",{value:e})}},ows:GeoGlobe.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"GeoGlobe.Format.WCSGetCoverage"}),GeoGlobe.Format.WPSExecute=GeoGlobe.Class4OL(GeoGlobe.Format.XML,GeoGlobe.Format.Filter.v1_1_0,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(e){},write:function(e){var t;GeoGlobe.Format.XML.supportActiveX?(t=new ActiveXObject("Microsoft.XMLDOM"),this.xmldom=t):t=document.implementation.createDocument("","",null);var i=this.writeNode("wps:Execute",e,t);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),GeoGlobe.Format.XML.prototype.write.apply(this,[i])},read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},writers:{wps:{Execute:function(e){var t=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("wps:DataInputs",e.dataInputs,t),this.writeNode("wps:ResponseForm",e.responseForm,t),t},ResponseForm:function(e){var t=this.createElementNSPlus("wps:ResponseForm",{});return e.rawDataOutput&&this.writeNode("wps:RawDataOutput",e.rawDataOutput,t),e.responseDocument&&this.writeNode("wps:ResponseDocument",e.responseDocument,t),t},ResponseDocument:function(e){var t=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:e.storeExecuteResponse,lineage:e.lineage,status:e.status}});if(e.outputs)for(var i=0,r=e.outputs.length;i<r;i++)this.writeNode("wps:Output",e.outputs[i],t);return t},Output:function(e){var t=this.createElementNSPlus("wps:Output",{attributes:{asReference:e.asReference,mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("ows:Title",e.title,t),this.writeNode("ows:Abstract",e.abstract,t),t},RawDataOutput:function(e){var t=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}});return this.writeNode("ows:Identifier",e.identifier,t),t},DataInputs:function(e){for(var t=this.createElementNSPlus("wps:DataInputs",{}),i=0,r=e.length;i<r;++i)this.writeNode("wps:Input",e[i],t);return t},Input:function(e){var t=this.createElementNSPlus("wps:Input",{});return this.writeNode("ows:Identifier",e.identifier,t),e.title&&this.writeNode("ows:Title",e.title,t),e.data&&this.writeNode("wps:Data",e.data,t),e.reference&&this.writeNode("wps:Reference",e.reference,t),e.boundingBoxData&&this.writeNode("wps:BoundingBoxData",e.boundingBoxData,t),t},Data:function(e){var t=this.createElementNSPlus("wps:Data",{});return e.literalData?this.writeNode("wps:LiteralData",e.literalData,t):e.complexData?this.writeNode("wps:ComplexData",e.complexData,t):e.boundingBoxData&&this.writeNode("ows:BoundingBox",e.boundingBoxData,t),t},LiteralData:function(e){return this.createElementNSPlus("wps:LiteralData",{attributes:{uom:e.uom},value:e.value})},ComplexData:function(e){var t=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}}),i=e.value;return"string"==typeof i?t.appendChild(this.getXMLDoc().createCDATASection(e.value)):t.appendChild(i),t},Reference:function(e){var t=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:e.mimeType,"xlink:href":e.href,method:e.method,encoding:e.encoding,schema:e.schema}});return e.body&&this.writeNode("wps:Body",e.body,t),t},BoundingBoxData:function(e,t){this.writers.ows.BoundingBox.apply(this,[e,t,"wps:BoundingBoxData"])},Body:function(e){var t=this.createElementNSPlus("wps:Body",{});return e.wcs?this.writeNode("wcs:GetCoverage",e.wcs,t):e.wfs?(this.featureType=e.wfs.featureType,this.version=e.wfs.version,this.writeNode("wfs:GetFeature",e.wfs,t)):this.writeNode("wps:Execute",e,t),t}},wcs:GeoGlobe.Format.WCSGetCoverage.prototype.writers.wcs,wfs:GeoGlobe.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:GeoGlobe.Format.Filter.v1_1_0.prototype.writers.ogc,ows:GeoGlobe.Format.OWSCommon.v1_1_0.prototype.writers.ows},readers:{wps:{ExecuteResponse:function(e,t){t.executeResponse={lang:e.getAttribute("lang"),statusLocation:e.getAttribute("statusLocation"),serviceInstance:e.getAttribute("serviceInstance"),service:e.getAttribute("service")},this.readChildNodes(e,t.executeResponse)},Process:function(e,t){t.process={},this.readChildNodes(e,t.process)},Status:function(e,t){t.status={creationTime:e.getAttribute("creationTime")},this.readChildNodes(e,t.status)},ProcessSucceeded:function(e,t){t.processSucceeded=!0},ProcessOutputs:function(e,t){t.processOutputs=[],this.readChildNodes(e,t.processOutputs)},Output:function(e,t){var i={};this.readChildNodes(e,i),t.push(i)},Reference:function(e,t){t.reference={href:e.getAttribute("href"),mimeType:e.getAttribute("mimeType"),encoding:e.getAttribute("encoding"),schema:e.getAttribute("schema")}},Data:function(e,t){t.data={},this.readChildNodes(e,t)},LiteralData:function(e,t){t.literalData={dataType:e.getAttribute("dataType"),uom:e.getAttribute("uom"),value:this.getChildValue(e)}},ComplexData:function(e,t){var i;if(t.complexData={mimeType:e.getAttribute("mimeType"),schema:e.getAttribute("schema"),encoding:e.getAttribute("encoding"),value:""},this.isSimpleContent(e))for(i=e.firstChild;i;i=i.nextSibling)switch(i.nodeType){case 3:case 4:t.complexData.value+=i.nodeValue}else for(i=e.firstChild;i;i=i.nextSibling)1==i.nodeType&&(t.complexData.value=i)},BoundingBox:function(e,t){t.boundingBoxData={dimensions:e.getAttribute("dimensions"),crs:e.getAttribute("crs")},this.readChildNodes(e,t.boundingBoxData)}},ows:GeoGlobe.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"GeoGlobe.Format.WPSExecute"}),GeoGlobe.Format.OGCExceptionReport=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e]));var t={exceptionReport:null};return e.documentElement&&(this.readChildNodes(e,t),null===t.exceptionReport&&(t=(new GeoGlobe.Format.OWSCommon).read(e))),t},readers:{ogc:{ServiceExceptionReport:function(e,t){t.exceptionReport={exceptions:[]},this.readChildNodes(e,t.exceptionReport)},ServiceException:function(e,t){var i={code:e.getAttribute("code"),locator:e.getAttribute("locator"),text:this.getChildValue(e)};t.exceptions.push(i)}}},CLASS_NAME:"GeoGlobe.Format.OGCExceptionReport"}),GeoGlobe.Format.QueryStringFilter=function(){var e={};return e[GeoGlobe.Filter.Comparison.EQUAL_TO]="eq",e[GeoGlobe.Filter.Comparison.NOT_EQUAL_TO]="ne",e[GeoGlobe.Filter.Comparison.LESS_THAN]="lt",e[GeoGlobe.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte",e[GeoGlobe.Filter.Comparison.GREATER_THAN]="gt",e[GeoGlobe.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte",e[GeoGlobe.Filter.Comparison.LIKE]="ilike",GeoGlobe.Class4OL(GeoGlobe.Format,{wildcarded:!1,srsInBBOX:!1,write:function(t,i){i=i||{};var r=t.CLASS_NAME,o=r.substring(r.lastIndexOf(".")+1);switch(o){case"Spatial":switch(t.type){case GeoGlobe.Filter.Spatial.BBOX:i.bbox=t.value.toArray(),this.srsInBBOX&&t.projection&&i.bbox.push(t.projection.getCode());break;case GeoGlobe.Filter.Spatial.DWITHIN:i.tolerance=t.distance;case GeoGlobe.Filter.Spatial.WITHIN:i.lon=t.value.x,i.lat=t.value.y;break;default:GeoGlobe.Console.warn("Unknown spatial filter type "+t.type)}break;case"Comparison":var n=e[t.type];if(void 0!==n){var s=t.value;t.type==GeoGlobe.Filter.Comparison.LIKE&&(s=s.replace(/%/g,"\\%").replace(/\\\\\.(\*)?/g,(function(e,t){return t?e:"\\\\_"})).replace(/\\\\\.\*/g,"\\\\%").replace(/(\\)?\.(\*)?/g,(function(e,t,i){return t||i?e:"_"})).replace(/(\\)?\.\*/g,(function(e,t){return t?e:"%"})).replace(/\\\./g,".").replace(/(\\)?\\\*/g,(function(e,t){return t?e:"*"})),this.wildcarded&&(s="%"+s+"%")),i[t.property+"__"+n]=s,i.queryable=i.queryable||[],i.queryable.push(t.property)}else GeoGlobe.Console.warn("Unknown comparison filter type "+t.type);break;case"Logical":if(t.type===GeoGlobe.Filter.Logical.AND)for(var a=0,l=t.filters.length;a<l;a++)i=this.write(t.filters[a],i);else GeoGlobe.Console.warn("Unsupported logical filter type "+t.type);break;default:GeoGlobe.Console.warn("Unknown filter type "+o)}return i},CLASS_NAME:"GeoGolobe.Format.QueryStringFilter"})}(),GeoGlobe.Format.BusCapabilities=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{tagName:"NETWORK_Capabilities",read:function(e){var t;"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e]));var i={};return(t=e.nodeName!=this.tagName?e.getElementsByTagName(this.tagName):[e]).length>0&&this.runChildNodes(i,t[0]),i},runChildNodes:function(e,t,i){for(var r,o,n=t.childNodes,s=0;s<n.length;++s)1==(r=n[s]).nodeType&&(o=i?this["read_"+i+"_"+r.nodeName]:this["read_"+r.nodeName])&&o.apply(this,[e,r])},read_Service:function(e,t){var i={};this.runChildNodes(i,t,"Service"),e.service=i},read_Service_Name:function(e,t){var i=this.getChildValue(t);i&&(e.name=i)},read_Service_Title:function(e,t){var i=this.getChildValue(t);i&&(e.title=i)},read_Service_Abstract:function(e,t){var i=this.getChildValue(t);i&&(e.serviceAbstract=i)},read_Service_KeywordList:function(e,t){},read_Service_OnlineResource:function(e,t){var i=this.getChildValue(t);e&&(e.onlineResource=i)},read_Capability:function(e,t){var i={};this.runChildNodes(i,t,"Capability"),e.capability=i},read_Capability_Request:function(e,t){var i={};this.runChildNodes(i,t,"Capability_Request"),e.request=i},read_Capability_Request_GetCapabilities:function(e,t){var i=t.getElementsByTagName("HTTP"),r={};i[0]&&this.runChildNodes(r,i[0],"Capability_Request_GetCapabilities_DCPType_HTTP"),e.getCapabilities=r},read_Capability_Request_GetCapabilities_DCPType_HTTP_Get:function(e,t){var i=t.getAttribute("onlineResource");i&&(e.getUrl=i)},read_Capability_Request_GetCapabilities_DCPType_HTTP_Post:function(e,t){var i=t.getAttribute("onlineResource");i&&(e.postUrl=i)},read_Capability_Request_queryStation:function(e,t){var i=t.getElementsByTagName("HTTP"),r={};i[0]&&this.runChildNodes(r,i[0],"Capability_Request_queryStation_DCPType_HTTP"),e.queryStation=r},read_Capability_Request_queryStation_DCPType_HTTP_Get:function(e,t){var i=t.getAttribute("onlineResource");i&&(e.getUrl=i)},read_Capability_Request_queryStation_DCPType_HTTP_Post:function(e,t){var i=t.getAttribute("onlineResource");i&&(e.postUrl=i)},read_Capability_Request_queryLine:function(e,t){var i=t.getElementsByTagName("HTTP"),r={};i[0]&&this.runChildNodes(r,i[0],"Capability_Request_queryLine_DCPType_HTTP"),e.queryLine=r},read_Capability_Request_queryLine_DCPType_HTTP_Get:function(e,t){var i=t.getAttribute("onlineResource");i&&(e.getUrl=i)},read_Capability_Request_queryLine_DCPType_HTTP_Post:function(e,t){var i=t.getAttribute("onlineResource");i&&(e.postUrl=i)},read_Capability_Request_queryChange:function(e,t){var i=t.getElementsByTagName("HTTP");i[0]&&this.runChildNodes({},i[0],"Capability_Request_queryChange_DCPType_HTTP")},read_Capability_Request_queryChange_DCPType_HTTP_Get:function(e,t){var i=t.getAttribute("onlineResource");i&&(e.getUrl=i)},read_Capability_Request_queryChange_DCPType_HTTP_Post:function(e,t){var i=t.getAttribute("onlineResource");i&&(e.postUrl=i)},read_Capability_Networks:function(e,t){for(var i=t.getElementsByTagName("Name"),r=[],o=0;o<i.length;o++){var n=this.getChildValue(i[o]);n&&r.push(n)}e.networks=r},CLASS_NAME:"GeoGlobe.Format.BusCapabilities"}),GeoGlobe.Format.XML2JSON=GeoGlobe.Class4OL({initialize:function(){},read:function(e,t,i){t||(t=""),e=(e=e.replace(/\s*\/>/g,"/>")).replace(/<\?[^>]*>/g,"").replace(/<\![^>]*>/g,""),t.sort||(t=t.split(","));var r=this.no_fast_endings(e);r=this.attris_to_tags(r),r=(r=escape(r)).split("%3C").join("<").split("%3E").join(">").split("%3D").join("=").split("%22").join('"');for(var o=0;o<t.length;o++)r=(r=r.replace(new RegExp("<"+t[o]+">","g"),"*$**"+t[o]+"**$*")).replace(new RegExp("</"+t[o]+">","g"),"*$***"+t[o]+"**$*");r="<JSONTAGWRAPPER>"+r+"</JSONTAGWRAPPER>",this.xmlobject={};var n=this.xml_to_object(r).JSONTAGWRAPPER;return i&&(n=this.show_json_structure(n,i)),n},xml_to_object:function xml_to_object(xmlcode){var x=xmlcode.replace(/<\//g,"?");x=x.split("<");for(var y=[],level=0,opentags=[],i=1;i<x.length;i++){var tagname=x[i].split(">")[0];for(opentags.push(tagname),level++,y.push(level+"<"+x[i].split("?")[0]);x[i].indexOf("?"+opentags[opentags.length-1]+">")>=0;)level--,opentags.pop()}for(var oldniva=-1,objname="this.xmlobject",i=0;i<y.length;i++){var preeval="",niva=y[i].split("<")[0],tagnamn=y[i].split("<")[1].split(">")[0];tagnamn=tagnamn.replace(/%3A/,"_");var rest=y[i].split(">")[1];if(niva<=oldniva)for(var tabort=oldniva-niva+1,j=0;j<tabort;j++)objname=objname.substring(0,objname.lastIndexOf("."));objname+="."+tagnamn;var pobject=objname.substring(0,objname.lastIndexOf("."));"object"!=eval("typeof "+pobject)&&(preeval+=pobject+"={value:"+pobject+"};\n");var objlast=objname.substring(objname.lastIndexOf(".")+1),already=!1;for(k in eval(pobject))k==objlast&&(already=!0);for(var onlywhites=!0,s=0;s<rest.length;s+=3)"%"!=rest.charAt(s)&&(onlywhites=!1);""==rest||onlywhites?rest="{}":rest/1!=rest&&(rest="'"+rest.replace(/\'/g,"\\'")+"'",rest=rest.replace(/\*\$\*\*\*/g,"</"),rest=rest.replace(/\*\$\*\*/g,"<"),rest=rest.replace(/\*\*\$\*/g,">")),"'"==rest.charAt(0)&&(rest="unescape("+rest+")"),already&&!eval(objname+".sort")&&(preeval+=objname+"=["+objname+"];\n");var before="=";after="",already&&(before=".push(",after=")");var toeval=preeval+objname+before+rest+after;eval(toeval),eval(objname+".sort")&&(objname+="["+eval(objname+".length-1")+"]"),oldniva=niva}return this.xmlobject},show_json_structure:function(e,t,i){var r="";for(var o in e.sort?r+="[\n":r+="{\n",e)e.sort||(r+=o+":"),"object"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11___default()(e[o])?r+=this.show_json_structure(e[o],!1,1):"function"==typeof e[o]?r+=e[o]+"":"string"!=typeof e[o]?r+=e[o]+",\n":r+="'"+e[o].replace(/\'/g,"\\'").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r")+"',\n";if(e.sort?r+="],\n":r+="},\n",!i){var n=(r=(r=(r=r.substring(0,r.lastIndexOf(","))).replace(new RegExp(",\n}","g"),"\n}")).replace(new RegExp(",\n]","g"),"\n]")).split("\n");r="";var s=0;for(o=0;o<n.length;o++){(n[o].indexOf("}")>=0||n[o].indexOf("]")>=0)&&s--,tabs="";for(var a=0;a<s;a++)tabs+="\t";r+=tabs+n[o]+"\n",(n[o].indexOf("{")>=0||n[o].indexOf("[")>=0)&&s++}"html"==t&&(r=(r=r.replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/\n/g,"<BR>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")),"compact"==t&&(r=r.replace(/\n/g,"").replace(/\t/g,""))}return r},no_fast_endings:function(e){e=e.split("/>");for(var t=1;t<e.length;t++){var i=e[t-1].substring(e[t-1].lastIndexOf("<")+1).split(" ")[0];e[t]="></"+i+">"+e[t]}return e.join("")},attris_to_tags:function(e){var t=" =\"'".split("");e=e.split(">");for(var i=0;i<e.length;i++){for(var r=e[i].split("<"),o=0;o<4;o++)r[0]=r[0].replace(new RegExp(t[o],"g"),"_jsonconvtemp"+o+"_");if(r[1]){r[1]=r[1].replace(/'/g,'"'),r[1]=r[1].split('"');for(var n=1;n<r[1].length;n+=2)for(o=0;o<4;o++)r[1][n]=r[1][n].replace(new RegExp(t[o],"g"),"_jsonconvtemp"+o+"_");r[1]=r[1].join('"')}e[i]=r.join("<")}for(e=(e=(e=e.join(">")).replace(/ ([^=]*)=([^ |>]*)/g,"><$1>$2</$1")).replace(/>"/g,">").replace(/"</g,"<"),o=0;o<4;o++)e=e.replace(new RegExp("_jsonconvtemp"+o+"_","g"),t[o]);return e},CLASS_NAME:"GeoGlobe.Format.XML2JSON"}),GeoGlobe.Format.CSWGetRecords=function(e){e=GeoGlobe.Util.applyDefaults(e,GeoGlobe.Format.CSWGetRecords.DEFAULTS);var t=GeoGlobe.Format.CSWGetRecords["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported CSWGetRecords version: "+e.version;return new t(e)},GeoGlobe.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"},GeoGlobe.Format.CSWGetRecords.v2_0_2=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(e){GeoGlobe.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{csw:{GetRecordsResponse:function(e,t){t.records=[],this.readChildNodes(e,t);var i=this.getAttributeNS(e,"","version");""!=i&&(t.version=i)},RequestId:function(e,t){t.RequestId=this.getChildValue(e)},SearchStatus:function(e,t){t.SearchStatus={};var i=this.getAttributeNS(e,"","timestamp");""!=i&&(t.SearchStatus.timestamp=i)},SearchResults:function(e,t){this.readChildNodes(e,t);for(var i=e.attributes,r={},o=0,n=i.length;o<n;++o)"numberOfRecordsMatched"==i[o].name||"numberOfRecordsReturned"==i[o].name||"nextRecord"==i[o].name?r[i[o].name]=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[o].nodeValue):r[i[o].name]=i[o].nodeValue;t.SearchResults=r},SummaryRecord:function(e,t){var i={type:"SummaryRecord"};this.readChildNodes(e,i),t.records.push(i)},BriefRecord:function(e,t){var i={type:"BriefRecord"};this.readChildNodes(e,i),t.records.push(i)},DCMIRecord:function(e,t){var i={type:"DCMIRecord"};this.readChildNodes(e,i),t.records.push(i)},Record:function(e,t){var i={type:"Record"};this.readChildNodes(e,i),t.records.push(i)},"*":function(e,t){t[e.localName||e.nodeName.split(":").pop()]=this.getChildValue(e)}},geonet:{info:function(e,t){var i={};this.readChildNodes(e,i),t.gninfo=i}},dc:{"*":function(e,t){var i=e.localName||e.nodeName.split(":").pop();GeoGlobe.Util.isArray(t[i])||(t[i]=[]);for(var r={},o=e.attributes,n=0,s=o.length;n<s;++n)r[o[n].name]=o[n].nodeValue;r.value=this.getChildValue(e),""!=r.value&&t[i].push(r)}},dct:{"*":function(e,t){var i=e.localName||e.nodeName.split(":").pop();GeoGlobe.Util.isArray(t[i])||(t[i]=[]),t[i].push(this.getChildValue(e))}},ows:GeoGlobe.Util.applyDefaults({BoundingBox:function(e,t){t.bounds&&(t.BoundingBox=[{crs:t.projection,value:[t.bounds._sw.lng,t.bounds._sw.lat,t.bounds._ne.lng,t.bounds._ne.lat]}],delete t.projection,delete t.bounds),GeoGlobe.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)}},GeoGlobe.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(e){var t=this.writeNode("csw:GetRecords",e);return t.setAttribute("xmlns:gmd",this.namespaces.gmd),GeoGlobe.Format.XML.prototype.write.apply(this,[t])},writers:{csw:{GetRecords:function(e){e||(e={});var t=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:e.requestId||this.requestId,resultType:e.resultType||this.resultType,outputFormat:e.outputFormat||this.outputFormat,outputSchema:e.outputSchema||this.outputSchema,startPosition:e.startPosition||this.startPosition,maxRecords:e.maxRecords||this.maxRecords}});(e.DistributedSearch||this.DistributedSearch)&&this.writeNode("csw:DistributedSearch",e.DistributedSearch||this.DistributedSearch,t);var i=e.ResponseHandler||this.ResponseHandler;if(GeoGlobe.Util.isArray(i)&&i.length>0)for(var r=0,o=i.length;r<o;r++)this.writeNode("csw:ResponseHandler",i[r],t);return this.writeNode("Query",e.Query||this.Query,t),t},DistributedSearch:function(e){return this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:e.hopCount}})},ResponseHandler:function(e){return this.createElementNSPlus("csw:ResponseHandler",{value:e.value})},Query:function(e){e||(e={});var t=this.createElementNSPlus("csw:Query",{attributes:{typeNames:e.typeNames||"csw:Record"}}),i=e.ElementName;if(GeoGlobe.Util.isArray(i)&&i.length>0)for(var r=0,o=i.length;r<o;r++)this.writeNode("csw:ElementName",i[r],t);else this.writeNode("csw:ElementSetName",e.ElementSetName||{value:"summary"},t);return e.Constraint&&this.writeNode("csw:Constraint",e.Constraint,t),e.SortBy&&this.writeNode("ogc:SortBy",e.SortBy,t),t},ElementName:function(e){return this.createElementNSPlus("csw:ElementName",{value:e.value})},ElementSetName:function(e){return this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:e.typeNames},value:e.value})},Constraint:function(e){var t=this.createElementNSPlus("csw:Constraint",{attributes:{version:e.version}});if(e.Filter){var i=new GeoGlobe.Format.Filter({version:e.version});t.appendChild(i.write(e.Filter))}else if(e.CqlText){var r=this.createElementNSPlus("CqlText",{value:e.CqlText.value});t.appendChild(r)}return t}},ogc:GeoGlobe.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"GeoGlobe.Format.CSWGetRecords.v2_0_2"}),function(e,t){e.GeoGlobe.Format.X2JS=function(e){void 0===(e=e||{}).escapeMode&&(e.escapeMode=!0),e.attributePrefix=e.attributePrefix||"_",e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0),e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0),void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0),e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1),e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=!1);var t=1,i=3,r=4,o=8,n=9;function s(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function a(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function l(e,t,i,r){for(var o=0;o<e.length;o++){var n=e[o];if("string"==typeof n){if(n==r)break}else if(n instanceof RegExp){if(n.test(r))break}else if("function"==typeof n&&n(t,i,r))break}return o!=e.length}function u(t,i,r){switch(e.arrayAccessForm){case"property":t[i]instanceof Array?t[i+"_asArray"]=t[i]:t[i+"_asArray"]=[t[i]]}!(t[i]instanceof Array)&&e.arrayAccessFormPaths.length>0&&l(e.arrayAccessFormPaths,t,i,r)&&(t[i]=[t[i]])}function h(e){var t=e.split(/[-T:+Z]/g),i=new Date(t[0],t[1]-1,t[2]),r=t[5].split(".");if(i.setHours(t[3],t[4],r[0]),r.length>1&&i.setMilliseconds(r[1]),t[6]&&t[7]){var o=60*t[6]+Number(t[7]);o=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*o:o),i.setMinutes(i.getMinutes()-o-i.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(i=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())));return i}function c(i,r,o,n){return!(r==t&&e.xmlElementsFilter.length>0)||l(e.xmlElementsFilter,i,o,n)}function g(a,p){if(a.nodeType==n){for(var f=new Object,d=a.childNodes,m=0;m<d.length;m++){if((C=d.item(m)).nodeType==t)f[y=s(C)]=g(C,y)}return f}if(a.nodeType==t){(f=new Object).__cnt=0;for(d=a.childNodes,m=0;m<d.length;m++){var C,y=s(C=d.item(m));if(C.nodeType!=o){var v=p+"."+y;c(f,C.nodeType,y,v)&&(f.__cnt++,null==f[y]?(f[y]=g(C,v),u(f,y,v)):(null!=f[y]&&(f[y]instanceof Array||(f[y]=[f[y]],u(f,y,v))),f[y][f[y].length]=g(C,v)))}}for(var A=0;A<a.attributes.length;A++){var _=a.attributes.item(A);f.__cnt++,f[e.attributePrefix+_.name]=_.value}var I=a.prefix;return null!=I&&""!=I&&(f.__cnt++,f.__prefix=I),null!=f["#text"]&&(f.__text=f["#text"],f.__text instanceof Array&&(f.__text=f.__text.join("\n")),e.stripWhitespaces&&(f.__text=f.__text.trim()),delete f["#text"],"property"==e.arrayAccessForm&&delete f["#text_asArray"],f.__text=function(t,i,r){if(e.datetimeAccessFormPaths.length>0){var o=r.split(".#")[0];return l(e.datetimeAccessFormPaths,t,i,o)?h(t):t}return t}(f.__text,y,p+"."+y)),null!=f["#cdata-section"]&&(f.__cdata=f["#cdata-section"],delete f["#cdata-section"],"property"==e.arrayAccessForm&&delete f["#cdata-section_asArray"]),0==f.__cnt&&"text"==e.emptyNodeForm?f="":1==f.__cnt&&null!=f.__text?f=f.__text:1!=f.__cnt||null==f.__cdata||e.keepCData?f.__cnt>1&&null!=f.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==f.__text||""==f.__text.trim())&&delete f.__text:f=f.__cdata,delete f.__cnt,!e.enableToStringFunc||null==f.__text&&null==f.__cdata||(f.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),f}if(a.nodeType==i||a.nodeType==r)return a.nodeValue}function p(t,i,r,o){var n="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+i;if(null!=r)for(var s=0;s<r.length;s++){var l=r[s],u=t[l];e.escapeMode&&(u=a(u)),n+=" "+l.substr(e.attributePrefix.length)+"=",e.useDoubleQuotes?n+='"'+u+'"':n+="'"+u+"'"}return n+(o?"/>":">")}function f(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function d(t,i){return"property"==e.arrayAccessForm&&(o="_asArray",-1!==(r=i.toString()).indexOf(o,r.length-o.length))||0==i.toString().indexOf(e.attributePrefix)||0==i.toString().indexOf("__")||t[i]instanceof Function;var r,o}function m(e){var t=0;if(e instanceof Object)for(var i in e)d(e,i)||t++;return t}function C(t){var i=[];if(t instanceof Object)for(var r in t)-1==r.toString().indexOf("__")&&0==r.toString().indexOf(e.attributePrefix)&&i.push(r);return i}function y(t){var i,r,o="";return t instanceof Object?o+=(r="",null!=(i=t).__cdata&&(r+="<![CDATA["+i.__cdata+"]]>"),null!=i.__text&&(e.escapeMode?r+=a(i.__text):r+=i.__text),r):null!=t&&(e.escapeMode?o+=a(t):o+=t),o}function v(e,t){return""===e?t:e+"."+t}function A(e,t,i,r){var o="";if(0==e.length)o+=p(e,t,i,!0);else for(var n=0;n<e.length;n++)o+=p(e[n],t,C(e[n]),!1),o+=_(e[n],v(r,t)),o+=f(e[n],t);return o}function _(t,i){var r,o,n,s="";if(m(t)>0)for(var a in t)if(!d(t,a)&&(""==i||(r=t,o=a,n=v(i,a),0==e.jsonPropertiesFilter.length||""==n||l(e.jsonPropertiesFilter,r,o,n)))){var u=t[a],h=C(u);if(null==u||null==u)s+=p(u,a,h,!0);else if(u instanceof Object)if(u instanceof Array)s+=A(u,a,h,i);else if(u instanceof Date)s+=p(u,a,h,!1),s+=u.toISOString(),s+=f(u,a);else{m(u)>0||null!=u.__text||null!=u.__cdata?(s+=p(u,a,h,!1),s+=_(u,v(i,a)),s+=f(u,a)):s+=p(u,a,h,!0)}else s+=p(u,a,h,!1),s+=y(u),s+=f(u,a)}return s+y(t)}this.parseXmlString=function(e){var t,i=window.ActiveXObject||"ActiveXObject"in window;if(void 0===e)return null;if(window.DOMParser){var r=new window.DOMParser,o=null;if(!i)try{o=r.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(e){o=null}try{t=r.parseFromString(e,"text/xml"),null!=o&&t.getElementsByTagNameNS(o,"parsererror").length>0&&(t=null)}catch(e){t=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e);return t},this.asArray=function(e){return void 0===e||null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?h(e):e},this.xml2json=function(e){return g(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return _(e,"")},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return"1.2.0"}},e.GeoGlobe.Format.X2JS.CLASS_NAME="GeoGlobe.Format.X2JS"}(window),GeoGlobe.Query.Service=GeoGlobe.Class4OL({name:null,url:null,version:null,userid:"test@liferay.com",initialize:function(e,t,i){this.name=e,this.url=t,GeoGlobe.Util.extend(this,i)},getCapabilities:function(e,t){},isExist:function(){},failFn:function(e){alert("服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+this.url+"\n操作类型："+e)},_parseToXML:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),(new GeoGlobe.Format.XML).read(t)},_checkIsError:function(e){return(new GeoGlobe.Format.XML).read(e).selectNodes("ServiceExceptionReport").length>0?this._parseToJSON(e):null},_isException:function(e){return!(!e||!e.ServiceExceptionReport)},_parseToJSON:function(e){return(new GeoGlobe.Util.Format.XML2JSON).read(e)},CLASS_NAME:"GeoGlobe.Query.Service"}),GeoGlobe.Query.RouteQuery=GeoGlobe.Class4OL(GeoGlobe.Query.Service,{_format:null,initialize:function(e,t,i){this.name=e,this.url=t,this._format=new GeoGlobe.Format.RouteQuery,GeoGlobe.Util.extend(this,i)},getCapabilities:function(e,t){var i=this.url;GeoGlobe.loadURL(i,{REQUEST:"GetCapabilities"},this,e,t)},findRoute:function(e,t,i){var r={REQUEST:"FindRoute",SERVICE:"ROUTE",VERSION:"1.0.0"};for(var o in{data:!0,orig:!0,dest:!0})if(!(o in e))throw new Error("Missing property '"+o+"'");r.DATA=e.data,r.ORIG=e.orig,r.DEST=e.dest,null!==e.service&&void 0!==e.service&&(r.SERVICE=e.service),null!==e.version&&void 0!==e.version&&(r.VERSION=e.version),null!==e.radius&&void 0!==e.radius&&(r.RADIUS=e.radius),null!==e.queryType&&void 0!==e.queryType&&(r.QUERYTYPE=e.queryType),null!==e.midpos&&void 0!==e.midpos&&(r.MIDPOS=e.midpos),null!==e.avoidPos&&void 0!==e.avoidPos&&(r.AVOIDPOS=e.avoidPos),null!==e.filterRoute&&void 0!==e.filterRoute&&(r.FILTERROUTE=e.filterRoute),null!==e.resultCount&&void 0!==e.resultCount&&(r.RESULTCOUNT=e.resultCount),GeoGlobe.Request.GET({url:this.url,params:r,async:!1,scope:this,success:function(e){var i=this._format.read(e.responseText);if("string"!=typeof i.exceptionInfo){var r=new GeoGlobe.Query.RoutesResult(i),o=r.routes,n=(new GeoGlobe.Format.GeoJSON).write(o),s=new GeoGlobe.Format.JSON;geojsonRoute=s.read(n),r.geojsonRoute=geojsonRoute,t(r)}else t(i)},failure:i})},getRouteInfo:function(e,t,i){var r={REQUEST:"GetRouteInfo",SERVICE:"ROUTE",VERSION:"1.0.0"};if(!e.data||!e.id)throw"Error!Not data and id for bus query.";r.DATA=e.data,r.ID=e.id,GeoGlobe.Request.GET({url:this.url,params:r,scope:this,success:function(e){var i=this._format.read(e.responseText);"string"!=typeof i.exceptionInfo?(i=new GeoGlobe.Query.RouteInfoResult(i),t(i)):t(i)},failure:i})},CLASS_NAME:"GeoGlobe.Query.RouteQuery"}),GeoGlobe.Format.RouteQuery=new GeoGlobe.Class4OL(GeoGlobe.Format.XML,{initialize:function(e){GeoGlobe.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){var t={},i=[];if("string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType){i=[];var r=GeoGlobe.Format.XML.prototype.getChildEl.apply(this,[e]).nodeName;if("ServiceExceptionReport"===r){var o=GeoGlobe.Format.XML.prototype.getElementsByTagNameNS(e,"*","ServiceException")[0];return{exceptionInfo:GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[o]),exceptionCode:o.getAttribute("code")}}for(var n=e.getElementsByTagName(r)[0].childNodes,s=0;s<n.length;s++){var a=n[s],l=a.nodeName;this._resultPaser[r][l]&&this._resultPaser[r][l].apply(this,[a,i])}}return"routeinfo"===(r=r.toLowerCase())?t.items=i:t[r]=i,t},_resultPaser:{RouteInfo:{Item:function(e,t){var i=e.childNodes,r=e.getAttribute("id"),o={};r&&(o={id:r});for(var n=0;n<i.length;n++){var s=(e=i[n]).nodeName;this._resultPaser.RouteInfo[s]&&this._resultPaser.RouteInfo[s].apply(this,[e,o])}t.push(o)},Name:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);i&&(t.name=i)},Toll:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);t.toll=i},Level:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);t.level=i},Length:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);t.length=i},Geometry:function(e,t){var i=GeoGlobe.Format.XML.prototype.getElementsByTagNameNS(e,"*","LineString")[0];if(i){var r=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[i]);if("string"==typeof r&&r.length>0){for(var o=r.split(" "),n=[],s=0,a=o.length;s<a;s++){var l=o[s].split(",");n.push(new GeoGlobe.Geometry.Point(new Number(l[0]),new Number(l[1])))}var u=new GeoGlobe.Geometry.LineString(n);t.geometry=u}}},Directions:function(e,t){t.directions=[];for(var i=e.childNodes,r=0;r<i.length;r++){var o=(e=i[r]).nodeName;this._resultPaser.RouteInfo[o]&&this._resultPaser.RouteInfo[o](e,t.directions)}},Direction:function(e,t){var i={},r=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);i.direction=r,i.nextID=e.getAttribute("nextID"),i.nextItem=e.getAttribute("nextItem"),t.push(i)}},Routes:{Route:function(e,t){for(var i=e.childNodes,r={},o=0;o<i.length;o++){var n=(e=i[o]).nodeName;this._resultPaser.Routes[n]&&this._resultPaser.Routes[n].apply(this,[e,r])}t.push(r)},Item:function(e,t){GeoGlobe.Util.isArray(t.items)||(t.items=[]);var i=e.childNodes,r=e.getAttribute("id"),o={};r&&(o={id:r});for(var n=0;n<i.length;n++){var s=(e=i[n]).nodeName;this._resultPaser.Routes[s]&&this._resultPaser.Routes[s].apply(this,[e,o])}t.items.push(o)},Distance:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);t.distance=i},Name:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);i&&(t.name=i)},Length:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);t.length=i},Direction:function(e,t){var i={},r=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);i.direction=r,i.nextID=e.getAttribute("nextID"),i.nextItem=e.getAttribute("nextItem"),t.direction=i},Geometry:function(e,t){var i=GeoGlobe.Format.XML.prototype.getElementsByTagNameNS(e,"*","LineString")[0];if(i){var r=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[i]);if("string"==typeof r&&r.length>0){for(var o=r.split(" "),n=[],s=0,a=o.length;s<a;s++){var l=o[s].split(",");n.push(new GeoGlobe.Geometry.Point(new Number(l[0]),new Number(l[1])))}var u=new GeoGlobe.Geometry.LineString(n);t.geometry=u}}},Duration:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);t.duration=i},BoundingBox:function(e,t){for(var i=e.childNodes,r=0;r<i.length;r++){var o=(e=i[r]).nodeName;this._resultPaser.Routes[o]&&this._resultPaser.Routes[o].apply(this,[e,t])}},LowerCorner:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]).replace(/^\s*|\s*$/g,""),r=(i=i.replace(/\s*,\s*/g,",")).split(",");t.left=r[0],t.bottom=r[1]},UpperCorner:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]).replace(/^\s*|\s*$/g,""),r=(i=i.replace(/\s*,\s*/g,",")).split(",");t.right=r[0],t.top=r[1],t.bounds=new GeoGlobe.LngLatBounds(new GeoGlobe.LngLat(t.left,t.bottom),new GeoGlobe.LngLat(t.right,t.top)),delete t.left,delete t.bottom,delete t.right,delete t.top},Count:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);t.count=i}}}}),GeoGlobe.Query.RoutesResult=GeoGlobe.Class4OL({data:null,routes:null,initialize:function(e){this.routes=[];var t=null;if(e&&e.routes&&(this.data=e,t=e.routes),GeoGlobe.Util.isArray(t))for(var i=0,r=t.length;i<r;i++){var o=new GeoGlobe.Query.RouteResult;for(var n in t[i])o[n]=t[i][n];this.routes.push(o)}},CLASS_NAME:"GeoGlobe.Query.RoutesResult"}),GeoGlobe.Query.RouteResult=GeoGlobe.Class4OL({bounds:null,count:null,distance:null,duration:null,geometry:null,items:null,initialize:function(){},CLASS_NAME:"GeoGlobe.Query.RouteResult"}),GeoGlobe.Query.RouteInfoResult=GeoGlobe.Class4OL({data:null,items:null,initialize:function(e){if(this.items=[],e&&e.items){this.data=e;var t=e.items}if(GeoGlobe.Util.isArray(t))for(var i=0,r=t.length;i<r;i++){var o=new GeoGlobe.Query.RouteInfoItem;for(var n in t[i])o[n]=t[i][n];this.items.push(o)}},CLASS_NAME:"GeoGlobe.Query.RouteInfoResult"}),GeoGlobe.Query.RouteInfoItem=GeoGlobe.Class4OL({id:null,name:null,toll:null,length:null,geometry:null,level:null,directions:null,initialize:function(){},CLASS_NAME:"GeoGlobe.Query.RouteInfoItem"}),GeoGlobe.Query.BusQuery=GeoGlobe.Class4OL(GeoGlobe.Query.Service,{networkName:null,transferScheme:null,initialize:function(e,t,i){this.name=e,this.url=t,GeoGlobe.Util.extend(this,i)},getCapabilities:function(e,t){"function"!=typeof t&&(t=function(){alert("公交服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+this.url+"\n操作类型：GetCapabilities")}),GeoGlobe.Request.GET({url:this.url,params:{REQUEST:"GetCapabilities"},scope:this,async:!1,success:function(t){"function"==typeof e&&e(t)},failure:t})},isExist:function(){var e=!1,t=this.url;return GeoGlobe.Request.GET({url:t,scope:this,async:!1,success:function(){e=!0}}),e},queryStation:function(e,t,i){var r={REQUEST:"QueryStation"};if(!e.networkName)throw"Error!Not network name for bus query.";r.NETWORKNAME=e.networkName,null!==e.stationId&&void 0!==e.stationId&&(r.STATIONID=e.stationId),null!==e.stationName&&void 0!==e.stationName&&(r.STATIONNAME=e.stationName),null!==e.lineId&&void 0!==e.lineId&&(r.LINEID=e.lineId),null!==e.lineName&&void 0!==e.lineName&&(r.LINENAME=e.lineName),null!==e.coordinate&&void 0!==e.coordinate&&(r.COORDINATE=e.coordinate),null!==e.bbox&&void 0!==e.bbox&&(r.BOX=e.bbox),GeoGlobe.Request.GET({url:this.url,params:r,scope:this,success:function(e){var i=this._parserFeatures(e.responseText);t(i)},failure:i})},queryLine:function(e,t,i){var r={REQUEST:"QueryLine"};if(!e.networkName)throw"Error!Not network name for bus query.";r.NETWORKNAME=e.networkName,null!==e.lineName&&void 0!==e.lineName&&(r.LINENAME=e.lineName),null!==e.lineId&&void 0!==e.lineId&&(r.LINEID=e.lineId),null!==e.stationName&&void 0!==e.stationName&&(r.STATIONNAME=e.stationName),null!==e.stationId&&void 0!==e.stationId&&(r.STATIONID=e.stationId),null!==e.coordinate&&void 0!==e.coordinate&&(r.COORDINATE=e.coordinate),null!==e.bbox&&void 0!==e.bbox&&(r.BOX=e.bbox),GeoGlobe.Request.GET({url:this.url,params:r,scope:this,success:function(e){var i=this._parserFeatures(e.responseText);t(i)},failure:i})},queryChange:function(e,t,i){var r={REQUEST:"QueryChange"};if(!e.networkName)throw"Error!Not network name for bus query.";r.NETWORKNAME=e.networkName,null!==e.startStationId&&void 0!==e.startStationId&&(r.STARTSTATIONID=e.startStationId),null!==e.endStationId&&void 0!==e.endStationId&&(r.ENDSTATIONID=e.endStationId),null!==e.orderType&&void 0!==e.orderType&&(r.ORDERTYPE=e.orderType),null!==e.startCoordinate&&void 0!==e.startCoordinate&&(r.STARTCOORDINATE=e.startCoordinate),null!==e.endCoordinate&&void 0!==e.endCoordinate&&(r.ENDCOORDINATE=e.endCoordinate),null!==e.maxDepth&&void 0!==e.maxDepth&&(r.MAXDEPTH=e.maxDepth),null!==e.maxCost&&void 0!==e.maxCost&&(r.MAXCOST=e.maxCost),null!==e.maxSolutions&&void 0!==e.maxSolutions&&(r.MAXSOLUTIONS=e.maxSolutions),null!==e.ChangeCount&&void 0!==e.ChangeCount&&(r.CHANGECOUNT=e.ChangeCount),GeoGlobe.Request.GET({url:this.url,params:r,scope:this,success:function(e){for(var i=[],r=(e.responseXML.documentElement?e.responseXML:format.read(e.responseText)).selectNodes("/Features/FeatureCollection"),o=new GeoGlobe.Format.XML,n=0;n<r.length;n++){var s=r[n],a=this._getAttibutionOfNode(s,["cost","price","walkingDistance","transferTimes"]),l=o.write(r[n]),u=this._parserFeatures(l);u.attributes=a;for(var h=s.selectNodes("featureMember"),c=0;c<h.length;c++){var g=h[c].selectNodes("Road");u[c].isOnFoot=g[0].getAttribute("isOnFoot")}i.push(u)}t(i)},failure:i})},_getAttibutionOfNode:function(e,t){var i={};if(e.tagName)for(var r=0;r<t.length;r++)i[t[r]]=e.getAttribute(t[r]);return i},_getGeometryType:function(e){return"polygon"},_pagingToString:function(e,t){return"<numPerPage>"+(t=t||this.maxPerPage)+"</numPerPage><curPage>"+(e=e||1)+"</curPage>"},_orderByToString:function(e,t){return e?"<orderBy><PropertyName>"+e+"</PropertyName></orderBy>":""},_geometryToString:function(e){return'<geometry><Polygon><outerBoundaryIs><LinearRing><coordinates decimal="." cs="," ts=" ">20,30 21,41 52,42 53,33 20,30</coordinates></LinearRing></outerBoundaryIs></Polygon></geometry>'},_stringToGeometry:function(e){return GeoGlobe.Geometry.Polygon.createRegularPolygon(new GeoGlobe.Geometry.Point(360*Math.random()-160,90*Math.random()-70),Math.round(20*Math.random()),Math.round(10*Math.random()))},_parserFeatures:function(e){var t=new GeoGlobe.Format.GML;return t.gmlns="*",t.read(e)},_parserResponseText:function(e,t){if(t){var i=new RegExp("<"+t+">",["g"]),r=new RegExp("</"+t+">",["g"]);e=(e=e.replace(i,"<featureMember><"+t+">")).replace(r,"</"+t+"></featureMember>")}return(e=(e=(e=e.replace(/<gml:LineString>/g,"<gml:LineString><gml:coordinates>")).replace(/<\/gml:LineString>/g,"</gml:coordinates></gml:LineString>")).replace(/<gml:Point>/g,"<gml:Point><gml:coordinates>")).replace(/<\/gml:Point>/g,"</gml:coordinates></gml:Point>")},_parserFeaturesNew:function(e,t){var i=new GeoGlobe.Format.GML;return i.gmlns="*",t&&(i.featureName=t),i.read(e)},_parserSuccessResult:function(e){return(new GeoGlobe.Util.Format.XML2JSON).read(e)},_parseToXML:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),(new GeoGlobe.Format.XML).read(t)},_parseToJSON:function(e){return(new GeoGlobe.Format.XML2JSON).read(e)},queryTransferScheme:function(e,t,i){var r={request:"QueryTransferScheme",SERVICE:"BUS",VERSION:"1.0.0"};for(var o in{networkName:!0,transferMode:!0,startInput:!0,endInput:!0})if(!(o in e))throw new Error("缺少必选属性：'"+o+"'。");r.networkName=e.networkName,null!==e.service&&void 0!==e.service&&(r.SERVICE=e.service),null!==e.version&&void 0!==e.version&&(r.VERSION=e.version),null!==e.transferMode&&void 0!==e.transferMode&&(r.TRANSFERMODE=e.transferMode),null!==e.startInput&&void 0!==e.startInput&&(r.STARTINPUT=e.startInput),null!==e.endInput&&void 0!==e.endInput&&(r.ENDINPUT=e.endInput),null!==e.inputMode&&void 0!==e.inputMode&&(r.INPUTMODEL=e.inputMode),null!==e.ExistGoTime&&void 0!==e.ExistGoTime&&(r.EXISTGOTIME=e.ExistGoTime),null!==e.StartTime&&void 0!==e.StartTime&&(r.STARTTIME=e.StartTime),null!==e.MaxSearchDistance&&void 0!==e.MaxSearchDistance&&(r.MAXSEARCHDISTANCE=e.MaxSearchDistance),null!==e.PrioritySubset&&void 0!==e.PrioritySubset&&(r.PRIORITYSUBSET=e.PrioritySubset),null!==e.ExistAbsolutePriority&&void 0!==e.ExistAbsolutePriority&&(r.EXISTABSOLUTEPRIORITY=e.ExistAbsolutePriority),null!==e.LagSubset&&void 0!==e.LagSubset&&(r.LAGSUBSET=e.LagSubset),null!==e.OutputPage&&void 0!==e.OutputPage&&(r.OUTPUTPAGE=e.OutputPage),null!==e.PageSize&&void 0!==e.PageSize&&(r.PAGESIZE=e.PageSize),null!==e.ChangeCount&&void 0!==e.ChangeCount&&(r.CHANGECOUNT=e.ChangeCount),GeoGlobe.Request.GET({url:this.url,params:r,async:!1,scope:this,success:GeoGlobe.Function.bind((function(e){var i=e.responseXML,r={startPoint:[],transferScheme:[],endPoint:[]};if(!i)return t(r),r;var o=new GeoGlobe.Format.XML,n=i.selectNodes("/ServiceExceptionReport/ServiceExceptionMessage");if(n&&n.length>0)return t(r),r;var s=i.selectNodes("/QueryTransferSchemeResponse"),a=o.write(s[0]),l=this._parseToJSON(a),u=l.QueryTransferSchemeResponse.StartPoint;GeoGlobe.Util.isArray(u)||(u=[u]);var h=l.QueryTransferSchemeResponse.EndPoint;GeoGlobe.Util.isArray(h)||(h=[h]);var c=l.QueryTransferSchemeResponse.TransferScheme,g=this._getPointGeometryByGMLPointStr(u[0].Geometry.gml_Point),p=new GeoGlobe.Feature(g),f=this._getPointGeometryByGMLPointStr(h[0].Geometry.gml_Point),d=new GeoGlobe.Feature(f),m=this._parserTransferScheme(c);t(r={startPoint:p,transferScheme:m,endPoint:d})}),this),failure:i})},_parserTransferScheme:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);for(var t=new Array,i=0;i<e.length;i++){var r=e[i],o=this._parserSectionInfo(r.SectionInfo),n=this._parserSectionRouting(r.SectionRouting),s={Cost:e[i].Cost,SectionInfo:o,SectionRouting:n,TotalDistance:e[i].TotalDistance,TransferCount:e[i].TransferCount};t.push(s)}return t},_parserSectionInfo:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);for(var t=new Array,i=0;i<e.length;i++){var r=this._getPointFeatureByObj(e[i].FromStation);e[i].FromStation.PassagewayRouting&&((o=this._getPointFeatureByObj(e[i].FromStation.PassagewayRouting)).SectionRouting&&(o.attributes.SectionRouting=o.data.SectionRouting=this._parserSectionRouting(o.SectionRouting)),r.attributes.PassagewayRouting=r.data.PassagewayRouting=o);var o,n=this._getPointFeatureByObj(e[i].ToStation);e[i].ToStation.PassagewayRouting&&((o=this._getPointFeatureByObj(e[i].ToStation.PassagewayRouting)).SectionRouting&&(o.attributes.SectionRouting=o.data.SectionRouting=this._parserSectionRouting(o.SectionRouting)),n.attributes.PassagewayRouting=n.data.PassagewayRouting=o);var s=this._parserSectionLines(e[i].SectionLines.SectionLine),a=this._parserSectionRouting(e[i].SectionRouting);t.push({FromStation:r,SectionLine:s,ToStation:n,SectionRouting:a})}return t},_parserSectionLines:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);for(var t=new Array,i=0;i<e.length;i++){var r=new GeoGlobe.Feature(null,e[i]);t.push(r)}return t},_parserSectionRouting:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);for(var t=new Array,i=0;i<e.length;i++)t.push(e[i]);return t},_getPointGeometryByGMLPointStr:function(e){var t=e.split(",");return new GeoGlobe.Geometry.Point(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(t[0]),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_12___default()(t[1]))},_getPointFeatureByObj:function(e){var t=null;return e.Geometry&&e.Geometry.gml_Point&&(t=this._getPointGeometryByGMLPointStr(e.Geometry.gml_Point)),new GeoGlobe.Feature(t,e)},_getLineGeometryByGMLLineStr:function(e){if(!e)return null;for(var t=e.split(" "),i=[],r=0,o=t.length;r<o;r++){var n=this._getPointGeometryByGMLPointStr(t[r]);i.push(n)}return new GeoGlobe.Geometry.LineString(i)},queryTransferGeometry:function(e,t,i){var r={request:"QueryTransferGeometry",SERVICE:"BUS",VERSION:"1.0.0"};if(!e.networkName)throw"Error!Not network name for bus query.";if(null===e.parameterInfo||void 0===e.parameterInfo||""===e.parameterInfo)throw"Error!Not parameterInfo for bus query.";r.networkName=e.networkName,r.PARAMETERINFO="";for(var o=0;o<e.parameterInfo.length;o++)r.PARAMETERINFO+=e.parameterInfo[o].toString(),o!=e.parameterInfo.length-1&&(r.PARAMETERINFO+="_");null!==e.service&&void 0!==e.service&&(r.SERVICE=e.service),null!==e.version&&void 0!==e.version&&(r.VERSION=e.version),GeoGlobe.Request.GET({url:this.url,params:r,scope:this,async:!1,success:GeoGlobe.Function.bind((function(e){var i=this._parseQueryTransferGeometryResult(e);t(i)}),this),failure:i})},_parseQueryTransferGeometryResult:function(e){resXML=e.responseXML;var t=[];if(!resXML)return t;var i=new GeoGlobe.Format.XML,r=resXML.selectNodes("/QueryTransferGeometryResponse");if(r&&r.length<=0)return t;var o=i.write(r[0]),n=this._parseToJSON(o).QueryTransferGeometryResponse.SectionGeometry;if(n){GeoGlobe.Util.isArray(n)||(n=[n]);for(var s=0;s<n.length;s++){var a=this._getLineGeometryByGMLLineStr(n[s].Geometry.gml_LineString),l=new GeoGlobe.Feature(a,{ID:n[s].ID});t.push(l)}}return t},queryKeyWord:function(e,t,i){var r={REQUEST:"QueryKeyWord",SERVICE:"BUS",VERSION:"1.0.0",SEARCHTYPE:2};if(!e.networkName)throw"Error!Not network name for bus query.";if(null===e.keyWord||void 0===e.keyWord||""===e.keyWord)throw"Error!Not keyWord for bus query.";r.NETWORKNAME=e.networkName,r.KEYWORD=e.keyWord,null!==e.service&&void 0!==e.service&&(r.SERVICE=e.service),null!==e.version&&void 0!==e.version&&(r.VERSION=e.version),null!==e.searchType&&void 0!==e.searchType&&(r.SEARCHTYPE=e.searchType),null!==e.keyWordType&&void 0!==e.keyWordType&&(r.KEYWORDTYPE=e.keyWordType),GeoGlobe.Request.GET({url:this.url,params:r,async:!1,scope:this,success:GeoGlobe.Function.bind((function(i){var r=this._parserQueryKeyWordResult(i,e.keyWordType);t(r)}),this),failure:i})},_parserQueryKeyWordResult:function(e,t){var i=e.responseXML,r=[];if(!i)return r;var o=new GeoGlobe.Format.XML,n=i.selectNodes("/ServiceExceptionReport/ServiceExceptionMessage");if(n&&n.length>0)return r;var s=i.selectNodes("/QueryKeyWordResponse"),a=o.write(s[0]),l=this._parseToJSON(a);if(1===t){var u=l.QueryKeyWordResponse.Stations.Station;u&&!GeoGlobe.Util.isArray(u)&&(u=[u]);for(var h=0;h<u.length;h++){var c=this._getPointFeatureByObj(u[h]);r.push(c)}}else if(2===t){var g=l.QueryKeyWordResponse.Passageways.Passageway;for(g&&!GeoGlobe.Util.isArray(g)&&(g=[g]),h=0;h<g.length;h++)c=this._getPointFeatureByObj(g[h]),r.push(c)}else{var p=l.QueryKeyWordResponse.Lines.Line;for(p&&!GeoGlobe.Util.isArray(p)&&(p=[p]),h=0;h<p.length;h++){var f=new GeoGlobe.Feature(null,p[h]);r.push(f)}}return r},queryStationInfo:function(e,t,i){var r={REQUEST:"QueryStationInfo",SERVICE:"BUS",VERSION:"1.0.0"};if(!e.networkName)throw"Error!Not network name for bus query.";if(null===e.stationId||void 0===e.stationId||""===e.stationId)throw"Error!Not stationId for bus query.";r.NETWORKNAME=e.networkName,null!==e.service&&void 0!==e.service&&(r.SERVICE=e.service),null!==e.version&&void 0!==e.version&&(r.VERSION=e.version),null!==e.stationId&&void 0!==e.stationId&&(r.STATIONID=e.stationId),GeoGlobe.Request.GET({url:this.url,params:r,scope:this,success:function(e){if(resXML=e.responseXML,resXML){for(var i=new GeoGlobe.Format.XML,r=this._parserQueryStationInfoNode("Lines",i,resXML),o=this._parserQueryStationInfoNode("Passageways",i,resXML),n=new Array,s=0;s<o.length;s++){var a=this._getPointFeatureByObj(o[s]);n.push(a)}t({lines:r,passageways:n})}else t({lines:[],passageways:[]})},failure:i})},_parserQueryStationInfoNode:function(e,t,i){switch(e){case"Lines":var r=i.selectNodes("/QueryStationInfoResponse/StationInfo/Lines"),o=new Array;if(r.length>0){var n=t.write(r[0]);o=this._parseToJSON(n).Lines.Line,GeoGlobe.Util.isArray(o)||(o=[o])}return o;case"Passageways":r=i.selectNodes("/QueryStationInfoResponse");var s=new Array;if(r.length>0){n=t.write(r[0]);var a=this._parseToJSON(n).QueryStationInfoResponse.StationInfo.Passageways;a&&(s=a.Passageway,GeoGlobe.Util.isArray(s)||(s=[s]))}return s;default:return[]}},queryLineInfo:function(e,t,i){var r={REQUEST:"QueryLineInfo",SERVICE:"BUS",VERSION:"1.0.0"};if(!e.networkName)throw"Error!Not network name for bus query.";if(null===e.lineId||void 0===e.lineId||""===e.lineId)throw"Error!Not lineId for bus query.";r.NETWORKNAME=e.networkName,null!==e.service&&void 0!==e.service&&(r.SERVICE=e.service),null!==e.version&&void 0!==e.version&&(r.VERSION=e.version),null!==e.lineId&&void 0!==e.lineId&&(r.LINEID=e.lineId),null!==e.startNodeNumber&&void 0!==e.startNodeNumber&&(r.STARTNODENUMBER=e.startNodeNumber),null!==e.endNodeNumber&&void 0!==e.endNodeNumber&&(r.ENDNODENUMBER=e.endNodeNumber),GeoGlobe.Request.GET({url:this.url,params:r,scope:this,success:function(e){var i=[],r=null;if(e.responseXML){var o=(r=e.responseXML).selectNodes("/ServiceExceptionReport/ServiceExceptionMessage");if(o&&o.length>0)return void t(i);for(var n=new GeoGlobe.Format.XML,s=this._parserQueryLineInfoNode("Line",n,r),a=new Array,l=0;l<s.length;l++){for(var u=new Array,h=0;h<s[l].VIAStations.Station.length;h++){var c=this._getPointFeatureByObj(s[l].VIAStations.Station[h]);u.push(c)}s[l].Stations=u;var g=this._getLineGeometryByGMLLineStr(s[l].Geometry.gml_LineString),p=new GeoGlobe.Feature(g,s[l]);a.push(p)}i=a}t(i)},failure:i})},_parserQueryLineInfoNode:function(e,t,i){switch(e){case"Line":var r=i.selectNodes("/QueryLineInfoResponse"),o=t.write(r[0]),n=this._parseToJSON(o).QueryLineInfoResponse.Line;return new Array,n&&!GeoGlobe.Util.isArray(n)?[n]:n;default:return[]}},queryPassagewayInfo:function(e,t,i){var r={REQUEST:"QueryPassagewayInfo",SERVICE:"BUS",VERSION:"1.0.0"};if(!e.networkName)throw"Error!Not network name for bus query.";if(null===e.passagewayId||void 0===e.passagewayId||""===e.passagewayId)throw"Error!Not passagewayId for bus query.";r.NETWORKNAME=e.networkName,null!==e.service&&void 0!==e.service&&(r.SERVICE=e.service),null!==e.version&&void 0!==e.version&&(r.VERSION=e.version),null!==e.passagewayId&&void 0!==e.passagewayId&&(r.PASSAGEWAYID=e.passagewayId),GeoGlobe.Request.GET({url:this.url,params:r,scope:this,success:function(e){var i=e.responseXML,r=[];if(!i)return t(r),r;new GeoGlobe.Format.XML;var o=i.selectNodes("/ServiceExceptionReport/ServiceExceptionMessage");if(o&&o.length>0)return t(r),r;var n=this._parserResponseText(e.responseText);r=this._parserFeaturesNew(n,"Stations"),t(r)}})},_queryByName:function(e,t,i){var r=this,o=null;return r.queryKeyWord({networkName:r.networkName,keyWord:e,keyWordType:1,SEARCHTYPE:2},(function(e){if(0!=e.length){var n=e[0].geometry.x+" "+e[0].geometry.y;r.queryKeyWord({networkName:r.networkName,keyWord:t,keyWordType:1,SEARCHTYPE:2},(function(e){if(0!=e.length){var t=e[0].geometry.x+" "+e[0].geometry.y;o=r._queryTransferScheme(n,t,i)}else alert("没有查询到终点")}))}else alert("没有查询到起点")})),o},queryBus:function(e,t,i){var r=this,o=null;return r.getCapabilities(GeoGlobe.Function.bind((function(n){var s=n.responseXML;s&&s.documentElement||(s=n.responseText);var a=(new GeoGlobe.Format.BusCapabilities).read(s);if(a.capability){var l=a.capability.networks[0];if(r.networkName=l,"string"==typeof e&&"string"==typeof t)o=r._queryByName(e,t,i);else{var u=e.lng+" "+e.lat,h=t.lng+" "+t.lat;o=r._queryTransferScheme(u,h,i)}}else alert("公交服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+url+"\n操作类型：GetCapabilities")}),this),(function(){alert("公交服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+url+"\n操作类型：GetCapabilities")})),{flag:!!o,featuresInfo:o}},failFn:function(){alert("公交服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+url+"\n操作类型：GetCapabilities")},_queryTransferScheme:function(e,t,i){return this.queryTransferScheme({networkName:this.networkName,transferMode:i||0,inputMode:0,startInput:e,endInput:t},(function(e){featuresInfo=e})),this.transferScheme=featuresInfo.transferScheme,featuresInfo},queryBusTransferSchemeByIndex:function(e){var t=null,r=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e),o=this.transferScheme[r].SectionInfo,n=new Array,s=new Array;for(i=0;i<o.length;i++){var a=o[i].SectionLine[0],l=a.data.ID,u=a.data.FromOrdinal,h=a.data.ToOrdinal;n.push([0,l,u,h]),s.push(o[i].FromStation),s.push(o[i].ToStation)}return this.queryTransferGeometry({networkName:this.networkName,parameterInfo:n},(function(e){var i=e,r=new GeoGlobe.Format.GeoJSON,o=r.write(i),n=r.write(s),a=new GeoGlobe.Format.JSON,l=a.read(o),u=a.read(n);t={lineFeatures:i,geojsonRoute:l,stationFeatures:s,geojsonStation:u}})),t},CLASS_NAME:"GeoGlobe.Query.BusQuery"}),document.implementation.hasFeature("XPath","3.0")&&(XMLDocument.prototype.selectNodes=function(e,t){t||(t=this);for(var i=this.evaluate(e,t,(function(e){return{csw:"http://www.opengis.net/cat/csw",smmd:"http://data.sbsm.gov.cn/smmd/2007",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",geoglobe:"http://www.geostar.com.cn/geoglobe"}[e]||null}),XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),r=[],o=0;o<i.snapshotLength;o++)r[o]=i.snapshotItem(o);return r},Element.prototype.selectNodes=function(e){if(this.ownerDocument.selectNodes)return this.ownerDocument.selectNodes(e,this);throw"For XML Elements Only"}),document.implementation.hasFeature("XPath","3.0")&&(XMLDocument.prototype.selectSingleNode=function(e,t){t||(t=this);var i=this.selectNodes(e,t);return i.length>0?i[0]:null},Element.prototype.selectSingleNode=function(e){if(this.ownerDocument.selectSingleNode)return this.ownerDocument.selectSingleNode(e,this);throw"For XML Elements Only"}),GeoGlobe.Query.WFSQuery=GeoGlobe.Class4OL({url:null,version:"1.0.0",featureNS:null,isReverse:!1,featurePrefix:"",featureType:"",maxFeatures:10,filter:null,geometryName:"the_geom",protocol:null,format:null,formatOptions:null,isSeparate:!1,srsName:"EPSG:4326",time:null,userecent:!0,sortBy:null,groupBy:null,resultType:"Results",startPosition:null,initialize:function(e,t,i){this.url=e,this.featureType=t;var r=null;i&&(!0===i.isReverse||!1===i.isReverse?(this.isReverse=i.isReverse,r=!i.isReverse):r=!this.isReverse,i.format?(i.format instanceof GeoGlobe.Format.GML.v2||i.format instanceof GeoGlobe.Format.GML.v3)&&i.format.setFeatureType_(t):this.format=new GeoGlobe.Format.GML({xy:r})),GeoGlobe.Util.extend(this,i)},query:function(e,t,i){this.protocol=new GeoGlobe.Protocol.WFS({readFormat:this.format,formatOptions:this.formatOptions,propertyNames:this.propertyNames,maxFeatures:this.maxFeatures,featurePrefix:this.featurePrefix,featureNS:this.featureNS,url:this.url,version:this.version,geometryName:this.geometryName,featureType:this.featureType,time:this.time,userecent:this.userecent,srsName:this.srsName});var r=e||this.filter,o=t||this.successFn,n=i||this.failFn,s=GeoGlobe.Function.bind((function(e){if(e.success()){var t=e.features;this.isSeparate&&(t=this._separateFeatures(t));var i=this._read_trueName(e);i&&(t.trueNames=i);var r=(new GeoGlobe.Format.GeoJSON).write(t),s=(new GeoGlobe.Format.JSON).read(r);o({features:t,geojson:s})}else n()}),this);this.response=this.protocol.read({sortBy:this.sortBy,filter:r,callback:s})},queryPage:function(e,t,i,r){var o=r&&r.perPageNumber||15,n=((r&&r.pageNumber||1)-1)*o+1;this.protocol=new GeoGlobe.Protocol.WFS({readFormat:this.format,multi:!0,formatOptions:this.formatOptions,propertyNames:this.propertyNames,maxFeatures:o,startPosition:n,featurePrefix:this.featurePrefix,url:this.url,featureNS:this.featureNS,version:this.version,geometryName:this.geometryName,featureType:this.featureType,time:this.time,userecent:this.userecent,srsName:this.srsName});var s=e||this.filter,a=t||this.successFn,l=i||this.failFn,u=GeoGlobe.Function.bind((function(e){if(e.success()){var t=e.features;this.isSeparate&&(t=this._separateFeatures(t));var i=this._read_trueName(e);t.trueNames=i;var r=(new GeoGlobe.Format.GeoJSON).write(t),o=(new GeoGlobe.Format.JSON).read(r);a({features:t,geojson:o})}else l()}),this);this.response=this.protocol.read({sortBy:this.sortBy,filter:s,callback:u})},queryTotalNumber:function(e,t,i){var r=new GeoGlobe.Format.WFSHits;this.protocol=new GeoGlobe.Protocol.WFS({readFormat:r,propertyNames:this.propertyNames,resultType:"hits",maxFeatures:this.maxFeatures,featurePrefix:this.featurePrefix,featureNS:this.featureNS,url:this.url,version:this.version,geometryName:this.geometryName,featureType:this.featureType,time:this.time,userecent:this.userecent});var o=e||this.filter,n=t||this.successFn,s=i||this.failFn,a=GeoGlobe.Function.bind((function(e){if(e.success()){var t=e.features;n(t)}else s()}),this);this.response=this.protocol.read({filter:o,callback:a})},_read_trueName:function(e){var t=[];if(e.priv&&e.priv.responseText){if(null==this.format)return null;var i=this.format.getXMLDoc().getElementsByTagName("trueName");if(null==i||0==i.length)return null;for(var r=0;r<i.length;r++)t.push(i[r].text);return t}return t},getBufferRegion:function(e,t,i){var r=this._getFeaturesCenter(e);switch(i){case"km":t*=1e3;case"m":t=this._meterToDegree(t,r)}return GeoGlobe.Geometry.Polygon.createRegularPolygon(e.geometry,t,40,360)},_getFeaturesCenter:function(e){return this._getFeaturesExtent(e).getCenterLonLat()},_getFeaturesExtent:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);var t=null;if(e&&e.length>0){t=new GeoGlobe.LngLatBounds;for(var i=null,r=0,o=e.length;r<o;r++)(i=e[r].geometry)&&t.extend(i.getBounds())}return t},_meterToDegree:function(e,t){var i=t.lat;return e*(899e-8/Math.cos(GeoGlobe.Util.rad(i)))},pointQuery:function(e,t,i,r,o){t=t||0,i=i||"degree";var n=new GeoGlobe.Filter.Spatial({type:GeoGlobe.Filter.Spatial.DWITHIN,property:this.geometryName,distance:t,distanceUnits:i,value:e});this.query(n,r,o)},pathQuery:function(e,t,i,r,o){t=t||0,i=i||"degree";var n=new GeoGlobe.Filter.Spatial({type:GeoGlobe.Filter.Spatial.DWITHIN,property:this.geometryName,distance:t,distanceUnits:i,value:e});this.query(n,r,o)},polygonQuery:function(e,t,i,r){var o=t?GeoGlobe.Filter.Spatial.CONTAINS:GeoGlobe.Filter.Spatial.INTERSECTS,n=new GeoGlobe.Filter.Spatial({type:o,property:this.geometryName,value:e});this.query(n,i,r)},bboxQuery:function(e,t,i){var r=new GeoGlobe.Filter.Spatial({type:GeoGlobe.Filter.Spatial.BBOX,property:this.geometryName,value:e});this.query(r,t,i)},attributeQuery:function(e,t,i,r,o,n){var s=r&&r.matchCase,a=r?r.lowerBoundary:null,l=r?r.upperBoundary:null,u=new GeoGlobe.Filter.Comparison({type:e,property:t,value:i,matchCase:s,lowerBoundary:a,upperBoundary:l});this.query(u,o,n)},statisticsQuery:function(e,t,i){this.protocol=new GeoGlobe.Protocol.WFS({readFormat:this.format,formatOptions:this.formatOptions,propertyNames:this.propertyNames,resultType:"statistics",maxFeatures:this.maxFeatures,featurePrefix:this.featurePrefix,featureNS:this.featureNS,url:this.url,version:this.version,geometryName:this.geometryName,featureType:this.featureType,time:this.time,userecent:this.userecent});var r=e||this.filter,o=t||this.successFn,n=i||this.failFn,s=GeoGlobe.Function.bind((function(e){if(e.success()){try{var t=e.priv.responseXML,i=this._analysis_StatisticsResult(t)}catch(t){return void o(e.priv.responseText)}o(i)}else n()}),this);this.response=this.protocol.read({sortBy:this.sortBy,groupBy:this.groupBy,filter:r,callback:s})},_analysis_StatisticsResult:function(e){var t={},i=e.documentElement.firstChild.childNodes;return 0<i.length&&(t.layers=this._analysis_StatisticsResult_results(i)),t},_analysis_StatisticsResult_results:function(e){for(var t=[],i=0;i<e.length;i++){for(var r={},o=[],n=e[i].childNodes,s=0;s<n.length;s++){var a={};a.layerName=n[s].parentNode.nodeName,"Microsoft Internet Explorer"==navigator.appName?a.result=this._analysis_StatisticsResult_results_result_IE(n[s]):a.result=this._analysis_StatisticsResult_results_result_google(n[s]),o.push(a)}r.results=o,t.push(r)}return t},_analysis_StatisticsResult_results_result_IE:function(e){var t={},i=0;"Key"==e.childNodes[0].nodeName&&(t.Key=e.childNodes[0].text,i=1);for(var r=[],o=[];i<e.childNodes.length;i++){var n={},s={};n.name=e.childNodes[i].getAttribute("name"),s.Value=e.childNodes[i].text,r.push(n),o.push(s)}return t.name=r,t.values=o,t},_analysis_StatisticsResult_results_result_google:function(e){var t={},i=0;"Key"==e.childNodes[0].nodeName&&(t.Key=e.childNodes[0].innerHTML,i=1);for(var r=[],o=[];i<e.childNodes.length;i++){var n={},s={};n.name=e.childNodes[i].getAttribute("name"),s.Value=e.childNodes[i].innerHTML,r.push(n),o.push(s)}return t.name=r,t.values=o,t},successFn:function(e){},failFn:function(){alert("对不起,查询失败,请查询服务是否正常。")},_separateFeatures:function(e){for(var t={},i=0;i<e.length;i++){var r,o=e[i];t[r=o.gml?o.gml.featureType:o.type]||(t[r]=[]),t[r].push(o)}return t},setTime:function(e){this.time=e},setUserecent:function(e){this.userecent=e},CLASS_NAME:"GeoGlobe.Query.WFSQuery"}),GeoGlobe.Query.WFSQuery.reverseGeometryXY=function(e){var t={Point:function(e,t){var i=e.x,r=e.y,o=e.clone(e);return o.x=r,o.y=i,o},LineString:function(e,t){for(var i=e.clone(e),r=0;r<i.components.length;r++){var o=t.Point(i.components[r]);i.components[r]=o}return i},Polygon:function(e,t){for(var i=e.clone(e),r=0;r<i.components.length;r++)for(var o=0;o<i.components[r].components.length-1;o++){var n=t.Point(i.components[r].components[o]);i.components[r].components[o]=n}return i}};return t[{"GeoGlobe.Geometry.Point":"Point","GeoGlobe.Geometry.MultiPoint":"MultiPoint","GeoGlobe.Geometry.LineString":"LineString","GeoGlobe.Geometry.MultiLineString":"MultiLineString","GeoGlobe.Geometry.Polygon":"Polygon","GeoGlobe.Geometry.MultiPolygon":"MultiPolygon","GeoGlobe.Geometry.Collection":"GeometryCollection"}[e.CLASS_NAME]](e,t)},GeoGlobe.Format.WFSHits=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{wfsns:"http://www.opengis.net/wfs",featureCollection:"FeatureCollection",read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e]));var t=e.documentElement;return{numberOfFeatures:_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(t.getAttribute("numberOfFeatures"))}}}),GeoGlobe.Query.GeoCodingQuery=function(e,t){t=GeoGlobe.Util.applyDefaults(t,GeoGlobe.Query.GeoCodingQuery.DEFAULTS);var i=GeoGlobe.Query.GeoCodingQuery["v"+t.version.replace(/\./g,"_")];if(!i)throw"不支持的地址匹配服务版本: "+t.version;return new i(e,t)},GeoGlobe.Query.GeoCodingQuery.DEFAULTS={version:"1.0.0"},GeoGlobe.Query.GeoCodingQuery.v1=GeoGlobe.Class4OL({version:"1.0.0",url:null,initialize:function(e,t){this.url=e,GeoGlobe.Util.extend(this,t),this.format=new GeoGlobe.Format.JSON},getCommonParams:function(e){var t={request:"GetCategory",service:"GeoCoding",version:this.version,output:"json"};return GeoGlobe.Util.extend(t,e),t},getCategoryByName:function(e,t,i){var r=this.getCommonParams();"string"==typeof e&&0!==e.length&&(r.categoryName=e),i=i||this.failFn,GeoGlobe.Function.bind(this._requestCategory,this)(r,t,i)},getCategoryByCode:function(e,t,i){var r=this.getCommonParams();"number"==typeof e&&(r.categoryCode=e),GeoGlobe.Function.bind(this._requestCategory,this)(r,t,i)},getAllCategory:function(e,t){var i=this.getCommonParams();GeoGlobe.Function.bind(this._requestCategory,this)(i,e,t)},_requestCategory:function(e,t,i){i=i||this.failFn,GeoGlobe.loadURL(this.url,e,this,(function(e){try{var i=this.format.read(e.responseText)}catch(i){return void t(e.responseText)}t(i)}),i)},_analysis_GeoCodeResult:function(e){var t={status:e.status};switch(e.status){case"OK":(i=e.results)&&(t.results=this._analysis_GeoCodeResult_results(i));break;case"INVALID_REQUEST":case"NO_RESULTS":case"UNKNOWN_ERROR":break;default:var i;t={requestKeyWord:e.requestKeyWord,count:e.count,statisticsLevel:e.statisticsLevel,statisticsLevelName:e.statisticsLevelName},e&&e.count>0&&(i=e.results)&&(t.results=this._analysis_GeoCodeResult_statistics(i))}return t},_analysis_GeoCodeResult_results:function(e){var t=[];if(GeoGlobe.Util.isArray(e)){for(var i=0,r=e.length;i<r;i++){var o={};o.requestKeyWord=e[i].requestKeyWord,e[i].errorCorrectionTips&&(o.errorCorrectionTips=e[i].errorCorrectionTips),o.count=e[i].count,e[i].result&&(o.result=this._analysis_GeoCodeResult_results_result(e[i].result)),t.push(o)}return t}},_analysis_GeoCodeResult_statistics:function(e){var t=[];if(GeoGlobe.Util.isArray(e)){for(var i=0,r=e.length;i<r;i++){var o={};e[i].errorCorrectionTips&&(o.errorCorrectionTips=e[i].errorCorrectionTips),e[i]&&(o.name=e[i].name,o.value=e[i].value,o.remark=e[i].remark),t.push(o)}return t}},_analysis_GeoCodeResult_results_result:function(e){for(var t=[],i=0,r=e.length;i<r;i++){var o={},n={};o.resultType=e[i].resultType,o.precise=e[i].precise,o.isBrief=e[i].isBrief,o.score=e[i].score,e[i].addressComponent.street&&(n=e[i].addressComponent.street),0==o.isBrief&&(o.addressComponent=this._analysis_GeoCodeResult_results_result_address(e[i].addressComponent,o.resultType)),o.poiArray=this._analysispoiArray(e[i].poiArray),e[i].location&&(o.location=e[i].location),0==o.precise&&(o.referenceAddressArray=e[i].referenceAddressArray),n&&(o.street_path=n),t.push(o)}return t},_analysis_GeoCodeResult_results_result_address:function(e,t){var i={country:e.country};if(e.province&&(i.province=e.province),e.city&&(i.city=e.city),e.district&&(i.district=e.district),e.town&&(i.town=e.town),e.street&&(i.street={name:e.street.name},"street"===t&&e.street.geometry)){var r=this.format.read(e.street.geometry),o=null;(r.paths||r.rings||r.x&&r.y)&&(o=this._getGeometry(r),i.street.geometry=o)}if(e.streetNumber&&(i.streetNumber=e.streetNumber),e.buildingNumber&&(i.buildingNumber=e.buildingNumber),"adminArea"===t){if(e.geometry){var n=this.format.read(e.geometry),s=null;n.rings||n.paths?(s=this._getGeometry(n),i.geometry=s):"number"==typeof n.x&&"number"==typeof n.y&&(i.geometry=this._getGeometry(n))}e.subordinate&&(i.subordinate=e.subordinate),e.zipCode&&(i.zipCode=e.zipCode),e.callingCode&&(i.callingCode=e.callingCode)}return i},_analysispoiArray:function(e){for(var t=[],i=0,r=e.length;i<r;i++){var o={};for(var n in e[i])o[n]=e[i][n];if(""!=o.geometry&&null!=o.geometry){var s=this.format.read(o.geometry);o.geometry=this._getGeometry(s)}t.push(o)}return t},_analysisLocation:function(e){},_getGeometry:function(e){for(var t in e){if("spatialReference"==t)return;return e=e.hasOwnProperty("x")&&e.hasOwnProperty("y")?new GeoGlobe.Geometry.Point(e.x,e.y):e.hasOwnProperty("xmin")&&e.hasOwnProperty("ymin")&&e.hasOwnProperty("xmax")&&e.hasOwnProperty("ymax")?new GeoGlobe.Bounds(e.xmin,e.ymin,e.xmax,e.ymax).toGeometry():this._geometryType[t](e[t])}},_geometryType:{points:function(e){var t=[];if(GeoGlobe.Util.isArray(e))for(var i=0,r=e.length;i<r;i++){var o=new GeoGlobe.Geometry.Point(e[i][0],e[i][1]);t.push(o)}return t},paths:function(e){var t=[];if(GeoGlobe.Util.isArray(e)){for(var i=0,r=e.length;i<r;i++){for(var o=[],n=0,s=e[i].length;n<s;n++)o.push(new GeoGlobe.Geometry.Point(e[i][n][0],e[i][n][1]));var a=new GeoGlobe.Geometry.LineString(o);t.push(a)}var l=new GeoGlobe.Geometry.MultiLineString(t)}return l},rings:function(e){var t=[];if(GeoGlobe.Util.isArray(e)){for(var i=0,r=e.length;i<r;i++){for(var o=[],n=0,s=e[i].length;n<s;n++)o.push(new GeoGlobe.Geometry.Point(e[i][n][0],e[i][n][1]));var a=new GeoGlobe.Geometry.LinearRing(o);t.push(a)}var l=new GeoGlobe.Geometry.Polygon(t)}return l}},failFn:function(e){"string"==typeof e&&alert(e),alert("对不起，查询请求失败！请检查地址匹配服务是否正常运行。\n当前服务地址为："+this.url)},CLASS_NAME:"GeoGlobe.Query.GeoCodingQuery.v1"}),GeoGlobe.Query.GeoCodingQuery.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Query.GeoCodingQuery.v1,{addressesToLocations:function(e,t,i){var r=this.getCommonParams({request:"GeoCoder"});if("string"==typeof e.address)r.address=e.address;else if(GeoGlobe.Util.isArray(e.address)){for(var o="",n=0;n<e.address.length;n++)o+=e.address[n]+",";o=o.substr(0,o.length-1),r.address=o}else if(null==e.address||null==e.address)throw"address是必选参数！";if("number"==typeof e.categoryCode&&(r.categoryCode=e.categoryCode),e.extent instanceof GeoGlobe.LngLatBounds)r.bbox=e.extent.toBBOX(null,!0);else if(e.extent instanceof GeoGlobe.Geometry.Polygon){for(var s=e.extent,a=[],l=(n=0,s.components.length);n<l;n++)for(var u=s.components[n].components,h=0;h<u.length;h++)a.push(u[h].toShortString());r.bbox=a.join(",")}"boolean"==typeof e.fuzzyMatch&&(r.fuzzyMatch=e.fuzzyMatch),"string"==typeof e.resultType&&(r.resultType=e.resultType),"number"==typeof e.maxCount&&(r.maxCount=e.maxCount),"number"==typeof e.startPosition&&(r.startPosition=e.startPosition),GeoGlobe.loadURL(this.url,r,this,(function(e){try{var i=this.format.read(e.responseText);if("result"==r.resultType)var o=this._parseQueryResultToFeature(i);else o=this._analysis_GeoCodeResult(i)}catch(i){return void t(e.responseText)}t(o)}),this.failFn)},locationToAddresses:function(e,t,i){var r=this.getCommonParams({request:"GeoCoder"});if(!e.lonlat)throw"address是必选参数！请填写正确的数据类型！";r.latlng=e.lonlat.lat+","+e.lonlat.lng,"number"==typeof e.tolerance&&(r.tolerance=e.tolerance),"string"==typeof e.unit&&(r.unit=e.unit),"string"==typeof e.resultType&&(r.resultType=e.resultType),"number"==typeof e.maxCount&&(r.maxCount=e.maxCount),"number"==typeof e.startPosition&&(r.startPosition=e.startPosition),GeoGlobe.loadURL(this.url,r,this,(function(e){try{var i=this.format.read(e.responseText);if("result"==r.resultType)var o=this._parseQueryResultToFeature(i);else o=this._analysis_GeoCodeResult(i)}catch(i){return void t(e.responseText)}t(o,i)}),this.failFn)},getLocations:function(e,t,i){this.addressesToLocations(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e,total))}),this),i)},getLocationsByPage:function(e,t,i){e.resultType="hits",this.addressesToLocations(e,GeoGlobe.Function.bind((function(r){if("OK"==r.status){e.resultType="result";var o=r.results[0].count;null!=e.maxCount&&null!=e.maxCount||(e.maxCount=3),e.startPosition=(e.startPosition-1)*e.maxCount+1,this.addressesToLocations(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e,o))}),this),i)}else alert("没有查询到任何数据")}),this),i)},getAddresses:function(e,t,i){this.locationToAddresses(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e,total))}),this),i)},getAddressesByPage:function(e,t,i){e.resultType="hits",this.locationToAddresses(e,GeoGlobe.Function.bind((function(r){if("OK"==r.status){e.resultType="result";var o=r.results[0].count;null!=e.maxCount&&null!=e.maxCount||(e.maxCount=3),e.startPosition=(e.startPosition-1)*e.maxCount+1,this.locationToAddresses(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e,o))}),this),i)}else alert("没有查询到任何数据")}),this),i)},_parseQueryResultToFeature:function(e){var t=[];if("OK"==e.status&&e.results)for(var i=0;i<e.results.length;i++){var r=e.results[i].result;if(r)for(var o=0;o<r.length;o++){var n={},s=null;if(n.requestKeyWord=e.results[i].requestKeyWord,GeoGlobe.Util.isArray(r[o].poiArray))for(var a=0;a<r[o].poiArray.length;a++)n.CONTINENT=r[o].poiArray[a].CONTINENT,n.GBCODE=r[o].poiArray[a].GBCODE,n.STANDARDNAME=r[o].poiArray[a].STANDARDNAME,n.name=r[o].poiArray[a].name;if(r[o].addressComponent){var l=r[o].addressComponent;n.address=this._getAddress(l,n.name),n.country=r[o].addressComponent.country,n.province=r[o].addressComponent.province,n.city=r[o].addressComponent.city,n.district=r[o].addressComponent.district,r[o].addressComponent.street?(n.streetName=r[o].addressComponent.street.name,n.streetgeometry=r[o].addressComponent.street.geometry):n.streetName="",n.streetNumber=r[o].addressComponent.streetNumber}r[o].location&&(r[o].location.lng&&(n.lng=r[o].location.lng),r[o].location.lat&&(n.lat=r[o].location.lat),s=new GeoGlobe.Geometry.Point(r[o].location.lng,r[o].location.lat)),n.isBrief=r[o].isBrief,n.precise=r[o].precise,n.resultType=r[o].resultType,n.score=r[o].score;var u=new GeoGlobe.Feature(s,n);t.push(u)}}var h=(new GeoGlobe.Format.GeoJSON).write(t),c=(new GeoGlobe.Format.JSON).read(h);return{status:e.status,features:t,geojsonFeatures:c}},_getAddress:function(e,t){var i="";return e.country&&(i+=e.country),e.province&&(i+=e.province),e.city&&(i+=e.city),e.district&&(i+=e.district),e.street&&(e.street.name&&(i+=e.street.name),e.streetNumber&&(i+=e.streetNumber+"号")),t&&(i+=t),i},CLASS_NAME:"GeoGlobe.Query.GeoCodingQuery.v1_0_0"}),GeoGlobe.Query.GeoCodingQuery.v1_1_0=GeoGlobe.Class4OL(GeoGlobe.Query.GeoCodingQuery.v1,{method:"get",initialize:function(e,t){GeoGlobe.Util.extend(this,t),this.filterFormat=new GeoGlobe.Format.Filter,GeoGlobe.Query.GeoCodingQuery.v1.prototype.initialize.apply(this,arguments)},addressesToLocations:function(e,t,i){var r=this.getCommonParams({request:"GeoCoder"});if(r.reverseMatch=!1,"string"==typeof e.address&&(r.keyword=e.address),"number"==typeof e.categoryCode&&(r.categoryCode=e.categoryCode),!(null!=e.address&&null!=e.address||null!=e.categoryCode&&null!=e.categoryCode))throw"address是必选参数！";if(e.extent instanceof GeoGlobe.LngLatBounds)r.bbox=e.extent.toBBOX(null,!0);else if(e.extent instanceof GeoGlobe.Geometry.Polygon){for(var o=e.extent,n=[],s=0,a=o.components.length;s<a;s++)for(var l=o.components[s].components,u=0;u<l.length;u++)n.push(l[u].toShortString());r.bbox=n.join(",")}if(e.filter instanceof GeoGlobe.Filter){var h=this.filterFormat.write(e.filter),c=GeoGlobe.Format.XML.prototype.write.apply(this.filterFormat,[h]);r.filter=c}"string"==typeof e.resultType&&(r.resultType=e.resultType),"statistics"==e.resultType&&(r.statisticsLevel=e.statisticsLevel),"number"==typeof e.maxCount&&(r.maxCount=e.maxCount),"number"==typeof e.startPosition&&(r.startPosition=e.startPosition),"boolean"==typeof e.semanticAnalysis&&(r.semanticAnalysis=e.semanticAnalysis),"boolean"==typeof e.customWeight&&(r.customWeight=e.customWeight),this._setGeoCoderCommonProperty(r,e),this._getCodingRequest(r,t,i)},_getCodingRequest:function(e,t,i){if("get"==this.method)GeoGlobe.loadURL(this.url,e,this,(function(i){try{var r=this.format.read(i.responseText);if("result"==e.resultType)var o=this._parseQueryResultToFeature(r);else o=this._analysis_GeoCodeResult(r)}catch(e){return void t(i.responseText)}t(o)}),this.failFn);else{var r=GeoGlobe.Util.getParameterString(e);GeoGlobe.Request.POST({url:this.url,data:r,success:function(e){try{var i=this.format.read(e.responseText),r=this._analysis_GeoCodeResult(i)}catch(i){return void t(e.responseText)}t(r)},failure:this.failFn,scope:this})}},_setGeoCoderCommonProperty:function(e,t){"string"==typeof t.sortFields&&(e.sortFields=t.sortFields),"string"==typeof t.scoreFilter&&(e.scoreFilter=t.scoreFilter)},locationToAddresses:function(e,t,i){var r=this.getCommonParams({request:"GeoCoder"});if(r.reverseMatch=!0,!e.lonlat)throw"address是必选参数！请填写正确的数据类型！";r.keyword=e.lonlat.lat+","+e.lonlat.lng,"number"==typeof e.tolerance&&(r.tolerance=e.tolerance),"string"==typeof e.unit&&(r.unit=e.unit),"string"==typeof e.resultType&&(r.resultType=e.resultType),"statistics"==e.resultType&&(r.statisticsLevel=e.statisticsLevel),"number"==typeof e.maxCount&&(r.maxCount=e.maxCount),"number"==typeof e.startPosition&&(r.startPosition=e.startPosition),"boolean"==typeof e.customWeight&&(r.customWeight=e.customWeight),this._setGeoCoderCommonProperty(r,e),this._getCodingRequest(r,t,i)},batchAddressesToLocations:function(e,t,i){var r=this.getCommonParams({request:"BatchGeoCoder",service:"GeoCoding"});if(r.reverseMatch=!1,GeoGlobe.Util.isArray(e.address)){for(var o="",n=0;n<e.address.length;n++)o+=e.address[n]+",";o=o.substr(0,o.length-1),r.keywords=o}else if(null==e.address||null==e.address)throw"address是必选参数！";if("number"==typeof e.singleKeywordResultCount&&(r.singleKeywordResultCount=e.singleKeywordResultCount),e.filter instanceof GeoGlobe.Filter){var s=this.filterFormat.write(e.filter),a=GeoGlobe.Format.XML.prototype.write.apply(this.filterFormat,[s]);r.filter=a}this._setGeoCoderCommonProperty(r,e),this._getCodingRequest(r,t,i)},batchLocationToAddresses:function(e,t,i){var r=this.getCommonParams({request:"BatchGeoCoder",service:"GeoCoding"});if(r.reverseMatch=!0,e.lonlats instanceof GeoGlobe.LonLat)e.lonlats=[e.lonlats];else if(!GeoGlobe.Util.isArray(e.lonlats))throw"address是必选参数！请填写正确的数据类型！";if(GeoGlobe.Util.isArray(e.lonlats)){for(var o="",n=0;n<e.lonlats.length;n++)o+=e.lonlats[n].lat+","+e.lonlats[n].lng+";";o=o.substr(0,o.length-1),r.keywords=o}"number"==typeof e.tolerance&&(r.tolerance=e.tolerance),"string"==typeof e.unit&&(r.unit=e.unit),"number"==typeof e.singleKeywordResultCount&&(r.singleKeywordResultCount=e.singleKeywordResultCount),this._setGeoCoderCommonProperty(r,e),this._getCodingRequest(r,t,i)},_getAddress:function(e,t){var i="";return e.country&&(i+=e.country),e.province&&(i+=e.province),e.city&&(i+=e.city),e.district&&(i+=e.district),e.street&&(e.street.name&&(i+=e.street.name),e.streetNumber&&(i+=e.streetNumber+"号")),t&&(i+=t),i},getLocations:function(e,t,i){this.addressesToLocations(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e,total))}),this),i)},getLocationsByPage:function(e,t,i){e.resultType="hits",this.addressesToLocations(e,GeoGlobe.Function.bind((function(r){if("OK"==r.status){e.resultType="result";var o=r.results[0].count;null!=e.maxCount&&null!=e.maxCount||(e.maxCount=3),e.startPosition=(e.startPosition-1)*e.maxCount+1,this.addressesToLocations(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e,o))}),this),i)}else alert("没有查询到任何数据")}),this),i)},getAddresses:function(e,t,i){this.locationToAddresses(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e,total))}),this),i)},getAddressesByPage:function(e,t,i){e.resultType="hits",this.locationToAddresses(e,GeoGlobe.Function.bind((function(r){if("OK"==r.status){e.resultType="result";var o=r.results[0].count;null!=e.maxCount&&null!=e.maxCount||(e.maxCount=3),e.startPosition=(e.startPosition-1)*e.maxCount+1,this.locationToAddresses(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e,o))}),this),i)}else alert("没有查询到任何数据")}),this),i)},batchGetAddresses:function(e,t,i){this.batchLocationToAddresses(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e))}),this),i)},batchGetLocations:function(e,t,i){this.batchAddressesToLocations(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e))}),this),i)},_parseQueryResultToFeature:function(e){var t=[];if("OK"==e.status&&e.results)for(var i=0;i<e.results.length;i++){var r=e.results[i].result;if(r)for(var o=0;o<r.length;o++){var n={},s=null;if(n.requestKeyWord=e.results[i].requestKeyWord,GeoGlobe.Util.isArray(r[o].poiArray))for(var a=0;a<r[o].poiArray.length;a++)n.CONTINENT=r[o].poiArray[a].CONTINENT,n.GBCODE=r[o].poiArray[a].GBCODE,n.STANDARDNAME=r[o].poiArray[a].STANDARDNAME,n.name=r[o].poiArray[a].name;if(r[o].addressComponent){var l=r[o].addressComponent;n.address=this._getAddress(l,n.name),n.country=r[o].addressComponent.country,n.province=r[o].addressComponent.province,n.city=r[o].addressComponent.city,n.district=r[o].addressComponent.district,r[o].addressComponent.street?(n.streetName=r[o].addressComponent.street.name,n.streetgeometry=r[o].addressComponent.street.geometry):n.streetName="",n.streetNumber=r[o].addressComponent.streetNumber}r[o].location&&(r[o].location.lng&&(n.lng=r[o].location.lng),r[o].location.lat&&(n.lat=r[o].location.lat),s=new GeoGlobe.Geometry.Point(r[o].location.lng,r[o].location.lat)),n.isBrief=r[o].isBrief,n.precise=r[o].precise,n.resultType=r[o].resultType,n.score=r[o].score;var u=new GeoGlobe.Feature(s,n);t.push(u)}}var h=(new GeoGlobe.Format.GeoJSON).write(t),c=(new GeoGlobe.Format.JSON).read(h);return{status:e.status,features:t,geojsonFeatures:c}},CLASS_NAME:"GeoGlobe.Query.GeoCodingQuery.v1_1_0"}),GeoGlobe.Service=GeoGlobe.Class({name:null,url:null,version:null,userid:"test@liferay.com",initialize:function(e,t,i){this.name=e,this.url=t,GeoGlobe.Util.extend(this,i)},getCapabilities:function(e,t){},isExist:function(){},failFn:function(e){alert("服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+this.url+"\n操作类型："+e)},_parseToXML:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),(new GeoGlobe.Format.XML).read(t)},_checkIsError:function(e){return(new GeoGlobe.Format.XML).read(e).selectNodes("ServiceExceptionReport").length>0?this._parseToJSON(e):null},_isException:function(e){return!(!e||!e.ServiceExceptionReport)},_parseToJSON:function(e){return(new GeoGlobe.Util.Format.XML2JSON).read(e)},CLASS_NAME:"GeoGlobe.Service"}),GeoGlobe.Service.WFST=GeoGlobe.Class4OL(GeoGlobe.Service,{xy:!0,initialize:function(e,t,i){GeoGlobe.Service.prototype.initialize.apply(this,arguments)},getCapabilities:function(e,t){var i=this.url,r={REQUEST:"GetCapabilities",SERVICE:"WFS",VERSION:"1.0.0"};t||(t=function(){this.failFn(r.REQUEST)}),GeoGlobe.loadURL(i,r,this,(function(t){e(t)}),t)},isExist:function(){var e=!1,t=this.url;return GeoGlobe.Request.GET({url:t,params:{REQUEST:"GetCapabilities",SERVICE:"WFS"},scope:this,async:!1,success:function(){e=!0}}),e},describeFeatureType:function(e,t,i){var r=this.url;GeoGlobe.Util.applyDefaults(e,{SERVICE:"WFS",VERSION:"1.0.0",REQUEST:"DescribeFeatureType"}),i||(i=function(){this.failFn(e.REQUEST)}),GeoGlobe.loadURL(r,e,this,(function(e){t(e)}),i)},getFeature:function(e,t,i){var r=this.url;GeoGlobe.Util.applyDefaults(e,{SERVICE:"WFS",VERSION:"1.0.0",REQUEST:"GetFeature"}),i||(i=function(){this.failFn(e.REQUEST)}),GeoGlobe.loadURL(r,e,this,(function(e){t(e)}),i)},lockFeature:function(e,t,i){this.url,GeoGlobe.Util.applyDefaults(e,{service:"WFS",version:"1.0.0",request:"LockFeature",expiry:1,lockAction:"ALL"});var r=this._parserFilterToString(e.filter),o=GeoGlobe.String.format('<?xml version="1.0" encoding="UTF-8"?><LockFeature version="${version}" service="${service}" lockAction="${lockAction}" expiry="${expiry}" xmlns:wfs=" http://www.opengis.net/wfs" xmlns:gml=" http://www.opengis.net/gml" xmlns:myns=" http://www.someserver.com/myns" xmlns:ogc=" http://www.opengis.net/ogc" xmlns:xsi=" http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs ../wfs/1.1.0/WFS.xsd"><Lock typeName="${typeName}">${filterXMLString}</Lock></LockFeature>',{version:e.version,service:e.service,lockAction:e.lockAction,expiry:e.expiry,typeName:e.typeName,filterXMLString:r});i||(i=function(){this.failFn(e.request)}),new GeoGlobe.Request.POST({url:this.url,data:o,scope:this,success:t,failure:i})},transaction:function(e,t,i,r,o,n){var s=this.url;GeoGlobe.Util.applyDefaults(e,{service:"WFS",version:"1.0.0",request:"Transaction",releaseAction:"ALL"});var a=e.lockId,l="";a&&(l+="<LockId>"+a+"</LockId>");var u="";t&&(u+=this._getInsertString(t)),i&&(u+=this._getUpdateString(i)),r&&(u+=this._getDeleteString(r));var h=GeoGlobe.String.format('<?xml version="1.0" encoding="UTF-8"?><wfs:Transaction releaseAction="${releaseAction}" handle="Transaction 01" version="${version}" service="${service}" xmlns="http://www.someserver.com/myns" xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc" xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">${lockIdString}${transactionString}</wfs:Transaction>',{releaseAction:e.releaseAction,version:e.version,service:e.service,lockIdString:l,transactionString:u});n||(n=function(){this.failFn(e.request)}),new GeoGlobe.Request.POST({url:s,data:h,scope:this,success:o,failure:n})},parseTransactionResult:function(e){var t=(new GeoGlobe.Format.XML2JSON).read(e.responseText),i=new Array,r=this._objToArray(t.wfs_WFS_TransactionResponse.wfs_TransactionResult.wfs_Status),o=this._objToArray(t.wfs_WFS_TransactionResponse.wfs_InsertResults);if(!r)return i;for(var n=0;n<r.length;n++)void 0!==r[n].wfs_SUCCESS?i.push({status:"SUCCESS",fid:o&&o[n]?o[n].ogc_FeatureId.fid:null}):i.push({status:"FAILED",fid:null});return i},_objToArray:function(e){return!e||e instanceof Array||(e=[e]),e},_getInsertString:function(e){for(var t=e.features,i=e.typeName,r="",o=0;o<t.length;o++){var n=t[o];r+='<wfs:Insert handle="Insert '+o+'">'+this._getInsertFeatureString(n,i)+"</wfs:Insert>"}return r},_getInsertFeatureString:function(e,t){var i="";for(var r in e.attributes)"OID"!=r&&(i+=GeoGlobe.String.format("<${tag}><![CDATA[${value}]]></${tag}>",{value:e.attributes[r]?e.attributes[r]:"",tag:r}));return i+=GeoGlobe.String.format("<GEOMETRY>${geometry}</GEOMETRY>",{geometry:this._getGeometryStringByFeature(e)}),GeoGlobe.String.format("<${typeName}>${content}</${typeName}>",{typeName:t,content:i})},_getUpdateString:function(e){e.filter;for(var t=e.typeName,i=e.features,r="",o=0;o<i.length;o++)if(i[o].geometry){var n=this._getUpdatePropertyString(i[o]),s=new GeoGlobe.Filter.FeatureId({fids:[t+"."+i[o].attributes.OID]});r+='<wfs:Update typeName="'+t+'" handle="Update '+o+'">'+n+this._parserFilterToString(s)+"</wfs:Update>"}return r},_getUpdatePropertyString:function(e){var t="";for(var i in e.data)"OID"!=i&&e.data[i]&&(t+="<wfs:Property><wfs:Name><![CDATA["+i+"]]></wfs:Name><wfs:Value><![CDATA["+(e.data[i]?e.data[i]:"")+"]]></wfs:Value></wfs:Property>");return t+"<wfs:Property><wfs:Name>Geometry</wfs:Name><wfs:Value>"+this._getGeometryStringByFeature(e)+"</wfs:Value></wfs:Property>"},_getGeometryStringByFeature:function(e){var t=new GeoGlobe.Format.GML({xy:this.xy});t.buildCoordinatesNode=GeoGlobe.Function.bind((function(e){var t=this.createElementNS(this.gmlns,"gml:coordinates");t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," ");var i=[];if(e instanceof GeoGlobe.LngLatBounds)this.xy?(i.push(e.left+","+e.bottom),i.push(e.right+","+e.top)):(i.push(e.bottom+","+e.left),i.push(e.top+","+e.right));else for(var r=e.components?e.components:[e],o=0;o<r.length;o++)this.xy?i.push(r[o].x+","+r[o].y):i.push(r[o].y+","+r[o].x);var n=this.createTextNode(i.join(" "));return t.appendChild(n),t}),t);var i=t.buildGeometryNode(e.geometry);return(new GeoGlobe.Format.XML).write(i)},_getDeleteString:function(e){for(var t=e.filter,i=e.typeName,r="",o=0;o<t.fids.length;o++){r+='<wfs:Delete typeName="'+i+'" handle="Delete '+o+'">';var n=new GeoGlobe.Filter.FeatureId({fids:[t.fids[o]]});r+=this._parserFilterToString(n),r+="</wfs:Delete>"}return r},_parserFilterToString:function(e){var t="";if(e){var i=(new GeoGlobe.Format.Filter.v1).write(e);return(new GeoGlobe.Format.XML).write(i)}return t},CLASS_NAME:"GeoGlobe.Service.WFST"}),GeoGlobe.Service.CTS=GeoGlobe.Class4OL(GeoGlobe.Service,{initialize:function(e,t,i){GeoGlobe.Service.prototype.initialize.apply(this,arguments)},getCapabilities:function(e,t){var i=this.url,r={REQUEST:"GetCapabilities",SERVICE:"CTS"};t||(t=function(){this.failFn(r.REQUEST)}),GeoGlobe.loadURL(i,r,this,(function(t){e(t)}),t)},isExist:function(){var e=!1,t=this.url;return GeoGlobe.Request.GET({url:t,params:{REQUEST:"GetCapabilities",SERVICE:"CTS"},scope:this,async:!1,success:function(){e=!0}}),e},TransCoords:function(e,t,i){var r=this.url;GeoGlobe.Util.applyDefaults(e,{SERVICE:"CTS",REQUEST:"TransCoords"}),i||(i=function(){this.failFn(e.REQUEST)}),GeoGlobe.loadURL(r,e,this,(function(i){if("xml"==e.FORMAT){var r={},o=i.responseXML;GeoGlobe.Function.bind(this.xmltoJson,this);var n=this.xmltoJson(o);r.attributes=n.CTS_TransResult["cts:Coordinate"].attributes.dim;for(var s=n.CTS_TransResult["cts:Coordinate"].text.split(","),a=[],l=0;l<s.length;l++)a.push(s[l]);r.coordvalue=a}else if("json"==e.FORMAT){r={},n=i.responseText;var u=(new GeoGlobe.Format.JSON).read(n);r.attributes=u.CTS_TransResult.dim,r.coordvalue=u.CTS_TransResult.Coordinate}t(r)}),i)},xmltoJson:function(e){var t={};if(1==e.nodeType){if(e.attributes.length>0){t.attributes={};for(var i=0;i<e.attributes.length;i++){var r=e.attributes.item(i);t.attributes[r.nodeName]=r.nodeValue}}}else 3==e.nodeType&&(t=e.nodeValue);if(e.hasChildNodes())for(var o=0;o<e.childNodes.length;o++){var n=e.childNodes.item(o),s=n.nodeName.replace("ows:","");if(void 0===t[s=s.replace("#","")])t[s]=this.xmltoJson(n);else{if(void 0===t[s].push){var a=t[s];t[s]=[],t[s].push(a)}t[s].push(this.xmltoJson(n))}}return t},AffineTransform:function(e,t,i){var r=this.url;GeoGlobe.Util.applyDefaults(e,{SERVICE:"CTS",REQUEST:"AffineTransform"}),i||(i=function(){this.failFn(e.REQUEST)}),GeoGlobe.loadURL(r,e,this,(function(i){if("xml"==e.FORMAT){var r={},o=i.responseXML;GeoGlobe.Function.bind(this.xmltoJson,this);var n=this.xmltoJson(o);r.attributes=n.CTS_AffineTransResult["cts:Coordinate"].attributes.dim;for(var s=n.CTS_AffineTransResult["cts:Coordinate"].text.split(","),a=[],l=0;l<s.length;l++)a.push(s[l]);r.coordvalue=a}else if("json"==e.FORMAT){r={},n=i.responseText;var u=(new GeoGlobe.Format.JSON).read(n);r.attributes=u.CTS_AffineTransResult.dim,r.coordvalue=u.CTS_AffineTransResult.Coordinate}t(r)}),i)},CLASS_NAME:"GeoGlobe.Service.CTS"}),GeoGlobe.Service.WMS=GeoGlobe.Class4OL(GeoGlobe.Service,{initialize:function(e,t,i){GeoGlobe.Service.prototype.initialize.apply(this,arguments)},getCapabilities:function(e,t){var i=this.url,r={REQUEST:"GetCapabilities",SERVICE:"WMS"};t||(t=function(){this.failFn(r.REQUEST)}),GeoGlobe.loadURL(i,r,this,(function(t){var i=t.responseXML;GeoGlobe.Function.bind(this.xmlToJson,this);var r,o=this.xmlToJson(i),n={},s=o.WMT_MS_Capabilities,a=s.Capability.Layer.Layer,l=s.Capability.Request;r=a.length?a[0]:a,n.version=s.attributes.version,n.format=l.GetMap.Format[1].text,n.layer=r.Title.text,n.bbox=r.BoundingBox.attributes.SRS,n.maxExtent=s.Capability.Layer.LatLonBoundingBox.attributes,e(n,o)}),t)},isExist:function(){var e=!1,t=this.url;return GeoGlobe.Request.GET({url:t,params:{REQUEST:"GetCapabilities",SERVICE:"WMS"},scope:this,async:!1,success:function(){e=!0}}),e},xmlToJson:function(e){var t={};if(1==e.nodeType){if(e.attributes.length>0){t.attributes={};for(var i=0;i<e.attributes.length;i++){var r=e.attributes.item(i);t.attributes[r.nodeName]=r.nodeValue}}}else 3==e.nodeType&&(t=e.nodeValue);if(e.hasChildNodes())for(var o=0;o<e.childNodes.length;o++){var n=e.childNodes.item(o),s=n.nodeName.replace("ows:","");if(void 0===t[s=s.replace("#","")])t[s]=this.xmlToJson(n);else{if(void 0===t[s].push){var a=t[s];t[s]=[],t[s].push(a)}t[s].push(this.xmlToJson(n))}}return t},getMap:function(e){this.url;var t={};return e.layers&&(t.LAYERS=e.layers),e.format&&(t.FORMAT=e.format),e.bbox&&(t.BBOX="{bbox-epsg-3857}"),e.width&&(t.WIDTH=e.width),e.height&&(t.HEIGHT=e.height),e.version&&(t.VERSION=e.version),e.SRS&&(t.SRS=e.SRS),GeoGlobe.Util.applyDefaults(t,{service:"WMS",request:"GetMap",TRANSPARENT:!0}),this.urlAppend(this.url,this.getParameterString(t||{}))},getParameterString:function(e){var t=[];for(var i in e){var r=e[i];if(null!=r&&"function"!=typeof r){var o;if("object"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11___default()(r)&&r.constructor==Array){for(var n,s=[],a=0,l=r.length;a<l;a++)n=r[a],s.push(encodeURIComponent(null==n?"":n));o=s.join(",")}else o=r;t.push(encodeURIComponent(i)+"="+o)}}return t.join("&")},urlAppend:function(e,t){var i=e;if(t){var r=(e+" ").split(/[?&]/);i+=" "===r.pop()?t:r.length?"&"+t:"?"+t}return i},CLASS_NAME:"GeoGlobe.Service.WMS"}),GeoGlobe.Service.WMTS=GeoGlobe.Class4OL(GeoGlobe.Service,{initialize:function(e,t,i){GeoGlobe.Service.prototype.initialize.apply(this,arguments)},getCapabilities:function(e,t){var i=this.url,r={REQUEST:"GetCapabilities",SERVICE:"WMTS"};t||(t=function(){this.failFn(r.REQUEST)}),GeoGlobe.loadURL(i,r,this,(function(t){var i=t.responseXML;GeoGlobe.Function.bind(this.xmlToJson,this);var r=this.xmlToJson(i),o=r.Capabilities,n={},s=o.Contents.Layer;s=s.length?s[0]:s,n.version=o.attributes.version;var a=o.Contents;n.layer=s.Title.text,n.LayerIdentifier=s.Identifier.text,n.StyleIdentifier=s.Style.Identifier.text,n.MatrixSet=s.TileMatrixSetLink[0].TileMatrixSet.text,n.Format=s.Format[1].text,n.Bounding=s.BoundingBox;var l="",u=a.TileMatrixSet[0].TileMatrix;if(u.length>0)for(var h=0,c=u.length;h<c&&h!=c;h++)l+=u[h].ScaleDenominator.text+",";n.Scales=l.substr(0,l.length-1),n.zoomOffset=u[0].Identifier.text,e(n,r)}),t)},xmlToJson:function(e){var t={};if(1==e.nodeType){if(e.attributes.length>0){t.attributes={};for(var i=0;i<e.attributes.length;i++){var r=e.attributes.item(i);t.attributes[r.nodeName]=r.nodeValue}}}else 3==e.nodeType&&(t=e.nodeValue);if(e.hasChildNodes())for(var o=0;o<e.childNodes.length;o++){var n=e.childNodes.item(o),s=n.nodeName.replace("ows:","");if(void 0===t[s=s.replace("#","")])t[s]=this.xmlToJson(n);else{if(void 0===t[s].push){var a=t[s];t[s]=[],t[s].push(a)}t[s].push(this.xmlToJson(n))}}return t},isExist:function(){var e=!1,t=this.url;return GeoGlobe.Request.GET({url:t,params:{REQUEST:"GetCapabilities",SERVICE:"WMTS"},scope:this,async:!1,success:function(){e=!0}}),e},getTile:function(e){var t={};return e.layer&&(t.LAYER=e.layer),e.format&&(t.FORMAT=e.format),e.tileMatrixSet&&(t.TILEMATRIXSET=e.tileMatrixSet),e.TILEMATRIX&&(t.TILEMATRIX=e.TILEMATRIX),e.TILEROW&&(t.TILEROW=e.TILEROW),e.TILECOL&&(t.TILECOL=e.TILECOL),e.version&&(t.VERSION=e.version),e.style&&(t.STYLE=e.style),GeoGlobe.Util.applyDefaults(t,{service:"WMTS",request:"GetTile"}),this.urlAppend(this.url,this.getParameterString(t||{}))},getParameterString:function(e){var t=[];for(var i in e){var r=e[i];if(null!=r&&"function"!=typeof r){var o;if("object"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_11___default()(r)&&r.constructor==Array){for(var n,s=[],a=0,l=r.length;a<l;a++)n=r[a],s.push(encodeURIComponent(null==n?"":n));o=s.join(",")}else o=r;t.push(encodeURIComponent(i)+"="+o)}}return t.join("&")},urlAppend:function(e,t){var i=e;if(t){var r=(e+" ").split(/[?&]/);i+=" "===r.pop()?t:r.length?"&"+t:"?"+t}return i},getCapabilitiesForRest:function(e,t){var i=this.url;i.match(/\/$/)||(i+="/"),i+="1.0.0/WMTSCapabilities.xml",t||(t=function(){this.failFn("GetCapabilities")}),GeoGlobe.loadURL(i,null,this,(function(t){e(t)}),t)},getTileForRest:function(e){var t=e.layer,i=e.style,r=e.tileMatrixSet,o=e.tileMatrix,n=e.tileRow,s=e.tileCol,a=null,l=e.format?e.format:"image/png";a||(a={"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"}[l]||l.split("/").pop());var u=t+"/"+i+"/"+r+"/"+o+"/"+n+"/"+s+"."+a,h=this.url;return h.match(/\/$/)||(h+="/"),h+u},CLASS_NAME:"GeoGlobe.Service.WMTS"}),GeoGlobe.Analysis.BufferAnalysis=GeoGlobe.Class4OL({url:null,type:1,accuracy:32,initialize:function(e,t){this.url=e,GeoGlobe.Util.extend(this,t)},_buildPostXML:function(e,t){return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><wps:Execute service="WPS" version="1.0.0" xmlns:gml="http://www.opengis.net/gml" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 ../wpsExecute_request.xsd"><ows:Identifier>Buffer</ows:Identifier><wps:DataInputs><wps:Input><ows:Identifier>InputPolygon</ows:Identifier><wps:Data><wps:ComplexData schema="http://foo.bar/MyComplexValueSchema.xsd" mimeType="text/xml" encoding="UTF-8">'+(new GeoGlobe.Format.GML).write(e)+"</wps:ComplexData></wps:Data></wps:Input><wps:Input><ows:Identifier>BufferDistance</ows:Identifier><wps:Data><wps:LiteralData>"+t+"</wps:LiteralData></wps:Data></wps:Input><wps:Input><ows:Identifier>BufferType</ows:Identifier><wps:Data><wps:LiteralData>"+this.type+"</wps:LiteralData></wps:Data></wps:Input><wps:Input><ows:Identifier>BufferAccuracy</ows:Identifier><wps:Data><wps:LiteralData>"+this.accuracy+"</wps:LiteralData></wps:Data></wps:Input></wps:DataInputs><wps:ResponseForm><wps:RawDataOutput><ows:Identifier>BufferedPolygon</ows:Identifier></wps:RawDataOutput></wps:ResponseForm></wps:Execute>"},_getFeaturesCenter:function(e){return this._getFeaturesExtent(e).getCenterLonLat()},_getFeaturesExtent:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);var t=null;if(e&&e.length>0){t=new GeoGlobe.LngLatBounds;for(var i=null,r=0,o=e.length;r<o;r++)(i=e[r].geometry)&&t.extend(i.getBounds())}return t},startAnalysis:function(e,t,i){var r=(new GeoGlobe.Format.GeoJSON).read(e),o=this._getFeaturesCenter(r);switch(i&&-1!=GeoGlobe.Util.indexOf(["m","km","degree"],i)||(i="m"),i){case"km":t*=1e3;case"m":t=this._meterToDegree(t,o)}var n=this._buildPostXML(r,t);new GeoGlobe.Request.POST({url:this.url,data:n,scope:this,success:function(e){if(""!=e.responseText&&null!=e.responseText){var t=this._parserResult(e),i=(new GeoGlobe.Format.GeoJSON).write(t),r=(new GeoGlobe.Format.JSON).read(i);this.successFn(r)}else this.failFn()},failure:this.failFn})},_meterToDegree:function(e,t){var i=t.lat;return e*(899e-8/Math.cos(GeoGlobe.Util.rad(i)))},successFn:function(e){},failFn:function(){alert("缓冲分析操作失败，请检测服务是否正常运行。")},_parserResult:function(e){var t=new GeoGlobe.Format.XML;return e.responseXML||(e.responseXML=t.read(e.responseText)),(new GeoGlobe.Format.GML).read(e.responseXML)},CLASS_NAME:"GeoGlobe.Analysis.BufferAnalysis"}),GeoGlobe.Analysis.BufferAnalysis.CAP_ROUND=1,GeoGlobe.Analysis.BufferAnalysis.CAP_BUTT=2,GeoGlobe.Analysis.BufferAnalysis.CAP_SQUARE=3,GeoGlobe.Analysis.CoreBufferAnalysis=GeoGlobe.Class({url:null,type:"intersection",_requestStrTemplate:"{'BufferAnalysis': {'service': 'OverlapService','version': '1.0.0','layerName': '${layerName}','bufferRadius': '${bufferRadius}','bufferStyle':'${bufferStyle}','outPutFormat': 'JSON','bufferType': '${bufferType}','isSynchronization': 'true'}}",initialize:function(e,t){this.url=e,GeoGlobe.Util.extend(this,t)},_buildRequestStr:function(){return GeoGlobe.String.format(this._requestStrTemplate,{type:this.type,layerName:this.layerName,bufferRadius:this.bufferRadius,bufferStyle:this.bufferStyle,bufferType:this.bufferType})},startAnalysis:function(e){if(this._checkSet())return!1;var t=this._buildRequestStr();new GeoGlobe.Request.POST({url:this.url,data:t,scope:this,success:function(t){""!=t.responseText&&null!=t.responseText?this.successFn(t,e):this.failFn()},failure:this.failFn})},_checkSet:function(){if(!this.url)return!1},successFn:function(e){},failFn:function(){alert("缓冲分析操作失败，请检测服务是否正常运行")},CLASS_NAME:"GeoGlobe.Analysis.CoreBufferAnalysis"}),GeoGlobe.Analysis.GetFeature=GeoGlobe.Class4OL({url:null,type:"intersection",_reqStrTemplate:"{'GetFeature': {'service': 'OverlapService','version': '1.0.0','dataSource':'${sourceInputs}','Query': [{'typeName':'${dataInputs}'}],'maxFeatures': '','startPosition': '','outPutFormat': 'GeoJSON','resultType': ''}}",initialize:function(e,t){this.url=e,GeoGlobe.Util.extend(this,t)},_buildReqStr:function(){return GeoGlobe.String.format(this._reqStrTemplate,{type:this.type,dataInputs:this.typeName,sourceInputs:this.DataSource})},startAnalysis:function(e){if(this._checkSet())return!1;var t=this._buildReqStr();new GeoGlobe.Request.POST({url:this.url,data:t,scope:this,success:function(e){""!=e.responseText&&null!=e.responseText?this.successFn(e):this.failFn()},failure:this.failFn})},_checkSet:function(){if(!this.url)return!1},successFn:function(e){},failFn:function(){alert("服务请求操作失败，请检测服务是否正常运行。")},CLASS_NAME:"GeoGlobe.Analysis.GetFeature"}),GeoGlobe.Analysis.SpatialAnalysis=GeoGlobe.Class({url:null,type:"intersection",_requestStrTemplate:"{'SpatialAnalysis': {'service': 'OverlapService','version': '1.0.0','origionLayerNames': ['${origionLayerNames}'],'targetLayerNames': ['${targetLayerNames}'],'outPutFormat': 'GeoJSON','operator': '${dataInputs}','isSynchronization': 'true','tolerance': '${tolerance}'}}",initialize:function(e,t){this.url=e,GeoGlobe.Util.extend(this,t)},_buildRequestStr:function(){return GeoGlobe.String.format(this._requestStrTemplate,{type:this.type,dataInputs:this.operator,origionLayerNames:this.origionLayerNames,targetLayerNames:this.targetLayerNames,tolerance:this.tolerance})},startAnalysis:function(e){if(this._checkSet())return!1;var t=this._buildRequestStr();new GeoGlobe.Request.POST({url:this.url,data:t,scope:this,success:function(t){""!=t.responseText&&null!=t.responseText?this.successFn(t,e):this.failFn()},failure:this.failFn})},_checkSet:function(){if(!this.url)return!1},successFn:function(e){},failFn:function(){alert("叠置分析操作失败，请检测服务是否正常运行。")},CLASS_NAME:"GeoGlobe.Analysis.SpatialAnalysis"})}).call(this,__webpack_require__(92)(module),__webpack_require__(228))},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";var r=i(22),o=i(14),n=i(134),s="".endsWith;r(r.P+r.F*i(135)("endsWith"),"String",{endsWith:function(e){var t=n(this,e,"endsWith"),i=arguments.length>1?arguments[1]:void 0,r=o(t.length),a=void 0===i?r:Math.min(o(i),r),l=String(e);return s?s.call(t,l,a):t.slice(a-l.length,a)===l}})},function(e,t,i){"use strict";var r=i(22),o=i(14),n=i(134),s="".startsWith;r(r.P+r.F*i(135)("startsWith"),"String",{startsWith:function(e){var t=n(this,e,"startsWith"),i=o(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return s?s.call(t,r,i):t.slice(i,i+r.length)===r}})},function(e,t,i){"use strict";var r=i(15),o=i(232),n=i(56);i(59)("search",1,(function(e,t,i,s){return[function(i){var r=e(this),o=null==i?void 0:i[t];return void 0!==o?o.call(i,r):new RegExp(i)[t](String(r))},function(e){var t=s(i,e,this);if(t.done)return t.value;var a=r(e),l=String(this),u=a.lastIndex;o(u,0)||(a.lastIndex=0);var h=n(a,l);return o(a.lastIndex,u)||(a.lastIndex=u),null===h?-1:h.index}]}))},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,i,r){"use strict";r.r(i);r(138),r(187),r(198),r(81),r(199),r(75);var o=r(7),n=r.n(o),s=r(136),a=r.n(s),l=(r(203),r(204),r(205),r(90)),u=r.n(l),h=r(137),c=r.n(h),g=(r(223),r(0)),p=r.n(g),f=r(1),d=r.n(f),m=(r(130),r(84),r(131),r(2)),C=r.n(m);r(62),r(36),r(82),r(133),r(80);!function(e){e&&(e.GeoOption={GeoCamera:!0,GeoCameraEventAggregator:!0,GeoScreenSpaceCameraController:!0},e.GEO_VERSION_NUMBER="$ Cesium Version: 1.40 build-20190301 $")}(window.Cesium),function(e){var t=e.DrawCircleWidget=function(t,i){this.viewer=t.viewer,this.color=t.color?t.color:e.Color.RED.withAlpha(.3),this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.mode=t.mode?t.mode:1,this.appearance=new e.PerInstanceColorAppearance,this.callback=i||null};function i(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}t.prototype.activate=function(){if(!this.handler){this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var t,i,r=this,o=[];this._array_=o,this._circles_=t=[],this._labels_=i,this.handler.setInputAction((function(i){r.lastP=i;var n=r.scene.pickPosition(i.position);if(!n){var s=r.camera.getPickRay(i.position);n=r.scene.globe.pick(s,r.scene)}if(n&&(e.Cartographic.fromCartesian(n).height<0&&(s=r.camera.getPickRay(i.position),n=r.scene.globe.pick(s,r.scene)),o[0]=n,o.length>0)){var a=new e.CircleGeometry({center:n,radius:0,height:0});a.name="draw_circle";var l=new e.GroundPrimitive({geometryInstances:new e.GeometryInstance({geometry:a,attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(r.color)}}),appearance:r.appearance,classificationType:e.ClassificationType.BOTH,interleave:!0});l.name="draw_circle",t.push({geometry:{center:n,radius:0,height:0},primitive:l}),r.primitives.add(l)}}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(n){var s=r.scene.pickPosition(n.endPosition);if(!s){var a=r.camera.getPickRay(n.endPosition);s=r.scene.globe.pick(a,r.scene)}if(!s)return i&&(r.primitives.remove(i),i=null),void(r._labels_=i);e.Cartographic.fromCartesian(s).height<0&&(a=r.camera.getPickRay(n.endPosition),s=r.scene.globe.pick(a,r.scene));var l=e.Cartographic.fromCartesian(s),u=e.Math.toDegrees(l.longitude),h=e.Math.toDegrees(l.latitude),c=l.height;o.length>0&&(t[0],r.primitives.remove(t[0].primitive),t[0].geometry.radius=e.Cartesian3.distance(t[0].geometry.center,s),t[0].geometry.radius>3189100&&(t[0].geometry.radius=3189100),t[0].primitive=new e.GroundPrimitive({geometryInstances:new e.GeometryInstance({geometry:new e.CircleGeometry({center:t[0].geometry.center.clone(),radius:t[0].geometry.radius,height:t[0].geometry.height}),attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(r.color)}}),appearance:r.appearance,classificationType:e.ClassificationType.BOTH,interleave:!0}),t[0].primitive.name="draw_circle",r.primitives.add(t[0].primitive)),i||((i=r.primitives.add(new e.LabelCollection)).name="draw_label",i.add({text:"左键单击开始绘制，右键单击结束绘制",font:"15px Microsoft YaHei",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY})),i.get(i.length-1).position=e.Cartesian3.fromDegrees(u,h,c),r._labels_=i}),e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction((function(e){r.drawEnd(e)}),e.ScreenSpaceEventType.RIGHT_CLICK)}},t.prototype.drawEnd=function(t){var i=this._array_,r=this._circles_,o=this._labels_;t||(t=this.lastP),this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",o&&(this.primitives.remove(o),o=null);var n=this.scene.pickPosition(t.position);if(!n){var s=this.camera.getPickRay(t.position);n=this.scene.globe.pick(s,this.scene)}if(n){e.Cartographic.fromCartesian(n).height<0&&(s=this.camera.getPickRay(t.position),n=this.scene.globe.pick(s,this.scene));var a=e.Cartographic.fromCartesian(n);if(e.Math.toDegrees(a.longitude),e.Math.toDegrees(a.latitude),a.height,this.mode,i.length>0&&(this.primitives.remove(r[0].primitive),r[0].geometry.radius=e.Cartesian3.distance(r[0].geometry.center,n),r[0].geometry.radius>3189100&&(r[0].geometry.radius=3189100),r[0].primitive=new e.GroundPrimitive({geometryInstances:new e.GeometryInstance({geometry:new e.CircleGeometry({center:r[0].geometry.center.clone(),radius:r[0].geometry.radius,height:r[0].geometry.height}),attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(this.color)}}),appearance:this.appearance,classificationType:e.ClassificationType.BOTH,interleave:!0}),r[0].primitive.name="draw_circle",this.primitives.add(r[0].primitive),this.callback)){var l=e.CircleGeometry.createGeometry(new e.CircleGeometry({center:r[0].geometry.center.clone(),radius:r[0].geometry.radius,height:r[0].geometry.height})),u=new e.Entity({polygon:{hierarchy:{positions:function(){for(var t=[],i=l.attributes.position.values,r=0;r<i.length;r+=3)t.push(new e.Cartesian3(i[r],i[r+1],i[r+2]));return t}()}}});this.callback(u)}i=[],r=[]}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_circle",this.primitives),function(e,t){for(var i=t.values,r=0;r<i.length;r++)"draw_circle"==i[r].name&&(t.remove(i[r]),r--)}(0,this.viewer.entities)}}(window.Cesium),function(e){var t=e.DrawHeightWidget=function(t,i){this.viewer=t.viewer,this.color=t.color?t.color:e.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=t.lineWidth?t.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=i||null};function i(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}t.prototype.activate=function(){if(!this.handler){this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var t,i,r=this,o=[];this.handler.setInputAction((function(i){if(!(o.length>0)){var n=r.camera.getPickRay(i.position),s=r.scene.globe.pick(n,r.scene);if(s){var a=e.Cartographic.fromCartesian(s),l=e.Math.toDegrees(a.longitude),u=e.Math.toDegrees(a.latitude),h=a.height;0==o.length&&(o.push(l),o.push(u),o.push(h),o.push(l),o.push(u),o.push(h),o.push(l),o.push(u),o.push(h),(t=r.primitives.add(new e.PolylineCollection)).name="draw_polyline",t.add({polyline:{}}),t.get(t.length-1).width=r.lineWidth,t.get(t.length-1).loop=!0,t.get(t.length-1).material.uniforms.color=r.color,t.get(t.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(o))}}}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(n){var s=r.camera.getPickRay(n.endPosition),a=r.scene.globe.pick(s,r.scene);if(a){var l=e.Cartographic.fromCartesian(a),u=e.Math.toDegrees(l.longitude),h=e.Math.toDegrees(l.latitude),c=l.height;9==o.length&&(o[3]=u,o[4]=h,o[5]=c,o[2]>=o[5]?(o[6]=o[0],o[7]=o[1],o[8]=o[5]):(o[6]=o[3],o[7]=o[4],o[8]=o[2]),t.get(t.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(o)),i||((i=r.primitives.add(new e.LabelCollection)).name="draw_label",i.add({text:"左键单击开始绘制，右键单击结束绘制",font:"16px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY})),i.get(i.length-1).position=e.Cartesian3.fromDegrees(u,h,c)}else i&&(r.primitives.remove(i),i=null)}),e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction((function(t){if(r.handler=r.handler&&r.handler.destroy(),r.viewer.canvas.style.cursor="default",i&&(r.primitives.remove(i),i=null),r.callback){var n=new e.Entity({polyline:{positions:e.Cartesian3.fromDegreesArrayHeights(o)}});r.callback(n)}}),e.ScreenSpaceEventType.RIGHT_CLICK)}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_polyline",this.primitives)}}(window.Cesium),function(e){var t=e.DrawPointWidget=function(t,i){this.viewer=t.viewer,this.color=t.color?t.color:e.Color.RED,this.pixelSize=t.pixelSize?t.pixelSize:10,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=i||null};function i(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}t.prototype.activate=function(){if(!this.handler){this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var t,i,r=this,o=[];this.handler.setInputAction((function(n){var s=r.scene.pickPosition(n.position);if(!s){var a=r.camera.getPickRay(n.position);s=r.scene.globe.pick(a,r.scene)}if(s&&(e.Cartographic.fromCartesian(s).height<0&&(a=r.camera.getPickRay(n.position),s=r.scene.globe.pick(a,r.scene)),o[0]=s,t?t.removeAll():(t=r.primitives.add(new e.PointPrimitiveCollection)).name="draw_point",t.add({position:s,color:r.color,pixelSize:r.pixelSize,disableDepthTestDistance:30}),r.handler=r.handler&&r.handler.destroy(),r.viewer.canvas.style.cursor="default",i&&(r.primitives.remove(i),i=null),r.callback)){var l=new e.Entity({position:o[0],point:{}});r.callback(l)}}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(t){var o=r.scene.pickPosition(t.endPosition);if(!o){var n=r.camera.getPickRay(t.endPosition);o=r.scene.globe.pick(n,r.scene)}o?(e.Cartographic.fromCartesian(o).height<0&&(n=r.camera.getPickRay(t.endPosition),o=r.scene.globe.pick(n,r.scene)),i||((i=r.primitives.add(new e.LabelCollection)).name="draw_label",i.add({text:"左键单击进行绘制",font:"15px Microsoft YaHei",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY})),i.get(i.length-1).position=o):i&&(r.primitives.remove(i),i=null)}),e.ScreenSpaceEventType.MOUSE_MOVE)}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_point",this.primitives)}}(window.Cesium),function(e){var t=e.DrawPolygonWidget=function(t,i){this.viewer=t.viewer,this.color=t.color?t.color:e.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=t.lineWidth?t.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=i||null,this.count=0};function i(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}t.prototype.activate=function(){if(!this.handler){this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var t,i,r=this,o=[],n=[],s=[];this._array_=n,this._array2_=s,this._polylines_=t,this._labels_=i,this.handler.setInputAction((function(i){r.lastP=i;var a=r.scene.pickPosition(i.position);if(!a){var l=r.camera.getPickRay(i.position);a=r.scene.globe.pick(l,r.scene)}if(a){e.Cartographic.fromCartesian(a).height<0&&(l=r.camera.getPickRay(i.position),a=r.scene.globe.pick(l,r.scene));var u=e.Cartographic.fromCartesian(a);n.push(a);var h=e.Math.toDegrees(u.longitude),c=e.Math.toDegrees(u.latitude),g=u.height;s.push([h,c]),o.push(h),o.push(c),o.push(g),3==o.length&&((t=r.primitives.add(new e.PolylineCollection)).name="draw_polyline",t.add({polyline:{}}),t.get(t.length-1).width=r.lineWidth,t.get(t.length-1).loop=!0,t.get(t.length-1).material.uniforms.color=r.color,t.get(t.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(o)),o.length>3&&(t.get(t.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(o)),r._polylines_=t}}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(n){var s=r.scene.pickPosition(n.endPosition);if(!s){var a=r.camera.getPickRay(n.endPosition);s=r.scene.globe.pick(a,r.scene)}if(s){e.Cartographic.fromCartesian(s).height<0&&(a=r.camera.getPickRay(n.endPosition),s=r.scene.globe.pick(a,r.scene));var l=e.Cartographic.fromCartesian(s),u=e.Math.toDegrees(l.longitude),h=e.Math.toDegrees(l.latitude),c=l.height;if(o.length>=3){var g=o.concat();g.push(u),g.push(h),g.push(c),t.get(t.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(g)}i||((i=r.primitives.add(new e.LabelCollection)).name="draw_label",i.add({text:"左键单击开始绘制，右键单击结束绘制",font:"15px Microsoft YaHei",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY})),i.get(i.length-1).position=e.Cartesian3.fromDegrees(u,h,c),r._labels_=i}}),e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction((function(e){r.drawEnd(e)}),e.ScreenSpaceEventType.RIGHT_CLICK),this.count++}},t.prototype.drawEnd=function(t){if(0!=this._array_.length){var i=this._array_,r=this._array2_,o=this._polylines_,n=this._labels_;t||(console.log("点击按钮结束绘制"),t=this.lastP),this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",n&&(this.primitives.remove(n),n=null);var s=this.scene.pickPosition(t.position);if(!s){var a=this.camera.getPickRay(t.position);s=this.scene.globe.pick(a,this.scene)}if(s){e.Cartographic.fromCartesian(s).height<0&&(a=this.camera.getPickRay(t.position),s=this.scene.globe.pick(a,this.scene)),i.push(s);var l=e.Cartographic.fromCartesian(s),u=e.Math.toDegrees(l.longitude),h=e.Math.toDegrees(l.latitude);r.push([u,h]),o.get(o.length-1).material.uniforms.color=e.Color.DODGERBLUE.withAlpha(0);var c=new e.GroundPrimitive({geometryInstances:[],appearance:new e.PerInstanceColorAppearance,show:!0,classificationType:e.ClassificationType.BOTH}),g=new e.GeometryInstance({geometry:e.PolygonGeometry.fromPositions({positions:i,vertexFormat:e.EllipsoidSurfaceAppearance.VERTEX_FORMAT}),attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(e.Color.GREEN.withAlpha(.3))}});if(c.geometryInstances.push(g),this.primitives.add(c).name="draw_polygon",this.callback){var p=new e.Entity({polygon:{hierarchy:{positions:i}}});this.callback(p)}this._array_=[],this._polylines_=null}}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_polyline",this.primitives),i("draw_polygon",this.primitives)}}(window.Cesium),function(e){var t=e.DrawPolylineWidget=function(t,i){this.viewer=t.viewer,this.lineColor=e.defaultValue(t.lineColor,e.Color.CHARTREUSE.withAlpha(.5)),this.lineWidth=e.defaultValue(t.lineWidth,1),this.lineLoop=e.defaultValue(t.lineLoop,!0),this.lineClampGround=e.defaultValue(t.lineClampGround,!0),this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.primitives=this.scene.primitives,this.callback=i||null};function i(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}function r(t){return[e.Math.toDegrees(e.Cartographic.fromCartesian(t).longitude),e.Math.toDegrees(e.Cartographic.fromCartesian(t).latitude),e.Cartographic.fromCartesian(t).height]}t.prototype.screenToCartesian=function(t){if(this.lineClampGround){if(!(r=this.scene.pickPosition(t))){var i=this.camera.getPickRay(t);r=this.scene.globe.pick(i,this.scene)}if(!r)return;e.Cartographic.fromCartesian(r).height<0&&(i=this.camera.getPickRay(t),r=this.scene.globe.pick(i,this.scene))}else{i=this.camera.getPickRay(t);var r=this.scene.globe.pick(i,this.scene)}return r},t.prototype.createGroundPrimitive=function(t){if(this.lineWidth&&this.lineColor&&this.primitives){var i=new e.GroundPrimitive({geometryInstances:new e.GeometryInstance({geometry:new e.CorridorGeometry({vertexFormat:e.VertexFormat.POSITION_ONLY,positions:t,width:this.lineWidth}),attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(this.lineColor)}}),classificationType:e.ClassificationType.BOTH});return this.primitives.add(i)}return!1},t.prototype.createPrimitive=function(t){if(this.lineWidth&&this.lineColor&&this.primitives){var i=this.primitives.add(new e.PolylineCollection);return i.add({polyline:{}}),i.get(i.length-1).width=this.lineWidth,i.get(i.length-1).material.uniforms.color=this.lineColor,i.get(i.length-1).positions=t,i}return!1},t.prototype.activate=function(){if(!this.handler){this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var t=[];this.degreesArrayHeights=[],this._labels=null;var i=this;this.handler.setInputAction((function(e){var o=i.screenToCartesian(e.position);t.push(o),i.degreesArrayHeights=i.degreesArrayHeights.concat(r(o));var n=t.length,s=[],a=[];1==n?s=[t[n-1]]:i.lineLoop?(s=[t[n-2],t[n-1]],a=[t[0],t[n-1]]):(s=[t[n-2],t[n-1]],a=[]),i.lineClampGround?(i.primitives.remove(i.temporaryGroundPrimitive),i.primitives.remove(i.concatGroundPrimitive),i.fixedGroundPrimitive=i.createGroundPrimitive(s),i.fixedGroundPrimitive.name="draw_polyline",i.concatGroundPrimitive=i.createGroundPrimitive(a),i.concatGroundPrimitive.name="draw_polylineConcat"):(i.primitives.remove(i.concatPrimitive),i.primitives.remove(i.temporaryPrimitive),i.fixedPrimitive=i.createPrimitive(s),i.fixedPrimitive.name="draw_polyline",i.concatPrimitive=i.createPrimitive(a),i.concatPrimitive.name="draw_polylineConcat")}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(r){var o=i.screenToCartesian(r.endPosition);if(o){var n=t.length;if(n)if(i.lineClampGround){i.primitives.remove(i.temporaryGroundPrimitive),i.primitives.remove(i.concatGroundPrimitive);var s=i.lineLoop&&n>=2?[t[n-1],o.clone(),t[0]]:[t[n-1],o.clone()];i.temporaryGroundPrimitive=i.createGroundPrimitive(s),i.temporaryGroundPrimitive.name="draw_polylineTemple"}else{i.primitives.remove(i.temporaryPrimitive),i.primitives.remove(i.concatPrimitive);var a=i.lineLoop&&n>=2?[t[n-1],o.clone(),t[0]]:[t[n-1],o.clone()];i.temporaryPrimitive=i.createPrimitive(a),i.temporaryPrimitive.name="draw_polylineTemple"}i._labels||(i._labels=i.primitives.add(new e.LabelCollection),i._labels.name="draw_label",i._labels.add({text:"左键单击开始绘制，右键单击结束绘制",font:"15px Microsoft YaHei",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY})),i._labels.get(i._labels.length-1).position=o}else i._labels&&(i.primitives.remove(i._labels),i._labels=null)}),e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction((function(e){i.drawEnd(t,e)}),e.ScreenSpaceEventType.RIGHT_CLICK)}},t.prototype.drawEnd=function(t,i){var o=this._labels;this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",o&&(this.primitives.remove(o),o=null);var n=this.screenToCartesian(i.position);t.push(n),this.degreesArrayHeights=this.degreesArrayHeights.concat(r(n));var s=t.length;if(this.lineClampGround){this.primitives.remove(this.temporaryGroundPrimitive),this.primitives.remove(this.concatGroundPrimitive);var a=this.lineLoop&&s>2?[t[s-2],t[s-1],t[0]]:[t[s-2],t[s-1]];this.finalGroundPrimitive=this.createGroundPrimitive(a),this.finalGroundPrimitive.name="draw_polyline"}else{this.primitives.remove(this.temporaryPrimitive),this.primitives.remove(this.concatPrimitive);var l=this.lineLoop&&s>2?[t[s-2],t[s-1],t[0]]:[t[s-2],t[s-1]];this.finalPrimitive=this.createPrimitive(l),this.finalPrimitive.name="draw_polyline"}if(this.callback){var u=new e.Entity({polyline:{positions:e.Cartesian3.fromDegreesArrayHeights(this.degreesArrayHeights)}});this.callback(u)}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_polyline",this.primitives)}}(window.Cesium);var v={version:"1.0.0",createTime:"2018.6.19",author:"xupinhui"},A="doublearrow",_=.25,I=.3,b=.85,w=.15,G={headHeightFactor:.18,headWidthFactor:.3,neckHeightFactor:.85,neckWidthFactor:.15,tailWidthFactor:.1,headTailFactor:.8,swallowTailFactor:1};v.algorithm={},v.algorithm.doubleArrow=function(e){this.connPoint=null,this.tempPoint4=null,this.points=e;var t={controlPoint:null,polygonalPoint:null};if(!(2>(a=e.length))){if(2==a)return e;var i,r,o=this.points[0],n=this.points[1],s=this.points[2],a=e.length;this.tempPoint4=3==a?v.algorithm.getTempPoint4(o,n,s):this.points[3],this.connPoint=3==a||4==a?E.PlotUtils.mid(o,n):this.points[4],E.PlotUtils.isClockWise(o,n,s)?(i=v.algorithm.getArrowPoints(o,this.connPoint,this.tempPoint4,!1),r=v.algorithm.getArrowPoints(this.connPoint,n,s,!0)):(i=v.algorithm.getArrowPoints(n,this.connPoint,s,!1),r=v.algorithm.getArrowPoints(this.connPoint,o,this.tempPoint4,!0));var l=i.length,u=(l-5)/2,h=i.slice(0,u),c=i.slice(u,u+5),g=i.slice(u+5,l),p=r.slice(0,u),f=r.slice(u,u+5),d=r.slice(u+5,l);p=E.PlotUtils.getBezierPoints(p);var m=E.PlotUtils.getBezierPoints(d.concat(h.slice(1)));g=E.PlotUtils.getBezierPoints(g);var C=p.concat(f,m,c,g),y=v.algorithm.array2Dto1D(C);t.controlPoint=[o,n,s,this.tempPoint4,this.connPoint],t.polygonalPoint=Cesium.Cartesian3.fromDegreesArray(y)}return t},v.algorithm.getTempPoint4=function(e,t,i,r){this.type=A,this.headHeightFactor=_,this.headWidthFactor=I,this.neckHeightFactor=b,this.neckWidthFactor=w;var o=E.PlotUtils.mid(e,t),n=E.PlotUtils.distance(o,i),s=E.PlotUtils.getThirdPoint(i,o,0,.3*n,!0),a=E.PlotUtils.getThirdPoint(i,o,0,.5*n,!0),l=[o,s=E.PlotUtils.getThirdPoint(o,s,E.Constants.HALF_PI,n/5,r),a=E.PlotUtils.getThirdPoint(o,a,E.Constants.HALF_PI,n/4,r),i],u=v.algorithm.getArrowHeadPoints(l,this.headHeightFactor,this.headWidthFactor,this.neckHeightFactor,this.neckWidthFactor),h=u[0],c=u[4],g=E.PlotUtils.distance(e,t)/E.PlotUtils.getBaseLength(l)/2,p=v.algorithm.getArrowBodyPoints(l,h,c,g),f=p.length,d=p.slice(0,f/2),m=p.slice(f/2,f);return d.push(h),m.push(c),(d=d.reverse()).push(t),(m=m.reverse()).push(e),d.reverse().concat(u,m)},v.algorithm.array2Dto1D=function(e){var t=[];return e.forEach((function(e){t.push(e[0]),t.push(e[1])})),t},v.algorithm.getArrowPoints=function(e,t,i,r){this.type=A,this.headHeightFactor=_,this.headWidthFactor=I,this.neckHeightFactor=b,this.neckWidthFactor=w;var o=E.PlotUtils.mid(e,t),n=E.PlotUtils.distance(o,i),s=E.PlotUtils.getThirdPoint(i,o,0,.3*n,!0),a=E.PlotUtils.getThirdPoint(i,o,0,.5*n,!0),l=[o,s=E.PlotUtils.getThirdPoint(o,s,E.Constants.HALF_PI,n/5,r),a=E.PlotUtils.getThirdPoint(o,a,E.Constants.HALF_PI,n/4,r),i],u=v.algorithm.getArrowHeadPoints(l,this.headHeightFactor,this.headWidthFactor,this.neckHeightFactor,this.neckWidthFactor),h=u[0],c=u[4],g=E.PlotUtils.distance(e,t)/E.PlotUtils.getBaseLength(l)/2,p=v.algorithm.getArrowBodyPoints(l,h,c,g),f=p.length,d=p.slice(0,f/2),m=p.slice(f/2,f);return d.push(h),m.push(c),(d=d.reverse()).push(t),(m=m.reverse()).push(e),d.reverse().concat(u,m)},v.algorithm.getArrowHeadPoints=function(e,t,i){this.type=A,this.headHeightFactor=_,this.headWidthFactor=I,this.neckHeightFactor=b,this.neckWidthFactor=w;var r=E.PlotUtils.getBaseLength(e)*this.headHeightFactor,o=e[e.length-1],n=(E.PlotUtils.distance(t,i),r*this.headWidthFactor),s=r*this.neckWidthFactor,a=r*this.neckHeightFactor,l=E.PlotUtils.getThirdPoint(e[e.length-2],o,0,r,!0),u=E.PlotUtils.getThirdPoint(e[e.length-2],o,0,a,!0),h=E.PlotUtils.getThirdPoint(o,l,E.Constants.HALF_PI,n,!1),c=E.PlotUtils.getThirdPoint(o,l,E.Constants.HALF_PI,n,!0);return[E.PlotUtils.getThirdPoint(o,u,E.Constants.HALF_PI,s,!1),h,o,c,E.PlotUtils.getThirdPoint(o,u,E.Constants.HALF_PI,s,!0)]},v.algorithm.getArrowBodyPoints=function(e,t,i,r){for(var o=E.PlotUtils.wholeDistance(e),n=E.PlotUtils.getBaseLength(e)*r,s=(n-E.PlotUtils.distance(t,i))/2,a=0,l=[],u=[],h=1;h<e.length-1;h++){var c=E.PlotUtils.getAngleOfThreePoints(e[h-1],e[h],e[h+1])/2,g=(n/2-(a+=E.PlotUtils.distance(e[h-1],e[h]))/o*s)/Math.sin(c),p=E.PlotUtils.getThirdPoint(e[h-1],e[h],Math.PI-c,g,!0),f=E.PlotUtils.getThirdPoint(e[h-1],e[h],c,g,!1);l.push(p),u.push(f)}return l.concat(u)},v.algorithm.getTempPoint4=function(e,t,i){var r,o,n,s,a=E.PlotUtils.mid(e,t),l=E.PlotUtils.distance(a,i),u=E.PlotUtils.getAngleOfThreePoints(e,a,i);return u<E.Constants.HALF_PI?(o=l*Math.sin(u),n=l*Math.cos(u),s=E.PlotUtils.getThirdPoint(e,a,E.Constants.HALF_PI,o,!1),r=E.PlotUtils.getThirdPoint(a,s,E.Constants.HALF_PI,n,!0)):u>=E.Constants.HALF_PI&&u<Math.PI?(o=l*Math.sin(Math.PI-u),n=l*Math.cos(Math.PI-u),s=E.PlotUtils.getThirdPoint(e,a,E.Constants.HALF_PI,o,!1),r=E.PlotUtils.getThirdPoint(a,s,E.Constants.HALF_PI,n,!1)):u>=Math.PI&&u<1.5*Math.PI?(o=l*Math.sin(u-Math.PI),n=l*Math.cos(u-Math.PI),s=E.PlotUtils.getThirdPoint(e,a,E.Constants.HALF_PI,o,!0),r=E.PlotUtils.getThirdPoint(a,s,E.Constants.HALF_PI,n,!0)):(o=l*Math.sin(2*Math.PI-u),n=l*Math.cos(2*Math.PI-u),s=E.PlotUtils.getThirdPoint(e,a,E.Constants.HALF_PI,o,!0),r=E.PlotUtils.getThirdPoint(a,s,E.Constants.HALF_PI,n,!1)),r},v.algorithm.tailedAttackArrow=function(e){e=v.algorithm.dereplication(e),this.tailWidthFactor=G.tailWidthFactor,this.swallowTailFactor=G.swallowTailFactor,this.swallowTailPnt=G.swallowTailPnt;var t={controlPoint:null,polygonalPoint:null};if(t.controlPoint=e,!(2>(f=e.length))){if(2==e.length)return t.polygonalPoint=e,t;var i=e,r=i[0],o=i[1];E.PlotUtils.isClockWise(i[0],i[1],i[2])&&(r=i[1],o=i[0]);var n=[E.PlotUtils.mid(r,o)].concat(i.slice(2)),s=v.algorithm.getAttackArrowHeadPoints(n,r,o,G),a=s[0],l=s[4],u=E.PlotUtils.distance(r,o),h=E.PlotUtils.getBaseLength(n),c=h*this.tailWidthFactor*this.swallowTailFactor;this.swallowTailPnt=E.PlotUtils.getThirdPoint(n[1],n[0],0,c,!0);var g=u/h,p=v.algorithm.getAttackArrowBodyPoints(n,a,l,g),f=p.length,d=[r].concat(p.slice(0,f/2));d.push(a);var m,C=[o].concat(p.slice(f/2,f));C.push(l),d=E.PlotUtils.getQBSplinePoints(d),C=E.PlotUtils.getQBSplinePoints(C),m=v.algorithm.array2Dto1D(d.concat(s,C.reverse(),[this.swallowTailPnt,d[0]])),t.polygonalPoint=Cesium.Cartesian3.fromDegreesArray(m)}return t},v.algorithm.getAttackArrowHeadPoints=function(e,t,i,r){this.headHeightFactor=r.headHeightFactor,this.headTailFactor=r.headTailFactor,this.headWidthFactor=r.headWidthFactor,this.neckWidthFactor=r.neckWidthFactor,this.neckHeightFactor=r.neckHeightFactor;var o=E.PlotUtils.getBaseLength(e),n=o*this.headHeightFactor,s=e[e.length-1];o=E.PlotUtils.distance(s,e[e.length-2]);var a=E.PlotUtils.distance(t,i);n>a*this.headTailFactor&&(n=a*this.headTailFactor);var l=n*this.headWidthFactor,u=n*this.neckWidthFactor,h=(n=n>o?o:n)*this.neckHeightFactor,c=E.PlotUtils.getThirdPoint(e[e.length-2],s,0,n,!0),g=E.PlotUtils.getThirdPoint(e[e.length-2],s,0,h,!0),p=E.PlotUtils.getThirdPoint(s,c,E.Constants.HALF_PI,l,!1),f=E.PlotUtils.getThirdPoint(s,c,E.Constants.HALF_PI,l,!0);return[E.PlotUtils.getThirdPoint(s,g,E.Constants.HALF_PI,u,!1),p,s,f,E.PlotUtils.getThirdPoint(s,g,E.Constants.HALF_PI,u,!0)]},v.algorithm.getAttackArrowBodyPoints=function(e,t,i,r){for(var o=E.PlotUtils.wholeDistance(e),n=E.PlotUtils.getBaseLength(e)*r,s=(n-E.PlotUtils.distance(t,i))/2,a=0,l=[],u=[],h=1;h<e.length-1;h++){var c=E.PlotUtils.getAngleOfThreePoints(e[h-1],e[h],e[h+1])/2,g=(n/2-(a+=E.PlotUtils.distance(e[h-1],e[h]))/o*s)/Math.sin(c),p=E.PlotUtils.getThirdPoint(e[h-1],e[h],Math.PI-c,g,!0),f=E.PlotUtils.getThirdPoint(e[h-1],e[h],c,g,!1);l.push(p),u.push(f)}return l.concat(u)},v.algorithm.dereplication=function(e){var t=e[e.length-1],i=!1,r=[];return r=e.filter((function(e){if(e[0]!=t[0]&&e[1]!=t[1])return e;i=!0})),i&&r.push(t),r},function(e){var t=e.DrawHelper=function(){var i=e.Ellipsoid.WGS84,r={billBoard:[],primitives:[]};function o(e){var t,i;this._scene=e.scene,this._tooltip=(t=e.container,(i=function(e){var t=document.createElement("DIV");t.className="twipsy right";var i=document.createElement("DIV");i.className="twipsy-arrow",t.appendChild(i);var r=document.createElement("DIV");r.className="twipsy-inner",t.appendChild(r),this._div=t,this._title=r,e.appendChild(t)}).prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},i.prototype.showAt=function(e,t){e&&t&&(this.setVisible(!0),this._title.innerHTML=t,this._div.style.left=e.x+10+"px",this._div.style.top=e.y-this._div.clientHeight/2+"px")},new i(t)),this._surfaces=[],this.initialiseHandlers(),this.enhancePrimitives()}o.prototype.initialiseHandlers=function(){var t,i=this._scene,r=this,o=new e.ScreenSpaceEventHandler(i.canvas);function n(e,t){if(1!=r._handlersMuted){var o=i.pick(t);o&&o.primitive&&o.primitive[e]&&o.primitive[e](t)}}o.setInputAction((function(e){n("leftClick",e.position)}),e.ScreenSpaceEventType.LEFT_CLICK),o.setInputAction((function(e){n("leftDoubleClick",e.position)}),e.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),o.setInputAction((function(e){if(1!=r._handlersMuted){var o=i.pick(e.endPosition);!t||o&&t==o.primitive||((!t.isDestroyed||!t.isDestroyed())&&t.mouseOut(e.endPosition),t=null),o&&o.primitive&&((o=o.primitive).mouseOut&&(t=o),o.mouseMove&&o.mouseMove(e.endPosition))}}),e.ScreenSpaceEventType.MOUSE_MOVE),o.setInputAction((function(e){n("leftUp",e.position)}),e.ScreenSpaceEventType.LEFT_UP),o.setInputAction((function(e){n("leftDown",e.position)}),e.ScreenSpaceEventType.LEFT_DOWN)},o.prototype.setListener=function(e,t,i){e[t]=i},o.prototype.muteHandlers=function(e){this._handlersMuted=e},o.prototype.registerEditableShape=function(e){var t=this;G(e,"mouseMove",(function(i){e.setHighlighted(!0),e._editMode||t._tooltip.showAt(i,"点击以编辑图形")})),G(e,"mouseOut",(function(i){e.setHighlighted(!1),t._tooltip.setVisible(!1)})),G(e,"leftClick",(function(t){e.setEditMode(!0),r.primitives.push(e)})),G(e,"leftDoubleClick",(function(t){r.primitives.push(e)}))},o.prototype.startDrawing=function(e){this.disableAllEditMode(),this.editCleanUp&&this.editCleanUp(),this.editCleanUp=e,this.muteHandlers(!0)},o.prototype.stopDrawing=function(){this.editCleanUp&&(this.editCleanUp(),this.editCleanUp=null),this.muteHandlers(!1)},o.prototype.disableAllHighlights=function(){this.setHighlighted(void 0)},o.prototype.setHighlighted=function(e){this._highlightedSurface&&!this._highlightedSurface.isDestroyed()&&this._highlightedSurface!=e&&this._highlightedSurface.setHighlighted(!1),this._highlightedSurface=e},o.prototype.disableAllEditMode=function(){this.setEdited(void 0)},o.prototype.setEdited=function(e){this._editedSurface&&!this._editedSurface.isDestroyed()&&this._editedSurface.setEditMode(!1),this._editedSurface=e};var n=e.Material.fromType(e.Material.ColorType);n.uniforms.color=new e.Color(1,1,0,.5);var s={ellipsoid:e.Ellipsoid.WGS84,textureRotationAngle:0,height:0,asynchronous:!0,show:!0,debugShowBoundingVolume:!1},a=w(s,{appearance:new e.EllipsoidSurfaceAppearance({aboveGround:!1}),material:n,granularity:Math.PI/180}),l=w(s,{}),u=w(s,{}),h=w(s,{}),c=(w(a,{rotation:0}),w(s,{width:5,geodesic:!0,granularity:1e4,appearance:new e.PolylineMaterialAppearance({aboveGround:!1}),material:n})),g=function(){function t(){}return t.prototype.initialiseOptions=function(e){b(this,e),this._ellipsoid=void 0,this._granularity=void 0,this._height=void 0,this._textureRotationAngle=void 0,this._id=void 0,this._createPrimitive=!0,this._primitive=void 0,this._outlinePolygon=void 0},t.prototype.setAttribute=function(e,t){this[e]=t,this._createPrimitive=!0},t.prototype.getAttribute=function(e){return this[e]},t.prototype.update=function(t,i,r){if(!e.defined(this.ellipsoid))throw new e.DeveloperError("this.ellipsoid must be defined.");if(!e.defined(this.appearance))throw new e.DeveloperError("this.material must be defined.");if(this.granularity<0)throw new e.DeveloperError("this.granularity and scene2D/scene3D overrides must be greater than zero.");if(this.show&&(this._createPrimitive||e.defined(this._primitive))){if(this._createPrimitive||this._ellipsoid!==this.ellipsoid||this._granularity!==this.granularity||this._height!==this.height||this._textureRotationAngle!==this.textureRotationAngle||this._id!==this.id){var o=this.getGeometry();if(!o)return;this._createPrimitive=!1,this._ellipsoid=this.ellipsoid,this._granularity=this.granularity,this._height=this.height,this._textureRotationAngle=this.textureRotationAngle,this._id=this.id,this._primitive=this._primitive&&this._primitive.destroy(),this._primitive=new e.Primitive({geometryInstances:new e.GeometryInstance({geometry:o,id:this.id,pickPrimitive:this}),appearance:this.appearance,asynchronous:this.asynchronous}),this._outlinePolygon=this._outlinePolygon&&this._outlinePolygon.destroy(),this.strokeColor&&this.getOutlineGeometry&&(this._outlinePolygon=new e.Primitive({geometryInstances:new e.GeometryInstance({geometry:this.getOutlineGeometry(),attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(this.strokeColor)}}),appearance:new e.PerInstanceColorAppearance({flat:!0,renderState:{depthTest:{enabled:!0},lineWidth:1}})}))}var n=this._primitive;n.appearance.material=this.material,n.debugShowBoundingVolume=this.debugShowBoundingVolume,n.update(t,i,r),this._outlinePolygon&&this._outlinePolygon.update(t,i,r)}},t.prototype.isDestroyed=function(){return!1},t.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),e.destroyObject(this)},t.prototype.setStrokeStyle=function(e,t){this.strokeColor&&this.strokeColor.equals(e)&&this.strokeWidth==t||(this._createPrimitive=!0,this.strokeColor=e,this.strokeWidth=t)},t}();o.ExtentPrimitive=function(){function t(t){if(!e.defined(t.extent))throw new e.DeveloperError("Extent is required");t=w(t,a),this.initialiseOptions(t),this.setExtent(t.extent)}return t.prototype=new g,t.prototype.setExtent=function(e){this.setAttribute("extent",e)},t.prototype.getExtent=function(){return this.getAttribute("extent")},t.prototype.getGeometry=function(){if(e.defined(this.extent))return e.PolygonGeometry.fromPositions({positions:this.extent,height:this.height,vertexFormat:e.EllipsoidSurfaceAppearance.VERTEX_FORMAT,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid,granularity:this.granularity})},t.prototype.getOutlineGeometry=function(){return e.PolygonOutlineGeometry.fromPositions({positions:this.extent})},t}(),o.PolygonPrimitive=function(){function t(e){e=w(e,a),this.initialiseOptions(e),this.isPolygon=!0}return t.prototype=new g,t.prototype.setPositions=function(e){this.setAttribute("positions",e)},t.prototype.getPositions=function(){return this.getAttribute("positions")},t.prototype.setCustom=function(e){this.setAttribute("custom")},t.prototype.getCustom=function(e){return this.getAttribute("custom")},t.prototype.getGeometry=function(){if(e.defined(this.positions)&&!(this.positions.length<3))return e.PolygonGeometry.fromPositions({positions:this.positions,height:this.height,vertexFormat:e.EllipsoidSurfaceAppearance.VERTEX_FORMAT,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid,granularity:this.granularity})},t.prototype.getOutlineGeometry=function(){return e.PolygonOutlineGeometry.fromPositions({positions:this.getPositions()})},t}(),o.TailedAttackPrimitive=function(){function t(e){e=w(e,a),this.initialiseOptions(e),this.isPolygon=!0}return t.prototype=new g,t.prototype.setPositions=function(e){this.setAttribute("positions",e)},t.prototype.getPositions=function(){return this.getAttribute("positions")},t.prototype.setCustom=function(e){this.setAttribute("custom")},t.prototype.getCustom=function(e){return this.getAttribute("custom")},t.prototype.getGeometry=function(){if(e.defined(this.positions)&&!(this.positions.length<3))return e.PolygonGeometry.fromPositions({positions:this.positions,height:this.height,vertexFormat:e.EllipsoidSurfaceAppearance.VERTEX_FORMAT,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid,granularity:this.granularity})},t.prototype.getOutlineGeometry=function(){return e.PolygonOutlineGeometry.fromPositions({positions:this.getPositions()})},t}(),o.PolylinePrimitive=function(){function t(e){e=w(e,c),this.initialiseOptions(e)}return t.prototype=new g,t.prototype.setPositions=function(e){this.setAttribute("positions",e)},t.prototype.setWidth=function(e){this.setAttribute("width",e)},t.prototype.setGeodesic=function(e){this.setAttribute("geodesic",e)},t.prototype.getPositions=function(){return this.getAttribute("positions")},t.prototype.getWidth=function(){return this.getAttribute("width")},t.prototype.getGeodesic=function(e){return this.getAttribute("geodesic")},t.prototype.getGeometry=function(){if(e.defined(this.positions)&&!(this.positions.length<2))return new e.PolylineGeometry({positions:this.positions,height:this.height,width:this.width<1?1:this.width,vertexFormat:e.EllipsoidSurfaceAppearance.VERTEX_FORMAT,ellipsoid:this.ellipsoid})},t}();var p={iconUrl:"/geomap-api/JsCesuimDemo/resource/images/img_plot/dragIcon.png",shiftX:0,shiftY:0},f={iconUrl:"/geomap-api/JsCesuimDemo/resource/images/img_plot/dragIcon.png",shiftX:0,shiftY:0},d={iconUrl:"/geomap-api/JsCesuimDemo/resource/images/img_plot/dragIconLight.png",shiftX:0,shiftY:0};function m(e){return[e[7],e[3]]}function y(t){var i=e.Cartographic.fromCartesian(t);return[e.Math.toDegrees(i.longitude),e.Math.toDegrees(i.latitude)]}function A(t,i){if(!(t.length<2||i.length<2)){var r=Math.PI/8.5,o=Math.PI/13,n=[];n[0]=t,n[1]=i;var s=n[0],a=n[1],l=E.PlotUtils.getBaseLength(n),u=.15*l,h=.2*l,c=.25*l,g=E.PlotUtils.getThirdPoint(a,s,E.Constants.HALF_PI,u,!0),p=E.PlotUtils.getThirdPoint(a,s,E.Constants.HALF_PI,u,!1),f=E.PlotUtils.getThirdPoint(s,a,r,c,!1),d=E.PlotUtils.getThirdPoint(s,a,r,c,!0),m=E.PlotUtils.getThirdPoint(s,a,o,h,!1),C=E.PlotUtils.getThirdPoint(s,a,o,h,!0),y=[];return y.push(g[0],g[1],m[0],m[1],f[0],f[1],a[0],a[1],d[0],d[1],C[0],C[1],p[0],p[1],s[0],s[1]),e.Cartesian3.fromDegreesArray(y)}}function _(t){for(var i=[],r=0;r<t.length;r++){var o=e.Cartesian3.fromDegrees(t[r][0],t[r][1],0);i.push(o)}return i}function I(e,t){if(null==e||"object"!=C()(e))return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(e.constructor==Date||e.constructor==RegExp||e.constructor==Function||e.constructor==String||e.constructor==Number||e.constructor==Boolean)return new e.constructor(e);for(var i in t=t||new e.constructor,e)t[i]=void 0===t[i]?I(e[i],null):t[i];return t}function b(e,t){var i;for(i in e=e||{},t)void 0===e[i]&&(e[i]=I(t[i]))}function w(e,t){var i,r=I(e);for(i in t)void 0===r[i]&&(r[i]=I(t[i]));return r}function G(e,t,i){e[t]=i}function S(e){e._listeners={},e.addListener=function(e,t){return this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(t),this._listeners[e].length},e.executeListeners=function(e,t){if(this._listeners[e.name]&&this._listeners[e.name].length>0)for(var i=0;i<this._listeners[e.name].length;i++)this._listeners[e.name][i](e);else t&&t(e)}}return o.prototype.createBillboardGroup=function(e,t,i){var r=new o.BillboardGroup(this,t);return r.addBillboards(e,i),r},o.BillboardGroup=function(t,i){this._drawHelper=t,this._scene=t._scene,this._options=w(i,p);var r=new e.BillboardCollection;this._scene.primitives.add(r),this._billboards=r,this._orderedBillboards=[]},o.BillboardGroup.prototype.createBillboard=function(t,r){var o=this._billboards.add({show:!0,position:t,pixelOffset:new e.Cartesian2(this._options.shiftX,this._options.shiftY),eyeOffset:new e.Cartesian3(0,0,0),horizontalOrigin:e.HorizontalOrigin.CENTER,verticalOrigin:e.VerticalOrigin.CENTER,scale:1,image:this._options.iconUrl,color:new e.Color(1,1,1,1)});if(r){var n=this,s=this._scene.screenSpaceCameraController;function a(e){s.enableRotate=e}function l(){for(var e=0,t=n._orderedBillboards.length;e<t&&n._orderedBillboards[e]!=o;++e);return e}r.dragHandlers&&(n=this,G(o,"leftDown",(function(t){function s(e){u.destroy(),a(!0),r.dragHandlers.onDragEnd&&r.dragHandlers.onDragEnd(l(),e)}var u=new e.ScreenSpaceEventHandler(n._scene.canvas);u.setInputAction((function(e){var t=n._scene.camera.pickEllipsoid(e.endPosition,i);t?function(e){o.position=e;for(var t=0,i=n._orderedBillboards.length;t<i&&n._orderedBillboards[t]!=o;++t);r.dragHandlers.onDrag&&r.dragHandlers.onDrag(l(),e)}(t):s(t)}),e.ScreenSpaceEventType.MOUSE_MOVE),u.setInputAction((function(e){s(n._scene.camera.pickEllipsoid(e.position,i))}),e.ScreenSpaceEventType.LEFT_UP),a(!1),r.dragHandlers.onDragStart&&r.dragHandlers.onDragStart(l(),n._scene.camera.pickEllipsoid(t,i))}))),r.onDoubleClick&&G(o,"leftDoubleClick",(function(e){r.onDoubleClick(l())})),r.onClick&&G(o,"leftClick",(function(e){r.onClick(l())})),r.tooltip&&(G(o,"mouseMove",(function(e){n._drawHelper._tooltip.showAt(e,r.tooltip())})),G(o,"mouseOut",(function(e){n._drawHelper._tooltip.setVisible(!1)})))}return o},o.BillboardGroup.prototype.insertBillboard=function(e,t,i){this._orderedBillboards.splice(e,0,this.createBillboard(t,i))},o.BillboardGroup.prototype.addBillboard=function(e,t){this._orderedBillboards.push(this.createBillboard(e,t))},o.BillboardGroup.prototype.removeLastBillboard=function(){this._billboards.remove(this._orderedBillboards.pop())},o.BillboardGroup.prototype.addBillboards=function(e,t){for(var i=0;i<e.length;i++)this.addBillboard(e[i],t)},o.BillboardGroup.prototype.updateBillboardsPositions=function(e){for(var t=0;t<e.length;t++)this.getBillboard(t).position=e[t]},o.BillboardGroup.prototype.countBillboards=function(){return this._orderedBillboards.length},o.BillboardGroup.prototype.getBillboard=function(e){return this._orderedBillboards[e]},o.BillboardGroup.prototype.removeBillboard=function(e){this._billboards.remove(this.getBillboard(e)),this._orderedBillboards.splice(e,1)},o.BillboardGroup.prototype.remove=function(){this._billboards=this._billboards&&this._billboards.removeAll()&&this._billboards.destroy()},o.BillboardGroup.prototype.setOnTop=function(){this._scene.primitives.raiseToTop(this._billboards)},o.prototype.startDrawingPolygon=function(e){e=w(e,a),this.startDrawingPolyshape(!0,e)},o.prototype.startDrawingPolyline=function(r){r=w(r,c),this.startDrawing((function(){l.remove(n),g.remove(),f.destroy(),u.setVisible(!1)}));var n,s=this,a=this._scene,l=a.primitives,u=this._tooltip;(n=new t.PolylinePrimitive(r)).asynchronous=!1,l.add(n);var h=[],g=new o.BillboardGroup(this,p),f=new e.ScreenSpaceEventHandler(a.canvas);f.setInputAction((function(e){if(null!=e.position){var t=a.camera.pickEllipsoid(e.position,i);t&&(0==h.length&&(h.push(t.clone()),g.addBillboard(h[0])),h.length>=2&&(n.positions=h,n._createPrimitive=!0),h.push(t),g.addBillboard(t))}}),e.ScreenSpaceEventType.LEFT_CLICK),f.setInputAction((function(e){var t=e.endPosition;if(null!=t)if(0==h.length)u.showAt(t,"<p>Click to add first point</p>");else{var r=a.camera.pickEllipsoid(t,i);r&&(h.pop(),r.y+=1+Math.random(),h.push(r),h.length>=2&&(n.positions=h,n._createPrimitive=!0),g.getBillboard(h.length-1).position=r,u.showAt(t,"<p>Click to add new point ("+h.length+")</p>"+(h.length>2?"<p>Double click to finish drawing</p>":"")))}}),e.ScreenSpaceEventType.MOUSE_MOVE),f.setInputAction((function(e){var t=e.position;if(null!=t){if(h.length<4)return;a.camera.pickEllipsoid(t,i)&&(s.stopDrawing(),"function"==typeof r.callback)&&(h.length,r.callback(h))}}),e.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},o.prototype.startDrawingTailedAttack=function(r){this.startDrawing((function(){a.remove(u),g.remove(),f.destroy(),l.setVisible(!1)})),this.firstTime=!0,this.options=r;var n=this,s=this._scene,a=s.primitives,l=this._tooltip,u=new t.TailedAttackPrimitive(r);/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)?u.asynchronous=!0:u.asynchronous=!1,a.add(u);var h=[],c=[],g=new o.BillboardGroup(this,p),f=new e.ScreenSpaceEventHandler(s.canvas);this.positions=h,this.minPoints=2,this.poly=u,f.setInputAction((function(t){if(null!=t.position){var r=s.camera.pickEllipsoid(t.position,i),o=e.Cartographic.fromCartesian(r),n=[e.Math.toDegrees(o.longitude),e.Math.toDegrees(o.latitude)];if(r){if(0==c.length&&(h.push(r.clone()),g.addBillboard(h[0])),c.length<3&&c.push(n),c.length>=2){c.push(n);var a=v.algorithm.tailedAttackArrow(c);u.positions=a.polygonalPoint,u.custom=a.controlPoint,u._createPrimitive=!0}h.push(r),h.length>=5&&g.removeLastBillboard(),g.addBillboard(r)}}}),e.ScreenSpaceEventType.LEFT_CLICK),f.setInputAction((function(t){var r=t.endPosition;if(null!=r)if(0==h.length)l.showAt(r,"<p>点击以增加第一个控制点</p>");else{var o=s.camera.pickEllipsoid(r,i),n=e.Cartographic.fromCartesian(o),a=[e.Math.toDegrees(n.longitude),e.Math.toDegrees(n.latitude)];if(o){if(h.pop(),o.y+=1+Math.random(),h.push(o),c.length>=3&&(c.pop(),c.push(a)),2==c.length&&c.push(a),h.length>2){var g=v.algorithm.tailedAttackArrow(c);u.positions=g?g.polygonalPoint:null,u.custom=g?g.controlPoint:null,u._createPrimitive=!0}var p=3==h.length?"<p>双击可结束绘制</p>":"单击以增加一个新的控制点";l.showAt(r,p)}}}),e.ScreenSpaceEventType.MOUSE_MOVE),f.setInputAction((function(e){n.drawEnd(e,r)}),e.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},o.prototype.drawEnd=function(e,t){var r,o=this.positions,n=this.minPoints,s=this.poly;if(t=this.options,null==e){if(this.firstTime){if(this.stopDrawing(),"function"!=typeof t.callback)return;o.length,t.callback(s.positions,s.custom),this.firstTime=!1}}else if(null!=(r=e.position)){if(o.length<n+2)return;scene.camera.pickEllipsoid(r,i)&&(this.stopDrawing(),"function"==typeof t.callback)&&(o.length,t.callback(s.positions,s.custom))}},o.prototype.startDrawingPolyshape=function(r,n){this.startDrawing((function(){u.remove(s),f.remove(),d.destroy(),h.setVisible(!1)})),this.firstTime=!0,this.options=n;var s,a=this,l=this._scene,u=l.primitives,h=this._tooltip;this.minPoints=2,s=r?new t.PolygonPrimitive(n):new t.PolylinePrimitive(n),/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)?s.asynchronous=!0:s.asynchronous=!1,u.add(s);var c=[],g=[],f=new o.BillboardGroup(this,p),d=new e.ScreenSpaceEventHandler(l.canvas);this.poly=s,this.positions=c,d.setInputAction((function(t){if(null!=t.position){var r=l.camera.pickEllipsoid(t.position,i),o=e.Cartographic.fromCartesian(r),n=[e.Math.toDegrees(o.longitude),e.Math.toDegrees(o.latitude)];if(r){if(0==g.length&&(c.push(r.clone()),f.addBillboard(c[0])),g.length<3&&g.push(n),g.length>=2){var a=v.algorithm.doubleArrow(g);s.positions=a.polygonalPoint,s.custom=a.controlPoint,s._createPrimitive=!0}c.push(r),c.length>=5&&f.removeLastBillboard(),f.addBillboard(r)}}}),e.ScreenSpaceEventType.LEFT_CLICK),d.setInputAction((function(t){var r=t.endPosition;if(null!=r)if(0==c.length)h.showAt(r,"<p>点击以增加第一个控制点</p>");else{var o=l.camera.pickEllipsoid(r,i),n=e.Cartographic.fromCartesian(o),a=[e.Math.toDegrees(n.longitude),e.Math.toDegrees(n.latitude)];if(o){if(c.pop(),o.y+=1+Math.random(),c.push(o),3==g.length&&(g.pop(),g.push(a)),2==g.length&&g.push(a),c.length>=2){var u=v.algorithm.doubleArrow(g);s.positions=u?u.polygonalPoint:null,s.custom=u?u.controlPoint:null,s._createPrimitive=!0}var p=3==c.length?"<p>双击可结束绘制</p>":"单击以增加一个新的控制点";h.showAt(r,p)}}}),e.ScreenSpaceEventType.MOUSE_MOVE),d.setInputAction((function(e){a.drawEnd(e,n)}),e.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},o.prototype.startDrawingExtent=function(t){t=w(t,a),this.startDrawing((function(){null!=h&&s.remove(h),c.remove(),g.destroy(),l.setVisible(!1)}));var r=this,n=this._scene,s=this._scene.primitives,l=this._tooltip,u=[],h=null,c=null,g=new e.ScreenSpaceEventHandler(n.canvas);g.setInputAction((function(a){if(null!=a.position){var l=n.camera.pickEllipsoid(a.position,i);if(l)if(null==h){var g=e.Cartographic.fromCartesian(l),f=e.Math.toDegrees(g.longitude),d=e.Math.toDegrees(g.latitude);u.push(f,d);var m=A(u,u);h=new o.ExtentPrimitive({extent:m,asynchronous:!1,material:t.material}),s.add(h),c=new o.BillboardGroup(r,p);var C=_([u,u]);c.addBillboards(C)}else r.stopDrawing(),"function"==typeof t.callback&&(g=e.Cartographic.fromCartesian(l),f=e.Math.toDegrees(g.longitude),d=e.Math.toDegrees(g.latitude),t.callback(A(u,[f,d])))}}),e.ScreenSpaceEventType.LEFT_DOWN),g.setInputAction((function(t){var r=t.endPosition;if(null!=r)if(null==h)l.showAt(r,"<p>点击开始绘制</p>");else{var o=n.camera.pickEllipsoid(r,i);if(o){var s=e.Cartographic.fromCartesian(o),a=e.Math.toDegrees(s.longitude),g=e.Math.toDegrees(s.latitude),p=A(u,[a,g]);h.setExtent(p);var f=_([u,[a,g]]);c.updateBillboardsPositions(f),l.showAt(r,"<p>拖动改变箭头</p><p>再次点击结束绘制</p>")}}}),e.ScreenSpaceEventType.MOUSE_MOVE)},o.prototype.enhancePrimitives=function(){var n=this;function s(t){n._scene,this._highlighted&&this._highlighted==t||!0!==this._editMode&&(this._highlighted=t,t?(n.setHighlighted(this),this._strokeColor=this.strokeColor,this.setStrokeStyle(e.Color.fromCssColorString("white"),this.strokeWidth)):this._strokeColor?this.setStrokeStyle(this._strokeColor,this.strokeWidth):this.setStrokeStyle(void 0,void 0))}function a(t){if(this._editMode!=t)if(n.disableAllHighlights(),t){n.setEdited(this);var s=n._scene,a=this;if(null==this._markers){var l=new o.BillboardGroup(n,f);r.billBoard.push(l);var u=new o.BillboardGroup(n,d);function h(e,t){var i=e-1<0?t.length-1:e-1;i<u.countBillboards()&&(u.getBillboard(i).position=p(i)),(i=e)<u.countBillboards()&&(u.getBillboard(i).position=p(i))}function c(){a.executeListeners({name:"onEdited",positions:a.positions})}r.billBoard.push(u);var g={dragHandlers:{onDrag:function(e,t){a.positions[e]=t,h(e,a.positions),a._createPrimitive=!0},onDragEnd:function(e,t){a._createPrimitive=!0,c()}},onDoubleClick:function(e){a.positions.length<4||(a.positions.splice(e,1),a._createPrimitive=!0,l.removeBillboard(e),u.removeBillboard(e),h(e,a.positions),c())},tooltip:function(){if(a.positions.length>3)return"Double click to remove this point"}};function p(t){var r=a.positions;return i.cartographicToCartesian(new e.EllipsoidGeodesic(i.cartesianToCartographic(r[t]),i.cartesianToCartographic(r[t<r.length-1?t+1:0])).interpolateUsingFraction(.5))}l.addBillboards(a.positions,g),this._markers=l;for(var m=[],C=0,y=a.positions.length+(this.isPolygon?0:-1);C<y;C++)m.push(p(C));var v={dragHandlers:{onDragStart:function(e,t){this.index=e+1,a.positions.splice(this.index,0,t),a._createPrimitive=!0},onDrag:function(e,t){a.positions[this.index]=t,a._createPrimitive=!0},onDragEnd:function(e,t){l.insertBillboard(this.index,t,g),u.getBillboard(this.index-1).position=p(this.index-1),u.insertBillboard(this.index,p(this.index),v),a._createPrimitive=!0,c()}},tooltip:function(){return"Drag to create a new point"}};u.addBillboards(m,v),this._editMarkers=u,this._globeClickhandler=new e.ScreenSpaceEventHandler(s.canvas),this._globeClickhandler.setInputAction((function(e){var t=s.pick(e.position);t&&t.primitive||a.setEditMode(!1)}),e.ScreenSpaceEventType.LEFT_CLICK),l.setOnTop(),u.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._editMarkers.remove(),this._markers=null,this._editMarkers=null,this._globeClickhandler.destroy()),this._editMode=!1}e.Billboard.prototype.setEditable=function(){if(!this._editable){this._editable=!0;var t=this,r=this;G(t,"leftDown",(function(s){function a(e){l.destroy(),o(!0),r.executeListeners({name:"dragEnd",positions:e})}var l=new e.ScreenSpaceEventHandler(n._scene.canvas);l.setInputAction((function(e){var o,s=n._scene.camera.pickEllipsoid(e.endPosition,i);s?(o=s,t.position=o,r.executeListeners({name:"drag",positions:o})):a(s)}),e.ScreenSpaceEventType.MOUSE_MOVE),l.setInputAction((function(e){a(n._scene.camera.pickEllipsoid(e.position,i))}),e.ScreenSpaceEventType.LEFT_UP),o(!1)})),S(t)}function o(e){n._scene.screenSpaceCameraController.enableRotate=e}},t.PolylinePrimitive.prototype.setEditable=function(){if(!this.setEditMode){this.isPolygon=!1,this.asynchronous=!1,n.registerEditableShape(this),this.setEditMode=a;var t=this.width;this.setHighlighted=function(e){!0!==this._editMode&&(e?(n.setHighlighted(this),this.setWidth(2*t)):this.setWidth(t))},this.getExtent=function(){return e.Extent.fromCartographicArray(i.cartesianArrayToCartographicArray(this.positions))},S(this),this.setEditMode(!1)}},t.PolygonPrimitive.prototype.setEditable=function(){var t=this;t.asynchronous=!1;var i=n._scene;n.registerEditableShape(t),t.setEditMode=function(s){if(this._editMode!=s)if(n.disableAllHighlights(),s){if(n.setEdited(this),null==this._markers){var a=new o.BillboardGroup(n,f);r.billBoard.push(a);var l={dragHandlers:{onDrag:function(e,i){var r=t.custom;r[e]=y(i);var o=v.algorithm.doubleArrow(r);t.positions=o.polygonalPoint,t.custom=o.controlPoint,t._createPrimitive=!0,a.updateBillboardsPositions(_(t.custom))},onDragEnd:function(e,i){t.executeListeners({name:"onEdited",positions:t.positions})}},tooltip:function(){return"拖动以钳击形状"}},u=t.custom;a.addBillboards(_(u),l),this._markers=a,this._globeClickhandler=new e.ScreenSpaceEventHandler(i.canvas),this._globeClickhandler.setInputAction((function(e){var r=i.pick(e.position);console.log("PolygonPrimitive单击"),r&&r.primitive||t.setEditMode(!1)}),e.ScreenSpaceEventType.LEFT_CLICK),a.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1},t.setHighlighted=s,S(t),t.setEditMode(!1)},t.TailedAttackPrimitive.prototype.setEditable=function(){var t=this;t.asynchronous=!1;var i=n._scene;n.registerEditableShape(t),t.setEditMode=function(s){if(this._editMode!=s)if(n.disableAllHighlights(),s){if(n.setEdited(this),null==this._markers){var a=new o.BillboardGroup(n,f);r.billBoard.push(a);var l={dragHandlers:{onDrag:function(e,i){var r=t.custom;r[e]=y(i);var o=v.algorithm.tailedAttackArrow(r);t.positions=o.polygonalPoint,t.custom=o.controlPoint,t._createPrimitive=!0,a.updateBillboardsPositions(_(t.custom))},onDragEnd:function(e,i){t.executeListeners({name:"onEdited",positions:t.positions})}},tooltip:function(){return"拖动以改变形状"}},u=t.custom;a.addBillboards(_(u),l),this._markers=a,this._globeClickhandler=new e.ScreenSpaceEventHandler(i.canvas),this._globeClickhandler.setInputAction((function(e){var r=i.pick(e.position);console.log("TailedAttackPrimitive单击"),r&&r.primitive||t.setEditMode(!1)}),e.ScreenSpaceEventType.LEFT_CLICK),a.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1},t.setHighlighted=s,S(t),t.setEditMode(!1)},t.ExtentPrimitive.prototype.setEditable=function(){if(!this.setEditMode){var t=this,i=n._scene;n.registerEditableShape(t),t.asynchronous=!1,t.setEditMode=function(s){if(this._editMode!=s)if(n.disableAllHighlights(),s){if(n.setEdited(this),null==this._markers){var a=new o.BillboardGroup(n,f);r.billBoard.push(a);var l={dragHandlers:{onDrag:function(e,i){var r=y(i),o=y(a.getBillboard((e+1)%2).position),n=0==e?A(r,o):A(o,r);t.setExtent(n),a.updateBillboardsPositions(m(t.extent))},onDragEnd:function(e,i){t.executeListeners({name:"onEdited",extent:t.extent})}},tooltip:function(){return"拖动以改变此箭头形状"}};a.addBillboards(m(t.extent),l),this._markers=a,this._globeClickhandler=new e.ScreenSpaceEventHandler(i.canvas),this._globeClickhandler.setInputAction((function(e){var r=i.pick(e.position);console.log("ExtentPrimitive单击"),r&&r.primitive||t.setEditMode(!1)}),e.ScreenSpaceEventType.LEFT_CLICK),a.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1},t.setHighlighted=s,S(t),t.setEditMode(!1)}}},o.DrawHelperWidget=function(t,i){if(!e.defined(i.container))throw new e.DeveloperError("Container is required");b(i,{markerIcon:"./img/glyphicons_242_google_maps.png",polylineIcon:"./img/glyphicons_097_vector_path_line.png",polygonIcon:"./img/qianjijiantou.png",circleIcon:"./img/glyphicons_095_vector_path_circle.png",tailedAttackArrowIcon:"./img/gongjijiantou.png",extentIcon:"./img/zhijiaojiantou.png",clearIcon:"./img/glyphicons_067_cleaning.png",polylineDrawingOptions:c,polygonDrawingOptions:l,extentDrawingOptions:u,circleDrawingOptions:h});var o=this,n=document.createElement("DIV");function s(e,t,i,r){var o=document.createElement("DIV");o.className="button",o.title=i,n.appendChild(o),o.onclick=r;var s=document.createElement("SPAN");o.appendChild(s);var a=document.createElement("IMG");return a.src=t,s.appendChild(a),o}n.className="toolbar",i.container.appendChild(n);var a=t._scene;s(0,i.extentIcon,"点击以绘制直箭头",(function(){t.startDrawingExtent({callback:function(e){o.executeListeners({name:"extentCreated",extent:e})}})})),s(0,i.polygonIcon,"点击以绘制钳击箭头",(function(){t.startDrawingPolygon({callback:function(e,t){o.executeListeners({name:"polygonCreated",positions:e,custom:t})}})})),s(0,i.tailedAttackArrowIcon,"点击以绘制攻击箭头",(function(){t.startDrawingTailedAttack({callback:function(e,t){o.executeListeners({name:"tailedAttackCreated",positions:e,custom:t})}})}));var g=document.createElement("DIV");g.className="divider",n.appendChild(g),s(0,i.clearIcon,"Remove all primitives",(function(){for(var e=r.primitives.length,t=r.billBoard.length,i=0;i<e;i++){var o=r.primitives.pop();o._globeClickhandler.destroy(),a.primitives.remove(o)}for(i=0;i<t;i++)r.billBoard.pop().remove()})),S(this)},o.prototype.addToolbar=function(e,t){return t=w(t,{container:e}),new o.DrawHelperWidget(this,t)},o.DrawWidget=function(e,t){var i=this;"extentCreated"==t&&e.startDrawingExtent({callback:function(e){i.executeListeners({name:"extentCreated",extent:e})}}),"polygonCreated"==t&&e.startDrawingPolygon({callback:function(e,t){i.executeListeners({name:"polygonCreated",positions:e,custom:t})}}),"tailedAttackCreated"==t&&e.startDrawingTailedAttack({callback:function(e,t){i.executeListeners({name:"tailedAttackCreated",positions:e,custom:t})}}),S(this)},o.ClearWidget=function(){var e=drawHelper._scene,t=r.primitives.length,i=r.billBoard.length;if(0!=t&&r.primitives[t-1]._editMode){for(var o=0;o<1;o++){var n=r.primitives[t-1];n._globeClickhandler.destroy(),e.primitives.remove(n)}for(o=0;o<1;o++)r.billBoard[i-1].remove();r={billBoard:[],primitives:[]},S(this)}},o.prototype.active=function(e){return new o.DrawWidget(this,e)},o.prototype.clear=function(){return new o.ClearWidget(this)},o}()}(window.Cesium);var E={version:"1.0.0",PlotUtils:{}};if(E.PlotUtils.distance=function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},E.PlotUtils.wholeDistance=function(e){for(var t=0,i=0;i<e.length-1;i++)t+=E.PlotUtils.distance(e[i],e[i+1]);return t},E.PlotUtils.getBaseLength=function(e){return Math.pow(E.PlotUtils.wholeDistance(e),.99)},E.PlotUtils.mid=function(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]},E.PlotUtils.getCircleCenterOfThreePoints=function(e,t,i){var r=[(e[0]+t[0])/2,(e[1]+t[1])/2],o=[r[0]-e[1]+t[1],r[1]+e[0]-t[0]],n=[(e[0]+i[0])/2,(e[1]+i[1])/2],s=[n[0]-e[1]+i[1],n[1]+e[0]-i[0]];return E.PlotUtils.getIntersectPoint(r,o,n,s)},E.PlotUtils.getIntersectPoint=function(e,t,i,r){if(e[1]==t[1]){var o=(r[0]-i[0])/(r[1]-i[1]),n=o*(e[1]-i[1])+i[0],s=e[1];return[n,s]}if(i[1]==r[1]){var a=(t[0]-e[0])/(t[1]-e[1]);return[n=a*(i[1]-e[1])+e[0],s=i[1]]}return a=(t[0]-e[0])/(t[1]-e[1]),o=(r[0]-i[0])/(r[1]-i[1]),[n=a*(s=(a*e[1]-e[0]-o*i[1]+i[0])/(a-o))-a*e[1]+e[0],s]},E.PlotUtils.getAzimuth=function(e,t){var i,r=Math.asin(Math.abs(t[1]-e[1])/E.PlotUtils.distance(e,t));return t[1]>=e[1]&&t[0]>=e[0]?i=r+Math.PI:t[1]>=e[1]&&t[0]<e[0]?i=E.Constants.TWO_PI-r:t[1]<e[1]&&t[0]<e[0]?i=r:t[1]<e[1]&&t[0]>=e[0]&&(i=Math.PI-r),i},E.PlotUtils.getAngleOfThreePoints=function(e,t,i){var r=E.PlotUtils.getAzimuth(t,e)-E.PlotUtils.getAzimuth(t,i);return 0>r?r+E.Constants.TWO_PI:r},E.PlotUtils.isClockWise=function(e,t,i){return(i[1]-e[1])*(t[0]-e[0])>(t[1]-e[1])*(i[0]-e[0])},E.PlotUtils.getPointOnLine=function(e,t,i){return[t[0]+e*(i[0]-t[0]),t[1]+e*(i[1]-t[1])]},E.PlotUtils.getCubicValue=function(e,t,i,r,o){var n=1-(e=Math.max(Math.min(e,1),0)),s=e*e,a=s*e,l=n*n,u=l*n;return[u*t[0]+3*l*e*i[0]+3*n*s*r[0]+a*o[0],u*t[1]+3*l*e*i[1]+3*n*s*r[1]+a*o[1]]},E.PlotUtils.getThirdPoint=function(e,t,i,r,o){var n=E.PlotUtils.getAzimuth(e,t),s=o?n+i:n-i,a=r*Math.cos(s),l=r*Math.sin(s);return[t[0]+a,t[1]+l]},E.PlotUtils.getArcPoints=function(e,t,i,r){var o,n,s=[],a=r-i;a=0>a?a+E.Constants.TWO_PI:a;for(var l=0;l<=E.Constants.FITTING_COUNT;l++){var u=i+a*l/E.Constants.FITTING_COUNT;o=e[0]+t*Math.cos(u),n=e[1]+t*Math.sin(u),s.push([o,n])}return s},E.PlotUtils.getBisectorNormals=function(e,t,i,r){var o=E.PlotUtils.getNormal(t,i,r),n=Math.sqrt(o[0]*o[0]+o[1]*o[1]),s=o[0]/n,a=o[1]/n,l=E.PlotUtils.distance(t,i),u=E.PlotUtils.distance(i,r);if(n>E.Constants.ZERO_TOLERANCE)if(E.PlotUtils.isClockWise(t,i,r)){var h=e*l,c=i[0]-h*a,g=i[1]+h*s,p=[c,g];h=e*u;var f=[c=i[0]+h*a,g=i[1]-h*s]}else h=e*l,p=[c=i[0]+h*a,g=i[1]-h*s],h=e*u,f=[c=i[0]-h*a,g=i[1]+h*s];else p=[c=i[0]+e*(t[0]-i[0]),g=i[1]+e*(t[1]-i[1])],f=[c=i[0]+e*(r[0]-i[0]),g=i[1]+e*(r[1]-i[1])];return[p,f]},E.PlotUtils.getNormal=function(e,t,i){var r=e[0]-t[0],o=e[1]-t[1],n=Math.sqrt(r*r+o*o);r/=n,o/=n;var s=i[0]-t[0],a=i[1]-t[1],l=Math.sqrt(s*s+a*a);return[r+(s/=l),o+(a/=l)]},E.PlotUtils.getCurvePoints=function(e,t){for(var i=[E.PlotUtils.getLeftMostControlPoint(t)],r=0;r<t.length-2;r++){var o=t[r],n=t[r+1],s=t[r+2],a=E.PlotUtils.getBisectorNormals(e,o,n,s);i=i.concat(a)}var l=E.PlotUtils.getRightMostControlPoint(t);i.push(l);var u=[];for(r=0;r<t.length-1;r++){for(o=t[r],n=t[r+1],u.push(o),e=0;e<E.Constants.FITTING_COUNT;e++){var h=E.PlotUtils.getCubicValue(e/E.Constants.FITTING_COUNT,o,i[2*r],i[2*r+1],n);u.push(h)}u.push(n)}return u},E.PlotUtils.getLeftMostControlPoint=function(e){var i=e[0],r=e[1],o=e[2],n=E.PlotUtils.getBisectorNormals(0,i,r,o)[0],s=E.PlotUtils.getNormal(i,r,o);if(Math.sqrt(s[0]*s[0]+s[1]*s[1])>E.Constants.ZERO_TOLERANCE)var a=E.PlotUtils.mid(i,r),l=i[0]-a[0],u=i[1]-a[1],h=2/E.PlotUtils.distance(i,r),c=-h*u,g=h*l,p=c*c-g*g,f=2*c*g,d=g*g-c*c,m=n[0]-a[0],C=n[1]-a[1],y=a[0]+p*m+f*C,v=a[1]+f*m+d*C;else y=i[0]+t*(r[0]-i[0]),v=i[1]+t*(r[1]-i[1]);return[y,v]},E.PlotUtils.getRightMostControlPoint=function(e){var i=e.length,r=e[i-3],o=e[i-2],n=e[i-1],s=E.PlotUtils.getBisectorNormals(0,r,o,n)[1],a=E.PlotUtils.getNormal(r,o,n);if(Math.sqrt(a[0]*a[0]+a[1]*a[1])>E.Constants.ZERO_TOLERANCE)var l=E.PlotUtils.mid(o,n),u=n[0]-l[0],h=n[1]-l[1],c=2/E.PlotUtils.distance(o,n),g=-c*h,p=c*u,f=g*g-p*p,d=2*g*p,m=p*p-g*g,C=s[0]-l[0],y=s[1]-l[1],v=l[0]+f*C+d*y,A=l[1]+d*C+m*y;else v=n[0]+t*(o[0]-n[0]),A=n[1]+t*(o[1]-n[1]);return[v,A]},E.PlotUtils.getBezierPoints=function(e){if(e.length<=2)return e;for(var t=[],i=e.length-1,r=0;1>=r;r+=.01){for(var o=y=0,n=0;i>=n;n++){var s=E.PlotUtils.getBinomialFactor(i,n),a=Math.pow(r,n),l=Math.pow(1-r,i-n);o+=s*a*l*e[n][0],y+=s*a*l*e[n][1]}t.push([o,y])}return t.push(e[i]),t},E.PlotUtils.getBinomialFactor=function(e,t){return E.PlotUtils.getFactorial(e)/(E.PlotUtils.getFactorial(t)*E.PlotUtils.getFactorial(e-t))},E.PlotUtils.getFactorial=function(e){if(1>=e)return 1;if(2==e)return 2;if(3==e)return 6;if(4==e)return 24;if(5==e)return 120;for(var t=1,i=1;e>=i;i++)t*=i;return t},E.PlotUtils.getQBSplinePoints=function(e){if(e.length<=2)return e;var t=[],i=e.length-2-1;t.push(e[0]);for(var r=0;i>=r;r++)for(var o=0;1>=o;o+=.05){for(var n=y=0,s=0;2>=s;s++){var a=E.PlotUtils.getQuadricBSplineFactor(s,o);n+=a*e[r+s][0],y+=a*e[r+s][1]}t.push([n,y])}return t.push(e[e.length-1]),t},E.PlotUtils.getQuadricBSplineFactor=function(e,t){return 0==e?Math.pow(t-1,2)/2:1==e?(-2*Math.pow(t,2)+2*t+1)/2:2==e?Math.pow(t,2)/2:0},E.Constants={TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,FITTING_COUNT:100,ZERO_TOLERANCE:1e-4},function(e){var t=e.MeasureAreaWidget=function(t,i){this.viewer=t.viewer,this.color=t.color?t.color:e.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=t.lineWidth?t.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.count=0,this.entityNames=[],this.labelNames=[]};function i(t,i,r,o){var n=t.add(new e.LabelCollection);n.name="result_labelArea"+o,n.add({text:i,font:"16px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY}),n.get(n.length-1).position=r[r.length-1]}function r(e,t){for(var i=0;i<t.length;i++)void 0!==t.get(i).name&&t.get(i).name.indexOf(e)>-1&&(t.remove(t.get(i)),i--)}function o(e,t){for(var i=t.values,r=0;r<i.length;r++)i[r].name.indexOf(e)>-1&&(t.remove(i[r]),r--)}t.prototype.activate=function(){if(this.handler=this.handler&&this.handler.destroy(),!this.handler){this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var t,i,r,o=this,n=[];this._array_=n,this._polylines_=t,this._labels_=i,this.handler.setInputAction((function(i){o.lastP=i;var s=o.camera.getPickRay(i.position),a=o.scene.globe.pick(s,o.scene);a&&(n.push(a),1==n.length&&((t=o.primitives.add(new e.PolylineCollection)).name="draw_polyline",t.add({polyline:{}}),t.get(t.length-1).width=o.lineWidth,t.get(t.length-1).loop=!0,t.get(t.length-1).material.uniforms.color=o.color,t.get(t.length-1).positions=n),n.length>=3&&(t.get(t.length-1).positions=n,/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)&&o.measureEnd()),o._polylines_=t,/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)&&((r=o.primitives.add(new e.PointPrimitiveCollection)).name="draw_point",r.add({position:a,color:e.Color.WHITE,outlineColor:e.Color.RED,outlineWidth:1,pixelSize:5})))}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(r){if(!/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)){var s=o.camera.getPickRay(r.endPosition),a=o.scene.globe.pick(s,o.scene);if(!a)return void(i&&(o.primitives.remove(i),i=null));if(n.length>=1){var l=n.concat();l.push(a),t.get(t.length-1).positions=l}i||((i=o.primitives.add(new e.LabelCollection)).name="draw_label",i.add({text:"左键单击开始绘制，右键单击结束绘制",font:"16px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY})),i.get(i.length-1).position=a,o._labels_=i}}),e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction((function(e){o.measureEnd(),o.handler=o.handler&&o.handler.destroy(),o.viewer.canvas.style.cursor="default"}),e.ScreenSpaceEventType.RIGHT_CLICK)}},t.prototype.selectFeatures=function(t){this.handler=this.handler&&this.handler.destroy(),this.handler=new e.ScreenSpaceEventHandler(this.canvas);var i=this;this.handler.setInputAction((function(t){var r=i.viewer.scene.pick(new e.Cartesian2(t.position.x,t.position.y));if(null!=r&&null!=r.id&&null!=r.id.polygon){r.id.polygon.material.color=e.Color.CHARTREUSE;var o=r.id.name,n=o.replace(/draw_polygon/,"result_labelArea");i.entityNames.push(o),i.labelNames.push(n)}}),e.ScreenSpaceEventType.LEFT_CLICK)},t.prototype.delete=function(){this.handler=this.handler&&this.handler.destroy();for(var e=0;e<this.entityNames.length;e++)o(this.entityNames[e],this.viewer.entities);for(var t=0;t<this.labelNames.length;t++)r(this.labelNames[t],this.primitives);this.count=0,this.entityNames=[],this.labelNames=[]},t.prototype.measureEnd=function(t){if(null!=this._array_&&0!=this._array_.length){this._labels_&&(this.primitives.remove(this._labels_),this._labels_=null),t||(t=this.lastP);var r=this.camera.getPickRay(t.position),o=this.scene.globe.pick(r,this.scene);if(o){this._array_.push(o),this._polylines_.get(this._polylines_.length-1).material.uniforms.color=e.Color.CHARTREUSE.withAlpha(0),this.viewer.entities.add({name:"draw_polygon"+this.count,polygon:{hierarchy:{positions:this._array_},material:this.color}});for(var n=[],s=0;s<this._array_.length;s++){var a=e.Cartographic.fromCartesian(this._array_[s]),l=e.Math.toDegrees(a.longitude),u=e.Math.toDegrees(a.latitude);n.push([l,u])}n.push(n[0]);var h,c=turf.polygon([n]),g=turf.area(c);h=g<1e6?"总面积："+g.toFixed(2)+"m²":"总面积："+(g/1e6).toFixed(2)+"km²",/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)?this.primitives.length>4?(this.primitives.remove(this.primitives.get(this.primitives.length-2)),i(this.primitives,h,this._array_)):i(this.primitives,h,this._array_):(i(this.primitives,h,this._array_,this.count),this.count++)}}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",r("result_labelArea",this.primitives),r("draw_label",this.primitives),r("draw_polyline",this.primitives),o("draw_polygon",this.viewer.entities)}}(window.Cesium),function(e){var t=e.MeasureDistanceWidget=function(t,i){this.viewer=t.viewer,this.color=t.color?t.color:e.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=t.lineWidth?t.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.entities=this.viewer.entities,this.ellipsoid=this.scene.globe.ellipsoid,this.mode=t.mode?t.mode:1,this.count=0,this.tags=[]};function i(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}function r(e,t){for(var i=0;i<t.length;i++)t.get(i).tag==e&&(t.remove(t.get(i)),i--)}function o(e,t){for(var i=t.values,r=0;r<i.length;r++)i[r].tag==e&&(t.remove(i[r]),r--)}t.prototype.activate=function(){var t=this;t.count++,this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var i,r,o,n=[];this._array_=n,this._polylines_=i,this._labels_=r,this.handler.setInputAction((function(r){t.lastP=r;var s=t.camera.getPickRay(r.position),a=t.scene.globe.pick(s,t.scene);if(a){var l=e.Cartographic.fromCartesian(a),u=e.Math.toDegrees(l.longitude),h=e.Math.toDegrees(l.latitude),c=l.height;n.push(u),n.push(h),n.push(c),3==n.length&&((i=t.primitives.add(new e.PolylineCollection)).tag=t.mode+"_"+t.count,i.name="draw_polyline",i.add({polyline:{}}),i.get(i.length-1).width=t.lineWidth,i.get(i.length-1).material.uniforms.color=t.color,i.get(i.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(n)),n.length>3&&(i.get(i.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(n)),t._polylines_=i,(o=t.primitives.add(new e.PointPrimitiveCollection)).tag=t.mode+"_"+t.count,o.name="draw_point",o.add({position:a,color:e.Color.WHITE,outlineColor:e.Color.RED,outlineWidth:1,pixelSize:t.pixelSize}),t.flag=!1,t.measureEnd(r)}}),e.ScreenSpaceEventType.LEFT_DOWN),this.handler.setInputAction((function(o){var s=t.camera.getPickRay(o.endPosition),a=t.scene.globe.pick(s,t.scene);if(a){var l=e.Cartographic.fromCartesian(a),u=e.Math.toDegrees(l.longitude),h=e.Math.toDegrees(l.latitude),c=l.height;if(/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent))r=null;else{if(n.length>=3){var g=n.concat();g.push(u),g.push(h),g.push(c),i.get(i.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(g)}r||((r=t.primitives.add(new e.LabelCollection)).name="draw_label",r.tag=t.mode+"_"+t.count,r.add({text:"左键单击开始绘制，右键单击结束绘制",font:"16px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY})),r.get(r.length-1).position=e.Cartesian3.fromDegrees(u,h,c)}t._labels_=r}else r&&(t.primitives.remove(r),r=null)}),e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction((function(i){t.flag=!0,i=t.lastP;var r=t.camera.getPickRay(i.position),n=t.scene.globe.pick(r,t.scene);if(n){var s=e.Cartographic.fromCartesian(n),a=e.Math.toDegrees(s.longitude),l=e.Math.toDegrees(s.latitude),u=s.height;(o=t.primitives.add(new e.PointPrimitiveCollection)).tag=t.mode+"_"+t.count,o.name="draw_point",o.add({position:n,color:e.Color.WHITE,outlineColor:e.Color.RED,outlineWidth:1,pixelSize:t.pixelSize}),t._array_.push(a),t._array_.push(l),t._array_.push(u),t.measureEnd(i),t.handler=t.handler&&t.handler.destroy(),t.viewer.canvas.style.cursor="default",t._array_=[],t._polylines_=null}}),e.ScreenSpaceEventType.RIGHT_CLICK)},t.prototype.measureEnd=function(t){if(null!=this._array_&&0!=this._array_.length){if(/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent))this._array_=this._array_;else if(!t){t=this.lastP;var i=this.camera.getPickRay(t.position),r=this.scene.globe.pick(i,this.scene);if(!r)return;var o=e.Cartographic.fromCartesian(r),n=e.Math.toDegrees(o.longitude),s=e.Math.toDegrees(o.latitude),a=o.height;this._array_[this._array_.length-1]==a&&this._array_[this._array_.length-2]==s&&this._array_[this._array_.length-3]==n?this._array_=this._array_:(this._array_.push(n),this._array_.push(s),this._array_.push(a))}this._labels_&&(this.primitives.remove(this._labels_),this._labels_=null);var l=this.mode;if(2==this.mode){var u=function(t,i){for(var r=[],o=0;o<t.length/3-1;o++){var n=3*o,s=t[n],a=t[n+1],l=t[n+2],u=t[n+3],h=t[n+4],c=t[n+5];r.push(s),r.push(a),r.push(l);for(var g=0;g<100;g++){var p={longitude:e.Math.toRadians(s),latitude:e.Math.toRadians(a),height:l},f={longitude:e.Math.toRadians(u),latitude:e.Math.toRadians(h),height:c},d=e.Math.lerp(p.longitude,f.longitude,.01*(g+1)),m=e.Math.lerp(p.latitude,f.latitude,.01*(g+1)),C={longitude:d,latitude:m},y=i.globe.getHeight(C);r.push(e.Math.toDegrees(d)),r.push(e.Math.toDegrees(m)),r.push(y)}r.push(u),r.push(h),r.push(c)}return r}(this._array_,this.scene);this._polylines_.get(this._polylines_.length-1).material.uniforms.color=e.Color.CHARTREUSE.withAlpha(0),this.viewer.entities.add({tag:this.mode+"_"+this.count,name:"draw_polyline",polyline:{positions:e.Cartesian3.fromDegreesArrayHeights(u),width:this.lineWidth,material:this.color}})}var h,c,g,p,f,d,m,C=e.Cartesian3.fromDegreesArrayHeights(this._array_),y=0,v=new e.EllipsoidGeodesic;if(1==l){for(var A=1;A<C.length;A++){var _=e.Cartographic.fromCartesian(C[A-1]),I=e.Math.toDegrees(_.longitude),b=e.Math.toDegrees(_.latitude),w=e.Cartographic.fromCartesian(C[A]),G=e.Math.toDegrees(w.longitude),E=e.Math.toDegrees(w.latitude),S=turf.point([I,b]),P=turf.point([G,E]);y+=turf.distance(S,P)}h=0==y?"起点":y>0&&y<1?this.flag?"总长："+(1e3*y).toFixed(2)+"m":(1e3*y).toFixed(2)+"m":this.flag?"总长："+y.toFixed(2)+"km":y.toFixed(2)+"km"}else if(2==l){for(A=1;A<C.length;A++){var T=e.Cartographic.fromCartesian(C[A-1]),x=e.Cartographic.fromCartesian(C[A]);v.setEndPoints(T,x),y+=Math.round(v.surfaceDistance),y=Number(y)}h=0==y?"起点":y>0&&y<1e3?this.flag?"总长："+y.toFixed(2)+"m":y.toFixed(2)+"m":this.flag?"总长："+(y/1e3).toFixed(2)+"km":(y/1e3).toFixed(2)+"km"}c=l,g=this.count,f=h,d=C,(m=(p=this.primitives).add(new e.LabelCollection)).name="result_label",m.tag=c+"_"+g,m.add({text:f,font:"16px sans-serif",showBackground:!0,backgroundColor:new e.Color(1,0,0,.3),pixelOffset:new e.Cartesian2(10,10),disableDepthTestDistance:Number.POSITIVE_INFINITY}),m.get(m.length-1).position=d[d.length-1],p.length>3&&"result_label"==p._primitives[p.length-3].name&&(p._primitives[p.length-3]._labels[0].backgroundColor=new e.Color(0,1,0,.3))}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_point",this.primitives),i("result_label",this.primitives),i("draw_label",this.primitives),i("draw_polyline",this.primitives),function(e,t){for(var i=t.values,r=0;r<i.length;r++)"draw_polyline"==i[r].name&&(t.remove(i[r]),r--)}(0,this.viewer.entities)},t.prototype.selectFeatures=function(){var t=this;this.handler||(this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction((function(i){var r=viewer.scene.pick(i.position);r&&(r.primitive._polylineCollection&&(t.tags.push(r.primitive._polylineCollection.tag),r.primitive.material.uniforms.color=e.Color.YELLOW.withAlpha(.5)),r.id&&r.id._polyline&&(t.tags.push(r.id.tag),r.id._polyline.material.color=e.Color.YELLOW.withAlpha(.5)))}),e.ScreenSpaceEventType.LEFT_CLICK))},t.prototype.delete=function(e){if(this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",this.tags&&this.tags.length>0)for(var t=0;t<this.tags.length;t++)r(this.tags[t],this.primitives),o(this.tags[t],this.viewer.entities)}}(window.Cesium),function(e){var t=e.MeasureElevationWidget=function(t,i){this.viewer=t.viewer,this.color=t.color?t.color:e.Color.YELLOW,this.pixelSize=t.pixelSize?t.pixelSize:10,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.count=0,this.tags=[]};function i(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}function r(e,t){for(var i=0;i<t.length;i++)t.get(i).tag==e&&(t.remove(t.get(i)),i--)}t.prototype.activate=function(){this.count++,this.handler&&(this.handler=this.handler&&this.handler.destroy()),this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var t,i,r=this,o=[];this.handler.setInputAction((function(n){var s=r.camera.getPickRay(n.position),a=r.scene.globe.pick(s,r.scene);if(a){o[0]=a,t?t.removeAll():((t=r.primitives.add(new e.PointPrimitiveCollection)).tag=r.count,t.name="draw_point"),t.add({position:a,color:r.color,pixelSize:r.pixelSize}),r.handler=r.handler&&r.handler.destroy(),r.viewer.canvas.style.cursor="default",i&&(r.primitives.remove(i),i=null);var l,u,h,c,g,p="高程值："+e.Cartographic.fromCartesian(o[0]).height.toFixed(2)+"m";l=r.primitives,u=p,h=o,c=r.count,(g=l.add(new e.LabelCollection)).name="result_label",g.tag=c,g.add({text:u,font:"16px sans-serif",showBackground:!0,pixelOffset:new e.Cartesian2(6,2),disableDepthTestDistance:Number.POSITIVE_INFINITY}),g.get(g.length-1).position=h[h.length-1]}}),e.ScreenSpaceEventType.LEFT_DOWN)},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("result_label",this.primitives),i("draw_point",this.primitives)},t.prototype.selectFeatures=function(){var t=this;this.handler||(this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction((function(i){var r=viewer.scene.pick(i.position);"draw_point"===r.collection.name?r.primitive&&(t.tags.push(r.collection.tag),r.primitive.color=e.Color.YELLOW.withAlpha(.5)):alert("您选择的不是高程点！")}),e.ScreenSpaceEventType.LEFT_CLICK))},t.prototype.delete=function(e){if(this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",this.tags&&this.tags.length>0)for(var t=0;t<this.tags.length;t++)r(this.tags[t],this.primitives)}}(window.Cesium),function(e){var t=e.MeasureHeightWidget=function(t,i){this.viewer=t.viewer,this.color=t.color?t.color:e.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=t.lineWidth?t.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=i||function(){},this.count=0,this.entityNames=[],this.labelNames=[],this.pointNames=[]};function i(t,i,r,o){var n=t.add(new e.LabelCollection);n.name="result_labelHeight"+o,n.add({text:i,font:"16px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY}),n.get(n.length-1).position=e.Cartesian3.fromDegrees(r[r.length-3],r[r.length-2],r[r.length-1])}function r(e,t){for(var i=0;i<t.length;i++)void 0!==t.get(i).name&&t.get(i).name.indexOf(e)>-1&&(t.remove(t.get(i)),i--)}function o(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}t.prototype.activate=function(){if(this.handler=this.handler&&this.handler.destroy(),!this.handler){this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var t,i,r=this,o=[];this._array_=o,this._polylines_=t,this._labels_=void 0,this.handler.setInputAction((function(n){var s=r.camera.getPickRay(n.position),a=r.scene.globe.pick(s,r.scene);if(a){var l=e.Cartographic.fromCartesian(a),u=e.Math.toDegrees(l.longitude),h=e.Math.toDegrees(l.latitude),c=l.height;o.length>0&&(9==o.length&&(o[3]=u,o[4]=h,o[5]=c,o[2]>=o[5]?(o[6]=o[0],o[7]=o[1],o[8]=o[5]):(o[6]=o[3],o[7]=o[4],o[8]=o[2]),t.get(t.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(o)),(i=r.primitives.add(new e.PointPrimitiveCollection)).name="draw_point"+r.count,i.add({position:a,color:r.color,pixelSize:r.pixelSize}),r._array_=o,r.measureEnd()),0==o.length&&(o.push(u),o.push(h),o.push(c),o.push(u),o.push(h),o.push(c),o.push(u),o.push(h),o.push(c),(t=r.primitives.add(new e.PolylineCollection)).name="draw_polyline"+r.count,t.add({polyline:{}}),t.get(t.length-1).width=r.lineWidth,t.get(t.length-1).loop=!0,t.get(t.length-1).material.uniforms.color=r.color,t.get(t.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(o),(i=r.primitives.add(new e.PointPrimitiveCollection)).name="draw_point"+r.count,i.add({position:a,color:r.color,pixelSize:r.pixelSize}))}}),e.ScreenSpaceEventType.LEFT_CLICK)}},t.prototype.selectFeatures=function(t){this.handler=this.handler&&this.handler.destroy(),this.handler=new e.ScreenSpaceEventHandler(this.canvas);var i=this;this.handler.setInputAction((function(t){var r=i.viewer.scene.pick(t.position);if(null!=r){if(null!=r.collection&&null!=r.collection.name&&null!=r.primitive&&null!=r.primitive.material){r.primitive.material.uniforms.color=e.Color.CHARTREUSE;var o=r.collection.name,n=o.replace(/draw_polyline/,"result_labelHeight"),s=o.replace(/draw_polyline/,"draw_point");i.entityNames.push(o),i.labelNames.push(n),i.pointNames.push(s)}}else alert("没有选中目标")}),e.ScreenSpaceEventType.LEFT_CLICK)},t.prototype.delete=function(e){this.handler=this.handler&&this.handler.destroy();for(var t=0;t<this.entityNames.length;t++)o(this.entityNames[t],this.primitives);for(var i=0;i<this.labelNames.length;i++)o(this.labelNames[i],this.primitives);for(i=0;i<this.pointNames.length;i++)o(this.pointNames[i],this.primitives);this.count=0,this.entityNames=[],this.labelNames=[],this.pointNames=[]},t.prototype.measureEnd=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",this._labels_&&(this.primitives.remove(this._labels_),this._labels_=null);var e=1e3*turf.distance(turf.point([this._array_[0],this._array_[1]]),turf.point([this._array_[3],this._array_[4]]));(o=[]).push((this._array_[0]+this._array_[3])/2),o.push((this._array_[1]+this._array_[4])/2),this._array_[2]>=this._array_[5]?o.push(this._array_[5]):o.push(this._array_[2]),t=e<1e3?"水平距离："+e.toFixed(2)+"m":"水平距离："+(e/1e3).toFixed(2)+"km",i(this.primitives,t,o,this.count);var t,r=Math.abs(this._array_[2]-this._array_[5]),o=[];this._array_[2]>=this._array_[5]?(o.push(this._array_[0]),o.push(this._array_[1])):(o.push(this._array_[3]),o.push(this._array_[4])),o.push((this._array_[2]+this._array_[5])/2),t=r<1e3?"垂直高度："+r.toFixed(2)+"m":"垂直高度："+(r/1e3).toFixed(2)+"km",i(this.primitives,t,o,this.count),(o=[]).push((this._array_[0]+this._array_[3])/2),o.push((this._array_[1]+this._array_[4])/2),o.push((this._array_[2]+this._array_[5])/2);var n=Math.sqrt(Math.pow(e,2)+Math.pow(r,2));t=n<1e3?"空间距离："+n.toFixed(2)+"m":"空间距离："+(n/1e3).toFixed(2)+"km",i(this.primitives,t,o,this.count),this.count++,this.callback(e,r,n,this._array_)},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",r("result_labelHeight",this.primitives),r("draw_label",this.primitives),r("draw_polyline",this.primitives),r("draw_point",this.primitives)}}(window.Cesium),function(e){e.Map=function(t,i){if((i=i||{}).baseLayerPicker=e.defaultValue(i.baseLayerPicker,!1),i.timeline=e.defaultValue(i.timeline,!1),i.animation=e.defaultValue(i.animation,!1),i.homeButton=e.defaultValue(i.homeButton,!1),i.navigationHelpButton=e.defaultValue(i.navigationHelpButton,!1),i.orderIndependentTranslucency=e.defaultValue(i.orderIndependentTranslucency,!0),i.sceneMode=e.defaultValue(i.sceneMode,e.SceneMode.SCENE3D),i.scene3DOnly=e.defaultValue(i.scene3DOnly,!0),i.maxLevel=e.defaultValue(i.maxLevel,25),i.geocoder=e.defaultValue(i.geocoder,!1),i.fullscreenButton=e.defaultValue(i.fullscreenButton,!1),!e.defined(i.imageryProvider)){var r=function(){for(var e="",t=new RegExp("(^|(.*?\\/))(Cesium.js)(\\?|$)"),i=document.getElementsByTagName("script"),r=0,o=i.length;r<o;r++){var n=i[r].getAttribute("src");if(n){var s=n.match(t);if(s){e=s[1];break}}}return e}(),o=new e.SingleTileImageryProvider({url:r+"Assets/Images/Earth.jpg",rectangle:e.Rectangle.fromDegrees(-180,-90,180,90)});i.imageryProvider=o}return new e.Viewer(t,i)}}(window.Cesium),function(e){var t=e.defaultValue,i=e.GeoClipping=function(i,r){i=t(i,e.defaultValue.EMPTY_OBJECT),this.steps=t(i.steps,64),this.edgeWidth=t(i.edgeWidth,2),this.edgeColor=t(i.edgeColor,e.Color.WHITE),this.cylinderRadius=t(i.cylinderRadius,50),this.clippingModeUnion=t(i.clippingModeUnion,!0),this.enabled=t(i.enabled,!0),this.clippingPlanes=void 0,this.modelEntityClippingPlanes=void 0};i.prototype.computePlanes=function(t){t=e.defined(t)?t:this.steps;for(var i=e.Math.TWO_PI/t,r=[],o=0;o<t;o++){var n=o*i,s=new e.Cartesian3;s.x=1,s.y=Math.tan(n),n>e.Math.PI_OVER_TWO&&(s.x=-1,s.y*=-1),n>e.Math.PI&&(s.x=-1),n>3*e.Math.PI_OVER_TWO&&(s.x=1,s.y=-s.y),e.Cartesian3.normalize(s,s);var a=new e.ClippingPlane(s,this.cylinderRadius);r.push(a)}return this.clippingPlanes=r,r},i.prototype.createClippingPlanes=function(t,i){for(var r=new e.ClippingPlaneCollection({modelMatrix:e.defined(t)?t:e.Matrix4.IDENTITY,edgeWidth:this.edgeWidth,edgeColor:this.edgeColor,unionClippingRegions:this.clippingModeUnion,enabled:this.enabled}),o=this.computePlanes(i),n=0;n<o.length;n++)r.add(o[n]);return this.modelEntityClippingPlanes=r,r}}(window.Cesium),function(e){var t=e.GeoFlood=function(e,t){this.viewer=e.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.cartesianArrayHeights=null,this.fragmentShader=null,this.normalMapUrl=null,this.geometry=null,this.appearance=null,this.callback=t||null};t.prototype.createWaterFace=function(e,t,i){return this.primitive?(this.clear(),this.primitive=this.creatPrimitive(e,t,i)):this.primitive=this.creatPrimitive(e,t,i),this.primitive},t.prototype.creatPrimitive=function(t,i,r){var o,n,s,a;if(t&&i&&!(i&&i.length<3))return this.fragmentShader="varying vec3 v_positionMC;\n\t\t\t\t\tvarying vec3 v_positionEC;\n\t\t\t\t\tvarying vec2 v_st;\n\t\t\t\t\t\n\t\t\t\t\tvoid main()\n\t\t\t\t\t{\n\t\t\t\t\t\tczm_materialInput materialInput;\n\t\t\t\t\t\tvec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\n\t\t\t\t\t#ifdef FACE_FORWARD\n\t\t\t\t\t\tnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n\t\t\t\t\t#endif\n\t\t\t\t\t\tmaterialInput.s = v_st.s;\n\t\t\t\t\t\tmaterialInput.st = v_st;\n\t\t\t\t\t\tmaterialInput.str = vec3(v_st, 0.0);\n\t\t\t\t\t\tmaterialInput.normalEC = normalEC;\n\t\t\t\t\t\tmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\n\t\t\t\t\t\tvec3 positionToEyeEC = -v_positionEC;\n\t\t\t\t\t\tmaterialInput.positionToEyeEC = positionToEyeEC;\n\t\t\t\t\t\tczm_material material = czm_getMaterial(materialInput);\n\t\t\t\t\t#ifdef FLAT\n\t\t\t\t\t\tgl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n\t\t\t\t\t#else\n\t\t\t\t\t\tgl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n\t\t\t\t\t\tgl_FragColor.a = 1.0;\n\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t\t",this.normalMapUrl=t,this.geometry=(o=i,n=r,new e.PolygonGeometry({polygonHierarchy:new e.PolygonHierarchy(e.Cartesian3.fromDegreesArrayHeights(o)),extrudedHeight:n||0,perPositionHeight:!1,closeTop:!0,closeBottom:!0,vertexFormat:e.EllipsoidSurfaceAppearance.VERTEXT_FORMAT})),this.appearance||(this.appearance=(s=this.fragmentShader,a=this.normalMapUrl,new e.EllipsoidSurfaceAppearance({material:new e.Material({translucent:!1,fabric:{type:"Water",uniforms:{normalMap:a,frequency:90,animationSpeed:.03,amplitude:90,specularIntensity:5}}}),fragmentShaderSource:s}))),this.primitives.add(new e.Primitive({allowPicking:!0,geometryInstances:new e.GeometryInstance({geometry:this.geometry,id:"GEOFlood_ID"}),vertexCacheOptimize:!0,appearance:this.appearance,interleave:!0,asynchronous:!1,cull:!1,releaseGeometryInstances:!0,show:!0}))},t.prototype.clear=function(){this.canvas.style.cursor="default",this.primitive&&this.primitives.remove(this.primitive)},t.prototype.clearPrimitive=function(e){e&&this.primitives.remove(e)},t.prototype.destroy=function(){this.clear(),this.viewer=void 0,this.scene=void 0,this.canvas=void 0,this.primitives=void 0,this.callback=void 0}}(window.Cesium),function(e){var t=e.defaultValue,i=e.GeoLimitHeight=function(i,r){i=t(i,e.defaultValue.EMPTY_OBJECT),this.viewer=i.viewer,this.scene=this.viewer.scene,this.entities=this.viewer.entities};i.prototype.analysis=function(i){i=t(i,e.defaultValue.EMPTY_OBJECT),this.targetHeight=t(i.targetHeight,0);var r=i.labelOption,o=i.polygonPlaneOption,n=i.polygonFitOption;r&&this.drawLabel(r),o&&this.drawPolygonPlane(o),n&&this.drawPolygonFit(n)},i.prototype.drawLabel=function(i){return this.clearLabelEntity(),i=t(i,e.defaultValue.EMPTY_OBJECT),this.labelEntity=this.entities.add({position:t(i.labelPosition,new e.Cartesian2(0,0,0)),label:{text:t(i.labelText,""),pixelOffset:t(i.labelPixelOffset,new e.Cartesian2(0,-60)),fillColor:t(i.labelFillColor,new e.Color(0,0,1,1)),font:t(i.labelFont,"18px 楷体"),outlineColor:t(i.labelOutlineColor,new e.Color(0,0,1,1)),outlineWidth:t(i.labelOutlineWidth,1.8),style:e.defaultValue(i.labelStyle,e.LabelStyle.FILL_AND_OUTLINE),show:t(i.labelShow,!0),disableDepthTestDistance:Number.POSITIVE_INFINITY}}),!0},i.prototype.drawPolygonPlane=function(i){return this.clearPolygonPlaneEntity(),i=t(i,e.defaultValue.EMPTY_OBJECT),this.polygonPlaneEntity=this.entities.add({polygon:{hierarchy:t(i.polygonPlaneHierarchy,new e.Cartesian3(0,0,0)),perPositionHeight:t(i.polygonPlanePerPositionHeight,!1),height:t(i.polygonPlaneHeight,this.targetHeight),material:t(i.polygonPlaneMaterial,e.Color.YELLOW.withAlpha(.3)),outline:t(i.polygonPlaneOutline,!0),outlineColor:t(i.polygonPlaneOutlineColor,e.Color.WHITE),show:t(i.polygonPlaneShow,!0)}}),!0},i.prototype.drawPolygonFit=function(i){this.clearPolygonFitPrimitive();var r=(i=t(i,e.defaultValue.EMPTY_OBJECT)).polygonFitPositions;if(!r||0==r.length)return console.error("请输入有效的坐标数组！"),!1;var o,n,s,a,l=(o=r,n=t(i.polygonFitHeight,this.targetHeight),s=t(i.polygonFitExtrudedHeight,1e4),a=t(i.polygonFitColor,new e.Color(1,0,0,.5)),new e.GeometryInstance({geometry:new e.PolygonGeometry({polygonHierarchy:new e.PolygonHierarchy(e.Cartesian3.fromDegreesArray(o)),height:n,extrudedHeight:s}),attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(a)}})),u=new e.PerInstanceColorAppearance({flat:!0}),h=new e.ClassificationPrimitive({geometryInstances:[l],appearance:u,classificationType:e.ClassificationType.CESIUM_3D_TILE});return this.polygonFitPrimitive=this.scene.primitives.add(h),!0},i.prototype.clearLabelEntity=function(){this.labelEntity&&this.entities.contains(this.labelEntity)&&(this.entities.remove(this.labelEntity),this.labelEntity=void 0)},i.prototype.clearPolygonPlaneEntity=function(){this.polygonPlaneEntity&&this.entities.contains(this.polygonPlaneEntity)&&(this.entities.remove(this.polygonPlaneEntity),this.polygonPlaneEntity=void 0)},i.prototype.clearPolygonFitPrimitive=function(){this.polygonFitPrimitive&&this.scene.primitives.contains(this.polygonFitPrimitive)&&(this.scene.primitives.remove(this.polygonFitPrimitive),this.polygonFitPrimitive=void 0)},i.prototype.clearAll=function(){this.clearLabelEntity(),this.clearPolygonPlaneEntity(),this.clearPolygonFitPrimitive()}}(window.Cesium),function(e){var t="GeoPLSViewShed3D_TIP",i="GeoPLSViewShed3D_LIGHTPOINT",r="GeoPLSViewShed3D_BOUNDARY",o="GeoPLSViewShed3D_DASHLINE",n="GeoPLSViewShed3D_DSP",s="GeoPLSViewShed3D_ORIENTLINE",a=e.GeoPLSViewShed3D=function(t,i){this.viewer=t.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.groundPrimitives=this.scene.groundPrimitives,this.callback=i||null,this._pointLightHeight=e.defaultValue(t.pointLightHeight,.2),this._pointLightPixelSize=e.defaultValue(t.pointLightPixelSize,5),this._pointLightColor=e.defaultValue(t.pointLightColor,e.Color.YELLOW),this._boundaryWidth=e.defaultValue(t.boundaryWidth,4),this._boundaryColor=e.defaultValue(t.boundaryColor,e.Color.YELLOW),this._orientLineWidth=e.defaultValue(t.orientLineWidth,8),this._orientLineColor=e.defaultValue(t.orientLineColor,new e.Color(1,1,0,.5)),this._baseDEMLerpCfg=e.defaultValue(t.baseDEMLerpCfg,{}),this._intervalAnalysis=e.defaultValue(t.intervalAnalysis,!0),d()(e.VERSION)<1.5&&console.error("当前Cesium版本："+e.VERSION+",点光源可视域分析暂不支持该版本，请更换至1.50以上的版本!")};function l(t,i,r,o,n,s){for(var a=[],l=[],u=p()(t.realTimeRadius/r),h=0;h<u;h++){var g={longitude:i[0],latitude:i[1],height:i[2]},f={longitude:i[3],latitude:i[4],height:i[5]},d=e.Math.lerp(g.longitude,f.longitude,1/u*(h+1)),m=e.Math.lerp(g.latitude,f.latitude,1/u*(h+1)),C={longitude:d,latitude:m},y=t.scene.globe.getHeight(C),v=e.Cartesian3.fromRadians(d,m,y);a.push(v);var A={longitude:i[0],latitude:i[1],height:y},_=e.Cartographic.toCartesian(A),I=e.Cartesian3.distance(_,v),b=(y-i[2])/I;l.push(b)}for(var w=[],G=[],E=[],S=[0],P=0;P<l.length-1;P++)w.length||l[P+1]<l[P]&&(w.push(l[P]),G.push(P)),w.length&&(l[P]>w[w.length-1]&&l[P+1]<l[P]&&(w.push(l[P]),G.push(P)),l[P]>w[w.length-1]&&l[P-1]<w[w.length-1]&&(E.push(l[P]),S.push(P)));G.push(l.length-1);var T=G.concat(S);T.sort((function(e,t){return e-t}));for(var x=[],N=0;N<T.length-1;N++){var L=[a[T[N]],a[T[N+1]]];x=N%2==0?x.concat(c(L,s,o,!0)):x.concat(c(L,s,n,!0))}return x}function u(t,i,r){var o=t.scene.pickPosition(i);if(o){var n=e.Cartographic.fromCartesian(o);if(n.height<0){t.scene.globe.depthTestAgainstTerrain=!0,t.viewer.terrainShadows=e.ShadowMode.ENABLED;var s=t.scene.camera.getPickRay(i),a=t.scene.globe.pick(s,t.scene);n=e.Cartographic.fromCartesian(a)}r=r||0;var l=e.Cartesian3.fromRadians(n.longitude,n.latitude,n.height+r),u=e.Cartographic.fromCartesian(l);return[e.Math.toDegrees(u.longitude),e.Math.toDegrees(u.latitude),u.height]}}function h(t,i,r,o){var n=t.add(new e.LabelCollection);return n.add({text:i,font:"16px sans-serif",showBackground:!0,position:r,pixelOffset:new e.Cartesian2(10,-30),style:e.LabelStyle.FILL_AND_OUTLINE}),n.name=o,n}function c(t,i,r,o){var n=[],s=o?t:e.Cartesian3.fromDegreesArray(t),a=new e.GeometryInstance({geometry:new e.GroundPolylineGeometry({positions:s,width:i}),attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(r)}});return n.push(a),n}function g(t,i,r){var o=t.add(new e.GroundPolylinePrimitive({geometryInstances:i,appearance:new e.PolylineColorAppearance({translucent:!0})}));return o.name=r,o}function f(e,t,i){for(var r=0;r<e.length;r++)e.name==i&&(t.position&&(e.get(r).position=t.position),t.text&&(e.get(r).text=t.text),void 0!==t.showBackground&&(e.get(r).showBackground=t.showBackground),t.backgroundColor&&(e.get(r).backgroundColor=t.backgroundColor),void 0!==t.horizontalOrigin&&(e.get(r).horizontalOrigin=t.horizontalOrigin),void 0!==t.verticalOrigin&&(e.get(r).verticalOrigin=t.verticalOrigin),t.pixelOffset&&(e.get(r).pixelOffset=t.pixelOffset),t.fillColor&&(e.get(r).fillColor=t.fillColor),t.outlineWidth&&(e.get(r).outlineWidth=t.outlineWidth),t.outlineColor&&(e.get(r).outlineColor=t.outlineColor))}function m(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}a.prototype.activate=function(){this.clear(),this.canvas.style.cursor="crosshair";var a=null,p=null,d=null,C=null,y=!0,v=null,A=null,_=this;this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction((function(o){if(y){v=u(_,o.position,_._pointLightHeight),A=e.Cartesian3.fromDegrees(v[0],v[1],v[2]),m(t,_.primitives),y=!1,_.firstLeftClick=y,a=null,m(i,_.primitives);var n=_.primitives.add(new e.PointPrimitiveCollection);n.name=i,n.add({position:A,color:_._pointLightColor,pixelSize:_._pointLightPixelSize})}else if(_.scene.globe.depthTestAgainstTerrain=!1,_.scene.shadowMap.enableGeoPLSViewShed3D=!0,_.canvas.style.cursor="default",_.handler&&!_.handler.isDestroyed()&&_.handler.destroy(),m(t,_.primitives),y=!0,_.firstLeftClick=y,a=null,_._baseDEMLerpCfg.enable)if(_._intervalAnalysis)_.angleInterval=e.defaultValue(_._baseDEMLerpCfg.angleInterval,1),_.timeInterval=e.defaultValue(_._baseDEMLerpCfg.timeInterval,100),_.num=0,setTimeout((function(){!function t(i){if(i.num%(2*i.angleInterval)==0){var o={longitude:i.boundaryPositionArr[i.num],latitude:i.boundaryPositionArr[i.num+1]},n=i.scene.globe.getHeight(o),s=[i.startPointLng,i.startPointLat,i.startPointHgt,o.longitude,o.latitude,n],a=e.defaultValue(i._baseDEMLerpCfg.interpolationBase,10),u=e.defaultValue(i._baseDEMLerpCfg.visibleColor,new e.Color(0,1,0,.8)),h=e.defaultValue(i._baseDEMLerpCfg.invisibleColor,new e.Color(1,0,0,.8)),c=e.defaultValue(i._baseDEMLerpCfg.lineWidth,5),p=l(i,s,a,u,h,c);g(i.scene.groundPrimitives,p,r)}i.num+=2*i.angleInterval,i.num<720&&setTimeout((function(){t(i)}),i.timeInterval)}(_)}),_.timeInterval);else{for(var s=[],h=0;h<_.boundaryPositionArr.length;h++)if(h%2==0){var c={longitude:_.boundaryPositionArr[h],latitude:_.boundaryPositionArr[h+1]},p=_.scene.globe.getHeight(c),f=[_.startPointLng,_.startPointLat,_.startPointHgt,c.longitude,c.latitude,p],d=e.defaultValue(_._baseDEMLerpCfg.interpolationBase,10),C=e.defaultValue(_._baseDEMLerpCfg.visibleColor,new e.Color(0,1,0,.8)),I=e.defaultValue(_._baseDEMLerpCfg.invisibleColor,new e.Color(1,0,0,.8)),b=e.defaultValue(_._baseDEMLerpCfg.lineWidth,5);l(_,f,d,C,I,b),s=s.concat(radiusLineInstance)}g(_.scene.groundPrimitives,s,r)}}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(i){var l,v,I,b,w,G,E,S;if(_.tipPosition=_.scene.pickPosition(i.endPosition),_.tipPosition&&(y&&(a?f(a,{position:_.tipPosition},t):a=h(_.primitives,"单击左键确定可视域位置",_.tipPosition,t)),!y)){a?f(a,{position:_.tipPosition},t):a=h(_.primitives,"单击左键固定可视域半径",_.tipPosition,t);var P=u(_,i.endPosition),T=e.Cartesian3.fromDegrees(P[0],P[1],P[2]);if(C=e.Cartesian3.distance(A,T),m(r,_.groundPrimitives),m(s,_.groundPrimitives),C){var x=e.Math.toDegrees(e.Cartographic.fromCartesian(A).longitude),N=e.Math.toDegrees(e.Cartographic.fromCartesian(A).latitude),L=e.Cartographic.fromCartesian(A).height,M=function(e,t,i){for(var r=[],o=0;o<=360;o++){var n=i*Math.sin(o*Math.PI/180),s=i*Math.cos(o*Math.PI/180),a=6356725+21412*(90-t)/90,l=e+n/(a*Math.cos(t*Math.PI/180))*180/Math.PI,u=t+s/a*180/Math.PI;r.push(l),r.push(u)}return r}(x,N,C),R=c(M,_._boundaryWidth,_._boundaryColor),O=(g(_.groundPrimitives,R,r),[x,N,M[0],M[1]]),F=(b=_.groundPrimitives,w=O,G=_._orientLineWidth,E=_._orientLineColor,s,S=new e.GeometryInstance({geometry:new e.GroundPolylineGeometry({positions:e.Cartesian3.fromDegreesArray(w),width:G})}),b.add(new e.GroundPolylinePrimitive({geometryInstances:S,appearance:new e.PolylineMaterialAppearance({material:new e.Material({fabric:{type:"PolylineArrow",uniforms:{color:E}}})})})).name="GeoPLSViewShed3D_ORIENTLINE",[x,N,L,x,N,L+C/3]),D=e.Color.fromAlpha(e.Color.YELLOW,.7);d?d.polyline.positions=e.Cartesian3.fromDegreesArrayHeights(F):(l=_.viewer.entities,v=F,2,I=D,o,d=l.add({name:"GeoPLSViewShed3D_DASHLINE",polyline:{positions:e.Cartesian3.fromDegreesArrayHeights(v),width:2,material:new e.PolylineDashMaterialProperty({color:I,dashLength:5})}}));var k=e.Cartesian3.fromDegrees(x,N,L+C/3),U="视高："+_._pointLightHeight.toFixed(2)+"米\n半径："+C.toFixed(4)+"米\n经度："+x.toFixed(6)+"度\n纬度："+N.toFixed(6)+"度",B={position:k,text:U,showBackground:!0,backgroundColor:e.Color.fromAlpha(e.Color.WHITE,.8),horizontalOrigin:e.HorizontalOrigin.CENTER,verticalOrigin:e.VerticalOrigin.BOTTOM,pixelOffset:new e.Cartesian2(0,0),fillColor:e.Color.BLACK};if(f(p||(p=h(_.primitives,U,k,n)),B,n),_._baseDEMLerpCfg.enable||_.dynamicAnalysis(A,C),_.pointLightPosition=A,_.realTimeRadius=C,_.firstLeftClick=y,_._baseDEMLerpCfg.enable){_.startPointLng=e.Math.toRadians(x),_.startPointLat=e.Math.toRadians(N),_.startPointHgt=L,_.boundaryPositionArr=[];for(var W=0;W<M.length;W++)_.boundaryPositionArr.push(e.Math.toRadians(M[W]));_.realTimeRadius=C}}}}),e.ScreenSpaceEventType.MOUSE_MOVE)},a.prototype.dynamicAnalysis=function(t,i){if(t&&i){var r,o=new e.Camera(this.scene);o.position=t,r={context:this.scene.context,lightCamera:o,isPointLight:!0},this.scene.shadowMap.destroy(),this.scene.shadowMap=new e.ShadowMap(r);var n=this.scene.shadowMap;n.size=1024,n._pointLightRadius=i,n._terrainBias.depthBias=0,n.enabled=!0,n.enableGeoPLSViewShed3D=!0}},a.prototype.clear=function(){this._baseDEMLerpCfg.enable&&(this.num=721),this.scene.globe.depthTestAgainstTerrain=!1,this.scene.shadowMap.enabled=!1,this.scene.shadowMap.enableGeoPLSViewShed3D=void 0,this.canvas.style.cursor="default",this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),m(t,this.primitives),m(n,this.primitives),m(i,this.primitives),m(r,this.groundPrimitives),m(s,this.groundPrimitives),function(e,t){for(var i=0;i<t.values.length;i++)"GeoPLSViewShed3D_DASHLINE"==t.values[i].name&&(t.remove(t.values[i]),i--)}(0,this.viewer.entities)},a.prototype.destroy=function(){this.clear(),this.viewer=void 0,this._pointLightHeight=void 0,this.scene=void 0,this.canvas=void 0,this.primitives=void 0,this.callback=void 0}}(window.Cesium),function(e){var t=e.GeoProfile=function(e,t){this.viewer=e.viewer,this.scene=this.viewer.scene};t.prototype.getLerpValue=function(t,i){this.lng_origin=t[0],this.lat_origin=t[1],this.hgt_origin=t[2],this.lng_destination=t[t.length-3],this.lat_destination=t[t.length-2],this.hgt_destination=t[t.length-1];for(var r=[],o=0;o<t.length-3;o+=3){var n=e.Cartesian3.fromDegrees(t[o],t[o+1]),s=e.Cartesian3.fromDegrees(t[o+3],t[o+4]),a=e.Cartesian3.distance(n,s);r.push(a),e.Cartesian3.distance(n,s)}for(var l=0,u=[],h=0;h<r.length;h++){var c=Math.floor(r[h]/i);u.push(c),l+=c}this.samplingNum=l;var g=[],p=[];for(o=0;o<u.length;o++){for(var f=0;f<=u[o];f++){var d=f*i;if(r[o]-d<=i)g.push(1);else{var m=d/r[o];g.push(m)}}p.push(g),g=[]}for(var C=[],y=[],v=[],A=[],_=(o=0,0);_<p.length;_++){for(f=0;f<p[_].length;f++){var I=e.Math.lerp(t[o],t[o+3],p[_][f]),b=e.Math.lerp(t[o+1],t[o+4],p[_][f]),w={longitude:e.Math.toRadians(I),latitude:e.Math.toRadians(b)},G=Number(this.scene.globe.getHeight(w).toFixed(2));v.push(G),C.push(e.Cartesian3.fromDegrees(I,b,G)),y.push(e.Cartesian3.fromDegrees(I,b,0))}o+=3}var E=Math.min.apply(null,v);this.minHeight=E;var S=Math.max.apply(null,v);this.maxHeight=S;var P=0;for(o=0;o<C.length-1;o++)P+=e.Cartesian3.distance(C[o],C[o+1]);this.surfaceLen=P;var T=e.Cartesian3.distance(C[0],C[C.length-1]);this.straightLen=T;var x=0;for(_=0;_<y.length-1;_++)x+=e.Cartesian3.distance(y[_],y[_+1]),A.push(x.toFixed(2));A.unshift(0);var N={};return N.YValueArray=v,N.addLenArray=A,N.lerpCoordnatesArray=C,N},t.prototype.drawChart=function(e,t){var i=document.getElementById(t);i.onmousedown=function(e){var t=e||event,r=t.clientX-i.offsetLeft,o=t.clientY-i.offsetTop;document.onmousemove=function(e){var t=e||event;i.style.left=t.clientX-r+"px",i.style.top=t.clientY-o+"px"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}};var r=echarts.init(i),o={title:{x:"center",padding:15,text:"剖面示意图",textStyle:{color:"#ccc",fontStyle:"normal",fontWeight:"bold",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"axis",confine:!0,formatter:function(e){return"长度: "+e[0].name+"<br />高程: "+e[0].value}},grid:{left:"2%",right:"12%",bottom:"3%",containLabel:!0},xAxis:{splitArea:{show:!1},splitLine:{show:!1,lineStyle:{color:["#aaa"],width:1,type:"solid"}},type:"category",boundaryGap:!1,data:e.addLenArray,name:"长度(米)",nameTextStyle:{color:"#ccc",fontWeight:"bolder"},axisLine:{lineStyle:{color:"rgba(0.0, 128, 255, 0.6)",width:4}},axisLabel:{color:"#ccc",fontWeight:"bolder"}},yAxis:{splitArea:{show:!1},splitLine:{show:!0,lineStyle:{color:["#aaa"],width:1,type:"dashed"}},type:"value",name:"高程(米)",nameTextStyle:{color:"#ccc",fontWeight:"bolder"},axisLine:{lineStyle:{color:"rgba(0.0, 128, 255, 0.6)",width:4}},axisLabel:{color:"#ccc",fontWeight:"bolder"}},series:[{type:"line",data:e.YValueArray,areaStyle:{color:"rgba(0.0,255.0,255.0,0.8)"}}]};r.setOption(o);var n=document.createElement("table"),s=document.createElement("tbody"),a=document.createElement("tr"),l=document.createElement("td");l.innerHTML="起点经度："+this.lng_origin.toFixed(6),a.appendChild(l);var u=document.createElement("td");u.innerHTML="起点高程："+e.YValueArray[0].toFixed(2),a.appendChild(u);var h=document.createElement("td");h.innerHTML="投影距离："+Number(e.addLenArray[e.addLenArray.length-1]).toFixed(2),a.appendChild(h),s.appendChild(a);var c=document.createElement("tr"),g=document.createElement("td");g.innerHTML="起点纬度："+this.lat_origin.toFixed(6),c.appendChild(g);var p=document.createElement("td");p.innerHTML="终点高程："+e.YValueArray[e.YValueArray.length-1].toFixed(2),c.appendChild(p);var f=document.createElement("td");f.innerHTML="地表距离："+this.surfaceLen.toFixed(2),c.appendChild(f),s.appendChild(c);var d=document.createElement("tr"),m=document.createElement("td");m.innerHTML="终点经度："+this.lng_destination.toFixed(6),d.appendChild(m);var C=document.createElement("td");C.innerHTML="最高高程："+this.maxHeight,d.appendChild(C);var y=document.createElement("td");y.innerHTML="直线距离："+this.straightLen.toFixed(2),d.appendChild(y),s.appendChild(d);var v=document.createElement("tr"),A=document.createElement("td");A.innerHTML="终点纬度："+this.lat_destination.toFixed(6),v.appendChild(A);var _=document.createElement("td");_.innerHTML="最低高程："+this.minHeight,v.appendChild(_);var I=document.createElement("td");return I.innerHTML="采样点数："+this.samplingNum,v.appendChild(I),s.appendChild(v),n.appendChild(s),i.appendChild(n),this.oTable=n,this.chartContainer=i,this.myChart=r,r},t.prototype.drawMark=function(t){t=e.defaultValue(t,{});var i=this.scene.primitives.add(new e.BillboardCollection);i.add({position:t.originCoordanate,image:t.originImage,verticalOrigin:e.VerticalOrigin.BOTTOM,scale:.2}),i.add({position:t.destinationCoordanate,image:t.destinationImage,verticalOrigin:e.VerticalOrigin.BOTTOM,scale:.2}),i.name="GeoProfile"},t.prototype.clearMark=function(){for(var e=0;e<this.scene.primitives.length;e++)"GeoProfile"==this.scene.primitives.get(e).name&&(this.scene.primitives.remove(this.scene.primitives.get(e)),e--)},t.prototype.clearChart=function(){this.myChart&&(this.myChart.clear(),this.myChart=null),this.oTable&&this.chartContainer&&this.chartContainer.removeChild(this.oTable)},t.prototype.clear=function(){this.clearChart(),this.clearMark()}}(window.Cesium),function(e){var t="GEOSIGHTLINE_TIP",i="GEOSIGHTLINEBILLBOARD",r=e.GeoSightline=function(t,i){this.viewer=t.viewer,this.observeRelativeHeight=t.observeRelativeHeight,this.targetRelativeHeight=t.targetRelativeHeight,this.observeImage=t.observeImage,this.targetImage=t.targetImage,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.entities=this.viewer.entities,this.callback=i||null,this.objectsToExclude=[],this.observeActualPosition=null,this.targetActualPosition=null,this.observeEntity=null,this.targetEntity=null,d()(e.VERSION)<1.5&&console.error("当前Cesium版本："+e.VERSION+",通视分析暂不支持该版本，请更换至1.50以上的版本!")};function o(t,i,r){if(t.scene){var o=t.scene.pickPosition(i);if(d()(e.VERSION)>=1.58){var n=viewer.scene.clampToHeight(o);n&&(o=n)}var s,a=e.Cartographic.fromCartesian(o);if(a.height<0){var l=t.camera.getPickRay(i),u=t.scene.globe.pick(l,t.scene);a=e.Cartographic.fromCartesian(u),t.scene.globe.depthTestAgainstTerrain=!0}return r=r||1,s=a.height+r,e.Cartesian3.fromRadians(a.longitude,a.latitude,s)}}function n(t,i,r,o){var n=t.add(new e.LabelCollection);return n.add({text:i,font:"16px sans-serif",showBackground:!0,position:r,pixelOffset:new e.Cartesian2(10,-10)}),n.name=o,n}function s(e,t,i){for(var r=0;r<e.length;r++)e.name==i&&(e.get(r).position=t)}function a(e,t){u(e,t)}function l(t,r,o){var n=t.add(new e.BillboardCollection);return n.add({position:r,image:o,scale:.4,verticalOrigin:e.VerticalOrigin.MIDDLE}),n.name=i,n}function u(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}function h(e,t){for(var i=0;i<t._entities._array.length;i++)t._entities._array[i].name==e&&(t.remove(t._entities._array[i]),i--)}r.prototype.activate=function(){this.scene.globe.depthTestAgainstTerrain=!1,this.destroyHandler(),this.clear(),1.52==d()(e.VERSION)&&(this.scene.enableGeoSightline=!0),d()(e.VERSION)>=1.58&&(this.scene.enableGeoSightline=!1),this.canvas.style.cursor="crosshair";var i=null,r=!0,u=this;this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction((function(e){r?(u.clear(),u.observeActualPosition=o(u,e.position,u.observeRelativeHeight),l(u.primitives,u.observeActualPosition,u.observeImage),a(t,u.primitives),i=null,r=!1):(u.targetActualPosition=o(u,e.position,u.targetRelativeHeight),l(u.primitives,u.targetActualPosition,u.targetImage),u.pickFromRays(),a(t,u.primitives),i=null,r=!0,u.scene.enableGeoSightline=!1,u.destroyHandler())}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(e){u.tipPosition=u.scene.pickPosition(e.endPosition),u.tipPosition&&(r&&(i?s(i,u.tipPosition,t):i=n(u.primitives,"单击左键确定观察点",u.tipPosition,t)),r||(i?s(i,u.tipPosition,t):i=n(u.primitives,"单击左键确定目标点",u.tipPosition,t)))}),e.ScreenSpaceEventType.MOUSE_MOVE)},r.prototype.pickFromRays=function(){var t=new e.Cartesian3(0,0,0);this.objectsToExclude=[this.observeEntity,this.targetEntity];var i=e.Cartesian3.normalize(e.Cartesian3.subtract(this.targetActualPosition,this.observeActualPosition,new e.Cartesian3),new e.Cartesian3),r=new e.Ray(this.observeActualPosition,i),o=[],n=[];o=this.scene.drillPickFromRay(r,1e3,this.objectsToExclude);var s=e.Cartesian3.distance(this.observeActualPosition,this.targetActualPosition);if(0!==o.length&&!o[0].position)for(var a=1;a<Math.floor(s)+1;a++)if(e.Cartesian3.lerp(this.observeActualPosition,this.targetActualPosition,a*(1/Math.floor(s)),t),i=e.Cartesian3.normalize(e.Cartesian3.subtract(this.targetActualPosition,this.observeActualPosition,new e.Cartesian3),new e.Cartesian3),r=new e.Ray(t,i),o=[],n=[],(o=this.scene.drillPickFromRay(r,1,this.objectsToExclude)).length>0){o[0].position||(e.Cartesian3.lerp(this.observeActualPosition,this.targetActualPosition,a*(1/Math.floor(s)),t),o[0].position=t);break}if(0==o.length)n=[this.observeActualPosition,this.targetActualPosition];else{var l=e.Cartesian3.normalize(e.Cartesian3.subtract(o[0].position,this.observeActualPosition,new e.Cartesian3),new e.Cartesian3),u=e.Cartesian3.normalize(e.Cartesian3.subtract(o[0].position,this.targetActualPosition,new e.Cartesian3),new e.Cartesian3);if(l.x.toFixed(8)==u.x.toFixed(8)&&l.y.toFixed(8)==u.y.toFixed(8)&&l.z.toFixed(8)==u.z.toFixed(8))n=[this.targetActualPosition,this.observeActualPosition];else{n=[this.observeActualPosition,o[0].position];var h={name:"REDLINE",polyline:{positions:[o[0].position,this.targetActualPosition],width:7,followSurface:!1,material:new e.PolylineArrowMaterialProperty(e.Color.RED)}};this.entities.add(h)}}var c={name:"GREENLINE",polyline:{positions:n,width:2,followSurface:!1,material:e.Color.GREEN}};this.entities.add(c)},r.prototype.clear=function(){this.primitives&&(u(t,this.primitives),u(i,this.primitives)),this.entities&&(h("REDLINE",this.entities),h("GREENLINE",this.entities))},r.prototype.destroyHandler=function(){this.handler=this.handler&&this.handler.destroy(),this.canvas.style.cursor="default"},r.prototype.destroy=function(){this.scene.enableGeoSightline=!1,this.scene.globe.depthTestAgainstTerrain=!1,this.destroyHandler(),this.clear(),this.viewer=void 0,this.observeRelativeHeight=void 0,this.targetRelativeHeight=void 0,this.scene=void 0,this.camera=void 0,this.canvas=void 0,this.primitives=void 0,this.entities=void 0,this.ellipsoid=void 0,this.callback=void 0,this.objectsToExclude=void 0,this.observeEntity=null,this.targetEntity=null}}(window.Cesium),function(e){var t=e.defaultValue,i=e.GeoSkyLine=function(i,r){this.viewer=i.viewer,this.scene=this.viewer.scene,this.canvas=this.viewer.canvas,this.entities=this.viewer.entities,this.skyLineShow=t(i.skylineShow,!0),this.skyLineWidth=t(i.skyLineWidth,2),this.skyLineMaterial=t(i.skyLineMaterial,e.Color.RED.clone()),this.skyLineDepthFailMaterial=t(i.skyLineDepthFailMaterial,void 0),this.skyLineVolumeMaterial=t(i.skyLineVolumeMaterial,e.Color.ORANGE.clone()),this.skyLineVolumeOutLine=t(i.skyLineVolumeOutLine,!1),this.skyLineVolumeOutLineColor=t(i.skyLineVolumeOutLineColor,e.Color.BLACK.clone()),this.extrudeRatio=t(i.extrudeRatio,1.2)};i.prototype.calculateSkyLinePositions=function(){if(!this.skyLine){for(var t=[],i={addLenArray:[],YValueArray:[]},r=this.canvas.width,o=this.canvas.height,n=50,s=[],a=0;a<r;a+=p()(r/3))for(var l=0;l<o;l++){var u=new e.Cartesian2(a,l);if(this.scene.pickPosition(u)){s.push(l);break}}Math.max.apply(null,s)<10&&(n=1);for(var h=0;h<r;h+=3)for(var c=0;c<o;c+=n){var g=new e.Cartesian2(h,c);if(this.scene.pickPosition(g))for(a=c-1;a>=c-n;a-=1){var f=new e.Cartesian2(h,a);if(!this.scene.pickPosition(f)){var d=new e.Cartesian2(h,a+1),m=this.scene.pickPosition(d);t.push(m),i.YValueArray.push(o-a),i.addLenArray.push(h),c=o;break}}}this.data=i,this.skyLinePositions=t,this.cameraPosition=this.viewer.camera.position.clone(),this.cameraHeight=e.Cartographic.fromCartesian(this.cameraPosition).height}},i.prototype.drawSkyLine=function(){this.skyLine||(this.skyLinePositions||this.calculateSkyLinePositions(),this.skyLine=this.entities.add({name:"GeoSkyLine",polyline:{positions:this.skyLinePositions,width:this.skyLineWidth,show:this.skyLineShow,material:this.skyLineMaterial,depthFailMaterial:this.skyLineDepthFailMaterial}}))},i.prototype.drawSkyLineVolume=function(){this.skyLineVolume||(this.skyLinePositions||this.calculateSkyLinePositions(),this.skyLinePositions=this.skyLinePositions.concat([this.cameraPosition]),this.skyLinePositions.push(this.skyLinePositions[0]),this.skyLineVolume=this.entities.add({name:"GeoSkyLineVolume",polygon:{hierarchy:this.skyLinePositions,extrudedHeight:this.cameraHeight/this.extrudeRatio,perPositionHeight:!0,material:this.skyLineVolumeMaterial,outline:this.skyLineVolumeOutLine,outlineColor:this.skyLineVolumeOutLineColor}}))},i.prototype.drawChart=function(e){if(!this.myChart&&(this.skyLinePositions||this.calculateSkyLinePositions(),this.data)){var t=document.getElementById(e);t.onmousedown=function(e){var i=e||event,r=i.clientX-t.offsetLeft,o=i.clientY-t.offsetTop;document.onmousemove=function(e){var i=e||event;t.style.left=i.clientX-r+"px",t.style.top=i.clientY-o+"px"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}};var i=echarts.init(t),r={title:{x:"center",padding:15,text:"天际线示意图",textStyle:{color:"#ccc",fontStyle:"normal",fontWeight:"bold",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"axis",confine:!0,formatter:function(e){return"宽度: "+e[0].name+"<br />高度: "+e[0].value}},grid:{left:"2%",right:"12%",bottom:"3%",containLabel:!0},xAxis:{splitArea:{show:!1},splitLine:{show:!1,lineStyle:{color:["#aaa"],width:1,type:"solid"}},type:"category",boundaryGap:!1,data:this.data.addLenArray,name:"宽度(PX)",nameTextStyle:{color:"#ccc",fontWeight:"bolder"},axisLine:{lineStyle:{color:"rgba(0.0, 128, 255, 0.6)",width:4}},axisLabel:{color:"#ccc",fontWeight:"bolder"}},yAxis:{splitArea:{show:!1},splitLine:{show:!0,lineStyle:{color:["#aaa"],width:1,type:"dashed"}},type:"value",name:"高度(PX)",nameTextStyle:{color:"#ccc",fontWeight:"bolder"},axisLine:{lineStyle:{color:"rgba(0.0, 128, 255, 0.6)",width:4}},axisLabel:{color:"#ccc",fontWeight:"bolder"}},series:[{type:"line",data:this.data.YValueArray,areaStyle:{color:"rgba(0.0,255.0,255.0,0.8)"}}]};return i.setOption(r),this.chartContainer=t,this.myChart=i,i}},i.prototype.clearChart=function(){this.myChart&&(this.myChart.clear(),this.myChart=null)},i.prototype.clear=function(){this.clearChart(),this.skyLine&&(this.entities.remove(this.skyLine),this.skyLine=void 0),this.skyLineVolume&&(this.entities.remove(this.skyLineVolume),this.skyLineVolume=void 0),this.data=void 0,this.skyLinePositions=void 0,this.cameraPosition=void 0,this.cameraHeight=void 0,this.skyLinePositions=void 0}}(window.Cesium),function(e){var t=e.defaultValue;(e.GeoTerrainSlope=function(e,i){e=t(e,t.EMPTY_OBJECT),this.viewer=e.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.camera=this.scene.camera,this.primitives=this.scene.primitives,this.callback=i||null,this.contourUniforms={},this.shadingUniforms={}}).prototype.updateMaterial=function(n){var s=!1;if(n&&n.contour){s=t(n.contour.enable,!1);var a=t(n.contour.width,2),l=t(n.contour.spacing,150),u=t(n.contour.color,e.Color.RED.clone())}var h="none";if(n&&n.selectedShading&&(h=n.selectedShading,-1==["elevation","slope","aspect","none"].indexOf(h)))return alert("输入值可选elevation,slope,aspect,none中的一个！"),!1;var c,g=-414,p=8777;return n&&n.minHeight&&(g=n.minHeight),n&&n.maxHeight&&(p=n.maxHeight),s?("elevation"===h?(c=new e.Material({fabric:{type:"ElevationColorContour",materials:{contourMaterial:{type:"ElevationContour"},elevationRampMaterial:{type:"ElevationRamp"}},components:{diffuse:"contourMaterial.alpha == 0.0 ? elevationRampMaterial.diffuse : contourMaterial.diffuse",alpha:"max(contourMaterial.alpha, elevationRampMaterial.alpha)"}},translucent:!1}),this.shadingUniforms=c.materials.elevationRampMaterial.uniforms,this.shadingUniforms.minimumHeight=g,this.shadingUniforms.maximumHeight=p,this.contourUniforms=c.materials.contourMaterial.uniforms):"slope"===h?(c=new e.Material({fabric:{type:"SlopeColorContour",materials:{contourMaterial:{type:"ElevationContour"},slopeRampMaterial:{type:"SlopeRamp"}},components:{diffuse:"contourMaterial.alpha == 0.0 ? slopeRampMaterial.diffuse : contourMaterial.diffuse",alpha:"max(contourMaterial.alpha, slopeRampMaterial.alpha)"}},translucent:!0}),this.shadingUniforms=c.materials.slopeRampMaterial.uniforms,this.contourUniforms=c.materials.contourMaterial.uniforms):"aspect"===h?(c=new e.Material({fabric:{type:"AspectColorContour",materials:{contourMaterial:{type:"ElevationContour"},aspectRampMaterial:{type:"AspectRamp"}},components:{diffuse:"contourMaterial.alpha == 0.0 ? aspectRampMaterial.diffuse : contourMaterial.diffuse",alpha:"max(contourMaterial.alpha, aspectRampMaterial.alpha)"}},translucent:!1}),this.shadingUniforms=c.materials.aspectRampMaterial.uniforms,this.contourUniforms=c.materials.contourMaterial.uniforms):(c=e.Material.fromType("ElevationContour"),this.contourUniforms=c.uniforms),this.contourUniforms.width=a,this.contourUniforms.spacing=l,this.contourUniforms.color=u):"elevation"===h?(c=e.Material.fromType("ElevationRamp"),this.shadingUniforms=c.uniforms,this.shadingUniforms.minimumHeight=g,this.shadingUniforms.maximumHeight=p):"slope"===h?(c=e.Material.fromType("SlopeRamp"),this.shadingUniforms=c.uniforms):"aspect"===h&&(c=e.Material.fromType("AspectRamp"),this.shadingUniforms=c.uniforms),"none"!==h&&(this.shadingUniforms.image=function(e){var t=document.createElement("canvas");t.width=100,t.height=1;var n,s=t.getContext("2d");"elevation"===e?n=i:"slope"===e?n=r:"aspect"===e&&(n=o);var a=s.createLinearGradient(0,0,100,0);return 7==n.length?(a.addColorStop(n[0],"#000000"),a.addColorStop(n[1],"#2747E0"),a.addColorStop(n[2],"#D33B7D"),a.addColorStop(n[3],"#D33038"),a.addColorStop(n[4],"#FF9742"),a.addColorStop(n[5],"#ffd700"),a.addColorStop(n[6],"#ffffff")):(a.addColorStop(n[0],"#0a8d33"),a.addColorStop(n[1],"#599668"),a.addColorStop(n[2],"#afdd76"),a.addColorStop(n[3],"#fafcb4"),a.addColorStop(n[4],"#f2b602"),a.addColorStop(n[5],"#eea706"),a.addColorStop(n[6],"#df7702"),a.addColorStop(n[7],"#a52100"),a.addColorStop(n[8],"#682b06"),a.addColorStop(n[9],"#6a2402"),a.addColorStop(n[10],"#420202")),s.fillStyle=a,s.fillRect(0,0,100,1),t}(h)),this.scene.globe.material=c,!0};var i=[0,.045,.1,.15,.37,.54,1],r=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1],o=[0,.2,.4,.6,.8,.9,1]}(window.Cesium),function(e){var t=e.GeoTilesetFlatten=function(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this._ready=!1,this.dirty=!1,this.polys=[],this.isCartesian3Point=e.defaultValue(t.isCartesian3Point,!0),this.show=e.defaultValue(t.show,!0),this.ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84)};function i(t){var i=t.content._model;e.defined(i)&&e.defined(i.platSlot)&&delete i.platSlot}function r(t){var i=t.content._model;if(e.defined(i)){var r=i.platSlot;if(!e.defined(r))throw new e.DeveloperError("storing of model vertex buffers is fail.")}}t.prototype.bindTileset=function(t){if(!e.defined(t))throw new e.DeveloperError("parameter tileset is required.");if(e.defined(this._tileset))throw new e.DeveloperError("There is a tileset already, Only One Bind");this._tileset=t,this._tileset.platBodyDebug=this,this.dirty=!0,this._tileset.tileUnload.addEventListener(i),this._tileset.tileLoad.addEventListener(r)},t.prototype.showPlat=function(e){this.show!=e&&(that.dirty=!0),this.show=e},t.prototype.isPlatShow=function(e){return this.show},t.prototype.isPlatDirty=function(){return this.dirty},t.prototype.clearPlatDirty=function(){this.dirty=!1},t.prototype.addPlatArea=function(t){if(void 0!==t&&t instanceof Array){var i=t.length;if(!(i<3)){for(var r=[],o=this.isCartesian3Point,n=0;n<i;n++){var s=t[n];o?void 0!==s.height?r.push(e.Cartesian3.fromRadians(s.longitude,s.latitude,s.height,this.ellipsoid)):r.push(e.Cartesian3.clone(s,new e.Cartesian3)):void 0!==s.height?r.push(e.Cartographic.clone(s,new e.Cartographic)):r.push(e.Cartographic.fromCartesian(s,this.ellipsoid,new e.Cartographic))}if(this.isCartesian3Point){if(!r[0].equals(r[i-1])){var a=e.Cartesian3.clone(r[0],new e.Cartesian3);r.push(a)}}else e.Cartographic.equals(r[0],r[i-1])||(a=e.Cartographic.clone(r[0],new e.Cartographic),r.push(a));var l={};l.platPickPoints=r,l._show=!0,this.polys.push(l);var u=this.polys.length-1;return this.dirty=!0,this.initPlatBodyDebug(),this._ready=!0,u}}},t.prototype.getPlatArea=function(t){if(void 0!==t&&"number"==typeof t&&t<this.polys.length){var i=this.polys[t];if(void 0===i)return;var r=i.platPickPoints;if(void 0===r)return;for(var o=[],n=0;n<r.length;n++){var s=e.Cartesian3.clone(r[n],new e.Cartesian3);o.push(s)}return o}},t.prototype.removePlatArea=function(e){void 0!==e&&"number"==typeof e&&e<this.polys.length&&(delete this.polys[e],this.dirty=!0)},t.prototype.showPlatArea=function(e,t){void 0!==e&&"number"==typeof e&&e<this.polys.length&&(this.polys[e]._show=t,this.dirty=!0)},t.prototype.initRegionMatrixes=function(t){var i=t,r=i._pickObject.content._tile;if(e.defined(i._runtime.rootNodes)&&!(i._runtime.rootNodes.length<1)){var o=r._boundingVolume._orientedBoundingBox.halfAxes,n=r._boundingVolume._orientedBoundingBox.center,s={};if(s.matOrg=this.createHalfMatrix(o),s.matOrgI=this.invertMatrix(s.matOrg),e.defined(s.matOrgI)&&(s.matPrj=e.Transforms.eastNorthUpToFixedFrame(n,this.ellipsoid,new e.Matrix4),s.matPrjI=this.invertMatrix(s.matPrj),e.defined(s.matPrjI)))return s.modelMatrix=e.Matrix4.clone(i._runtime.rootNodes[0].computedMatrix,new e.Matrix4),s}},t.prototype.initBoxMatrixes=function(t){var i=t,r=i._pickObject.content._tile;if(e.defined(i._runtime.rootNodes)&&!(i._runtime.rootNodes.length<1)){var o=r._boundingVolume._orientedBoundingBox.center,n={};if(n.matPrj=e.Transforms.eastNorthUpToFixedFrame(o,this.ellipsoid,new e.Matrix4),n.matPrjI=this.invertMatrix(n.matPrj),e.defined(n.matPrjI)&&(n.modelMatrix=e.Matrix4.clone(i._runtime.rootNodes[0].computedMatrix,new e.Matrix4),n.modelMatrixI=this.invertMatrix(n.modelMatrix),e.defined(n.modelMatrixI)))return n}},t.prototype.toPlatRegionModel=function(t,i){var r=i,o=r.platSlot.buffers,n=o.length,s=this.initRegionMatrixes(r);if(e.defined(s)){this.initializePlatPoly(r);for(var a=0;a<n;a++){var l=o[a];if(void 0!==l&&1!=l.showPlat){l.showPlat=!0;for(var u=l.buffer.slice(0),h=new Float32Array(u.buffer,u.byteOffset,u.length/Float32Array.BYTES_PER_ELEMENT),c=0,g=[],p=[],f=0;f<h.length;f+=3){var d=new e.Cartesian3(h[f],h[f+1],h[f+2]);p.push(d),(m=e.Matrix4.multiplyByPoint(s.matOrgI,d,new e.Cartesian3)).z<c&&(c=m.z),g.push(m)}for(f=0;f<g.length;f++){var m=g[f];d=p[f],d=e.Matrix4.multiplyByPoint(s.modelMatrix,d,new e.Cartesian3),d=e.Matrix4.multiplyByPoint(s.matPrjI,d,new e.Cartesian3),this.isPlatPoint(r,d)&&(m.z=c),m=e.Matrix4.multiplyByPoint(s.matOrg,m,new e.Cartesian3),h[3*f]=m.x,h[3*f+1]=m.y,h[3*f+2]=m.z}this.replaceCommandVertexBuffer(r,u,a,t)}}r.platSlot.platPolys=void 0}},t.prototype.toPlatBoxModel=function(t,i){var r=i,o=r.platSlot.buffers,n=o.length,s=this.initBoxMatrixes(r);if(e.defined(s)){var a={};this.initializePlatPoly(r);for(var l=0;l<n;l++){var u=o[l];if(!u.showPlat||this.isPlatDirty()){u.showPlat=!0;for(var h=u.buffer.slice(0),c=new Float32Array(h.buffer,h.byteOffset,h.length/Float32Array.BYTES_PER_ELEMENT),g=0;g<c.length;g+=3){var p=new e.Cartesian3(c[g],c[g+1],c[g+2]);p=e.Cartesian3.clone(p);var f=e.Matrix4.multiplyByPoint(s.modelMatrix,p,new e.Cartesian3);a.pt=f,p=e.Matrix4.multiplyByPoint(s.matPrjI,f,new e.Cartesian3),this.isPlatPoint(r,p,a)&&(f=e.Matrix4.multiplyByPoint(s.modelMatrixI,a.pt,new e.Cartesian3),c[g]=f.x,c[g+1]=f.y,c[g+2]=f.z)}this.replaceCommandVertexBuffer(r,h,l,t)}}r.platSlot.platPolys=void 0}},t.prototype.toPlatModel=function(t,i){var r=i._pickObject.content._tile._header.boundingVolume.region;e.defined(r)?this.toPlatRegionModel(t,i):this.toPlatBoxModel(t,i)},t.prototype.toUnplatModel=function(e,t){for(var i=t,r=i.platSlot.buffers,o=r.length,n=0;n<o;n++){var s=r[n];if(void 0!==s&&0!=s.showPlat){s.showPlat=!1;var a=s.buffer.slice(0);this.replaceCommandVertexBuffer(i,a,n,e)}}i.platSlot.platPolys=void 0},t.prototype.platModel=function(e,t){var i=t;if(this._ready&&void 0!==i.platSlot&&void 0!==i.platSlot.buffers&&!(i.platSlot.buffers.length<1)){var r=this.hitPlatTest(i);(r||i.platSlot.isUsed)&&(i.platSlot.isUsed=!0,r?this.toPlatModel(e,t):this.toUnplatModel(e,t))}},t.prototype.hitPlatTest=function(e){var t=e,i=this.polys,r=i.length;if(r<1)return!1;for(var o=0;o<r;o++){var n=i[o];if(void 0!==n&&void 0!==n.platPickRegion&&this.hitPlatTestByRegion(t,n.platPickRegion))return!0}return!1},t.prototype.initPlatBodyDebug=function(){var t=this.ellipsoid;if(this.isCartesian3Point){if(void 0===(s=this.polys))return;if(void 0===(a=s.length)||a<1)return;if(!this.dirty)return;for(var i=0;i<a;i++)if(void 0!==(l=s[i])&&!e.defined(l.platPickRegion)){if(void 0===(p=l.platPickPoints))return;if(void 0===(f=p.length)||f<1)return;for(var r=0;r<f;r++){var o=e.Cartesian3.clone(p[r],new e.Cartesian3),n=e.Cartographic.fromCartesian(o,t);0!=r?(h>n.longitude?h=n.longitude:u<n.longitude&&(u=n.longitude),c>n.latitude?c=n.latitude:g<n.latitude&&(g=n.latitude)):(u=h=n.longitude,c=g=n.latitude)}l.platPickRegion={west:h,south:c,east:u,north:g}}}else{var s,a;if(void 0===(s=this.polys))return;if(void 0===(a=s.length)||a<1)return;if(!this.dirty)return;for(i=0;i<a;i++){var l;if(void 0!==(l=s[i])&&!e.defined(l.platPickRegion)){var u,h,c,g,p,f;if(void 0===(p=l.platPickPoints))return;if(void 0===(f=p.length)||f<1)return;for(u=h=p[0].longitude,c=g=p[0].latitude,r=1;r<f;r++)h>(o=e.Cartographic.clone(p[r],new e.Cartographic)).longitude?h=o.longitude:u<o.longitude&&(u=o.longitude),c>o.latitude?c=o.latitude:g<o.latitude&&(g=o.latitude);l.platPickRegion={west:h,south:c,east:u,north:g}}}}},t.prototype.createTileRegion=function(t){var i=t._header.boundingVolume;if(e.defined(i)){if(void 0!==i.region){var r=i.region;if(!e.defined(r))return;return{west:r[0],south:r[1],east:r[2],north:r[3]}}if(i.box){if(!e.defined(t._boundingVolume))return;var o=t._boundingVolume._orientedBoundingBox;if(!e.defined(o))return;var n,s=e.Cartesian3.add,a=e.Cartesian3.subtract,l=[];for(n=0;n<3;n++){var u=new e.Cartesian3(o.halfAxes[3*n],o.halfAxes[3*n+1],o.halfAxes[3*n+2]),h=[];h.push({f:s,a:u}),h.push({f:a,a:u}),l.push(h)}var c,g,p,f,d,m,C=this.ellipsoid,y=o.center,v=[],A=l[0],_=l[1],I=l[2];for(n=0;n<A.length;n++)for(var b=A[n],w=e.Cartesian3.clone(y,new e.Cartesian3),G=b.f(w,b.a,new e.Cartesian3),E=0;E<_.length;E++)for(var S=_[E],P=S.f(G,S.a,new e.Cartesian3),T=0;T<I.length;T++){var x=I[T],N=x.f(P,x.a,new e.Cartesian3);v.push(N)}for(c=g=v[0].x,p=f=v[0].y,d=m=v[0].z,n=1;n<v.length;n++){var L=v[n];c>L.x?c=L.x:g<L.x&&(g=L.x),p>L.y?p=L.y:f<L.y&&(f=L.y),d>L.z?d=L.z:m<L.z&&(m=L.z)}var M,R,O,F,D=[];for(D.push(e.Cartographic.fromCartesian(new e.Cartesian3(c,p,d),C,new e.Cartographic)),D.push(e.Cartographic.fromCartesian(new e.Cartesian3(g,f,m),C,new e.Cartographic)),n=0;n<D.length;n++){var k=D[n];0!=n?(M>k.longitude?M=k.longitude:R<k.longitude&&(R=k.longitude),F>k.latitude?F=k.latitude:O<k.latitude&&(O=k.latitude)):(M=R=k.longitude,O=F=k.latitude)}return{west:M,south:F,east:R,north:O}}}},t.prototype.hitPlatTestByRegion=function(t,i){return!!e.defined(i)},t.prototype.initializePlatPoly=function(e){this.isCartesian3Point?this.initializeCartesianPlatPoly(e):this.initializeCartographicPlatPoly(e)},t.prototype.initializeCartesianPlatPoly=function(t){var i=t,r=i.platSlot;if(e.defined(r.platPolys)){if(!this.isPlatDirty())return;delete r.platPolys}var o,n=this.ellipsoid,s=this.polys;if(e.defined(i._runtime.rootNodes)&&(o=i._runtime.rootNodes[0].computedMatrix),e.defined(o)){var a=this.invertMatrix(o);if(e.defined(a)){r.platPolys=[];var l,u,h=r.platPolys;for(u=0;u<s.length;u++){var c=s[u];if(e.defined(c)){var g,p,f,d,m=c.platPickPoints,C=new e.Cartesian3,y=[];for(l=1;l<m.length;l++){var v=m[l];C=e.Cartesian3.add(C,v,new e.Cartesian3);var A=e.Matrix4.multiplyByPoint(a,v,new e.Cartesian3);y.push(A),e.defined(g)?(g>A.x?g=A.x:f<A.x&&(f=A.x),p>A.y?p=A.y:d<A.y&&(d=A.y)):(g=f=A.x,p=d=A.y)}C=e.Cartesian3.divideByScalar(C,y.length,new e.Cartesian3);var _={pts:y,minX:g,minY:p,maxX:f,maxY:d,compressPlane:this.initCompressPlane(n,C),show:c._show};h.push(_)}}}}},t.prototype.initializeCartographicPlatPoly=function(t){var i=t,r=i._pickObject.content._tile,o=i.platSlot;if(e.defined(o.platPolys)){if(!this.isPlatDirty())return;o.platPolys=void 0}var n,s=this.ellipsoid,a=this.polys;if(e.defined(r._boundingVolume)&&e.defined(r._boundingVolume._orientedBoundingBox)&&(n=r._boundingVolume._orientedBoundingBox.center),e.defined(n)){var l,u=e.Transforms.eastNorthUpToFixedFrame(n,s,new e.Matrix4),h=this.invertMatrix(u);if(e.defined(h)&&(e.defined(i._runtime)&&e.defined(i._runtime.rootNodes)&&i._runtime.rootNodes.length>0&&e.defined(i._runtime.rootNodes[0])&&(l=i._runtime.rootNodes[0].computedMatrix),e.defined(l))){var c=this.invertMatrix(l);if(e.defined(c)){o.platPolys=[];var g,p,f=o.platPolys;for(p=0;p<a.length;p++){var d=a[p];if(e.defined(d)){var m=d.platPickPoints;if(e.defined(m)&&!(m.length<1)){var C,y,v,A,_=new e.Cartesian3,I=[];for(g=0;g<m.length;g++){var b,w=m[g];if(this.isCartesian3Point)b=e.Cartesian3.clone(w,new e.Cartesian3),_=e.Cartesian3.add(_,b,new e.Cartesian3),b=e.Matrix4.multiplyByPoint(c,b,new e.Cartesian3);else{b=e.Cartographic.clone(w,new e.Cartographic);var G=e.Cartesian3.fromRadians(b.longitude,b.latitude,0,s);_=e.Cartesian3.add(_,G,new e.Cartesian3),b=e.Matrix4.multiplyByPoint(h,G,new e.Cartesian3)}I.push(b),e.defined(C)?(C>b.x?C=b.x:v<b.x&&(v=b.x),y>b.y?y=b.y:A<b.y&&(A=b.y)):(C=v=b.x,y=A=b.y)}_=e.Cartesian3.divideByScalar(_,I.length,new e.Cartesian3);var E={pts:I,minX:C,minY:y,maxX:v,maxY:A,compressPlane:this.initCompressPlane(s,_)};f.push(E)}}}}}}},t.prototype.initCompressPlane=function(t,i){var r=e.Cartesian3.clone(i,new e.Cartesian3),o=e.Cartographic.fromCartesian(r,t,new e.Cartographic),n=e.Cartesian3.fromRadians(o.longitude,o.latitude,0,t);if(!r.equals(n))return e.Plane.fromPointNormal(r,e.Cartesian3.normalize(e.Cartesian3.subtract(r,n,new e.Cartesian3),new e.Cartesian3))},t.prototype.isPlatPointNoResult=function(t,i){for(var r=t.platSlot.platPolys,o=e.Cartesian3.clone(i,new e.Cartesian3),n=0;n<r.length;n++){var s=r[n];if(e.defined(s)&&this.isInsidedPoint(s,o))return!0}return!1},t.prototype.isPlatPointResult=function(t,i,r){for(var o=t.platSlot.platPolys,n=e.Cartesian3.clone(i,new e.Cartesian3),s=e.Cartesian3.clone(r.pt,new e.Cartesian3),a=!1,l=0;l<o.length;l++){var u=o[l];if(e.defined(u)&&this.isInsidedPoint(u,n)){var h=this.mapPosition(u.compressPlane,s);e.defined(h)&&(s=h),a=!0}}return a&&(r.pt=s),a},t.prototype.isPlatPoint=function(t,i,r){return e.defined(r)?this.isPlatPointResult(t,i,r):this.isPlatPointNoResult(t,i)},t.prototype.mapPosition=function(t,i){if(e.defined(t)&&e.defined(i)&&e.defined(t.normal)){var r=e.Cartesian3.clone(t.normal,new e.Cartesian3),o=e.Cartesian3.clone(i,new e.Cartesian3),n=new e.Ray(o,r),s=e.IntersectionTests.rayPlane(n,t);if(e.defined(s))return o;var a=e.Cartesian3.negate(r,new e.Cartesian3),l=new e.Ray(o,a),u=e.IntersectionTests.rayPlane(l,t);if(!e.defined(u))return o;var h=e.Cartesian3.distance(u,o);return e.Cartesian3.add(o,e.Cartesian3.multiplyByScalar(a,h,new e.Cartesian3),new e.Cartesian3)}},t.prototype.isInsidedPoint=function(t,i){if(!e.defined(t))return!1;if(!e.defined(t.show)||!t.show)return!1;if(!e.defined(i))return!1;var r,o,n=i.x,s=i.y;if(n<t.minX||n>t.maxX||s<t.minY||s>t.maxY)return!1;var a,l,u,h,c,g,p={z:!1,b:!1,t:!1},f=t.pts,d=f.length;for(r=0,o=d-1;r<d;o=r++){if(a=f[r],l=f[o],u=a.x,h=a.y,c=l.x,g=l.y,this.isEqualFloat(g,h)){if(this.isEqualFloat(s,h)){if(this.isEqualFloat(n,u))return!0;if(this.isEqualFloat(n,c))return!0;if(u>n==c<n)return!0}}else if(this.isEqualFloat(s,h)){if(this.isEqualFloat(n,u))return!0;u<n&&(g<s?p.b=!p.b:p.t=!p.t)}else if(this.isEqualFloat(s,g)){if(this.isEqualFloat(n,c))return!0;c<n&&(h<s?p.b=!p.b:p.t=!p.t)}if(h>s!=g>s){var m=(c-u)/(g-h);if(m*=s-h,m+=u,this.isEqualFloat(n,m))return!0;n<m&&(p.z=!p.z)}}return p.t==p.b?p.t?!p.z:p.z:void 0},t.prototype.isEqualFloat=function(t,i,r){if(e.defined(r)||(r=1e-8),!e.defined(t))return!1;if(!e.defined(i))return!1;var o=t-i;return(o=Math.abs(o))<r},t.prototype.replaceCommandVertexBuffer=function(t,i,r,o){var n=t;if(e.defined(i)&&e.defined(r)&&"number"==typeof r&&e.defined(o)&&e.defined(o.context)){var s=n._nodeCommands;if(e.defined(s)&&!(s.length<=r)){var a=e.Buffer.createVertexBuffer({context:o.context,typedArray:i,usage:e.BufferUsage.STATIC_DRAW});if(e.defined(a)){var l=s[r];if(e.defined(l)){var u=l.command;if(e.defined(u)){var h=u._vertexArray;if(e.defined(h)){var c=h._attributes;if(e.defined(c)&&c.length>0){var g=c[0];if(!e.defined(g))return;var p=g.vertexBuffer;e.defined(p)&&!p.isDestroyed()&&p.vertexArrayDestroyable&&p.destroy(),g.vertexBuffer=a;var f=h._vao;e.defined(f)&&(o.context.glDeleteVertexArray(h._vao),h._vao=void 0)}}}}}}}},t.prototype.storeVertexBuffer=function(t){if(e.defined(t)){var i=t;if(!e.defined(i.platSlot)){var r=i._pickObject;if(e.defined(r)){var o=r.content;if(e.defined(o)){var n=o._tileset;if(e.defined(n)&&e.defined(n.platBodyDebug)){var s=i._loadResources;if(e.defined(s)){var a=i._cachedGltf._gltf;if(e.defined(a)){var l=a.accessors;if(e.defined(l)){var u=a.bufferViews;if(e.defined(u)){var h=a.meshes;if(e.defined(h)){i.platSlot={},i.platSlot.buffers=[],i.platSlot.isUsed=!1;for(var c=0;c<h.length;c++){var g=h[c];if(e.defined(g)){var p=g.primitives;if(e.defined(p))for(var f=0;f<p.length;f++){var d=p[f];if(e.defined(d)){var m=d.attributes;if(e.defined(m))for(var C in m)if("POSITION"===C){var y=u[l[m[C]].bufferView],v=s.getBuffer(y),A=v.slice(0,v.length);i.platSlot.buffers.push({buffer:A,showPlat:!1})}}}}}}}}}}}}}}}},t.prototype.invertMatrix=function(t){var i=void 0;try{i=e.Matrix4.inverse(t,new e.Matrix4)}catch(e){}return i},t.prototype.createMatrix=function(t){if(e.defined(t)){var i=new e.Matrix4;return e.Matrix4.setColumn(i,0,new e.Cartesian4(t[0].x,t[0].y,t[0].z,0),i),e.Matrix4.setColumn(i,1,new e.Cartesian4(t[1].x,t[1].y,t[1].z,0),i),e.Matrix4.setColumn(i,2,new e.Cartesian4(t[2].x,t[2].y,t[2].z,0),i),e.Matrix4.setColumn(i,3,new e.Cartesian4(0,0,0,1),i),i}},t.prototype.createHalfMatrix=function(t){if(e.defined(t)){for(var i=[],r=0;r<3;r++)i.push(this.createNormal(t[3*r],t[3*r+1],t[3*r+2]));return this.createMatrix(i)}},t.prototype.createNormal=function(t,i,r){return e.Cartesian3.normalize(new e.Cartesian3(t,i,r),new e.Cartesian3)}}(window.Cesium),function(e){var t="GEOVIEWRADAR_TIP",i="GEOVIEWRADAR_LIGHTPOINT",r=e.GeoViewRadar=function(t,i){this.viewer=t.viewer,this.pointLightHeight=e.defaultValue(t.pointLightHeight,.2),this.boundingSphereStackPartitions=e.defaultValue(t.boundingSphereStackPartitions,100),this.boundingSphereSlicePartitions=e.defaultValue(t.boundingSphereSlicePartitions,80),this.boundingSphereSubdivisions=e.defaultValue(t.boundingSphereSubdivisions,100),this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.callback=i||null,d()(e.VERSION)<1.5&&console.error("当前Cesium版本："+e.VERSION+",雷达分析暂不支持该版本，请更换至1.50以上的版本!")};function o(t,i,r){var o=t.scene.pickPosition(i);if(o){var n=e.Cartographic.fromCartesian(o);if(n.height<0){t.scene.globe.depthTestAgainstTerrain=!0,t.viewer.terrainShadows=e.ShadowMode.CAST_ONLY;var s=t.scene.camera.getPickRay(i),a=t.scene.globe.pick(s,t.scene);n=e.Cartographic.fromCartesian(a)}r=r||0;var l=e.Cartesian3.fromRadians(n.longitude,n.latitude,n.height+r),u=e.Cartographic.fromCartesian(l);return[e.Math.toDegrees(u.longitude),e.Math.toDegrees(u.latitude),u.height]}}function n(t,i,r,o){var n=t.add(new e.LabelCollection);return n.add({text:i,font:"16px sans-serif",showBackground:!0,position:r,pixelOffset:new e.Cartesian2(10,-30)}),n.name=o,n}function s(e,t,i){for(var r=0;r<e.length;r++)e.name==i&&(e.get(r).position=t)}function a(e,t){l(e,t)}function l(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}r.prototype.activate=function(){this.clear(),this.canvas.style.cursor="crosshair";var i=null,r=null,l=!0,u=null,h=null,c=this;this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction((function(r){l?(u=o(c,r.position,c.pointLightHeight),h=e.Cartesian3.fromDegrees(u[0],u[1],u[2]),a(t,c.primitives),l=!1,c.firstLeftClick=l,i=null):(c.scene.shadowMap.enableGeoViewRadar=!0,c.canvas.style.cursor="default",c.handler&&!c.handler.isDestroyed()&&c.handler.destroy(),a(t,c.primitives),l=!0,c.firstLeftClick=l,i=null)}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(a){if(c.tipPosition=c.scene.pickPosition(a.endPosition),c.tipPosition&&(l&&(i?s(i,c.tipPosition,t):i=n(c.primitives,"单击左键确定雷达位置",c.tipPosition,t)),!l)){i?s(i,c.tipPosition,t):i=n(c.primitives,"单击左键固定雷达半径",c.tipPosition,t);var u=o(c,a.endPosition),g=e.Cartesian3.fromDegrees(u[0],u[1],u[2]);r=e.Cartesian3.distance(h,g),c.dynamicAnalysis(h,r),c.pointLightPosition=h,c.realTimeRadius=r,c.firstLeftClick=l}}),e.ScreenSpaceEventType.MOUSE_MOVE)},r.prototype.dynamicAnalysis=function(t,r){if(t&&r){var o=new e.Camera(this.scene);o.position=t,l(i,this.primitives);var n,s=this.primitives.add(new e.PointPrimitiveCollection);s.name=i,s.add({position:t,color:e.Color.YELLOW,pixelSize:5}),n={context:this.scene.context,lightCamera:o,isPointLight:!0},this.scene.shadowMap.destroy(),this.scene.shadowMap=new e.ShadowMap(n);var a=this.scene.shadowMap;a.enabled=!0,a.debugShow=!0,a.enableGeoViewRadar=!0,a.size=1024,a._pointLightRadius=r,a._boundingSphere.stackPartitions=this.boundingSphereStackPartitions,a._boundingSphere.slicePartitions=this.boundingSphereSlicePartitions,a._boundingSphere.subdivisions=this.boundingSphereSubdivisions}},r.prototype.clear=function(){this.scene.shadowMap.enabled=!1,this.scene.shadowMap.enableGeoViewRadar=void 0,this.canvas.style.cursor="default",this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),a(t,this.primitives),l(i,this.primitives)},r.prototype.destroy=function(){this.clear(),this.viewer=void 0,this.pointLightHeight=void 0,this.scene=void 0,this.canvas=void 0,this.primitives=void 0,this.callback=void 0}}(window.Cesium),function(e){var t="GEOVIEWSHED3D_TIP",i="GEOVIEWSHED3D_SPOTID",r=e.GeoViewShed3D=function(t,i){this.viewer=t.viewer,this.spotLightHeight=e.defaultValue(t.spotLightHeight,1),this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.callback=i||null,d()(e.VERSION)<1.5&&console.error("当前Cesium版本："+e.VERSION+",可视域分析暂不支持该版本，请更换至1.50以上的版本!")};function o(t,i,r){var o=t.scene.pickPosition(i);if(o){var n=e.Cartographic.fromCartesian(o);if(n.height<0){t.scene.globe.depthTestAgainstTerrain=!0,t.viewer.terrainShadows=e.ShadowMode.ENABLED;var s=t.camera.getPickRay(i),a=t.scene.globe.pick(s,t.scene);n=e.Cartographic.fromCartesian(a)}r=r||0;var l=e.Cartesian3.fromRadians(n.longitude,n.latitude,n.height+r),u=e.Cartographic.fromCartesian(l);return[e.Math.toDegrees(u.longitude),e.Math.toDegrees(u.latitude),u.height]}}function n(t,i,r,o){var n=t.add(new e.LabelCollection);return n.add({text:i,font:"16px sans-serif",showBackground:!0,position:r,pixelOffset:new e.Cartesian2(10,-10)}),n.name=o,n}function s(e,t,i){for(var r=0;r<e.length;r++)e.name==i&&(e.get(r).position=t)}function a(e,t){!function(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}(e,t)}function l(e,t){for(var i=0;i<t.length;i++)t.get(i).id==e&&(t.remove(t.get(i)),i--)}r.prototype.activate=function(){var r=null;l(i,this.primitives),this.scene.shadowMap.enabled=!1,this.scene.shadowMap.enableGeoViewShed3D=void 0;var u=null,h=null,c=null;this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),this.canvas.style.cursor="crosshair";var g=this,p=!0,f=null,d=null;this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction((function(e){p?(f=o(g,e.position,g.spotLightHeight),p=!1,g.firstLeftClick=p,a(t,g.primitives),r=null):(g.handler&&!g.handler.isDestroyed()&&g.handler.destroy(),p=!0,g.firstLeftClick=p,g.canvas.style.cursor="default",a(t,g.primitives),r=null)}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(i){if(g.tipPosition=g.scene.pickPosition(i.endPosition),g.tipPosition&&(p&&(r?s(r,g.tipPosition,t):r=n(g.primitives,"单击左键确定观察位置",g.tipPosition,t)),!p)){r?s(r,g.tipPosition,t):r=n(g.primitives,"单击左键固定视域范围",g.tipPosition,t),d=o(g,i.endPosition),u=turf.bearing(turf.point([f[0],f[1]]),turf.point([d[0],d[1]]));var a=turf.distance(turf.point([f[0],f[1]]),turf.point([d[0],d[1]])),l=d[2]-f[2];h=e.Math.toDegrees(Math.atan(l/(1e3*a)));var m=e.Cartesian3.fromDegrees(f[0],f[1],f[2]),C=e.Cartesian3.fromDegrees(d[0],d[1],d[2]);c=e.Cartesian3.distance(m,C),g.analysis({observePtCoordinate:f,frustumLength:c,frustumHead:u,frustumPitch:h,frustumField:30}),g.spotLightPosition=f,g.realTimeHeading=u,g.realTimePitching=h,g.realTimeDistance=c,g.realTimeFieldAngle=30,g.firstLeftClick=p}}),e.ScreenSpaceEventType.MOUSE_MOVE)},r.prototype.analysis=function(t){var r=t.observePtCoordinate,o=t.frustumLength,n=t.frustumHead,s=t.frustumPitch,a=t.frustumField;if(null!=r&&null!=o&&null!=n&&null!=s&&null!=a){var u,h=e.Cartesian3.fromDegrees(r[0],r[1],r[2]),c=new e.Camera(this.scene),g=e.Math.toRadians(n),p=e.Math.toRadians(s);c.frustum=new e.PerspectiveFrustum({fov:e.Math.toRadians(a),aspectRatio:1.6,near:1,far:o}),c.lookAt(h,new e.HeadingPitchRange(g,p,1e-21)),l(i,this.primitives),this.primitives.add(new e.DebugCameraPrimitive({camera:c,color:e.Color.fromHsl(1,1,1,1),id:i})),u={context:this.scene.context,lightCamera:c,cascadesEnabled:!1,darkness:.5,isPointLight:!1},this.scene.shadowMap.destroy(),this.scene.shadowMap=new e.ShadowMap(u);var f=this.scene.shadowMap;f._terrainBias.depthBias=0,f.enabled=!0,f.size=2048,f.enableGeoViewShed3D=!0}},r.prototype.clear=function(){this.scene.shadowMap.enabled=!1,l(i,this.primitives),a(t,this.primitives),viewer.scene.shadowMap.enableGeoViewShed3D=void 0},r.prototype.destroy=function(){this.scene.shadowMap.enableGeoViewShed3D=void 0,this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),this.scene.shadowMap.enabled=!1,this.canvas.style.cursor="default",this.clear(),this.viewer=void 0,this.spotLightHeight=void 0,this.scene=void 0,this.camera=void 0,this.canvas=void 0,this.primitives=void 0,this.ellipsoid=void 0,this.callback=void 0}}(window.Cesium),function(e){var t="GeoVolumeCalculate_LINE",i="GeoVolumeCalculate_TIP",r="GeoVolumeCalculate_GON",o="GeoVolumeCalculate_DEGON",n="GeoVolumeCalculate_CORAL",s=e.GeoVolumeCalculate=function(e,t){this.viewer=e.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.camera=this.scene.camera,this.primitives=this.scene.primitives,this.designElevation=e.designElevation?e.designElevation:4e3,this.samplingPointsNumber=e.samplingPointsNumber?e.samplingPointsNumber:500,this.callback=t||null};function a(e,t){for(var i=0,r=0;r<t.length;r++)if(t[r]==e&&i++,2==i)return!0}function l(e,t,i,r,o,n,s){var a={},l=turf.polygon([[e.geometry.coordinates[0][i[0]],t[0],t[1],e.geometry.coordinates[0][i[0]]]]),u=turf.area(l),h=s-r,c=1/3*u*h,g=turf.polygon([[e.geometry.coordinates[0][i[1]],t[0],t[1],e.geometry.coordinates[0][i[1]]]]),p=turf.area(g),f=s-o,d=turf.polygon([[e.geometry.coordinates[0][i[1]],e.geometry.coordinates[0][i[2]],t[0],t[1],e.geometry.coordinates[0][i[1]]]]),m=turf.area(d),C=turf.polygon([[e.geometry.coordinates[0][i[1]],e.geometry.coordinates[0][i[2]],t[1],t[0],e.geometry.coordinates[0][i[1]]]]),y=turf.area(C),v=m>y?m:y,A=1/3*p*f+1/3*(v-p)*(f+(s-n));return h>=0?(a.fillVolume=c,a.fillArea=u,a.excavationVolume=A,a.excavationArea=v,a):(a.fillVolume=A,a.fillArea=v,a.excavationVolume=c,a.excavationArea=u,a)}function u(t,i,r,o,n,s,a,l,u){var h={},c=Math.abs(t/(t-i)),g=new e.Cartesian3(0,0,0),p=e.Cartesian3.fromRadians(r.geometry.coordinates[0][o][0],r.geometry.coordinates[0][n][1],l),f=e.Cartesian3.fromRadians(r.geometry.coordinates[0][n][0],r.geometry.coordinates[0][n][1],u),d=e.Cartographic.fromCartesian(e.Cartesian3.lerp(p,f,c,g));return h.intersection=[d.longitude,d.latitude],h.vertexSerial=[s,a],h}function h(t,r){return t.add({name:i,position:r,label:{text:"左键点击绘制，右键点击结束",font:"15px sans-serif",showBackground:!0,pixeloffset:new e.Cartesian2(0,20)}})}function g(e,t){for(var i=0;i<t.values.length;i++)t.values[i].name==e&&(t.remove(t.values[i]),i--)}s.prototype.activate=function(){this.canvas.style.cursor="crosshair";var s=0,a=this,l=[],u=[],c=[],p=[],f=[];this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction((function(i){var r=a.camera.getPickRay(i.position),o=a.scene.globe.pick(r,a.scene);u.push(o);var n=e.Cartographic.fromCartesian(o),h=e.Math.toDegrees(n.longitude),g=e.Math.toDegrees(n.latitude),d=n.height;c.push(h,g,d),p.push(h,g,a.designElevation),s?(f[s-1].polyline.positions.getValue().shift(),l=[f[0].polyline.positions.getValue()[1],o,f[s-1].polyline.positions.getValue()[0]]):l=[o,o,o],a.polylineEntity=a.viewer.entities.add({name:t,polyline:{positions:l,clampToGround:!0,width:5,material:new e.PolylineOutlineMaterialProperty({color:e.Color.ORANGE,outlineWidth:2,outlineColor:e.Color.BLACK})}}),f.push(a.polylineEntity),s++}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(e){if(l.length){var t=a.camera.getPickRay(e.endPosition),i=a.scene.globe.pick(t,a.scene);l.splice(l.length-2,1,i),f[s-1].polyline.positions=l,a.labelEntity?a.labelEntity.position=i:a.labelEntity=h(a.viewer.entities,i)}else a.labelEntity?a.labelEntity.position=i:a.labelEntity=h(a.viewer.entities,i)}),e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction((function(s){var l=a.camera.getPickRay(s.position),h=a.scene.globe.pick(l,a.scene);u.push(h);var f=e.Cartographic.fromCartesian(h),d=e.Math.toDegrees(f.longitude),m=e.Math.toDegrees(f.latitude),C=f.height;c.push(d,m,C),p.push(d,m,a.designElevation),a.handler.destroy(),a.canvas.style.cursor="default",a.labelEntity&&g(i,a.viewer.entities),a.polylineEntity&&g(t,a.viewer.entities),a.VOLUME=a.volumeAnalysis(a.scene,c,a.designElevation,a.samplingPointsNumber),a.callback(a.VOLUME),a.designPolygonEntity=a.viewer.entities.add({name:o,polygon:{hierarchy:{positions:e.Cartesian3.fromDegreesArrayHeights(p)},material:e.Color.BLUE.withAlpha(.8),perPositionHeight:!0}}),a.polygonEntity=a.viewer.entities.add({name:r,polygon:{hierarchy:{positions:u},material:e.Color.GREEN.withAlpha(.5)}}),a.designPolygonEntity_coral=a.viewer.entities.add({name:n,polygon:{hierarchy:{positions:e.Cartesian3.fromDegreesArrayHeights(p)},material:e.Color.CORAL.withAlpha(.5),perPositionHeight:!0,outline:!0,outlineColor:e.Color.YELLOW.withAlpha(1),extrudedHeight:0,closeTop:!0,closeBottom:!1}})}),e.ScreenSpaceEventType.RIGHT_CLICK)},s.prototype.volumeAnalysis=function(t,i,r,o){for(var n,s={features:[]},h=t.globe.ellipsoid,g=[],p=e.Cartesian3.fromDegreesArrayHeights(i),f=0;f<p.length;f++){var d=e.Math.toDegrees(h.cartesianToCartographic(p[f]).longitude),m=e.Math.toDegrees(h.cartesianToCartographic(p[f]).latitude);g.push([d,m])}g.push([e.Math.toDegrees(h.cartesianToCartographic(p[0]).longitude),e.Math.toDegrees(h.cartesianToCartographic(p[0]).latitude)]);var C=turf.lineString(g),y=turf.bbox(C),v=turf.randomPoint(2*o,{bbox:y}),A=turf.polygon([g]);for(f=0;f<v.features.length;f++){var _=turf.point(v.features[f].geometry.coordinates);turf.booleanPointInPolygon(_,A)||(v.features.splice(f,1),f--)}var I=[],b=p.concat(p[0]);for(f=0;f<b.length-1;f++)for(var w=1;w<Math.ceil(o/10);w++){var G=new e.Cartesian3(0,0,0);G=e.Cartesian3.lerp(b[f],b[f+1],w*(1/Math.ceil(o/10)),G),I.push(G)}p=p.concat(I);var E=[],S=[];for(f=0;f<p.length;f++){var P=h.cartesianToCartographic(p[f]).longitude,T=h.cartesianToCartographic(p[f]).latitude;E.push(new e.Cartographic(P,T)),S.push([P,T])}for(f=0;f<v.features.length;f++){var x=e.Math.toRadians(v.features[f].geometry.coordinates[0]),N=e.Math.toRadians(v.features[f].geometry.coordinates[1]);E.push(new e.Cartographic(x,N))}return t.sampleHeightMostDetailed(E).then((function(e){s.type="FeatureCollection";for(var t=0;t<e.length;t++)s.features.push({type:"Feature",geometry:{coordinates:[e[t].longitude,e[t].latitude],type:"Point"},properties:{z:e[t].height}});n=turf.tin(s,"z");var i=0,o=0,h=0,g=0,p=r;for(t=0;t<n.features.length;t++){var f=n.features[t].properties.a-p,d=n.features[t].properties.b-p,m=n.features[t].properties.c-p,C=[],y=[];if(f*d<0||f*m<0||d*m<0){if(f*d<0){var v=u(f,d,n.features[t],0,1,"a","b",n.features[t].properties.a,n.features[t].properties.b);C.push(v.intersection),y.push(v.vertexSerial[0],v.vertexSerial[1])}var A;f*m<0&&(v=u(f,m,n.features[t],0,2,"a","c",n.features[t].properties.a,n.features[t].properties.c),C.push(v.intersection),y.push(v.vertexSerial[0],v.vertexSerial[1])),d*m<0&&(v=u(d,m,n.features[t],1,2,"b","c",n.features[t].properties.b,n.features[t].properties.c),C.push(v.intersection),y.push(v.vertexSerial[0],v.vertexSerial[1])),a("a",y)&&(o+=(A=l(n.features[t],C,[0,1,2],n.features[t].properties.a,n.features[t].properties.b,n.features[t].properties.c,p)).fillVolume,g+=A.fillArea,i+=A.excavationVolume,h+=A.excavationArea),a("b",y)&&(o+=(A=l(n.features[t],C,[1,0,2],n.features[t].properties.b,n.features[t].properties.a,n.features[t].properties.c,p)).fillVolume,g+=A.fillArea,i+=A.excavationVolume,h+=A.excavationArea),a("c",y)&&(o+=(A=l(n.features[t],C,[2,0,1],n.features[t].properties.c,n.features[t].properties.a,n.features[t].properties.b,p)).fillVolume,g+=A.fillArea,i+=A.excavationVolume,h+=A.excavationArea)}else{var _=turf.polygon([n.features[t].geometry.coordinates[0]]),I=turf.area(_),b=1/3*[p-n.features[t].properties.a+(p-n.features[t].properties.b)+(p-n.features[t].properties.c)];b>=0?(o+=I*b,g+=I):(i+=I*b,h+=I)}}var w={fillVolume:Number(o.toFixed(3)),excavationVolume:Number(Math.abs(i).toFixed(3)),totalVolume:Number(o.toFixed(3))+Number(Math.abs(i).toFixed(3)),fillArea:Number(g.toFixed(3)),excavationArea:Number(h.toFixed(3)),totalArea:Number(g.toFixed(3))+Number(h.toFixed(3))};return new c.a((function(e){e(w)}))}))},s.prototype.clear=function(){this.canvas.style.cursor="default",this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),this.polylineEntity&&g(t,this.viewer.entities),this.labelEntity&&g(i,this.viewer.entities),this.polygonEntity&&g(r,this.viewer.entities),this.designPolygonEntity&&g(o,this.viewer.entities),this.designPolygonEntity_coral&&g(n,this.viewer.entities),this.polylineEntity=void 0,this.labelEntity=void 0},s.prototype.destroy=function(){this.clear(),this.viewer=void 0,this.scene=void 0,this.canvas=void 0,this.camera=void 0,this.primitives=void 0,this.designElevation=void 0,this.samplingPointsNumber=void 0,this.callback=void 0}}(window.Cesium),function(e){var t=e.SingleBuildingWidget=function(t,i,r){this.viewer=t.viewer,this.scene=this.viewer.scene,this.globe=this.viewer.scene.globe,this.data=t.data?t.data:{},this.entities=this.viewer.entities,this.callback_click=i||function(){},this.callback_move=r||function(){},this.show=void 0===t.show||t.show,this.fillColor=t.fillColor?t.fillColor:e.Color.CORNFLOWERBLUE.withAlpha(.3),this.outline=void 0!==t.outline&&t.outline,this.outlineColor=t.outlineColor?t.outlineColor:e.Color.WHITE,this.highlightColor_click=t.highlightColor_click?t.highlightColor_click:e.Color.YELLOW.withAlpha(.3),this.highlightColor_move=t.highlightColor_move?t.highlightColor_move:e.Color.WHITE.withAlpha(.2),this._INTERSECTED_FLOOR=null,this._INTERSECTED_FLOOR2=null,this._INTERSECTED_FLOOR3=null,this.handler=new e.ScreenSpaceEventHandler(this.viewer.canvas)};function i(e,t){var i=null,r=e.drillPick(t);if(r&&r.length>0){for(var o=[],n=0;n<r.length;n++)r[n].id&&"GEO_EXTRUDE_POLYGON"==r[n].id.name&&o.push(r[n].id);if(o&&o.length>0){i=o[0];for(var s=0;s<o.length-1;s++)i=i.id<o[s+1].id?o[s+1]:i}}return i}e.defineProperties(t.prototype,{show:{set:function(e){this._show=e;for(var t=this.entities.values,i=0;i<t.length;i++)"GEO_EXTRUDE_POLYGON"==t[i].name&&(t[i].show=e)},get:function(){return this._show}}}),t.prototype.extrudeToBuilding=function(){if(this.clear(),this.data&&this.data.geometry){var t=0;this.data.properties.baseHeight?t=this.data.properties.baseHeight:(t=this.globe.getHeight({longitude:e.Math.toRadians(this.data.geometry.coordinates[0][0][0]),latitude:e.Math.toRadians(this.data.geometry.coordinates[0][0][1])}))||console.error("地形还未准备好！");for(var i=this.data.properties.levels,r=[],o=0;o<this.data.geometry.coordinates[0].length;o++)r.push(this.data.geometry.coordinates[0][o][0]),r.push(this.data.geometry.coordinates[0][o][1]);for(var n=0,s=0;s<i.length;s++){var a=t+n,l=a+i[s],u=new e.Entity({id:s+1,name:"GEO_EXTRUDE_POLYGON",description:{data:this.data,level:s+1},polygon:{hierarchy:e.Cartesian3.fromDegreesArray(r),fill:!0,material:this.fillColor,outline:this.outline,outlineColor:this.outlineColor,outlineWidth:1,height:a,extrudedHeight:l,show:this.show,closeTop:!0,closeBottom:!0}});n+=i[s],this.entities.add(u)}}},t.prototype.activate=function(){var t=this;t.handler.setInputAction((function(e){var r=i(t.scene,e.position);if(r){if(t.callback_click(r),t._INTERSECTED_FLOOR&&t._INTERSECTED_FLOOR!=r&&(t._INTERSECTED_FLOOR.polygon.material=t.fillColor),t._INTERSECTED_FLOOR=r,t._INTERSECTED_FLOOR3&&t._INTERSECTED_FLOOR3.polygon.material._color._value.equals(t.highlightColor_click)&&(t._INTERSECTED_FLOOR3.polygon.material=t.fillColor),t._INTERSECTED_FLOOR.polygon.material._color._value.equals(t.highlightColor_click))return;t._INTERSECTED_FLOOR.polygon.material=t.highlightColor_click}}),e.ScreenSpaceEventType.LEFT_CLICK),t.handler.setInputAction((function(e){var r=i(t.scene,e.endPosition);if(r){if(t.callback_move(r),t._INTERSECTED_FLOOR2&&t._INTERSECTED_FLOOR2!=r&&(t._INTERSECTED_FLOOR2.polygon.material=t.fillColor),t._INTERSECTED_FLOOR2=r,t._INTERSECTED_FLOOR&&t._INTERSECTED_FLOOR.polygon.material._color._value.equals(t.fillColor)&&(t._INTERSECTED_FLOOR.polygon.material=t.highlightColor_click),t._INTERSECTED_FLOOR2.polygon.material._color._value.equals(t.highlightColor_move))return;t._INTERSECTED_FLOOR2.polygon.material=t.highlightColor_move}}),e.ScreenSpaceEventType.MOUSE_MOVE)},t.prototype.highlightFloor=function(e){if(this.data&&this.data.geometry&&this._show){var t=this.entities.getById(e);this._INTERSECTED_FLOOR3&&this._INTERSECTED_FLOOR3!=t&&(this._INTERSECTED_FLOOR3.polygon.material=this.fillColor),this._INTERSECTED_FLOOR3=t,this._INTERSECTED_FLOOR3.polygon.material=this.highlightColor_click}},t.prototype.clear=function(){for(var e=this.entities.values,t=0;t<e.length;t++)"GEO_EXTRUDE_POLYGON"==e[t].name&&(this.entities.remove(e[t]),t--)},t.prototype.deActivate=function(){this.handler.removeInputAction(e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.removeInputAction(e.ScreenSpaceEventType.LEFT_CLICK)},t.prototype.destroy=function(){this.clear(),this.handler=this.handler&&this.handler.destroy(),this.viewer=void 0,this.data=void 0,this.fillColor=void 0,this.outlineColor=void 0,this.highlightColor_click=void 0,this.highlightColor_move=void 0,this._INTERSECTED_FLOOR=void 0,this._INTERSECTED_FLOOR2=void 0}}(window.Cesium),function(e){e.FlyAround=function(t){this.viewer=t.viewer,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.heading=e.Math.toDegrees(this.camera.heading),this.pitch=e.Math.toDegrees(this.camera.pitch),this.dip_angle=e.Math.toRadians(-30),this.speed=t.speed,this.height=0,this.distance=0,this.isFlying=t.isFlying,this.deltaHeight=0,this.deltaRadians=e.Math.toRadians(1),this.deltaDistance=0,this.roll=0,this.keyEvent()},e.FlyAround.prototype.play=function(t,i){var r=this,o=this.camera.heading;this.scene.preRender.addEventListener((function(n,s){if(r.isFlying){r.heading=e.Math.toDegrees(n.camera.heading),r.pitch=e.Math.toDegrees(n.camera.pitch);var a=o+=e.Math.toRadians(r.speed);r.height=(i[2]+r.deltaHeight).toFixed(1),r.distance=(t+r.deltaDistance).toFixed(1),r.camera.setView({destination:e.Cartesian3.fromDegrees(i[0],i[1],i[2]+r.deltaHeight),orientation:{heading:a,pitch:r.dip_angle,roll:r.roll}}),r.camera.moveBackward(t+r.deltaDistance)}}))},e.FlyAround.prototype.pause=function(){this.viewer.scene.postRender.removeEventListener(this.play,this)},e.FlyAround.prototype.continue=function(){0!=this.viewer.entities._entities.length?(this.viewer.scene.postRender.removeEventListener(this.play,this),this.viewer.scene.postRender.addEventListener(this.play,this)):this.viewer.scene.postRender.removeEventListener(this.play,this)},e.FlyAround.prototype.stop=function(){this.viewer.scene.postRender.removeEventListener(this.play,this),this.viewer.entities.removeAll(),document.removeEventListener("keydown",this.keydownOption)},e.FlyAround.prototype.keyEvent=function(){var t=this;document.addEventListener("keydown",(function(i){switch(i.keyCode){case 40:i.shiftKey?t.deltaHeight-=10:(t.dip_angle-=t.deltaRadians,t.dip_angle<-e.Math.TWO_PI&&(t.dip_angle+=e.Math.TWO_PI));break;case 38:i.shiftKey?t.deltaHeight+=10:(t.dip_angle+=t.deltaRadians,t.dip_angle>-e.Math.TWO_PI&&(t.dip_angle-=e.Math.TWO_PI));break;case 39:i.shiftKey?(t.roll+=t.deltaRadians,t.roll>e.Math.TWO_PI&&(t.roll-=e.Math.TWO_PI)):t.deltaDistance-=50;break;case 37:i.shiftKey?(t.roll-=t.deltaRadians,t.roll<e.Math.TWO_PI&&(t.roll+=e.Math.TWO_PI)):t.deltaDistance+=50}}))}}(window.Cesium),function(e){e.FreeFlight=function(t){this.viewer=t.viewer,this.direct=t.direct,this.pitch=t.pitch,this.roll=t.roll,this.height=t.height,this.speed=t.speed,this.lon=t.lon,this.lat=t.lat,this.planePrimitive=t.planePrimitive,this.hpRoll=t.hpRoll,this.fromBehind=t.fromBehind,this.isFlying=t.isFlying,this.position=t.position,this.fixedFrameTransform=t.fixedFrameTransform,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.pathPosition=new e.SampledPositionProperty,this.speedVector=new e.Cartesian3,this.center=new e.Cartesian3,this.hpRange=new e.HeadingPitchRange,this.deltaRadians=e.Math.toRadians(3),this.init(),this.keyEvent()},e.FreeFlight.prototype.init=function(){var t=this,i=this.scene.screenSpaceCameraController,r=0;this.planePrimitive.readyPromise.then((function(o){o.activeAnimations.addAll({speedup:.5,loop:e.ModelAnimationLoop.REPEAT}),r=2*Math.max(o.boundingSphere.radius,t.camera.frustum.near),i.minimumZoomDistance=.5*r,e.Matrix4.multiplyByPoint(o.modelMatrix,o.boundingSphere.center,t.center);var n=e.Math.toRadians(230),s=e.Math.toRadians(-20);t.hpRange.heading=n,t.hpRange.pitch=s,t.hpRange.range=50*r,t.camera.lookAt(t.center,t.hpRange)})),viewer.entities.add({position:this.pathPosition,name:"path",path:{show:!0,leadTime:0,trailTime:60,width:2,resolution:1,material:new e.PolylineGlowMaterialProperty({glowPower:.3,color:e.Color.PALEGOLDENROD})}})},e.FreeFlight.prototype.animation=function(){if(this.isFlying){this.direct=e.Math.toDegrees(this.hpRoll.heading).toFixed(1),this.pitch=e.Math.toDegrees(this.hpRoll.pitch).toFixed(1),this.roll=e.Math.toDegrees(this.hpRoll.roll).toFixed(1),this.speed=this.speed,this.speedVector=e.Cartesian3.multiplyByScalar(e.Cartesian3.UNIT_X,this.speed/10,this.speedVector);var t=e.Matrix4.multiplyByPoint(this.planePrimitive.modelMatrix,this.speedVector,this.position);this.pathPosition.addSample(e.JulianDate.now(),t),e.Transforms.headingPitchRollToFixedFrame(t,this.hpRoll,e.Ellipsoid.WGS84,this.fixedFrameTransform,this.planePrimitive.modelMatrix);var i=e.Cartographic.fromCartesian(t);this.lon=e.Math.toDegrees(i.longitude),this.lat=e.Math.toDegrees(i.latitude),this.height=i.height,this.fromBehind&&(e.Matrix4.multiplyByPoint(this.planePrimitive.modelMatrix,this.planePrimitive.boundingSphere.center,this.center),this.hpRange.heading=this.hpRoll.heading,this.hpRange.pitch=this.hpRoll.pitch,this.camera.lookAt(this.center,this.hpRange))}},e.FreeFlight.prototype.play=function(){this.viewer.scene.postRender.addEventListener(this.animation,this)},e.FreeFlight.prototype.pause=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this)},e.FreeFlight.prototype.continue=function(){0!=this.viewer.entities._entities.length?(this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.scene.postRender.addEventListener(this.animation,this)):this.viewer.scene.postRender.removeEventListener(this.animation,this)},e.FreeFlight.prototype.stop=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.entities.removeAll(),this.scene.primitives.removeAll(),document.removeEventListener("keydown",this.keydownOption)},e.FreeFlight.prototype.keyEvent=function(){var t=this;document.addEventListener("keydown",(function(i){switch(i.keyCode){case 40:i.shiftKey?t.speed=Math.max(--t.speed,1):(t.hpRoll.pitch-=t.deltaRadians,t.hpRoll.pitch<-e.Math.TWO_PI&&(t.hpRoll.pitch+=e.Math.TWO_PI));break;case 38:i.shiftKey?t.speed=Math.min(++t.speed,100):(t.hpRoll.pitch+=t.deltaRadians,t.hpRoll.pitch>e.Math.TWO_PI&&(t.hpRoll.pitch-=e.Math.TWO_PI));break;case 39:i.shiftKey?(t.hpRoll.roll+=t.deltaRadians,t.hpRoll.roll>e.Math.TWO_PI&&(t.hpRoll.roll-=e.Math.TWO_PI)):(t.hpRoll.heading+=t.deltaRadians,t.hpRoll.heading>e.Math.TWO_PI&&(t.hpRoll.heading-=e.Math.TWO_PI));break;case 37:i.shiftKey?(t.hpRoll.roll-=t.deltaRadians,t.hpRoll.roll<0&&(t.hpRoll.roll+=e.Math.TWO_PI)):(t.hpRoll.heading-=t.deltaRadians,t.hpRoll.heading<0&&(t.hpRoll.heading+=e.Math.TWO_PI))}}))}}(window.Cesium),function(e){e.RouteFly=function(t){this.viewer=t.viewer,this.cartographicArray=t.cartographicArray,this.pointArray=t.pointArray,this.start=t.start,this.stop=t.stop,this.speed=t.speed,this.deltaHeight=e.defaultValue(t.deltaHeight,10),this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.cartesian3=new e.Cartesian3(0,0,0),this.initialHeading=[],this.keydownOption=null,this.point=[],this.bearing=[],this.differentBearing=[],this.reduceBearing=[],this.HorizontalRadian=0,this.VerticalRadians=0,this.i=0,this.keyEvent()},e.RouteFly.prototype.init=function(){for(var t=0;t<this.pointArray.length;t++)this.point.push(turf.point(this.pointArray[t]));for(var i=0;i<this.point.length-1;i++)this.bearing.push(turf.bearing(this.point[i],this.point[i+1]));for(t=0;t<this.bearing.length;t++)this.initialHeading.push(e.Math.toRadians(this.bearing[t]));for(var r=0;r<this.bearing.length-1;r++)this.bearing[r+1]-this.bearing[r]<-180?(this.differentBearing.push(e.Math.toRadians(this.bearing[r+1]-this.bearing[r]+360)),this.reduceBearing.push(e.Math.toRadians(this.bearing[r+1]-this.bearing[r]+360))):this.bearing[r+1]-this.bearing[r]>180?(this.differentBearing.push(e.Math.toRadians(this.bearing[r+1]-this.bearing[r]-360)),this.reduceBearing.push(e.Math.toRadians(Math.abs(this.bearing[r+1]-this.bearing[r]-360)))):(this.differentBearing.push(e.Math.toRadians(this.bearing[r+1]-this.bearing[r])),this.reduceBearing.push(e.Math.toRadians(Math.abs(this.bearing[r+1]-this.bearing[r]))))},e.RouteFly.prototype.initializationFly=function(){this.viewer.clock.startTime=this.start.clone(),this.viewer.clock.stopTime=this.stop.clone(),this.viewer.clock.currentTime=this.start.clone(),this.viewer.clock.clockRange=e.ClockRange.CLAMPED},e.RouteFly.prototype.computeCirclularFlight=function(t){for(var i=new e.SampledPositionProperty,r=0;r<t.length;r++){var o=e.JulianDate.addSeconds(this.start,r,new e.JulianDate),n=e.Cartesian3.fromRadians(Number(t[r][0]),Number(t[r][1]),Number(t[r][2]));i.addSample(o,n),this.viewer.entities.add({position:n,point:{pixelSize:2,color:e.Color.TRANSPARENT,outlineColor:e.Color.YELLOW,outlineWidth:2}})}return i},e.RouteFly.prototype.animation=function(){if(this.cartographicArray){var t=this.computeCirclularFlight(this.cartographicArray),i=this.viewer.entities.add({availability:new e.TimeIntervalCollection([new e.TimeInterval({start:this.start,stop:this.stop})]),position:t});this.cartesian3=i.position.getValue(this.viewer.clock.currentTime);var r=this.scene.globe.ellipsoid;if(null==this.cartesian3)this.viewer.clock.multiplier=0,document.removeEventListener("keydown",this.keydownOption),this.viewer.scene.postRender.removeEventListener(this.animation);else{var o=r.cartesianToCartographic(this.cartesian3),n=Math.floor(1e5*e.Math.toDegrees(o.latitude))/1e5,s=Math.floor(1e5*e.Math.toDegrees(o.longitude))/1e5,a=(Math.floor(1e5*o.height),1e3*turf.distance(turf.point(this.pointArray[this.i+1]),turf.point([s,n,0]))),l=turf.distance(turf.point(this.pointArray[this.i]),turf.point(this.pointArray[this.i+1]));a<=1*(50+this.deltaHeight)/10?(this.camera.setView({destination:e.Cartesian3.fromDegrees(e.Math.toDegrees(this.cartographicArray[this.i+1][0]),e.Math.toDegrees(this.cartographicArray[this.i+1][1]),50+this.deltaHeight),orientation:{heading:this.initialHeading[this.i]+this.HorizontalRadian,pitch:e.Math.toRadians(0)+this.VerticalRadians,roll:0}}),this.viewer.clock.multiplier=0,this.i<this.reduceBearing.length?this.reduceBearing[this.i]<1e-5?(this.HorizontalRadian=0,this.i+=1,this.viewer.clock.multiplier=this.speed):(this.HorizontalRadian+=this.differentBearing[this.i]/200,this.reduceBearing[this.i]-=Math.abs(this.differentBearing[this.i]/200)):(this.viewer.clock.multiplier=0,document.removeEventListener("keydown",this.keydownOption),this.viewer.scene.postRender.removeEventListener(this.animation,this))):(this.camera.setView({destination:e.Cartesian3.fromDegrees(e.Math.toDegrees(o.longitude),e.Math.toDegrees(o.latitude),50+this.deltaHeight),orientation:{heading:this.initialHeading[this.i],pitch:e.Math.toRadians(0)+this.VerticalRadians,roll:0}}),this.viewer.clock.multiplier=l>1?this.speed*(1/l):this.speed*(1-l))}}},e.RouteFly.prototype.play=function(){this.initializationFly(),this.init(),this.scene.postRender.addEventListener(this.animation,this)},e.RouteFly.prototype.pause=function(){this.scene.postRender.removeEventListener(this.animation,this)},e.RouteFly.prototype.continue=function(){this.scene.postRender.removeEventListener(this.animation,this),this.scene.postRender.addEventListener(this.animation,this)},e.RouteFly.prototype.STOP=function(){this.scene.postRender.removeEventListener(this.animation,this),this.viewer.entities.removeAll(),document.removeEventListener("keydown",this.keydownOption),this.viewer=null,this.cartographicArray=null,this.pointArray=null,this.start=null,this.stop=null,this.speed=null,this.scene=null,this.camera=null,this.cartesian3=new e.Cartesian3(0,0,0),this.initialHeading=[],this.keydownOption=null,this.point=[],this.bearing=[],this.differentBearing=[],this.reduceBearing=[],this.deltaHeight=e.defaultValue(this.deltaHeight,10),this.HorizontalRadian=0,this.VerticalRadians=0,this.i=0},e.RouteFly.prototype.reset=function(t){this.viewer&&(this.scene.postRender.removeEventListener(this.animation,this),this.cartesian3=new e.Cartesian3(0,0,0),this.initialHeading=[],this.keydownOption=null,this.point=[],this.bearing=[],this.differentBearing=[],this.reduceBearing=[],this.deltaHeight=e.defaultValue(this.deltaHeight,10),this.HorizontalRadian=0,this.VerticalRadians=0,this.i=0,this.play())},e.RouteFly.prototype.keyEvent=function(){var e=this;this.keydownOption=function(t){switch(t.keyCode){case 40:t.shiftKey?e.deltaHeight-=1:e.VerticalRadians-=.01;break;case 38:t.shiftKey?e.deltaHeight+=1:e.VerticalRadians+=.01}},document.addEventListener("keydown",this.keydownOption)}}(window.Cesium),function(e){e.WalkBrowse=function(e){this.viewer=e.viewer,this.pointArray=e.pointArray,this.orientationAngle=[],this.point1=turf.point(this.pointArray[0]),this.point2=turf.point(this.pointArray[1]),this.point3=turf.point(this.pointArray[2]),this.bearing1=turf.bearing(this.point1,this.point2),this.bearing2=turf.bearing(this.point2,this.point3),this.drawMarker(),this.init()},e.WalkBrowse.prototype.animation=function(){var t=this.viewer.scene.globe.ellipsoid,i=this.viewer.camera.position,r=t.cartesianToCartographic(i),o=Math.floor(1e5*e.Math.toDegrees(r.latitude))/1e5,n=Math.floor(1e5*e.Math.toDegrees(r.longitude))/1e5;n==this.pointArray[1][0]&&o==this.pointArray[1][1]?(this.orientationAngle.push(e.Math.toDegrees(this.viewer.camera.heading)),this.bearing2-e.Math.toDegrees(this.viewer.camera.heading)>=1e-12?(this.viewer.camera.moveForward(0),this.viewer.camera.lookRight(e.Math.toRadians((this.bearing2-this.orientationAngle[0])/200))):(this.orientationAngle=[],this.viewer.camera.setView({destination:e.Cartesian3.fromDegrees(this.pointArray[1][0],this.pointArray[1][1],this.pointArray[1][2]),orientation:{heading:e.Math.toRadians(this.bearing2),pitch:e.Math.toRadians(0)}}),this.viewer.camera.moveForward(this.viewer.clock.multiplier))):n-this.pointArray[2][0]>-1e-5&&o-this.pointArray[2][1]>-1e-5?this.viewer.camera.moveForward(0):this.viewer.camera.moveForward(this.viewer.clock.multiplier)},e.WalkBrowse.prototype.init=function(){this.viewer.camera.setView({destination:e.Cartesian3.fromDegrees(this.pointArray[0][0],this.pointArray[0][1],this.pointArray[0][2]),orientation:{heading:e.Math.toRadians(this.bearing1),pitch:e.Math.toRadians(0)}})},e.WalkBrowse.prototype.drawMarker=function(){this.viewer.entities.add({position:e.Cartesian3.fromDegrees(this.pointArray[1][0],this.pointArray[1][1]),point:{pixelSize:2,color:e.Color.TRANSPARENT,outlineColor:e.Color.YELLOW,outlineWidth:2}}),this.viewer.entities.add({position:e.Cartesian3.fromDegrees(this.pointArray[2][0],this.pointArray[2][1]),point:{pixelSize:2,color:e.Color.TRANSPARENT,outlineColor:e.Color.RED,outlineWidth:2}})},e.WalkBrowse.prototype.play=function(){0==this.viewer.entities._entities.length&&this.drawMarker(),this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.camera.setView({destination:e.Cartesian3.fromDegrees(this.pointArray[0][0],this.pointArray[0][1],this.pointArray[0][2]),orientation:{heading:e.Math.toRadians(this.bearing1),pitch:e.Math.toRadians(0)}}),this.viewer.scene.postRender.addEventListener(this.animation,this)},e.WalkBrowse.prototype.pause=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this)},e.WalkBrowse.prototype.continue=function(){0!=this.viewer.entities._entities.length?(this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.scene.postRender.addEventListener(this.animation,this)):this.viewer.scene.postRender.removeEventListener(this.animation,this)},e.WalkBrowse.prototype.stop=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.entities.removeAll(),this.init()}}(window.Cesium),function(e){var t=e.GeoHeatMap=function(t,i){return this.viewer=t.viewer,this.heatmapOptions=t.heatmapOptions,this.dataOptions=t.dataOptions,this.defaults={minCanvasSize:700,maxCanvasSize:2e3,useEntities:!0,radiusFactor:60,spacingFactor:1.5,maxOpacity:.8,minOpacity:.1,blur:.85,gradient:{.3:"blue",.65:"yellow",.8:"orange",.95:"red"}},this.heatmapOptions.useEntities=e.defaultValue(this.heatmapOptions.useEntities,this.defaults.useEntities),this.heatmapOptions.gradient=e.defaultValue(this.heatmapOptions.gradient,this.defaults.gradient),this.heatmapOptions.maxOpacity=e.defaultValue(this.heatmapOptions.maxOpacity,this.defaults.maxOpacity),this.heatmapOptions.minOpacity=e.defaultValue(this.heatmapOptions.minOpacity,this.defaults.minOpacity),this.heatmapOptions.blur=e.defaultValue(this.heatmapOptions.blur,this.defaults.blur),this};t.prototype._computeBounds=function(e){if(e&&e.features&&e.features.length>0&&e.features[0].geometry&&e.features[0].geometry.coordinates){for(var t={west:e.features[0].geometry.coordinates[0],south:e.features[0].geometry.coordinates[1],east:e.features[0].geometry.coordinates[0],north:e.features[0].geometry.coordinates[1]},i=0;i<e.features.length;i++){var r=e.features[i].geometry.coordinates[0],o=e.features[i].geometry.coordinates[1];t.west=r>t.west?t.west:r,t.east=r>t.east?r:t.east,t.south=o>t.south?t.south:o,t.north=o>t.north?o:t.north}return t}return!1},t.prototype._getContainer=function(e,t,i){var r=document.createElement("div");return i&&r.setAttribute("id",i),r.setAttribute("style","width: "+e+"px; height: "+t+"px; margin: 0px; display: none;"),document.body.appendChild(r),r},t.prototype._getImageryProvider=function(t){var i=t._heatmap.getDataURL(),r=new e.SingleTileImageryProvider({url:i,rectangle:t._rectangle});return r._tilingScheme=new e.WebMercatorTilingScheme({rectangleSouthwestInMeters:new e.Cartesian2(t._mbounds.west,t._mbounds.south),rectangleNortheastInMeters:new e.Cartesian2(t._mbounds.east,t._mbounds.north)}),r},t.prototype._getID=function(e){for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<(e||8);r++)t+=i.charAt(Math.floor(Math.random()*i.length));return t};var i=new e.WebMercatorProjection;t.prototype.wgs84ToMercator=function(t){var r=i.project(e.Cartographic.fromDegrees(t.x,t.y));return{x:r.x,y:r.y}},t.prototype.wgs84ToMercatorBB=function(t){var r=i.project(e.Cartographic.fromDegrees(t.west,t.south)),o=i.project(e.Cartographic.fromDegrees(t.east,t.north));return{north:o.y,east:o.x,south:r.y,west:r.x}},t.prototype.mercatorToWgs84=function(t){var r=i.unproject(new e.Cartesian3(t.x,t.y));return{x:r.longitude,y:r.latitude}},t.prototype.mercatorToWgs84BB=function(t){var r=i.unproject(new e.Cartesian3(t.west,t.south)),o=i.unproject(new e.Cartesian3(t.east,t.north));return{north:this.rad2deg(o.latitude),east:this.rad2deg(o.longitude),south:this.rad2deg(r.latitude),west:this.rad2deg(r.longitude)}},t.prototype.deg2rad=function(e){return e*(Math.PI/180)},t.prototype.rad2deg=function(e){return e/(Math.PI/180)},t.prototype.wgs84PointToHeatmapPoint=function(e){return this.mercatorPointToHeatmapPoint(this.wgs84ToMercator(e))},t.prototype.mercatorPointToHeatmapPoint=function(e){var t={};return t.x=Math.round((e.x-this._xoffset)/this._factor+this._spacing),t.y=Math.round((e.y-this._yoffset)/this._factor+this._spacing),t.y=this.height-t.y,t},t.prototype._setWidthAndHeight=function(e){this.width=e.east>0&&e.west<0?e.east+Math.abs(e.west):Math.abs(e.east-e.west),this.height=e.north>0&&e.south<0?e.north+Math.abs(e.south):Math.abs(e.north-e.south),this._factor=1,this.width>this.height&&this.width>this.defaults.maxCanvasSize?(this._factor=this.width/this.defaults.maxCanvasSize,this.height/this._factor<this.defaults.minCanvasSize&&(this._factor=this.height/this.defaults.minCanvasSize)):this.height>this.width&&this.height>this.defaults.maxCanvasSize?(this._factor=this.height/this.defaults.maxCanvasSize,this.width/this._factor<this.defaults.minCanvasSize&&(this._factor=this.width/this.defaults.minCanvasSize)):this.width<this.height&&this.width<this.defaults.minCanvasSize?(this._factor=this.width/this.defaults.minCanvasSize,this.height/this._factor>this.defaults.maxCanvasSize&&(this._factor=this.height/this.defaults.maxCanvasSize)):this.height<this.width&&this.height<this.defaults.minCanvasSize&&(this._factor=this.height/this.defaults.minCanvasSize,this.width/this._factor>this.defaults.maxCanvasSize&&(this._factor=this.width/this.defaults.maxCanvasSize)),this.width=this.width/this._factor,this.height=this.height/this._factor},t.prototype.setData=function(t,i,r){if(this._id=this._getID(),this._initBounds=this._computeBounds(r),this._mbounds=this.wgs84ToMercatorBB(this._initBounds),this._setWidthAndHeight(this._mbounds),this.heatmapOptions.radius=Math.round(this.heatmapOptions.radius?this.heatmapOptions.radius:this.width>this.height?this.width/this.defaults.radiusFactor:this.height/this.defaults.radiusFactor),this._spacing=this.heatmapOptions.radius*this.defaults.spacingFactor,this._xoffset=this._mbounds.west,this._yoffset=this._mbounds.south,this.width=Math.round(this.width+2*this._spacing),this.height=Math.round(this.height+2*this._spacing),this._mbounds.west-=this._spacing*this._factor,this._mbounds.east+=this._spacing*this._factor,this._mbounds.south-=this._spacing*this._factor,this._mbounds.north+=this._spacing*this._factor,this.bounds=this.mercatorToWgs84BB(this._mbounds),this._rectangle=e.Rectangle.fromDegrees(this.bounds.west,this.bounds.south,this.bounds.east,this.bounds.north),this._container?(this._id&&this._container.setAttribute("id",this._id),this._container.setAttribute("style","width: "+this.width+"px; height: "+this.height+"px; margin: 0px; display: none;")):this._container=this._getContainer(this.width,this.height,this._id),this.heatmapOptions.container=this._container,this._heatmap?this._heatmap.repaint():this._heatmap=h337.create(this.heatmapOptions),this._container.children[0].setAttribute("id",this._id+"-hm"),r&&r.features.length>0&&null!==t&&!1!==t&&null!==i&&!1!==i){for(var o=[],n=0;n<r.features.length;n++){var s={};s.x=r.features[n].geometry.coordinates[0],s.y=r.features[n].geometry.coordinates[1],s.value=r.features[n].properties.z,o.push(s)}for(var a=[],l=0;l<o.length;l++){var u=o[l],h=this.wgs84PointToHeatmapPoint(u);(u.value||0===u.value)&&(h.value=u.value),a.push(h)}return this._heatmap.setData({min:t,max:i,data:a}),this.updateLayer(),!0}return!1},t.prototype.show=function(e){this._layer&&(this._layer.show=e)},t.prototype.remove=function(){this._layer&&(this.viewer.scene.imageryLayers.remove(this._layer),this.viewer.entities.remove(this._layer))},t.prototype.updateLayer=function(){if(this.heatmapOptions.useEntities&&this.viewer.entities){this._layer&&this.viewer.entities.remove(this._layer);var t=new e.ImageMaterialProperty({image:this._heatmap._renderer.canvas});e.VERSION>="1.21"?t.transparent=!0:e.VERSION>="1.16"&&(t.alpha=.99),this._layer=this.viewer.entities.add({show:!0,rectangle:{coordinates:this._rectangle,material:t}})}else this._layer&&this.viewer.scene.imageryLayers.remove(this._layer),this._layer=this.viewer.scene.imageryLayers.addImageryProvider(this._getImageryProvider(this))}}(window.Cesium),function(e){var t=e.GeoWind=function(t,i){return this.viewer=t.viewer,this.data=t.data,this.level=t.level,this.rectangle=t.rectangle,this.options=t.options,this.options.velocityScale=e.defaultValue(this.options.velocityScale,.11),this.options.particleMultiplier=e.defaultValue(this.options.particleMultiplier,.002),this.options.maxWindIntensity=e.defaultValue(this.options.maxWindIntensity,30),this.options.lineWidth=e.defaultValue(this.options.lineWidth,2),this.options.opacity=e.defaultValue(this.options.opacity,.6),this.options.colors=e.defaultValue(this.options.colors,["#00ffff","#64f0ff","#87e1ff","#a0d0ff","#b5c0ff","#c6adff","#d49bff","#e185ff","#ec6dff","#ff1edb"]),this.canvas=document.createElement("canvas"),this.canvasContext=this.canvas.getContext("2d"),this._initWindy(),this.setData(this.data),this};t.prototype._initWindy=function(){var e=this;this.Windy=function(){var t=e.options.velocityScale,i=e.options.maxWindIntensity,r=e.options.lineWidth,o=e.options.particleMultiplier,n=e.options.opacity,s=e.options.colors,a=[NaN,NaN,null],l=2*Math.PI,h=Math.pow(10,-5.2),c=function(e,t,i,r,o,n){var s=1-e,a=1-t,l=s*a,u=e*a,h=s*t,c=e*t,g=i[0]*l+r[0]*u+o[0]*h+n[0]*c,p=i[1]*l+r[1]*u+o[1]*h+n[1]*c;return[g,p,Math.sqrt(g*g+p*p)]},g=function(e){var t,i,r,o,n=null,s=null;return e.forEach((function(e){switch(e.header.parameterCategory+","+e.header.parameterNumber){case"2,2":n=e;break;case"2,3":s=e}})),i=s,r=(t=n).data,o=i.data,{header:t.header,data:function(e){return[r[e],o[e]]},interpolate:c}},f=function(e){return null!=e},d=function(e,t,i,r,o,n,s,a){var l=s[0]*n,u=s[1]*n,h=m(e,t,i,r,o,a);return s[0]=h[0]*l+h[2]*u,s[1]=h[1]*l+h[3]*u,s},m=function(e,t,i,r,o,n){var s=t<0?h:-h,a=i<0?h:-h,u=_(i,t+s,n),c=_(i+a,t,n),g=Math.cos(i/360*l);return[(u[0]-r)/s/g,(u[1]-o)/s/g,(c[0]-r)/a,(c[1]-o)/a]},C=function(e){return e/180*Math.PI},y=function(e){return e/(Math.PI/180)},v=function(e,t,i){var r=i.east-i.west,o=i.width/y(r)*360/(2*Math.PI),n=o/2*Math.log((1+Math.sin(i.south))/(1-Math.sin(i.south))),s=(i.height+n-t)/o,a=180/Math.PI*(2*Math.atan(Math.exp(s))-Math.PI/2);return[y(i.west)+e/i.width*y(r),a]},A=function(e){return Math.log(Math.tan(e/2+Math.PI/4))},_=function(e,t,i){var r=A(i.south),o=A(i.north),n=i.width/(i.east-i.west),s=i.height/(o-r),a=A(C(e));return[(C(t)-i.west)*n,a=(o-a)*s]},I=function(e,i,r){var o={},n=t,s=[],l=e.x;function h(t){for(var r=[],a=e.y;a<=e.yMax;a+=2){var l=v(t,a,i);if(l){var u=l[0],h=l[1];if(isFinite(u)){var c=G(u,h);c&&(c=d(o,u,h,t,a,n,c,i),r[a+1]=r[a]=c)}}}s[t+1]=s[t]=r}!function t(){for(var i=u()();l<e.width;)if(h(l),l+=2,u()()-i>1e3)return void setTimeout(t,25);!function(e,t,i){function r(t,i){var r=e[Math.round(t)];return r&&r[Math.round(i)]||a}r.release=function(){e=[]},r.randomize=function(e){var i,o,n=0;do{i=Math.round(Math.floor(Math.random()*t.width)+t.x),o=Math.round(Math.floor(Math.random()*t.height)+t.y)}while(null===r(i,o)[2]&&n++<30);return e.x=i,e.y=o,e},i(t,r)}(s,e,r)}()},b=function(t,a){function l(e){return"#"==e.charAt(0)?e.substring(1,7):e}var u,h,c=(u=i,h=[],s.forEach((function(e){h.push("rgba("+p()(l(e).substring(0,2),16)+", "+p()(l(e).substring(2,4),16)+", "+p()(l(e).substring(4,6),16)+", "+n+")")})),h.indexFor=function(e){return Math.floor(Math.min(e,u)/u*(h.length-1))},h),g=c.map((function(){return[]})),f=Math.round(t.width*t.height*o);/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i.test(navigator.userAgent)&&(f*=.075);for(var d=[],m=0;m<f;m++)d.push(a.randomize({age:Math.floor(100*Math.random())+0}));var C=e.canvasContext;C.lineWidth=r,C.fillStyle="rgba(0, 0, 0, 0.97)",function e(){try{E.timer=setTimeout((function(){var i;requestAnimationFrame(e),g.forEach((function(e){e.length=0})),d.forEach((function(e){e.age>100&&(a.randomize(e).age=0);var t=e.x,i=e.y,r=a(t,i),o=r[2];if(null===o)e.age=100;else{var n=t+r[0],s=i+r[1];null!==a(n,s)[2]?(e.xt=n,e.yt=s,g[c.indexFor(o)].push(e)):(e.x=n,e.y=s)}e.age+=1})),i=C.globalCompositeOperation,C.globalCompositeOperation="destination-in",C.fillRect(t.x,t.y,t.width,t.height),C.globalCompositeOperation=i,g.forEach((function(e,t){e.length>0&&(C.beginPath(),C.strokeStyle=c[t],e.forEach((function(e){C.moveTo(e.x,e.y),C.lineTo(e.xt,e.yt),e.x=e.xt,e.y=e.yt})),C.stroke())}))}),50)}catch(e){console.error(e)}}()},w=function(){E.field&&E.field.release(),E.timer&&clearTimeout(E.timer)},G=function(e){var t=g(e),i=t.header,r=i.lo1,o=i.la1,n=i.dx,s=i.dy,a=i.nx,l=i.ny,u=new Date(i.refTime);u.setHours(u.getHours()+i.forecastTime);for(var h=[],c=0,p=Math.floor(a*n)>=360,d=0;d<l;d++){for(var m=[],C=0;C<a;C++,c++)m[C]=t.data(c);p&&m.push(m[0]),h[d]=m}return function(e,i){var a,l=function(e,t){return e-t*Math.floor(e/t)}(e-r,360)/n,u=(o-i)/s,c=Math.floor(l),g=c+1,p=Math.floor(u),d=p+1;if(a=h[p]){var m=a[c],C=a[g];if(f(m)&&f(C)&&(a=h[d])){var y=a[c],v=a[g];if(f(y)&&f(v))return t.interpolate(l-c,u-p,m,C,y,v)}}return null}}(e.data),E={start:function(e,t,i,r){var o,n,s,a,l,u,h,c={south:C(r[0][1]),north:C(r[1][1]),east:C(r[1][0]),west:C(r[0][0]),width:t,height:i};w(),I((n=t,s=i,a=(o=e)[0],l=o[1],u=Math.round(a[0]),h=Math.max(Math.floor(a[1],0),0),Math.min(Math.ceil(l[0],n),n-1),{x:u,y:h,xMax:n,yMax:Math.min(Math.ceil(l[1],s),s-1),width:n,height:s}),c,(function(e,t){E.field=t,b(e,t)}))},stop:w};return E}},t.prototype._calculateBounds=function(){var t=this.rectangle[0][0],i=this.rectangle[1][1],r=this.rectangle[1][0],o=this.rectangle[0][1],n=this.level,s=this._locationCoordinate(t,o,n),a=this._locationCoordinate(r,i,n);this._size=[512*Math.abs(s[0]-a[0]),512*Math.abs(s[1]-a[1])],this._bounds=[[t,o],[r,i]],this._rectangle=e.Rectangle.fromDegrees(t,o,r,i)},t.prototype._locationCoordinate=function(e,t,i){return[(180+e)*Math.pow(2,i)/360,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*Math.pow(2,i)/360]},t.prototype._getCenterPoint=function(){var t=this.viewer.canvas,i=new e.Cartesian2(t.clientWidth/2,t.clientHeight/2),r=this.viewer.camera.getPickRay(i);return this.viewer.scene.globe.pick(r,this.viewer.scene)||this.viewer.camera.pickEllipsoid(i)},t.prototype._getLevel=function(){var t=e.Ellipsoid.WGS84,i=this._getCenterPoint();if(!i){var r=this.viewer.scene.globe,o=this.viewer.camera.positionCartographic.clone(),n=r.getHeight(o);o.height=n||0,i=t.cartographicToCartesian(o)}var s=e.Cartesian3.distance(i,this.viewer.camera.position)/1405.5;return Math.log2(78271.51696402031/s)-1.2},t.prototype.show=function(e){this._layer&&(this._layer.show=e)},t.prototype.remove=function(){this._layer&&this.viewer.entities.remove(this._layer)},t.prototype.updateLayer=function(){var t=this;this._calculateBounds(),this.canvas.width=Math.round(this._size[0]),this.canvas.height=Math.round(this._size[1]),setTimeout((function(){t.windy.start([[0,0],t._size],t._size[0],t._size[1],t._bounds)}),1),this._layer&&this.viewer.entities.remove(this._layer);var i=new e.ImageMaterialProperty({image:new e.CallbackProperty((function(){return t.canvas.toDataURL()}),!1)});e.VERSION>="1.21"?i.transparent=!0:e.VERSION>="1.16"&&(i.alpha=.99),this._layer=this.viewer.entities.add({rectangle:{coordinates:this._rectangle,material:i}})},t.prototype.setData=function(e){this.data=e,this.windy=new this.Windy,this.updateLayer()}}(window.Cesium),function(e){var t=e.GeoGeographicTilingScheme=function(t){t=e.defaultValue(t,{}),this._numberOfLevelZeroTilesX=e.defaultValue(t.numberOfLevelZeroTilesX,1),this._numberOfLevelZeroTilesY=e.defaultValue(t.numberOfLevelZeroTilesY,.5),this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this._rectangle=e.defaultValue(t.rectangle,e.Rectangle.MAX_VALUE),this._projection=new e.GeographicProjection(this._ellipsoid)};t.prototype=new e.GeographicTilingScheme,delete t.prototype._numberOfLevelZeroTilesX,delete t.prototype._numberOfLevelZeroTilesY,delete t.prototype._ellipsoid,delete t.prototype._rectangle,delete t.prototype._projection,t.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY*Math.pow(2,e)}}(window.Cesium),function(e){var t=e.GeoTerrainProvider=function(t){if(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),!e.defined(t.urls))throw new e.DeveloperError("options.urls is required.");this._dataType=e.defaultValue(t.dataType,e.GeoTerrainProvider.INT),this._urls=t.urls,this._urls_length=this._urls.length,this._url_i=0,this._url_step=0,this._maxTerrainLevel=e.defaultValue(t.dataType,e.GeoTerrainProvider.INT),this._errorEvent=new e.Event,this._ready=!1,this._readyPromise=e.when.defer(),this._proxy=t.proxy,this._terrainDataStructure={heightScale:.001,heightOffset:-1e3,elementsPerHeight:3,stride:4,elementMultiplier:256,isBigEndian:!0};var i=t.credit;"string"==typeof i&&(i=new e.Credit(i)),this._credit=i,this._tilingScheme=void 0,this._rectangles=[];var r=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84);this._tilingScheme=new e.GeographicTilingScheme({ellipsoid:r}),this._heightmapWidth=64,this._heightmapHeight=64,this._levelZeroMaximumGeometricError=e.TerrainProvider.getEstimatedLevelZeroGeometricErrorForAHeightmap(r,Math.min(this._heightmapWidth,this._heightmapHeight),this._tilingScheme.getNumberOfXTilesAtLevel(0)),this._ready=!0,this._readyPromise.resolve(!0),this._name=t.name,this._opacity=t.opacity,this._maxExtent=t.maxExtent,this._topLevel=e.defaultValue(t.topLevel,5),this._bottomLevel=e.defaultValue(t.bottomLevel,25)};function i(t,i){return(i=e.defined(i)?i:new e.Request).url=t,i.requestFunction=function(){var i,r,o=new XMLHttpRequest;return o.open("GET",t,!0),o.responseType="arraybuffer",o.async=!1,o.send(null),i=o,r=e.when.defer(),i.onreadystatechange=function(){if(4===i.readyState&&200===i.status&&e.defined(i.response)){for(var t=new DataView(i.response),o=new Uint8Array(t.byteLength),n=0;n<t.byteLength;)o[n]=t.getUint8(n,!0),n++;var s=function(t){if(!(t.length<1e3)){var i=new Zlib.Inflate(t);return e.defined(i)?i.decompress():void 0}}(o);e.defined(s)?r.resolve(s):r.reject(void 0)}},r.promise},e.RequestScheduler.request(i)}e.defineProperties(t.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){if(!this.ready)throw new e.DeveloperError("requestTileGeometry must not be called before ready returns true.");return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}}}),t.prototype.requestTileGeometry=function(t,r,n,s){if(!this.ready)throw new e.DeveloperError("requestTileGeometry must not be called before ready returns true.");this._urls_length>1&&(this._url_step<8?this._url_step++:(this._url_step=0,this._url_i++,this._url_i>=this._urls_length&&(this._url_i=0)));var a=this._urls[this._url_i];if(this._tilingScheme.getNumberOfYTilesAtLevel(n),n<this._bottomLevel&&n>=this._topLevel){var l,u=a+(-1===a.indexOf("?")?"?":"&")+"x="+t+"&y="+r+"&l="+(n+1),h=this._proxy;if(e.defined(h)&&(u=h.getURL(u)),s=e.defaultValue(s,!0)){if(l=i(u,s),!e.defined(l))return}else l=i(u);var c=this;return e.when(l,(function(i){var s=c.transformBuffer(i);if(e.defined(s)){var a=new e.HeightmapTerrainData({buffer:s,width:c._heightmapWidth,height:c._heightmapHeight,childTileMask:o(c,t,r,n),structure:c._terrainDataStructure});return a._skirtHeight=6e3,a}}))}if(n<this._topLevel){var g=this._heightmapWidth,p=this._heightmapHeight,f=o(this,t,r,n),d=this._terrainDataStructure;return new e.HeightmapTerrainData({buffer:this.getvHeightBuffer(),width:g,height:p,childTileMask:f,structure:d})}},t.prototype.getLevelMaximumGeometricError=function(t){if(!this.ready)throw new e.DeveloperError("requestTileGeometry must not be called before ready returns true.");return this._levelZeroMaximumGeometricError/(1<<t)},t.prototype.getTileDataAvailable=function(e,t,i){if(i<25)return!0},t.prototype.getvHeightBuffer=function(){var t=this._vHeightBuffer;if(!e.defined(t)){t=new Uint8ClampedArray(this._heightmapWidth*this._heightmapHeight*4);for(var i=0;i<this._heightmapWidth*this._heightmapHeight*4;)t[i++]=15,t[i++]=66,t[i++]=64,t[i++]=255;this._vHeightBuffer=t}return t},t.prototype.transformBuffer=function(t){var i=2;this._dataType===e.GeoTerrainProvider.INT?i=2:this._dataType===e.GeoTerrainProvider.FLOAT&&(i=4);var r=t;if(r.length===22500*i){for(var o,n,s,a,l,u=new ArrayBuffer(i),h=new DataView(u),c=this._heightmapWidth,g=this._heightmapHeight,f=new Uint8Array(c*g*4),d=0;d<g;d++)for(var m=0;m<c;m++){a=p()(149*d/(g-1)),l=p()(149*m/(c-1)),4===i?(n=i*(150*a+l),h.setInt8(0,r[n]),h.setInt8(1,r[n+1]),h.setInt8(2,r[n+2]),h.setInt8(3,r[n+3]),o=h.getFloat32(0,!0)):o=r[n=i*(150*a+l)]+256*r[n+1],(o>1e4||o<-2e3)&&(o=0);var C=(o+1e3)/.001;f[s=4*(d*c+m)]=C/65536,f[s+1]=(C-256*f[s]*256)/256,f[s+2]=C-256*f[s]*256-256*f[s+1],f[s+3]=255}return f}return null};var r=new e.Rectangle;function o(t,i,o,s){for(var a=t._tilingScheme,l=t._rectangles,u=a.tileXYToRectangle(i,o,s),h=0,c=0;c<l.length&&15!==h;++c){var g=l[c];if(!(g.maxLevel<=s)){var p=g.rectangle,f=e.Rectangle.intersection(p,u,r);e.defined(f)&&(n(a,p,2*i,2*o,s+1)&&(h|=4),n(a,p,2*i+1,2*o,s+1)&&(h|=8),n(a,p,2*i,2*o+1,s+1)&&(h|=1),n(a,p,2*i+1,2*o+1,s+1)&&(h|=2))}}return h}function n(t,i,o,n,s){var a=t.tileXYToRectangle(o,n,s);return e.defined(e.Rectangle.intersection(a,i,r))}t.INT="int",t.FLOAT="float"}(window.Cesium),Cesium.VERSION>=1.5){a()(Cesium.Model.prototype,{_cachedGltf:{set:function(e){this._vtxf_cachedGltf=e,this._vtxf_cachedGltf&&this._vtxf_cachedGltf._gltf&&function(e){if(e.extensionsUsed&&(!e.extensionsUsed||-1!=e.extensionsUsed.indexOf("KHR_technique_webgl"))){var t=e.extensionsUsed.indexOf("KHR_technique_webgl"),i=e.extensionsRequired.indexOf("KHR_technique_webgl");if(-1!==t){e.extensionsRequired.splice(i,1,"KHR_techniques_webgl"),e.extensionsUsed.splice(t,1,"KHR_techniques_webgl"),e.extensions=e.extensions||{},e.extensions.KHR_techniques_webgl={},e.extensions.KHR_techniques_webgl.programs=e.programs,e.extensions.KHR_techniques_webgl.shaders=e.shaders,e.extensions.KHR_techniques_webgl.techniques=e.techniques;var r=e.extensions.KHR_techniques_webgl.techniques;e.materials.forEach((function(t,i){e.materials[i]&&e.materials[i].name&&(e.materials[i].extensions={KHR_technique_webgl:{technique:e.materials[i].technique,values:{diffuse:0}}}),void 0===e.materials[i].extensions&&(e.materials[i].extensions={},e.materials[i].extensions.KHR_technique_webgl={}),e.materials[i].extensions.KHR_technique_webgl.values=e.materials[i].values,e.materials[i].extensions.KHR_techniques_webgl=e.materials[i].extensions.KHR_technique_webgl;var o=e.materials[i].extensions.KHR_techniques_webgl;for(var n in o.values){void 0===o.technique&&(o.technique=e.materials[i].technique);var s=r[o.technique].uniforms;for(var a in s)if(s[a]===n){o.values[a]=o.values[n],delete o.values[n];break}}})),r.forEach((function(e){for(var t in e.attributes){var i=e.attributes[t];e.attributes[t]=e.parameters[i]}for(var r in e.uniforms)i=e.uniforms[r],e.uniforms[r]=e.parameters[i]}))}}}(this._vtxf_cachedGltf._gltf)},get:function(){return this._vtxf_cachedGltf}}})}!function(e){var t=e.defaultValue;function i(i){i=t(i,t.EMPTY_OBJECT),this.viewer=i.viewer,this.tileset=i.tileset,this.source=i.source,this.autoActivate=t(i.autoActivate,!0),this.active=t(i.active,null),this.showDefaultSelectedEntity=t(i.showDefaultSelectedEntity,!0),this.originalColor=t(i.originalColor,e.Color.fromBytes(255,50,50,1)),this.moveColor=t(i.moveColor,e.Color.fromBytes(255,50,50,122)),this.selectedColor=t(i.selectedColor,e.Color.fromBytes(50,255,50,122)),this.selectedFeature=void 0,this.dataSource=void 0,this.selectedEntity=new e.Entity,this.wrappedBoxDataSource=void 0,this.source&&"geojson"===this.source.type&&this._loadGeoJSON(this.source.data),this.handler=new e.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.autoActivate&&this.activateAction(),this._seletedEvent=new e.Event}e.defined,e.defineProperties(i.prototype,{seletedEvent:{get:function(){return this._seletedEvent}}}),i.prototype._loadGeoJSON=function(t){var i=this;e.GeoJsonDataSource.load(t).then((function(e){i.dataSource=e,i.viewer.dataSources.add(e);for(var t=e.entities.values,r=0;r<t.length;r++){var o=t[r],n=i.originalColor;o.polygon.material=n,o.polygon.outline=!1,o.polygon.height=o.properties.minheight,o.polygon.extrudedHeight=o.properties.maxheight}}))},i.prototype.reloadGeoJSON=function(e){this.dataSource=this.viewer.dataSources.remove(this.dataSource)?null:this.dataSource,this._loadGeoJSON(e)},i.prototype.showSelectedEntity=function(e){if(e&&e.id){this.selectedEntity.name=e.id.name,this.viewer.selectedEntity=this.selectedEntity;for(var t=e.id.properties.propertyNames,i='<table class="cesium-infoBox-defaultTable"><tbody>',r=0;r<t.length;r++)i+="<tr><th>"+t[r]+"</th><td>"+e.id.properties[t[r]].getValue()+"</td></tr>";i+="</tbody></table>",this.selectedEntity.description=i}},i.prototype.isContaintFeature=function(e){for(var t=this.dataSource.entities.values,i=0;i<t.length;i++)if(t[i]===e.id)return!0;return!1},i.prototype.showWrappedBox=function(t){var i=this;i.hideWrappedBox(),e.GeoJsonDataSource.load(t).then((function(e){i.viewer.dataSources.add(e);for(var t=e.entities.values,r=0;r<t.length;r++){var o=t[r],n=i.selectedColor;o.polygon.material=n,o.polygon.outline=!1,o.polygon.height=o.properties.minheight,o.polygon.extrudedHeight=o.properties.maxheight}i.wrappedBoxDataSource=e}))},i.prototype.hideWrappedBox=function(){this.wrappedBoxDataSource&&(this.viewer.dataSources.remove(this.wrappedBoxDataSource),this.wrappedBoxDataSource=void 0)},i.prototype.activateAction=function(){if(!0!==this.active){this.active=!0;var t=this,i=null,r=null;t.handler.setInputAction((function(o){if(i&&i.id){if(r&&r.id&&i&&i.id&&i.id.id===r.id.id)return;i.id.polygon.material=t.originalColor,i=void 0}for(var n=void 0,s=t.viewer.scene.drillPick(o.endPosition,10),a=0;a<s.length;a++)if(s[a].id&&s[a].id instanceof e.Entity){n=s[a];break}if(e.defined(n)&&(!r&&n&&n.id||n&&n.id&&r&&r.id&&n.id.id!==r.id.id)){if(!t.isContaintFeature(n))return;i=n,n.id.polygon.material=t.moveColor}}),e.ScreenSpaceEventType.MOUSE_MOVE),t.handler.setInputAction((function(o){r&&(r.id.polygon.material=t.originalColor,r=void 0,t.selectedFeature=r);for(var n=void 0,s=t.viewer.scene.drillPick(o.position,10),a=0;a<s.length;a++)if(s[a].id&&s[a].id instanceof e.Entity){n=s[a];break}if(e.defined(n)){if(r!==n){if(n&&n.id&&r!==n){if(!t.isContaintFeature(n))return;r=n,n.id.polygon.material=t.selectedColor,t.selectedFeature=r}n&&r&&i&&n.id===i.id&&(i=void 0),n&&n.id?(t.showDefaultSelectedEntity?t.showSelectedEntity(n):t.viewer.selectedEntity=null,t._seletedEvent.raiseEvent(n)):t.viewer.selectedEntity=null}}else t.viewer.selectedEntity=null}),e.ScreenSpaceEventType.LEFT_CLICK)}},i.prototype.deactivateAction=function(){!0===this.active&&(this.active=!1,this.selectedFeature&&this.selectedFeature.id&&(this.selectedFeature.id.polygon.material=this.originalColor,this.selectedFeature=null,this.viewer.selectedEntity=null),this.handler.removeInputAction(e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.removeInputAction(e.ScreenSpaceEventType.LEFT_CLICK))},i.prototype.destroy=function(){this.deactivateAction(),this.handler=this.handler&&this.handler.destroy(),this.dataSource=this.viewer.dataSources.remove(this.dataSource)?null:this.dataSource,this.viewer=void 0,this.tileset=void 0,this.source=void 0,this.originalColor=void 0,this.moveColor=void 0,this.selectedColor=void 0,this.selectedFeature=void 0,this.selectedEntity=void 0},e.Cesium3DTilesetMonomer=i}(window.Cesium),function(e){var t=e.BoundingSphere,i=e.Cartesian2,r=e.Cartesian3,o=e.Cartesian4,n=e.Cartographic,s=e.defaultValue,a=e.defined,l=e.defineProperties,u=e.DeveloperError,h=e.EasingFunction,c=e.Ellipsoid,g=e.EllipsoidGeodesic,p=e.Event,f=e.HeadingPitchRange,d=e.HeadingPitchRoll,m=e.Intersect,C=e.IntersectionTests,y=e.Math,v=e.Matrix3,A=e.Matrix4,_=e.OrthographicFrustum,I=e.OrthographicOffCenterFrustum,b=e.PerspectiveFrustum,w=e.Quaternion,G=e.Ray,E=e.Rectangle,S=e.Transforms,P=e.CameraFlightPath,T=e.MapMode2D,x=e.SceneMode;function N(e){if(!a(e))throw new u("scene is required.");this._scene=e,this._transform=A.clone(A.IDENTITY),this._invTransform=A.clone(A.IDENTITY),this._actualTransform=A.clone(A.IDENTITY),this._actualInvTransform=A.clone(A.IDENTITY),this._transformChanged=!1,this.position=new r,this._position=new r,this._positionWC=new r,this._positionCartographic=new n,this.direction=new r,this._direction=new r,this._directionWC=new r,this.up=new r,this._up=new r,this._upWC=new r,this.right=new r,this._right=new r,this._rightWC=new r,this.frustum=new b,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.fov=y.toRadians(60),this.defaultMoveAmount=1e5,this.defaultLookAmount=Math.PI/60,this.defaultRotateAmount=Math.PI/3600,this.defaultZoomAmount=1e5,this.constrainedAxis=void 0,this.maximumZoomFactor=1.5,this._moveStart=new p,this._moveEnd=new p,this._changed=new p,this._changedPosition=void 0,this._changedDirection=void 0,this._changedFrustum=void 0,this.percentageChanged=.5,this._viewMatrix=new A,this._invViewMatrix=new A,L(this),this._mode=x.SCENE3D,this._modeChanged=!0;var t=e.mapProjection;this._projection=t,this._maxCoord=t.project(new n(Math.PI,y.PI_OVER_TWO)),this._max2Dfrustum=void 0,this._suspendTerrainAdjustment=!1,Ke(this,N.DEFAULT_VIEW_RECTANGLE,this.position,!0);var i=r.magnitude(this.position);i+=i*N.DEFAULT_VIEW_FACTOR,r.normalize(this.position,this.position),r.multiplyByScalar(this.position,i,this.position)}function L(e){A.computeView(e._position,e._direction,e._up,e._right,e._viewMatrix),A.multiply(e._viewMatrix,e._actualInvTransform,e._viewMatrix),A.inverseTransformation(e._viewMatrix,e._invViewMatrix)}N.TRANSFORM_2D=new A(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),N.TRANSFORM_2D_INVERSE=A.inverseTransformation(N.TRANSFORM_2D,new A),N.DEFAULT_VIEW_RECTANGLE=E.fromDegrees(-95,-20,-70,90),N.DEFAULT_VIEW_FACTOR=.5,N.DEFAULT_OFFSET=new f(0,-y.PI_OVER_FOUR,0),N.prototype._updateCameraChanged=function(){if(0!==this._changed.numberOfListeners){var e=this.percentageChanged;if(this._mode!==x.SCENE2D){if(!a(this._changedDirection))return this._changedPosition=r.clone(this.positionWC,this._changedPosition),void(this._changedDirection=r.clone(this.directionWC,this._changedDirection));var t,i=y.acosClamped(r.dot(this.directionWC,this._changedDirection));t=a(this.frustum.fovy)?i/(.5*this.frustum.fovy):i;var o=r.distance(this.positionWC,this._changedPosition)/this.positionCartographic.height;(t>e||o>e)&&(this._changed.raiseEvent(Math.max(t,o)),this._changedPosition=r.clone(this.positionWC,this._changedPosition),this._changedDirection=r.clone(this.directionWC,this._changedDirection))}else{if(!a(this._changedFrustum))return this._changedPosition=r.clone(this.position,this._changedPosition),void(this._changedFrustum=this.frustum.clone());var n,s=this.position,l=this._changedPosition,u=this.frustum,h=this._changedFrustum,c=s.x+u.left,g=s.x+u.right,p=l.x+h.left,f=l.x+h.right,d=s.y+u.bottom,m=s.y+u.top,C=l.y+h.bottom,v=l.y+h.top,A=Math.max(c,p),_=Math.min(g,f),I=Math.max(d,C),b=Math.min(m,v);if(A>=_||I>=m)n=1;else{var w=h;c<p&&g>f&&d<C&&m>v&&(w=u),n=1-(_-A)*(b-I)/((w.right-w.left)*(w.top-w.bottom))}n>e&&(this._changed.raiseEvent(n),this._changedPosition=r.clone(this.position,this._changedPosition),this._changedFrustum=this.frustum.clone(this._changedFrustum))}}};var M=new A,R=new n;N.prototype._adjustHeightForTerrain=function(){var e=this._scene,t=e.screenSpaceCameraController,i=t.enableCollisionDetection,o=t.minimumCollisionTerrainHeight,n=t.minimumZoomDistance;if(!this._suspendTerrainAdjustment&&i){var s=this._mode,l=e.globe;if(a(l)&&s!==x.SCENE2D&&s!==x.MORPHING){var u,h,c=l.ellipsoid,g=e.mapProjection;A.equals(this.transform,A.IDENTITY)||(u=A.clone(this.transform,M),h=r.magnitude(this.position),this._setTransform(A.IDENTITY));var p=R;s===x.SCENE3D?c.cartesianToCartographic(this.position,p):g.unproject(this.position,p);var f=!1;if(p.height<o){var d=l.getHeight(p);a(d)&&(d+=n,p.height<d&&(p.height=d,s===x.SCENE3D?c.cartographicToCartesian(p,this.position):g.project(p,this.position),f=!0))}a(u)&&(this._setTransform(u),f&&(r.normalize(this.position,this.position),r.negate(this.position,this.direction),r.multiplyByScalar(this.position,Math.max(h,n),this.position),r.normalize(this.direction,this.direction),r.cross(this.direction,this.up,this.right),r.cross(this.right,this.direction,this.up)))}}};var O=new n,F=new r,D=new r,k=new o,U=new o,B=new o,W=new o,V=new o,j=new r;function H(e){var t=e._mode,i=!1,n=0;t===x.SCENE2D&&(i=(n=e.frustum.right-e.frustum.left)!==e._positionCartographic.height);var s=e._position,a=!r.equals(s,e.position)||i;a&&(s=r.clone(e.position,e._position));var l=e._direction,u=!r.equals(l,e.direction);u&&(r.normalize(e.direction,e.direction),l=r.clone(e.direction,e._direction));var h=e._up,c=!r.equals(h,e.up);c&&(r.normalize(e.up,e.up),h=r.clone(e.up,e._up));var g=e._right,p=!r.equals(g,e.right);p&&(r.normalize(e.right,e.right),g=r.clone(e.right,e._right));var f,d=e._transformChanged||e._modeChanged;e._transformChanged=!1,d&&(A.inverseTransformation(e._transform,e._invTransform),e._mode===x.COLUMBUS_VIEW||e._mode===x.SCENE2D?A.equals(A.IDENTITY,e._transform)?A.clone(N.TRANSFORM_2D,e._actualTransform):e._mode===x.COLUMBUS_VIEW?(f=e,S.basisTo2D(f._projection,f._transform,f._actualTransform)):function(e){var t=e._projection,i=t.ellipsoid,n=A.getColumn(e._transform,3,k),s=i.cartesianToCartographic(n,O),a=t.project(s,F),l=U;l.x=a.z,l.y=a.x,l.z=a.y,l.w=1;var u=o.clone(o.UNIT_X,V),h=o.add(A.getColumn(e._transform,0,D),n,D);i.cartesianToCartographic(h,s),t.project(s,a);var c=B;c.x=a.z,c.y=a.x,c.z=a.y,c.w=0,r.subtract(c,l,c),c.x=0;var g=W;if(r.magnitudeSquared(c)>y.EPSILON10)r.cross(u,c,g);else{var p=o.add(A.getColumn(e._transform,1,D),n,D);i.cartesianToCartographic(p,s),t.project(s,a),g.x=a.z,g.y=a.x,g.z=a.y,g.w=0,r.subtract(g,l,g),g.x=0,r.magnitudeSquared(g)<y.EPSILON10&&(o.clone(o.UNIT_Y,c),o.clone(o.UNIT_Z,g))}r.cross(g,u,c),r.normalize(c,c),r.cross(u,c,g),r.normalize(g,g),A.setColumn(e._actualTransform,0,c,e._actualTransform),A.setColumn(e._actualTransform,1,g,e._actualTransform),A.setColumn(e._actualTransform,2,u,e._actualTransform),A.setColumn(e._actualTransform,3,l,e._actualTransform)}(e):A.clone(e._transform,e._actualTransform),A.inverseTransformation(e._actualTransform,e._actualInvTransform),e._modeChanged=!1);var m=e._actualTransform;if(a||d)if(e._positionWC=A.multiplyByPoint(m,s,e._positionWC),t===x.SCENE3D||t===x.MORPHING)e._positionCartographic=e._projection.ellipsoid.cartesianToCartographic(e._positionWC,e._positionCartographic);else{var C=j;C.x=e._positionWC.y,C.y=e._positionWC.z,C.z=e._positionWC.x,t===x.SCENE2D&&(C.z=n),e._projection.unproject(C,e._positionCartographic)}if(u||c||p){var v=r.dot(l,r.cross(h,g,j));if(Math.abs(1-v)>y.EPSILON2){var _=1/r.magnitudeSquared(h),I=r.dot(h,l)*_,b=r.multiplyByScalar(l,I,j);h=r.normalize(r.subtract(h,b,e._up),e._up),r.clone(h,e.up),g=r.cross(l,h,e._right),r.clone(g,e.right)}}(u||d)&&(e._directionWC=A.multiplyByPointAsVector(m,l,e._directionWC),r.normalize(e._directionWC,e._directionWC)),(c||d)&&(e._upWC=A.multiplyByPointAsVector(m,h,e._upWC),r.normalize(e._upWC,e._upWC)),(p||d)&&(e._rightWC=A.multiplyByPointAsVector(m,g,e._rightWC),r.normalize(e._rightWC,e._rightWC)),(a||u||c||p||d)&&L(e)}function z(e,t){var i;return i=y.equalsEpsilon(Math.abs(e.z),1,y.EPSILON3)?Math.atan2(t.y,t.x)-y.PI_OVER_TWO:Math.atan2(e.y,e.x)-y.PI_OVER_TWO,y.TWO_PI-y.zeroToTwoPi(i)}function q(e){return y.PI_OVER_TWO-y.acosClamped(e.z)}function X(e,t,i){var r=0;return y.equalsEpsilon(Math.abs(e.z),1,y.EPSILON3)||(r=Math.atan2(-i.z,t.z),r=y.zeroToTwoPi(r+y.TWO_PI)),r}var Y=new A,K=new A;l(N.prototype,{transform:{get:function(){return this._transform}},inverseTransform:{get:function(){return H(this),this._invTransform}},viewMatrix:{get:function(){return H(this),this._viewMatrix}},inverseViewMatrix:{get:function(){return H(this),this._invViewMatrix}},positionCartographic:{get:function(){return H(this),this._positionCartographic}},positionWC:{get:function(){return H(this),this._positionWC}},directionWC:{get:function(){return H(this),this._directionWC}},upWC:{get:function(){return H(this),this._upWC}},rightWC:{get:function(){return H(this),this._rightWC}},heading:{get:function(){if(this._mode!==x.MORPHING){var e=this._projection.ellipsoid,t=A.clone(this._transform,Y),i=S.eastNorthUpToFixedFrame(this.positionWC,e,K);this._setTransform(i);var r=z(this.direction,this.up);return this._setTransform(t),r}}},pitch:{get:function(){if(this._mode!==x.MORPHING){var e=this._projection.ellipsoid,t=A.clone(this._transform,Y),i=S.eastNorthUpToFixedFrame(this.positionWC,e,K);this._setTransform(i);var r=q(this.direction);return this._setTransform(t),r}}},roll:{get:function(){if(this._mode!==x.MORPHING){var e=this._projection.ellipsoid,t=A.clone(this._transform,Y),i=S.eastNorthUpToFixedFrame(this.positionWC,e,K);this._setTransform(i);var r=X(this.direction,this.up,this.right);return this._setTransform(t),r}}},moveStart:{get:function(){return this._moveStart}},moveEnd:{get:function(){return this._moveEnd}},changed:{get:function(){return this._changed}}}),N.prototype.update=function(e){if(!a(e))throw new u("mode is required.");if(e===x.SCENE2D&&!(this.frustum instanceof I))throw new u("An OrthographicOffCenterFrustum is required in 2D.");if(!(e!==x.SCENE3D&&e!==x.COLUMBUS_VIEW||this.frustum instanceof b||this.frustum instanceof _))throw new u("A PerspectiveFrustum or OrthographicFrustum is required in 3D and Columbus view");var t=!1;if(e!==this._mode&&(this._mode=e,this._modeChanged=e!==x.MORPHING,t=this._mode===x.SCENE2D),t){var i=this._max2Dfrustum=this.frustum.clone();if(!(i instanceof I))throw new u("The camera frustum is expected to be orthographic for 2D camera control.");var r=i.top/i.right;i.right=2*this._maxCoord.x,i.left=-i.right,i.top=r*i.right,i.bottom=-i.top}this._mode===x.SCENE2D&&me(this,this.position);var o=this._scene.globe,n=!a(o)||o._surface.tileProvider.ready&&0===o._surface._tileLoadQueueHigh.length&&0===o._surface._tileLoadQueueMedium.length&&0===o._surface._tileLoadQueueLow.length&&0===o._surface._debug.tilesWaitingForChildren;this._suspendTerrainAdjustment&&(this._suspendTerrainAdjustment=!n),this._adjustHeightForTerrain()};var Q=new r,Z=new r,J=new r;N.prototype._setTransform=function(e){var t=r.clone(this.positionWC,Q),i=r.clone(this.upWC,Z),o=r.clone(this.directionWC,J);A.clone(e,this._transform),this._transformChanged=!0,H(this);var n=this._actualInvTransform;A.multiplyByPoint(n,t,this.position),A.multiplyByPointAsVector(n,o,this.direction),A.multiplyByPointAsVector(n,i,this.up),r.cross(this.direction,this.up,this.right),H(this)};var $=new i,ee=new G,te=new r,ie=new r;N.prototype._adjustOrthographicFrustum=function(e){if(this.frustum instanceof _&&(e||!(this._positionCartographic.height<15e4)))if(A.equals(A.IDENTITY,this.transform)){var t,i,o=this._scene,n=o._globe;if(a(n)){var s=$;s.x=o.drawingBufferWidth/2,s.y=o.drawingBufferHeight/2;var l=this.getPickRay(s,ee);if(t=n.pick(l,o,te),o.pickPositionSupported&&(i=o.pickPositionWorldCoordinates(s,ie)),a(t)&&a(i)){var u=a(i)?r.distance(i,this.positionWC):Number.POSITIVE_INFINITY,h=a(t)?r.distance(t,this.positionWC):Number.POSITIVE_INFINITY;this.frustum.width=Math.min(u,h)}else a(i)?this.frustum.width=r.distance(i,this.positionWC):a(t)&&(this.frustum.width=r.distance(t,this.positionWC))}if(!a(n)||!a(t)&&!a(i)){var c=Math.max(this.positionCartographic.height,0);this.frustum.width=c}}else this.frustum.width=r.magnitude(this.position)};var re=new r,oe=new A,ne=new A,se=new w,ae=new v,le=new n,ue=new r,he=new r,ce=new r;function ge(e,t,i,o){var n=r.clone(i.direction,ue),s=r.clone(i.up,he);if(e._scene.mode===x.SCENE3D){var a=e._projection.ellipsoid,l=S.eastNorthUpToFixedFrame(t,a,Y),u=A.inverseTransformation(l,K);A.multiplyByPointAsVector(u,n,n),A.multiplyByPointAsVector(u,s,s)}var h=r.cross(n,s,ce);return o.heading=z(n,s),o.pitch=q(n),o.roll=X(n,s,h),o}var pe={destination:void 0,orientation:{direction:void 0,up:void 0,heading:void 0,pitch:void 0,roll:void 0},convert:void 0,endTransform:void 0},fe=new d;N.prototype.setView=function(e){e=s(e,s.EMPTY_OBJECT);var t=s(e.orientation,s.EMPTY_OBJECT),o=this._mode;if(o!==x.MORPHING){a(e.endTransform)&&this._setTransform(e.endTransform);var n=s(e.convert,!0),l=s(e.destination,r.clone(this.positionWC,re));a(l)&&a(l.west)&&(l=this.getRectangleCameraCoordinates(l,re),n=!1),a(t.direction)&&(t=ge(this,l,t,pe.orientation)),fe.heading=s(t.heading,0),fe.pitch=s(t.pitch,-y.PI_OVER_TWO),fe.roll=s(t.roll,0),this._suspendTerrainAdjustment=!1,o===x.SCENE3D?function(e,t,i){var o=A.clone(e.transform,oe),n=S.eastNorthUpToFixedFrame(t,e._projection.ellipsoid,ne);e._setTransform(n),r.clone(r.ZERO,e.position),i.heading=i.heading-y.PI_OVER_TWO;var s=w.fromHeadingPitchRoll(i,se),a=v.fromQuaternion(s,ae);v.getColumn(a,0,e.direction),v.getColumn(a,2,e.up),r.cross(e.direction,e.up,e.right),e._setTransform(o),e._adjustOrthographicFrustum(!0)}(this,l,fe):o===x.SCENE2D?function(e,t,o,n){var s=A.clone(e.transform,oe);if(e._setTransform(A.IDENTITY),!r.equals(t,e.positionWC)){if(n){var a=e._projection,l=a.ellipsoid.cartesianToCartographic(t,le);t=a.project(l,re)}i.clone(t,e.position);var u=.5*-t.z,h=-u,c=e.frustum;if(h>u){var g=c.top/c.right;c.right=h,c.left=u,c.top=c.right*g,c.bottom=-c.top}}if(e._scene.mapMode2D===T.ROTATE){o.heading=o.heading-y.PI_OVER_TWO,o.pitch=-y.PI_OVER_TWO,o.roll=0;var p=w.fromHeadingPitchRoll(o,se),f=v.fromQuaternion(p,ae);v.getColumn(f,2,e.up),r.cross(e.direction,e.up,e.right)}e._setTransform(s)}(this,l,fe,n):function(e,t,i,o){var n=A.clone(e.transform,oe);if(e._setTransform(A.IDENTITY),!r.equals(t,e.positionWC)){if(o){var s=e._projection,a=s.ellipsoid.cartesianToCartographic(t,le);t=s.project(a,re)}r.clone(t,e.position)}i.heading=i.heading-y.PI_OVER_TWO;var l=w.fromHeadingPitchRoll(i,se),u=v.fromQuaternion(l,ae);v.getColumn(u,0,e.direction),v.getColumn(u,2,e.up),r.cross(e.direction,e.up,e.right),e._setTransform(n),e._adjustOrthographicFrustum(!0)}(this,l,fe,n)}};var de=new r;function me(e,t){var i,r,o=e._scene.mapMode2D===T.ROTATE,n=e._maxCoord.x,s=e._maxCoord.y;o?i=-(r=n):(r=t.x-2*n,i=t.x+2*n),t.x>n&&(t.x=r),t.x<-n&&(t.x=i),t.y>s&&(t.y=s),t.y<-s&&(t.y=-s)}N.prototype.flyHome=function(e){var t=this._mode;if(t===x.MORPHING&&this._scene.completeMorph(),t===x.SCENE2D)this.flyTo({destination:N.DEFAULT_VIEW_RECTANGLE,duration:e,endTransform:A.IDENTITY});else if(t===x.SCENE3D){var i=this.getRectangleCameraCoordinates(N.DEFAULT_VIEW_RECTANGLE),o=r.magnitude(i);o+=o*N.DEFAULT_VIEW_FACTOR,r.normalize(i,i),r.multiplyByScalar(i,o,i),this.flyTo({destination:i,duration:e,endTransform:A.IDENTITY})}else if(t===x.COLUMBUS_VIEW){var n=this._projection.ellipsoid.maximumRadius,s=new r(0,-1,1);s=r.multiplyByScalar(r.normalize(s,s),5*n,s),this.flyTo({destination:s,duration:e,orientation:{heading:0,pitch:-Math.acos(r.normalize(s,de).z),roll:0},endTransform:A.IDENTITY,convert:!1})}},N.prototype.worldToCameraCoordinates=function(e,t){if(!a(e))throw new u("cartesian is required.");return a(t)||(t=new o),H(this),A.multiplyByVector(this._actualInvTransform,e,t)},N.prototype.worldToCameraCoordinatesPoint=function(e,t){if(!a(e))throw new u("cartesian is required.");return a(t)||(t=new r),H(this),A.multiplyByPoint(this._actualInvTransform,e,t)},N.prototype.worldToCameraCoordinatesVector=function(e,t){if(!a(e))throw new u("cartesian is required.");return a(t)||(t=new r),H(this),A.multiplyByPointAsVector(this._actualInvTransform,e,t)},N.prototype.cameraToWorldCoordinates=function(e,t){if(!a(e))throw new u("cartesian is required.");return a(t)||(t=new o),H(this),A.multiplyByVector(this._actualTransform,e,t)},N.prototype.cameraToWorldCoordinatesPoint=function(e,t){if(!a(e))throw new u("cartesian is required.");return a(t)||(t=new r),H(this),A.multiplyByPoint(this._actualTransform,e,t)},N.prototype.cameraToWorldCoordinatesVector=function(e,t){if(!a(e))throw new u("cartesian is required.");return a(t)||(t=new r),H(this),A.multiplyByPointAsVector(this._actualTransform,e,t)};var Ce=new r;N.prototype.move=function(e,t){if(!a(e))throw new u("direction is required.");var i=this.position;r.multiplyByScalar(e,t,Ce),r.add(i,Ce,i),this._mode===x.SCENE2D&&me(this,i),this._adjustOrthographicFrustum(!0)},N.prototype.moveForward=function(e){e=s(e,this.defaultMoveAmount),this.move(this.direction,e)},N.prototype.moveBackward=function(e){e=s(e,this.defaultMoveAmount),this.move(this.direction,-e)},N.prototype.moveUp=function(e){e=s(e,this.defaultMoveAmount),this.move(this.up,e)},N.prototype.moveDown=function(e){e=s(e,this.defaultMoveAmount),this.move(this.up,-e)},N.prototype.moveRight=function(e){e=s(e,this.defaultMoveAmount),this.move(this.right,e)},N.prototype.moveLeft=function(e){e=s(e,this.defaultMoveAmount),this.move(this.right,-e)},N.prototype.lookLeft=function(e){e=s(e,this.defaultLookAmount),this.look(this.up,-e)},N.prototype.lookRight=function(e){e=s(e,this.defaultLookAmount),this.look(this.up,e)},N.prototype.lookUp=function(e){e=s(e,this.defaultLookAmount),this.look(this.right,-e)},N.prototype.lookDown=function(e){e=s(e,this.defaultLookAmount),this.look(this.right,e)};var ye=new w,ve=new v;N.prototype.look=function(e,t){if(!a(e))throw new u("axis is required.");var i=s(t,this.defaultLookAmount),r=w.fromAxisAngle(e,-i,ye),o=v.fromQuaternion(r,ve),n=this.direction,l=this.up,h=this.right;v.multiplyByVector(o,n,n),v.multiplyByVector(o,l,l),v.multiplyByVector(o,h,h)},N.prototype.twistLeft=function(e){e=s(e,this.defaultLookAmount),this.look(this.direction,e)},N.prototype.twistRight=function(e){e=s(e,this.defaultLookAmount),this.look(this.direction,-e)};var Ae=new w,_e=new v;N.prototype.rotate=function(e,t){if(!a(e))throw new u("axis is required.");var i=s(t,this.defaultRotateAmount),o=w.fromAxisAngle(e,-i,Ae),n=v.fromQuaternion(o,_e);v.multiplyByVector(n,this.position,this.position),v.multiplyByVector(n,this.direction,this.direction),v.multiplyByVector(n,this.up,this.up),r.cross(this.direction,this.up,this.right),r.cross(this.right,this.direction,this.up),this._adjustOrthographicFrustum(!1)},N.prototype.rotateDown=function(e){Ee(this,e=s(e,this.defaultRotateAmount))},N.prototype.rotateUp=function(e){Ee(this,-(e=s(e,this.defaultRotateAmount)))};var Ie=new r,be=new r,we=new r,Ge=new r;function Ee(e,t){var i=e.position,o=r.normalize(i,Ie);if(a(e.constrainedAxis)){var n=r.equalsEpsilon(o,e.constrainedAxis,y.EPSILON2),s=r.equalsEpsilon(o,r.negate(e.constrainedAxis,Ge),y.EPSILON2);if(n||s)(n&&t<0||s&&t>0)&&e.rotate(e.right,t);else{var l=r.normalize(e.constrainedAxis,be),u=r.dot(o,l),h=y.acosClamped(u);t>0&&t>h&&(t=h-y.EPSILON4),u=r.dot(o,r.negate(l,Ge)),h=y.acosClamped(u),t<0&&-t>h&&(t=-h+y.EPSILON4);var c=r.cross(l,o,we);e.rotate(c,t)}}else e.rotate(e.right,t)}function Se(e,t){a(e.constrainedAxis)?e.rotate(e.constrainedAxis,t):e.rotate(e.up,t)}function Pe(e,t){var i,r=e.frustum;if(!(r instanceof I&&a(r.left)&&a(r.right)&&a(r.bottom)&&a(r.top)))throw new u("The camera frustum is expected to be orthographic for 2D camera control.");if(t*=.5,Math.abs(r.top)+Math.abs(r.bottom)>Math.abs(r.left)+Math.abs(r.right)){var o=r.top-t,n=r.bottom+t,s=e._maxCoord.y;e._scene.mapMode2D===T.ROTATE&&(s*=e.maximumZoomFactor),n>s&&(n=s,o=-s),o<=n&&(o=1,n=-1),i=r.right/r.top,r.top=o,r.bottom=n,r.right=r.top*i,r.left=-r.right}else{var l=r.right-t,h=r.left+t,c=e._maxCoord.x;e._scene.mapMode2D===T.ROTATE&&(c*=e.maximumZoomFactor),l>c&&(l=c,h=-c),l<=h&&(l=1,h=-1),i=r.top/r.right,r.right=l,r.left=h,r.top=r.right*i,r.bottom=-r.top}}function Te(e,t){e.move(e.direction,t)}N.prototype.rotateRight=function(e){Se(this,-(e=s(e,this.defaultRotateAmount)))},N.prototype.rotateLeft=function(e){Se(this,e=s(e,this.defaultRotateAmount))},N.prototype.zoomIn=function(e){e=s(e,this.defaultZoomAmount),this._mode===x.SCENE2D?Pe(this,e):Te(this,e)},N.prototype.zoomOut=function(e){e=s(e,this.defaultZoomAmount),this._mode===x.SCENE2D?Pe(this,-e):Te(this,-e)},N.prototype.getMagnitude=function(){return this._mode===x.SCENE3D?r.magnitude(this.position):this._mode===x.COLUMBUS_VIEW?Math.abs(this.position.z):this._mode===x.SCENE2D?Math.max(this.frustum.right-this.frustum.left,this.frustum.top-this.frustum.bottom):void 0};var xe=new A;N.prototype.lookAt=function(e,t){if(!a(e))throw new u("target is required");if(!a(t))throw new u("offset is required");if(this._mode===x.MORPHING)throw new u("lookAt is not supported while morphing.");var i=S.eastNorthUpToFixedFrame(e,c.WGS84,xe);this.lookAtTransform(i,t)};var Ne=new r,Le=new w,Me=new w,Re=new v;function Oe(e,t,i){t=y.clamp(t,-y.PI_OVER_TWO,y.PI_OVER_TWO),e=y.zeroToTwoPi(e)-y.PI_OVER_TWO;var o=w.fromAxisAngle(r.UNIT_Y,-t,Le),n=w.fromAxisAngle(r.UNIT_Z,-e,Me),s=w.multiply(n,o,n),a=v.fromQuaternion(s,Re),l=r.clone(r.UNIT_X,Ne);return v.multiplyByVector(a,l,l),r.negate(l,l),r.multiplyByScalar(l,i,l),l}N.prototype.lookAtTransform=function(e,t){if(!a(e))throw new u("transform is required");if(this._mode===x.MORPHING)throw new u("lookAtTransform is not supported while morphing.");if(this._setTransform(e),a(t)){var o;if(o=a(t.heading)?Oe(t.heading,t.pitch,t.range):t,this._mode===x.SCENE2D){i.clone(i.ZERO,this.position),r.negate(o,this.up),this.up.z=0,r.magnitudeSquared(this.up)<y.EPSILON10&&r.clone(r.UNIT_Y,this.up),r.normalize(this.up,this.up),this._setTransform(A.IDENTITY),r.negate(r.UNIT_Z,this.direction),r.cross(this.direction,this.up,this.right),r.normalize(this.right,this.right);var n=this.frustum,s=n.top/n.right;return n.right=.5*r.magnitude(o),n.left=-n.right,n.top=s*n.right,n.bottom=-n.top,void this._setTransform(e)}r.clone(o,this.position),r.negate(this.position,this.direction),r.normalize(this.direction,this.direction),r.cross(this.direction,r.UNIT_Z,this.right),r.magnitudeSquared(this.right)<y.EPSILON10&&r.clone(r.UNIT_X,this.right),r.normalize(this.right,this.right),r.cross(this.right,this.direction,this.up),r.normalize(this.up,this.up),this._adjustOrthographicFrustum(!0)}};var Fe,De=new n,ke=new n,Ue=new r,Be=new r,We=new r,Ve=new r,je=new r,He=new r,ze=new r,qe=new r,Xe={direction:new r,right:new r,up:new r};function Ye(e,t,i,o){return Math.abs(r.dot(t,i))/o-r.dot(e,i)}function Ke(e,t,i,o){var n=e._projection.ellipsoid,s=o?e:Xe,l=t.north,u=t.south,h=t.east,c=t.west;c>h&&(h+=y.TWO_PI);var p,f=.5*(c+h);if(u<-y.PI_OVER_TWO+y.RADIANS_PER_DEGREE&&l>y.PI_OVER_TWO-y.RADIANS_PER_DEGREE)p=0;else{var d=De;d.longitude=f,d.latitude=l,d.height=0;var m=ke;m.longitude=f,m.latitude=u,m.height=0;var C=Fe;a(C)&&C.ellipsoid===n||(Fe=C=new g(void 0,void 0,n)),C.setEndPoints(d,m),p=C.interpolateUsingFraction(.5,De).latitude}var v=De;v.longitude=f,v.latitude=p,v.height=0;var A=n.cartographicToCartesian(v,ze),I=De;I.longitude=h,I.latitude=l;var b=n.cartographicToCartesian(I,Ue);I.longitude=c;var w=n.cartographicToCartesian(I,We);I.longitude=f;var G=n.cartographicToCartesian(I,je);I.latitude=u;var E=n.cartographicToCartesian(I,He);I.longitude=h;var S=n.cartographicToCartesian(I,Ve);I.longitude=c;var P=n.cartographicToCartesian(I,Be);r.subtract(w,A,w),r.subtract(S,A,S),r.subtract(b,A,b),r.subtract(P,A,P),r.subtract(G,A,G),r.subtract(E,A,E);var T=n.geodeticSurfaceNormal(A,s.direction);r.negate(T,T);var x=r.cross(T,r.UNIT_Z,s.right);r.normalize(x,x);var N,L=r.cross(x,T,s.up);if(e.frustum instanceof _){var M,R,O=Math.max(r.distance(b,w),r.distance(S,P)),F=Math.max(r.distance(b,S),r.distance(w,P)),D=e.frustum._offCenterFrustum.right/e.frustum._offCenterFrustum.top,k=F*D;O>k?R=(M=O)/D:(R=F,M=k),N=Math.max(M,R)}else{var U=Math.tan(.5*e.frustum.fovy),B=e.frustum.aspectRatio*U;if(N=Math.max(Ye(T,L,w,U),Ye(T,L,S,U),Ye(T,L,b,U),Ye(T,L,P,U),Ye(T,L,G,U),Ye(T,L,E,U),Ye(T,x,w,B),Ye(T,x,S,B),Ye(T,x,b,B),Ye(T,x,P,B),Ye(T,x,G,B),Ye(T,x,E,B)),u<0&&l>0){var W=De;W.longitude=c,W.latitude=0,W.height=0;var V=n.cartographicToCartesian(W,qe);r.subtract(V,A,V),N=Math.max(N,Ye(T,L,V,U),Ye(T,x,V,B)),W.longitude=h,V=n.cartographicToCartesian(W,qe),r.subtract(V,A,V),N=Math.max(N,Ye(T,L,V,U),Ye(T,x,V,B))}}return r.add(A,r.multiplyByScalar(T,-N,qe),i)}var Qe=new n,Ze=new r,Je=new r,$e=new n,et=new r,tt=new r;N.prototype.getRectangleCameraCoordinates=function(e,t){if(!a(e))throw new u("rectangle is required");var i=this._mode;return a(t)||(t=new r),i===x.SCENE3D?Ke(this,e,t):i===x.COLUMBUS_VIEW?function(e,t,i){var r=e._projection;t.west>t.east&&(t=E.MAX_VALUE);var o=e._actualTransform,n=e._actualInvTransform,s=Qe;s.longitude=t.east,s.latitude=t.north;var l=r.project(s,Ze);A.multiplyByPoint(o,l,l),A.multiplyByPoint(n,l,l),s.longitude=t.west,s.latitude=t.south;var u=r.project(s,Je);if(A.multiplyByPoint(o,u,u),A.multiplyByPoint(n,u,u),i.x=.5*(l.x-u.x)+u.x,i.y=.5*(l.y-u.y)+u.y,a(e.frustum.fovy)){var h=Math.tan(.5*e.frustum.fovy),c=e.frustum.aspectRatio*h;i.z=.5*Math.max((l.x-u.x)/c,(l.y-u.y)/h)}else{var g=l.x-u.x,p=l.y-u.y;i.z=Math.max(g,p)}return i}(this,e,t):i===x.SCENE2D?function(e,t,i){var r=e._projection;t.west>t.east&&(t=E.MAX_VALUE);var o=$e;o.longitude=t.east,o.latitude=t.north;var n=r.project(o,et);o.longitude=t.west,o.latitude=t.south;var s,a,l=r.project(o,tt),u=.5*Math.abs(n.x-l.x),h=.5*Math.abs(n.y-l.y),c=e.frustum.right/e.frustum.top,g=h*c;return u>g?a=(s=u)/c:(a=h,s=g),h=Math.max(2*s,2*a),i.x=.5*(n.x-l.x)+l.x,i.y=.5*(n.y-l.y)+l.y,(o=r.unproject(i,o)).height=h,r.project(o,i)}(this,e,t):void 0};var it=new G,rt=new G,ot=new G;N.prototype.pickEllipsoid=function(e,t,i){if(!a(e))throw new u("windowPosition is required.");var o=this._scene.canvas;if(0!==o.clientWidth&&0!==o.clientHeight){if(a(i)||(i=new r),t=s(t,c.WGS84),this._mode===x.SCENE3D)i=function(e,t,i,r){i=s(i,c.WGS84);var o=e.getPickRay(t,it),n=C.rayEllipsoid(o,i);if(n){var a=n.start>0?n.start:n.stop;return G.getPoint(o,a,r)}}(this,e,t,i);else if(this._mode===x.SCENE2D)i=function(e,t,i,r){var o=e.getPickRay(t,rt).origin;o.z=0;var n=i.unproject(o);if(!(n.latitude<-y.PI_OVER_TWO||n.latitude>y.PI_OVER_TWO))return i.ellipsoid.cartographicToCartesian(n,r)}(this,e,this._projection,i);else{if(this._mode!==x.COLUMBUS_VIEW)return;i=function(e,t,i,o){var n=e.getPickRay(t,ot),s=-n.origin.x/n.direction.x;G.getPoint(n,s,o);var a=i.unproject(new r(o.y,o.z,0));if(!(a.latitude<-y.PI_OVER_TWO||a.latitude>y.PI_OVER_TWO||a.longitude<-Math.PI||a.longitude>Math.PI))return i.ellipsoid.cartographicToCartesian(a,o)}(this,e,this._projection,i)}return i}};var nt=new r,st=new r,at=new r,lt=new r;N.prototype.getPickRay=function(e,t){if(!a(e))throw new u("windowPosition is required.");a(t)||(t=new G);var i=this.frustum;return a(i.aspectRatio)&&a(i.fov)&&a(i.near)?function(e,t,i){var o=e._scene.canvas,n=o.clientWidth,s=o.clientHeight,a=Math.tan(.5*e.frustum.fovy),l=e.frustum.aspectRatio*a,u=e.frustum.near,h=2/n*t.x-1,c=2/s*(s-t.y)-1,g=e.positionWC;r.clone(g,i.origin);var p=r.multiplyByScalar(e.directionWC,u,nt);r.add(g,p,p);var f=r.multiplyByScalar(e.rightWC,h*u*l,st),d=r.multiplyByScalar(e.upWC,c*u*a,at),m=r.add(p,f,i.direction);return r.add(m,d,m),r.subtract(m,g,m),r.normalize(m,m),i}(this,e,t):function(e,t,i){var o=e._scene.canvas,n=o.clientWidth,s=o.clientHeight,l=e.frustum;a(l._offCenterFrustum)&&(l=l._offCenterFrustum);var u=2/n*t.x-1;u*=.5*(l.right-l.left);var h=2/s*(s-t.y)-1;h*=.5*(l.top-l.bottom);var c=i.origin;return r.clone(e.position,c),r.multiplyByScalar(e.right,u,lt),r.add(lt,c,c),r.multiplyByScalar(e.up,h,lt),r.add(lt,c,c),r.clone(e.directionWC,i.direction),e._mode===x.COLUMBUS_VIEW&&r.fromElements(i.origin.z,i.origin.x,i.origin.y,i.origin),i}(this,e,t)};var ut=new r,ht=new r;N.prototype.distanceToBoundingSphere=function(e){if(!a(e))throw new u("boundingSphere is required.");var t=r.subtract(this.positionWC,e.center,ut),i=r.multiplyByScalar(this.directionWC,r.dot(t,this.directionWC),ht);return Math.max(0,r.magnitude(i)-e.radius)};var ct=new i;N.prototype.getPixelSize=function(e,t,i){if(!a(e))throw new u("boundingSphere is required.");if(!a(t))throw new u("drawingBufferWidth is required.");if(!a(i))throw new u("drawingBufferHeight is required.");var r=this.distanceToBoundingSphere(e),o=this.frustum.getPixelDimensions(t,i,r,ct);return Math.max(o.x,o.y)};var gt=new r,pt=new r,ft=new r,dt=new r;N.prototype.createCorrectPositionTween=function(e){if(!a(e))throw new u("duration is required.");if(this._mode===x.COLUMBUS_VIEW)return function(e,t){var i=e.position,o=e.direction,n=e.worldToCameraCoordinatesVector(r.UNIT_X,gt),s=-r.dot(n,i)/r.dot(n,o),a=r.add(i,r.multiplyByScalar(o,s,pt),pt);e.cameraToWorldCoordinatesPoint(a,a),i=e.cameraToWorldCoordinatesPoint(e.position,ft);var l,u,c,g,p,f,d,m=Math.tan(.5*e.frustum.fovy),C=e.frustum.aspectRatio*m,y=r.magnitude(r.subtract(i,a,dt)),v=C*y,A=m*y,_=e._maxCoord.x,I=e._maxCoord.y,b=Math.max(v-_,_),w=Math.max(A-I,I);if(i.z<-b||i.z>b||i.y<-w||i.y>w){var G=a.y<-b||a.y>b,E=a.z<-w||a.z>w;if(G||E)return l=e,u=i,c=a,g=b,p=w,f=t,d=r.clone(u),c.y>g?d.y-=c.y-g:c.y<-g&&(d.y+=-g-c.y),c.z>p?d.z-=c.z-p:c.z<-p&&(d.z+=-p-c.z),{easingFunction:h.EXPONENTIAL_OUT,startObject:{time:0},stopObject:{time:1},duration:f,update:function(e){var t=r.lerp(u,d,e.time,new r);l.worldToCameraCoordinatesPoint(t,l.position)}}}}(this,e)};var mt=new r,Ct={destination:void 0,heading:void 0,pitch:void 0,roll:void 0,duration:void 0,complete:void 0,cancel:void 0,endTransform:void 0,maximumHeight:void 0,easingFunction:void 0};N.prototype.cancelFlight=function(){a(this._currentFlight)&&(this._currentFlight.cancelTween(),this._currentFlight=void 0)},N.prototype.flyTo=function(e){var t=(e=s(e,s.EMPTY_OBJECT)).destination;if(!a(t))throw new u("destination is required.");if(this._mode!==x.MORPHING){this.cancelFlight();var i=s(e.orientation,s.EMPTY_OBJECT);if(a(i.direction)&&(i=ge(this,t,i,pe.orientation)),a(e.duration)&&e.duration<=0){var r=pe;return r.destination=e.destination,r.orientation.heading=i.heading,r.orientation.pitch=i.pitch,r.orientation.roll=i.roll,r.convert=e.convert,r.endTransform=e.endTransform,this.setView(r),void("function"==typeof e.complete&&e.complete())}var o=a(t.west);o&&(t=this.getRectangleCameraCoordinates(t,mt));var n,l=this;Ct.destination=t,Ct.heading=i.heading,Ct.pitch=i.pitch,Ct.roll=i.roll,Ct.duration=e.duration,Ct.complete=function(){n===l._currentFlight&&(l._currentFlight=void 0),a(e.complete)&&e.complete()},Ct.cancel=e.cancel,Ct.endTransform=e.endTransform,Ct.convert=!o&&e.convert,Ct.maximumHeight=e.maximumHeight,Ct.pitchAdjustHeight=e.pitchAdjustHeight,Ct.flyOverLongitude=e.flyOverLongitude,Ct.flyOverLongitudeWeight=e.flyOverLongitudeWeight,Ct.easingFunction=e.easingFunction;var h=this._scene;n=h.tweens.add(P.createTween(h,Ct)),this._currentFlight=n}};function yt(e,t,i){a(i)||(i=f.clone(N.DEFAULT_OFFSET));var r,o,n,s,l=e._scene.screenSpaceCameraController.minimumZoomDistance,u=e._scene.screenSpaceCameraController.maximumZoomDistance,h=i.range;if(!a(h)||0===h){var c=t.radius;0===c?i.range=100:e.frustum instanceof _||e._mode===x.SCENE2D?i.range=function(e,t){var i,r,o=e.frustum;a(o._offCenterFrustum)&&(o=o._offCenterFrustum);var n=o.right/o.top,s=t*n;return t>s?r=(i=t)/n:(r=t,i=s),1.5*Math.max(i,r)}(e,c):i.range=(r=c,o=e.frustum,n=Math.tan(.5*o.fovy),s=o.aspectRatio*n,Math.max(r/s,r/n)),i.range=y.clamp(i.range,l,u)}return i}N.prototype.viewBoundingSphere=function(e,t){if(!a(e))throw new u("boundingSphere is required.");if(this._mode===x.MORPHING)throw new u("viewBoundingSphere is not supported while morphing.");t=yt(this,e,t),this.lookAt(e.center,t)};var vt=new A,At=new r,_t=new r,It=new r,bt=new r,wt=new o,Gt=new w,Et=new v;N.prototype.flyToBoundingSphere=function(e,t){if(!a(e))throw new u("boundingSphere is required.");t=s(t,s.EMPTY_OBJECT);var i=this._mode===x.SCENE2D||this._mode===x.COLUMBUS_VIEW;this._setTransform(A.IDENTITY);var o,n=yt(this,e,t.offset);o=i?r.multiplyByScalar(r.UNIT_Z,n.range,At):Oe(n.heading,n.pitch,n.range);var l,h,g=S.eastNorthUpToFixedFrame(e.center,c.WGS84,vt);if(A.multiplyByPoint(g,o,o),!i){if(l=r.subtract(e.center,o,_t),r.normalize(l,l),h=A.multiplyByPointAsVector(g,r.UNIT_Z,It),1-Math.abs(r.dot(l,h))<y.EPSILON6){var p=w.fromAxisAngle(l,n.heading,Gt),f=v.fromQuaternion(p,Et);r.fromCartesian4(A.getColumn(g,1,wt),h),v.multiplyByVector(f,h,h)}var d=r.cross(l,h,bt);r.cross(d,l,h),r.normalize(h,h)}this.flyTo({destination:o,orientation:{direction:l,up:h},duration:t.duration,complete:t.complete,cancel:t.cancel,endTransform:t.endTransform,maximumHeight:t.maximumHeight,easingFunction:t.easingFunction,flyOverLongitude:t.flyOverLongitude,flyOverLongitudeWeight:t.flyOverLongitudeWeight,pitchAdjustHeight:t.pitchAdjustHeight})};var St=new r,Pt=new r,Tt=new r,xt=new r,Nt=[new r,new r,new r,new r],Lt=new i,Mt=new r,Rt=[new n,new n,new n,new n];function Ot(e,t,i,r,o,n){Lt.x=e,Lt.y=t;var s=r.pickEllipsoid(Lt,o,Mt);return a(s)?(Rt[i]=o.cartesianToCartographic(s,Rt[i]),1):(Rt[i]=o.cartesianToCartographic(n[i],Rt[i]),0)}N.prototype.computeViewRectangle=function(e,i){e=s(e,c.WGS84);var o=this.frustum.computeCullingVolume(this.positionWC,this.directionWC,this.upWC),n=new t(r.ZERO,e.maximumRadius);if(o.computeVisibility(n)!==m.OUTSIDE){var a=this._scene.canvas,l=a.clientWidth,u=a.clientHeight,h=0,g=function(e,t){var i,o,n=t.radii,s=e.positionWC,a=r.multiplyComponents(t.oneOverRadii,s,St),l=r.magnitude(a),u=r.normalize(a,Pt);r.equalsEpsilon(u,r.UNIT_Z,y.EPSILON10)?(i=new r(0,1,0),o=new r(0,0,1)):(i=r.normalize(r.cross(r.UNIT_Z,u,Tt),Tt),o=r.normalize(r.cross(u,i,xt),xt));var h=Math.sqrt(r.magnitudeSquared(a)-1),c=r.multiplyByScalar(u,1/l,St),g=h/l,p=r.multiplyByScalar(i,g,Pt),f=r.multiplyByScalar(o,g,Tt),d=r.add(c,f,Nt[0]);r.subtract(d,p,d),r.multiplyComponents(n,d,d);var m=r.subtract(c,f,Nt[1]);r.subtract(m,p,m),r.multiplyComponents(n,m,m);var C=r.subtract(c,f,Nt[2]);r.add(C,p,C),r.multiplyComponents(n,C,C);var v=r.add(c,f,Nt[3]);return r.add(v,p,v),r.multiplyComponents(n,v,v),Nt}(this,e);if(h+=Ot(0,0,0,this,e,g),h+=Ot(0,u,1,this,e,g),h+=Ot(l,u,2,this,e,g),(h+=Ot(l,0,3,this,e,g))<2)return E.MAX_VALUE;i=E.fromCartographicArray(Rt,i);for(var p=0,f=Rt[3].longitude,d=0;d<4;++d){var C=Rt[d].longitude,v=Math.abs(C-f);v>y.PI?p+=y.TWO_PI-v:p+=v,f=C}return y.equalsEpsilon(Math.abs(p),y.TWO_PI,y.EPSILON9)&&(i.west=-y.PI,i.east=y.PI,Rt[0].latitude>=0?i.north=y.PI_OVER_TWO:i.south=-y.PI_OVER_TWO),i}},N.prototype.switchToPerspectiveFrustum=function(){if(!(this._mode===x.SCENE2D||this.frustum instanceof b)){var e=this._scene;this.frustum=new b,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.fov=y.toRadians(60)}},N.prototype.switchToOrthographicFrustum=function(){if(!(this._mode===x.SCENE2D||this.frustum instanceof _)){var e=this._scene;this.frustum=new _,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.width=r.magnitude(this.position);var t=this.frustum.projectionMatrix;a(t)&&this._adjustOrthographicFrustum(!0)}},N.clone=function(e,t){return a(t)||(t=new N(e._scene)),r.clone(e.position,t.position),r.clone(e.direction,t.direction),r.clone(e.up,t.up),r.clone(e.right,t.right),A.clone(e._transform,t.transform),t._transformChanged=!0,t},e.GeoCamera=N}(window.Cesium),function(e){var t=e.Cartesian2,i=e.defined,r=e.defineProperties,o=e.destroyObject,n=e.DeveloperError,s=e.KeyboardEventModifier,a=e.Math,l=e.ScreenSpaceEventHandler,u=e.ScreenSpaceEventType,h=e.CameraEventType;function c(e,t){var r=e;return i(t)&&(r+="+"+t),r}function g(e,r,o){var n=c(h.PINCH,r),s=e._update,a=e._isDown,l=e._eventStartPosition,g=e._pressTime,p=e._releaseTime;s[n]=!0,a[n]=!1,l[n]=new t;var f=e._movement[n];i(f)||(f=e._movement[n]={}),f.distance={startPosition:new t,endPosition:new t},f.angleAndHeight={startPosition:new t,endPosition:new t},f.prevAngle=0,e._eventHandler.setInputAction((function(i){e._buttonsDown++,a[n]=!0,g[n]=new Date,t.lerp(i.position1,i.position2,.5,l[n])}),u.PINCH_START,r),e._eventHandler.setInputAction((function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),a[n]=!1,p[n]=new Date}),u.PINCH_END,r),e._eventHandler.setInputAction((function(e){if(a[n]){s[n]?(u=e,h=f,t.clone(u.distance.startPosition,h.distance.startPosition),t.clone(u.distance.endPosition,h.distance.endPosition),t.clone(u.angleAndHeight.startPosition,h.angleAndHeight.startPosition),t.clone(u.angleAndHeight.endPosition,h.angleAndHeight.endPosition),s[n]=!1,f.prevAngle=f.angleAndHeight.startPosition.x):(t.clone(e.distance.endPosition,f.distance.endPosition),t.clone(e.angleAndHeight.endPosition,f.angleAndHeight.endPosition));for(var i=f.angleAndHeight.endPosition.x,r=f.prevAngle,l=2*Math.PI;i>=r+Math.PI;)i-=l;for(;i<r-Math.PI;)i+=l;f.angleAndHeight.endPosition.x=-i*o.clientWidth/12,f.angleAndHeight.startPosition.x=-r*o.clientWidth/12}var u,h}),u.PINCH_MOVE,r)}function p(e,r){var o=c(h.WHEEL,r),n=e._update;n[o]=!0;var s=e._movement[o];i(s)||(s=e._movement[o]={}),s.startPosition=new t,s.endPosition=new t,e._eventHandler.setInputAction((function(e){var i=10*a.toRadians(e);n[o]?(t.clone(t.ZERO,s.startPosition),s.endPosition.x=0,s.endPosition.y=i,n[o]=!1):s.endPosition.y=s.endPosition.y+i}),u.WHEEL,r)}function f(e,r,o){var n=c(o,r),s=e._isDown,a=e._eventStartPosition,l=e._pressTime,g=e._releaseTime;s[n]=!1,a[n]=new t;var p,f,d=e._lastMovement[n];i(d)||(d=e._lastMovement[n]={startPosition:new t,endPosition:new t,valid:!1}),o===h.LEFT_DRAG?(p=u.LEFT_DOWN,f=u.LEFT_UP):o===h.RIGHT_DRAG?(p=u.RIGHT_DOWN,f=u.RIGHT_UP):o===h.MIDDLE_DRAG&&(p=u.MIDDLE_DOWN,f=u.MIDDLE_UP),e._eventHandler.setInputAction((function(i){e._buttonsDown++,d.valid=!1,s[n]=!0,l[n]=new Date,t.clone(i.position,a[n])}),p,r),e._eventHandler.setInputAction((function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),s[n]=!1,g[n]=new Date}),f,r)}function d(e,i){t.clone(e.startPosition,i.startPosition),t.clone(e.endPosition,i.endPosition)}function m(e,r){var o=e._update,n=e._movement,s=e._lastMovement,a=e._isDown;for(var l in h)if(h.hasOwnProperty(l)){var g=h[l];if(i(g)){var p=c(g,r);o[p]=!0,i(e._lastMovement[p])||(e._lastMovement[p]={startPosition:new t,endPosition:new t,valid:!1}),i(e._movement[p])||(e._movement[p]={startPosition:new t,endPosition:new t})}}e._eventHandler.setInputAction((function(l){for(var u in h)if(h.hasOwnProperty(u)){var g=h[u];if(i(g)){var p=c(g,r);a[p]&&(o[p]?(d(n[p],s[p]),s[p].valid=!0,d(l,n[p]),o[p]=!1):t.clone(l.endPosition,n[p].endPosition))}}t.clone(l.endPosition,e._currentMousePosition)}),u.MOUSE_MOVE,r)}function C(e){if(!i(e))throw new n("canvas is required.");for(var r in this._eventHandler=new l(e,!0),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new t,p(this,void 0),g(this,void 0,e),f(this,void 0,h.LEFT_DRAG),f(this,void 0,h.RIGHT_DRAG),f(this,void 0,h.MIDDLE_DRAG),m(this,void 0),s)if(s.hasOwnProperty(r)){var o=s[r];i(o)&&(p(this,o),g(this,o,e),f(this,o,h.LEFT_DRAG),f(this,o,h.RIGHT_DRAG),f(this,o,h.MIDDLE_DRAG),m(this,o))}}r(C.prototype,{currentMousePosition:{get:function(){return this._currentMousePosition}},anyButtonDown:{get:function(){var e=!(this._update[c(h.WHEEL)]&&this._update[c(h.WHEEL,s.SHIFT)]&&this._update[c(h.WHEEL,s.CTRL)]&&this._update[c(h.WHEEL,s.ALT)]);return this._buttonsDown>0||e}}}),C.prototype.isMoving=function(e,t){if(!i(e))throw new n("type is required.");var r=c(e,t);return!this._update[r]},C.prototype.getMovement=function(e,t){if(!i(e))throw new n("type is required.");var r=c(e,t);return this._movement[r]},C.prototype.getLastMovement=function(e,t){if(!i(e))throw new n("type is required.");var r=c(e,t),o=this._lastMovement[r];if(o.valid)return o},C.prototype.isButtonDown=function(e,t){if(!i(e))throw new n("type is required.");var r=c(e,t);return this._isDown[r]},C.prototype.getStartMousePosition=function(e,t){if(!i(e))throw new n("type is required.");if(e===h.WHEEL)return this._currentMousePosition;var r=c(e,t);return this._eventStartPosition[r]},C.prototype.getButtonPressTime=function(e,t){if(!i(e))throw new n("type is required.");var r=c(e,t);return this._pressTime[r]},C.prototype.getButtonReleaseTime=function(e,t){if(!i(e))throw new n("type is required.");var r=c(e,t);return this._releaseTime[r]},C.prototype.reset=function(){for(var e in this._update)this._update.hasOwnProperty(e)&&(this._update[e]=!0)},C.prototype.isDestroyed=function(){return!1},C.prototype.destroy=function(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),o(this)},e.GeoCameraEventAggregator=C}(window.Cesium),function(e){var t=e.defaultValue;function i(i){i=t(i,t.EMPTY_OBJECT),this.viewer=i.viewer,this.scene=this.viewer.scene,this.primitives=this.scene.primitives,this.topCylinderColor=t(i.topCylinderColor,new e.Color(1,0,0,.5)),this.bottomCylinderColor=t(i.bottomCylinderColor,new e.Color(0,1,0,.5)),this.createPrestrainPrimitive(),this.active()}function r(t,i,r,o){return new e.GeometryInstance({geometry:new e.EllipseGeometry({center:t,semiMajorAxis:i,semiMinorAxis:r,height:o,vertexFormat:e.EllipsoidSurfaceAppearance.VERTEXT_FORMAT})})}function o(t,i,r,o,n,s,a,l,u,h){return new e.GeometryInstance({geometry:new e.CylinderGeometry({length:t,topRadius:i,bottomRadius:r,vertexFormat:e.VertexFormat.POSITION_AND_NORMAL}),attributes:{color:new e.ColorGeometryInstanceAttribute(o,n,s,a)},modelMatrix:e.Matrix4.multiplyByTranslation(e.Transforms.eastNorthUpToFixedFrame(e.Cartesian3.fromDegrees(l,u,h)),new e.Cartesian3(0,0,0),new e.Matrix4)})}function n(t,i){return new e.Primitive({allowPicking:!0,geometryInstances:t,vertexCacheOptimize:!0,appearance:i,interleave:!0,asynchronous:!1,cull:!1,releaseGeometryInstances:!0,show:!0})}e.defineProperties(i.prototype,{}),i.prototype.createPrestrainPrimitive=function(){var t=r(e.Cartesian3.UNIT_X,1e-4,1e-4,1e-4);this.ellipseAppearance=("varying vec3 v_positionMC;\n\t\t\t\t\tvarying vec3 v_positionEC;\n\t\t\t\t\tvarying vec2 v_st;\n\t\t\t\t\t\n\t\t\t\t\tvoid main()\n\t\t\t\t\t{\n\t\t\t\t\t\tczm_materialInput materialInput;\n\t\t\t\t\t\tvec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\n\t\t\t\t\t#ifdef FACE_FORWARD\n\t\t\t\t\t\tnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n\t\t\t\t\t#endif\n\t\t\t\t\t\tmaterialInput.s = v_st.s;\n\t\t\t\t\t\tmaterialInput.st = v_st;\n\t\t\t\t\t\tmaterialInput.str = vec3(v_st, 0.0);\n\t\t\t\t\t\tmaterialInput.normalEC = normalEC;\n\t\t\t\t\t\tmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\n\t\t\t\t\t\tvec3 positionToEyeEC = -v_positionEC;\n\t\t\t\t\t\tmaterialInput.positionToEyeEC = positionToEyeEC;\n\t\t\t\t\t\tczm_material material = czm_getMaterial(materialInput);\n\t\t\t\t\t#ifdef FLAT\n\t\t\t\t\t\tgl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n\t\t\t\t\t#else\n\t\t\t\t\t\tgl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n\t\t\t\t\t\tif(gl_FragColor.r==1.0&&gl_FragColor.g==1.0&&gl_FragColor.b==1.0&&gl_FragColor.a==1.0){\n\t\t\t\t\t\t\tgl_FragColor.a = 0.0;\n\t\t\t\t\t\t}\n\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t\t",new e.EllipsoidSurfaceAppearance({translucent:!0,material:new e.Material({fabric:{type:"Image",uniforms:{image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAA6E2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS41LWMwMTQgNzkuMTUxNDgxLCAyMDEzLzAzLzEzLTEyOjA5OjE1ICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpPC94bXA6Q3JlYXRvclRvb2w+CiAgICAgICAgIDx4bXA6Q3JlYXRlRGF0ZT4yMDE5LTA2LTExVDA5OjQ2OjU3KzA4OjAwPC94bXA6Q3JlYXRlRGF0ZT4KICAgICAgICAgPHhtcDpNb2RpZnlEYXRlPjIwMTktMDYtMTFUMTA6MTY6NTMrMDg6MDA8L3htcDpNb2RpZnlEYXRlPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDE5LTA2LTExVDEwOjE2OjUzKzA4OjAwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3BuZzwvZGM6Zm9ybWF0PgogICAgICAgICA8cGhvdG9zaG9wOkNvbG9yTW9kZT4zPC9waG90b3Nob3A6Q29sb3JNb2RlPgogICAgICAgICA8cGhvdG9zaG9wOklDQ1Byb2ZpbGU+c1JHQiBJRUM2MTk2Ni0yLjE8L3Bob3Rvc2hvcDpJQ0NQcm9maWxlPgogICAgICAgICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjNkNWU2OTU5LTZiOTMtZTQ0Mi1hNmFkLWVhMmExOWQxZGI0MTwveG1wTU06SW5zdGFuY2VJRD4KICAgICAgICAgPHhtcE1NOkRvY3VtZW50SUQ+eG1wLmRpZDo5ODQ4MzQ2Ny03Mjg5LTUzNGQtOTUyOC05MGY3MWU0MTEwMmU8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDo5ODQ4MzQ2Ny03Mjg5LTUzNGQtOTUyOC05MGY3MWU0MTEwMmU8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkhpc3Rvcnk+CiAgICAgICAgICAgIDxyZGY6U2VxPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5jcmVhdGVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6OTg0ODM0NjctNzI4OS01MzRkLTk1MjgtOTBmNzFlNDExMDJlPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE5LTA2LTExVDA5OjQ2OjU3KzA4OjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+c2F2ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDozZDVlNjk1OS02YjkzLWU0NDItYTZhZC1lYTJhMTlkMWRiNDE8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDp3aGVuPjIwMTktMDYtMTFUMTA6MTY6NTMrMDg6MDA8L3N0RXZ0OndoZW4+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpzb2Z0d2FyZUFnZW50PkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cyk8L3N0RXZ0OnNvZnR3YXJlQWdlbnQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpjaGFuZ2VkPi88L3N0RXZ0OmNoYW5nZWQ+CiAgICAgICAgICAgICAgIDwvcmRmOmxpPgogICAgICAgICAgICA8L3JkZjpTZXE+CiAgICAgICAgIDwveG1wTU06SGlzdG9yeT4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgICAgPHRpZmY6WFJlc29sdXRpb24+NzIwMDAwLzEwMDAwPC90aWZmOlhSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpZUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WVJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDxleGlmOkNvbG9yU3BhY2U+MTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+NjQ8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+NjQ8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/Pu16zW8AAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAEbhJREFUeNrsW3t0VPWd//x+9955ZDKTyeRNnrxCXEGEgAqyQXqEWmtdtbj0gVsaaVfWB6tSjh5r67J2j0qhPrrWcnqaLisKVK0bLdsKIiBGBOVhSYiERwghk5AQ8pqZ3Dv3/r77x/yGjrOZyUSC7jnu95zfyeP+Ht/f5/5+3/dlRIQvM3F8yenzACAPwDIAc0cwZhyABwBUXGrm1Es4dz6AbwGYB+BvAPzrCMZ6AHwfwE0A3gewGcChS8EkuwQy4DYA1QBKAZwDsA/AWwB2AwiN4GRWArgRwLUACgB0A3gNwDP/VwH4HoD7ANgB/BnAbwHUj9Lc2QDuBPB3AHwAXgHw41GZmYguts0mov1EdISIVozCfMO1hUT0ARE1EdGdFzvfxTKzjoi6ieipz2Hj8W0JEZ0moneJKOPzBiCfiE4Q0SEiKv0CNh/bXiaiEBF97bOM/ywyYB6APwFYB+DeEYzzAZgG4DKp5nwAFPlMABgA0AzgKIADAFpGMPcdAH4H4LERapsRn4BvUoS+l2J/HxEtJaI3iaiXUieLiN4jooeJaGKKa11GRANE9ItLdQVulszNSaFvERE9TUQ9iXZomqZlGIZpGIZlGIY5DCCvSWE73LppRNRBRGtG+wrMBLBXWnO7hun7UwAPAXDE/M+sq6s7vmfPnuaGhgZ/a2tr/7lz53TTNIkxxgCQ1+vVxowZk15eXp47c+bM0qqqqvEulys9bu71cm5/kvVdADoB/ATAz0fDDvDKCX8IoCZJvyskg1Oj//D7/Z01NTUf1NbW1h88eNCv67oBQOGca3a7XeGcI7q+YRjCNE0TQBgAr6ioyLnhhhsmLV68eEZlZeWEmHX6APwjgI1JeJkAoAnAfADbLhaAj+XbX5qkz3cAbLjwuk1z8LHHHvvjunXr9nZ2dp5XFMWTm5vrstvtXModBoDFiyPGGMnx1N3dPRgMBns1TbMtWrRoyqpVq24cO3bsmJj+qwGsTMLTrdJy9ADo/6wAPCIdmaIkfR4AsCb6x7Zt2w7de++9f2hsbDzjdruzc3JynEIIQUQqgHR5Naxij9s2PsOT7rQM5VjfQH/TQCgktYIpGTYUReEDAwPm2bNnz2ZkZLgef/zxr95zzz0LYtZ+CcB3k/D2nwBKkjliyQAoAnAawBQAhxP0uRvAL6N/rFmzZsuKFStqATjHjRvnE0KYROQAkCn9gBYAJwG0PVKcWzY1M+M6h6JkHusPvPPAsdP7pANVJptXAtGvqqra3t4eCAQCnXfcccc169ev/36MI/eyPIGJKCCv74aRAvA2gDapY4eimwC8Ef3jwQcffHnt2rVbMzMzC3w+n900TZKucEA6RB/W3TTvOBgD0zToRw7foR9peJQrWqlWNvZRraT0KTJNgAhzdh/IkzbDLOkIdXLOjXA4zFpbW1vnzp07cevWrcs1TbPL5X8O4EcJ+LwdwAsAskYSD7haSv4fJnheAKA2+sfDDz+8ee3atdvy8/OLvV6vZpqmDcAYadA8DWDT/oeWH3dMvgKOK66E88pKqJneYqurZ6Le3GkTg4ZHzc6C4s2A4s3A+zdd1yGNrdXSk8wQQnhVVbXKyspKdu7ceXzBggXPArAkCysA3JKA199LrbFqJAD8Qh6tRO5rbVSI1dTU7HziiSf+nJeXV+h0OiGEcEvBs1lai60AYLafiTR/K8JtLTarv6+YGCAEQIKXkBAVZFo2CpugsBldZ0B6fr8CoBNRLoBwWVlZ4Y4dO45WV1f/R9xGvQn4/RGAf0oVgHEAxkp9OxQtATADAI4cOXKqurp6o8fjyXW5XFxu3gHg1/HqJ7h/T7R5Qvveuz58+uQk6FL8G+HJYlCvIgE7MQX0v9mql8e8h4jyAFiFhYVFNTU1u2tqanbGBHfWJeD5vwG0A7gnFQAeAvAhgPNDPNPkkQYAWrp06UYAak5OjtOyLLt88+uk6vwUmaeaI635pMc4eaLK6usdz5yAogFWZ+v4cMuxK3m6Q1NzfFAyPUNtokuezBARZdpsNkpPT8+97777Xvf7/V0x9/2KBCDUyCjTsADMTWLwLAOQAQDr169/t66urqm0tDTHNE0BIEfq3Y+HNM+uW4D0r94Mx7SrMkiIKhEIljAVUDIBq/+8xzjdMoMBecxmA1OURIK5W54uuxDClpeX5xoYGAg98sgjb8T0eTLB2BekAzYpGQDXyp+vJdH5ICJz9erVOzVN83LOhYzYHJGRoKGDj3kF0AqLoXgyJtLAwAQYAszOwNI0kA5YXQFP+GzHlHDrKY/RcjKZbXJMCsZc0zTNnJyc3BdffPFAU1NTq3x+QwK7JSBVcHUyAL4rOw1F18g4H2praw8cPnz4TEFBgVsIoch5XkvGdejghwgd+rBcP940R/QEXOAAc6gAY4AJUMDyit7+vwVDCfdmDGedbpF3Ot3tdqvhcNhYt25dXVx4bijaCaBKmspDAjA9ibOzKPrLpk2bDgLQOOdRP/+g9OUTkggFYDQfqzSaPqkSuqlBYQDngACYBpAYzDLbz8xnmlZqGzt2OAAMuRmvZVkiLS3N++abbzbouh7VWt9Mor2yASxMBMDSJFHXrwBAT09Pb11d3SmPx+ORRpQqDZ2k5Jw5C6rbPZkCfdOgQAVnkTAIAJ6pgKm6qh87Osns6ipNMV2xTwpqm8/nczY2Nnbt2rWrST6bJu2QeDog7YXfJwLgsLwr8ZQDYDIA7N27t7mlpaXX4/FoUuV1yChOUhLBwBirp28K6brKnWBMkwAQwO0M4IDoBUSQplJYTEoBgF4AxwG4VVUFALFnz57mOGNuKKqX40aUGKmIgtXQ0NBORJaqqoyI0qTbGRxugv4d7/xDuKmtQnQDzEkAWZHGAMYBywBMAejNLTcyTi0AfpYCX80ApsmTqDU2Np6NeZYKiCkDcEGqnjlzpj/Gh1BlrGBYKszUzgyUF+4z9IIuxcHPCzDBAHAOUlRuWSHdEQ7odueEMW32orxPcOCTVKbtkN4jUxRF8/v9AzHPikcTgAuWSXd3dzhOiwRTmcCVQVudqnoQYZ7GbUwnzgVxBs4AaAohCIX6LZVl2wLwOc6myFcwCoDdbmc9PT1hy7KEoig8ludRzQ3KYManrncq4zb1TW4Ph1m7SRwAg2AcBEABQVEYzNAgwrqBzEAx0vuyU2XnwtqRyBqYEAJKYkPqMwPAYgD4TLm05T3XFrmddpdiU7lOsAQxBgEwEuCWgG6EedgSfFzIo2f3Oc8lMMWHezk0FM+jAYB1wRnQtNiJKSa2n5SKHcZSZuqzLJNl2zjvFWAMBMaIiDOCzdBdImxxj6WccAu8BOD1FPlnACCEgKqqTFEUFs/zaADQfUEf5uTYZfwORCQAuFOZYHJ5vvr2lg8mnT7dWcrcOZZ8ZRH+VQUUDCjcHDQ1jHOEzZzcFPlyyz2QrusiKyvLxjln8TyPBgCnLrzJ4uKMaEJFRnDzU5lg2pVFGz/6+NRXTncZpU63TdEUDi7lAFc4Bp0KINyC2R1vChJvpchXAQCFMUZCCKOwsNATpyJTysOnQo1RaT916tQxmqZp4XCYpNFUImN+yWPr3rQTmT5PPZwOy7QIXFVgd2rQbAoM04RmV5Gd6+lLc9q2M8aaU+RrHIBBeQ3MKVOmFMQZPCMG4FsyGBJPAwA+AoDp06eXlZeXZ/X09AzKE+ADcPmwCDb6RV5W2geluZ5DRm8IpmGBAFiWQDBggCwaTE/TPjQtq30goKfC+xjJ64Cu65bNZrPPmTNnXIyvsHeIMQqAbwO4LhEAj0Zd3iHoLQCw2+2OefPmjQ8Gg33yvgWTmJ0X6Fx3wCwfn7N74rjsAzAFhBDSCmTgjEFV+HFF4X8yDPNsMJgSALMBOBljZmdnZ2D69OkFM2bMGC+f7ZIJlKH8meejEa2hANgcm9mJo5ejvyxevHgGAKbrugDQI83OymTcTqrIM0vLshp9eZ5GxeOEKYDBUBhEBM2mwONxnPT5XNuyfK7urCzXcJvPkrGLLsaYYppm38KFC6+I2c/GJJHsvQB+kwiADQAKE0j24wA+AICrr7560vXXXz+xra2tWxod/TITk1CoGoaFYCgMu11pzc11tUEIMdCvQ9dNKJyhpNh7bOb04voZ04qMyiuLhgNgIQAHY0w/d+5cMDs721tdXT07Gn0DsCnBuFnyJPckAuCYvO9LEkxwwUF59NFH5wPQQ6GQYIz1So8xUSAC7+05ibd3HEVPz2Dz2OLs3RrnvVb3AMIDRrhoTObxMQXew5wzcIUjYskmpCp5hDsYY2pfX1/n/fffPyczMzMaRVkn9xBPpQBy48N9Q630qhQUQ9EbMvSFqqqqy5csWXKV3+9vVxRFlbH3WQC+MdTAvBw3crPTMbY06+SEcdm7HC6tHyAwjetOp7anr09vqD/SjobGDjQeTegKTJa8damqyk6ePNk9adKkwpUrV94Q0+enCcbeD+BEvH0wFABrAYyXKbGh6M7oL88888zf5+fnZ5w4ceK8qqpMhqlulu3TCrvAg4ICD/Lz3B2Zmc73XS77ABw2OF2OQE62e2uG23FIVRRoaqQNQdMRyQoHOOeD3d3dOoBATU3Nt1VVtcVsvisB37dhiHQ5T6Dy3olNeMbR+9Fj5PF43LW1tT8goqDf7w+oqmpKF/UbEqi06KCGI+1oONKOQ385g2PHu7o0RTnPnXZwzvQsb9rHBXme4Ji8DERbHH0dwA8ADHLO+0KhEJ0/f97/3HPPLZw1a1ZFjIxalcgVkY7TllQtwX+WE06UAY94qpa6dOzMmTMnvvLKK0sWLlz4W7/fj4KCApdpmm0ArpJG0lsA3ms44o86LFAUbnrcjsbCPPdVlhBdgaDe390dgG6Y8etcJqO8lwHoUhRFDwQC1NHRcWbFihUL4jLFX0siNx6WexpRcvTf5SZmJnheBuATADYA2Lx58/uLFi1aD8A5fvz4TMuyTCLyylNwTBpSDZVzftwBwMs5+3pPT+iq3t7Qac5ZDSJVpWg/+csMAOUyrjdFWnmdqqryzs7Owb6+vo6VK1cuePLJJxfFGXCJJP8qmTC5bKQAMHkdqpNMfo28EgCA3bt3NyxatGh9W1vb+YKCgnyn08kty4JMpjili9sqZUW/VFlRjzINkWxykdQoFoDznHOLiHhzc3MXAOv555+/ddmyZdfHCbenE/CXK69kJYD9IwUAiNTq/lFuoC9BnznymDsB4Ny5c+eXL1/+yoYNGz4CYCssLPTZbDYuhBDytKTJnzzOZxfStA7Juw4hBFpbW/sty+qdPXv2hGefffbWysrK8pgx9wF4Lgn/hxFJ8y9P+JZTiG/8Th7HqUn6lAP4AyJV4ZHMxZYtH61Zs2bX9u3bjwMQaWlpHq/Xa9c0jUtXeujAg2VRf3+/0dvb2w/AnDx5csFdd901++6774596zoiRRHJkjFPyqtRmjTSk2KApx7AnlgVmODKvIC4moLt27cffvXVVw/u3LnzRFNTU7dhGEaSaA0xxpSSkpKMWbNmldxyyy1Tbr/99umcc3tcdufO2NB2giTORumqd4wGAC5EqkWeSiFcPR/Av0ij6K/Ry2AwsH///pb6+np/S0tLb2dn56BpmtFYHnw+n1ZYWOiuqKjInzZtWnFeXp4vbt4ziFSB/nqY9a9FpDS/CsC7qcTRUm1FRNRPRD9Jsf/tRLSNLp4+JqIHiciRwprziEgQ0W2Xqli6SJa8bhjBmMtlyevbsrJ8OBokon1EtJqI5o5gnbvl+FsudbG0S+blwogUTnePYGyGzMyWIVLOosZogAFEqshOIHkl6FC0AZGPKRYAqBtpKPliytR7R+OjhYto1xDRUSL6CxF5vogPJhYS0Rki2k1E0z7HjfuIaD0RdRHRz77IL0ZivxxpJqLXiejqS7jxQiL6lVxry2h8rDGaH00VSRV5jTR3axEpZe28yHlV6cp+RxpcLQD+DcNXraeW8roEn81lIvIlyXyZoOxApHDqNzK8nuocy6ROL5GW3x5E6gXrR5NZdom/HZ6MSEXGfGnAvJTiuKnSwTkI4L8A7LhUDLL//3j6S05fegD+ZwD3gk1Njxe3yQAAAABJRU5ErkJggg=="}}}),fragmentShaderSource:"varying vec3 v_positionMC;\n\t\t\t\t\tvarying vec3 v_positionEC;\n\t\t\t\t\tvarying vec2 v_st;\n\t\t\t\t\t\n\t\t\t\t\tvoid main()\n\t\t\t\t\t{\n\t\t\t\t\t\tczm_materialInput materialInput;\n\t\t\t\t\t\tvec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\n\t\t\t\t\t#ifdef FACE_FORWARD\n\t\t\t\t\t\tnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n\t\t\t\t\t#endif\n\t\t\t\t\t\tmaterialInput.s = v_st.s;\n\t\t\t\t\t\tmaterialInput.st = v_st;\n\t\t\t\t\t\tmaterialInput.str = vec3(v_st, 0.0);\n\t\t\t\t\t\tmaterialInput.normalEC = normalEC;\n\t\t\t\t\t\tmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\n\t\t\t\t\t\tvec3 positionToEyeEC = -v_positionEC;\n\t\t\t\t\t\tmaterialInput.positionToEyeEC = positionToEyeEC;\n\t\t\t\t\t\tczm_material material = czm_getMaterial(materialInput);\n\t\t\t\t\t#ifdef FLAT\n\t\t\t\t\t\tgl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n\t\t\t\t\t#else\n\t\t\t\t\t\tgl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n\t\t\t\t\t\tif(gl_FragColor.r==1.0&&gl_FragColor.g==1.0&&gl_FragColor.b==1.0&&gl_FragColor.a==1.0){\n\t\t\t\t\t\t\tgl_FragColor.a = 0.0;\n\t\t\t\t\t\t}\n\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t\t"}));var i=n(t,this.ellipseAppearance);this.primitives.add(i),this.prestrainEllipsePrimitive=i;var s=n([o(1e-4,1e-4,0,1,0,0,0,0,0,0),o(1e-4,0,1e-4,1,0,0,0,0,0,0)],new e.PerInstanceColorAppearance);this.primitives.add(s),this.prestrainCylinderPrimitive=s},i.prototype.active=function(){var t=null,i=this,s=new e.ScreenSpaceEventHandler(this.scene.canvas);s.setInputAction((function(s){if(!i.viewer.trackedEntity){i.scene.screenSpaceCameraController.enableInputs=!1;var a;if(a=null==i.scene.pick(s.position)?i.scene.globe.pick(i.viewer.camera.getPickRay(s.position),i.scene):i.scene.pickPosition(s.position)){var l=e.Cartographic.fromCartesian(a),u=e.Math.toDegrees(l.longitude),h=e.Math.toDegrees(l.latitude),c=l.height+.5,g=e.Cartesian3.distance(i.viewer.camera.position,a)/80,p=i.viewer.entities.add({id:"pointEntity",position:a,point:{color:new e.Color(1,1,1,0)}});p.enableGeoLocateRatate=!0,i.viewer.trackedEntity=p;var f=n(r(a,g,g,c),i.ellipseAppearance);i.primitives.add(f),i.ellipsePrimitive=f;var d=n([o(.3*g,.1*g,0,i.topCylinderColor.red,i.topCylinderColor.green,i.topCylinderColor.blue,i.topCylinderColor.alpha,u,h,c+.2*g),o(.3*g,0,.1*g,i.bottomCylinderColor.red,i.bottomCylinderColor.green,i.bottomCylinderColor.blue,i.bottomCylinderColor.alpha,u,h,c-.2*g)],new e.PerInstanceColorAppearance);i.primitives.add(d),i.cylinderPrimitive=d,i.scene.screenSpaceCameraController.rotateEventTypes=e.CameraEventType.MIDDLE_DRAG,t=setTimeout((function(){i.scene.screenSpaceCameraController.enableInputs=!0}),10),i.scene.globe.depthTestAgainstTerrain=!1}}}),e.ScreenSpaceEventType.MIDDLE_DOWN),s.setInputAction((function(r){i.viewer.trackedEntity.enableGeoLocateRatate&&(clearTimeout(t),i.prestrainEllipsePrimitive&&i.primitives.remove(i.prestrainEllipsePrimitive),i.prestrainCylinderPrimitive&&i.primitives.remove(i.prestrainCylinderPrimitive),i.ellipsePrimitive&&i.primitives.remove(i.ellipsePrimitive),i.cylinderPrimitive&&i.primitives.remove(i.cylinderPrimitive),i.viewer.entities.removeById("pointEntity"),t=null,i.prestrainEllipsePrimitive=null,i.prestrainCylinderPrimitive=null,i.ellipsePrimitive=null,i.cylinderPrimitive=null,i.viewer.trackedEntity=void 0,i.scene.screenSpaceCameraController.rotateEventTypes=e.CameraEventType.LEFT_DRAG,i.scene.screenSpaceCameraController.enableInputs=!0)}),e.ScreenSpaceEventType.MIDDLE_UP)},e.GeoLocateRatate=i}(window.Cesium),function(e){var t=e.Cartesian2,i=e.Cartesian3,r=e.Cartesian4,o=e.Cartographic,n=e.defaultValue,s=e.defined,a=e.destroyObject,l=e.DeveloperError,u=e.Ellipsoid,h=e.HeadingPitchRoll,c=e.IntersectionTests,g=e.isArray,p=e.KeyboardEventModifier,f=e.Math,d=e.Matrix3,m=e.Matrix4,C=e.OrthographicFrustum,y=e.Plane,v=e.Quaternion,A=e.Ray,_=e.Transforms,I=e.CameraEventAggregator,b=e.CameraEventType,w=e.MapMode2D,G=e.SceneMode,E=e.SceneTransforms,S=e.TweenCollection;function P(r){if(!s(r))throw new l("scene is required.");this.constrainedPitch=-f.PI_OVER_SIX,this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=b.LEFT_DRAG,this.zoomEventTypes=[b.WHEEL,b.PINCH],this.rotateEventTypes=b.LEFT_DRAG,this.tiltEventTypes=[b.RIGHT_DRAG,b.MIDDLE_DRAG,b.PINCH,{eventType:b.LEFT_DRAG,modifier:p.CTRL},{eventType:b.RIGHT_DRAG,modifier:p.CTRL}],this.lookEventTypes={eventType:b.LEFT_DRAG,modifier:p.SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=-75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this._scene=r,this._globe=void 0,this._ellipsoid=void 0,e.GeoOption&&e.GeoOption.GeoCameraEventAggregator?this._aggregator=new e.GeoCameraEventAggregator(r.canvas):this._aggregator=new I(r.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._tweens=new S,this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new t(-1,-1),this._tiltCenter=new i,this._rotateMousePosition=new t(-1,-1),this._rotateStartPosition=new i,this._strafeStartPosition=new i,this._zoomMouseStart=new t(-1,-1),this._zoomWorldPosition=new i,this._useZoomWorldPosition=!1,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._rotatingZoom=!1;var n=r.mapProjection;this._maxCoord=n.project(new o(Math.PI,f.PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3}function T(e,i,r,o,n,a,l){var u=a[l];s(u)||(u=a[l]={startPosition:new t,endPosition:new t,motion:new t,active:!1});var h,c=e.getButtonPressTime(i,r),g=e.getButtonReleaseTime(i,r),p=c&&g&&(g.getTime()-c.getTime())/1e3,d=new Date,m=g&&(d.getTime()-g.getTime())/1e3;if(c&&g&&p<.4){var C=function(e,t){if(e<0)return 0;var i=25*(1-t);return Math.exp(-i*e)}(m,o);if(u.active)u.startPosition=t.clone(u.endPosition,u.startPosition),u.endPosition=t.multiplyByScalar(u.motion,C,u.endPosition),u.endPosition=t.add(u.startPosition,u.endPosition,u.endPosition),u.motion=t.clone(t.ZERO,u.motion);else{var y=e.getLastMovement(i,r);if(!s(y)||(h=y,t.equalsEpsilon(h.startPosition,h.endPosition,f.EPSILON14)))return;u.motion.x=.5*(y.endPosition.x-y.startPosition.x),u.motion.y=.5*(y.endPosition.y-y.startPosition.y),u.startPosition=t.clone(y.startPosition,u.startPosition),u.endPosition=t.multiplyByScalar(u.motion,C,u.endPosition),u.endPosition=t.add(u.startPosition,u.endPosition,u.endPosition),u.active=!0}if(isNaN(u.endPosition.x)||isNaN(u.endPosition.y)||t.distance(u.startPosition,u.endPosition)<.5)return void(u.active=!1);e.isButtonDown(i,r)||n(a,e.getStartMousePosition(i,r),u)}else u.active=!1}var x=[];function N(e,t,i,r,o,n){if(s(i)){var a=e._aggregator;g(i)||(x[0]=i,i=x);for(var l=i.length,u=0;u<l;++u){var h=i[u],c=s(h.eventType)?h.eventType:h,p=h.modifier,f=a.isMoving(c,p)&&a.getMovement(c,p),d=a.getStartMousePosition(c,p);e.enableInputs&&t&&(f?r(e,d,f):o<1&&T(a,c,p,o,r,e,n))}}}var L=new A,M=new i,R=new t,O=new i,F=new t,D=new i,k=new i,U=new i,B=new i,W=new i,V=new i,j=new i,H=new i,z=new i,q=new i,X=new i,Y=new i,K=new i,Q=new i,Z=new i,J=new i,$=new i,ee=new i,te={orientation:new h};function ie(o,n,a,l,u,h){var c=1;s(h)&&(c=f.clamp(Math.abs(h),.25,1));var g=o.minimumZoomDistance*c,p=o.maximumZoomDistance,d=l*(u-g);d=f.clamp(d,o._minimumZoomRate,o._maximumZoomRate);var m=a.endPosition.y-a.startPosition.y;if(!(o.autoResetHeadingPitch&&m<0&&function(t,i){var o=r.clone(r.UNIT_W),n=r.clone(r.UNIT_W),s=t._scene,a=s.globe.ellipsoid,l=s.camera,u=s.canvas;if(Math.abs(l.pitch)>=1.5&&(l.heading<=.25||l.heading>=6.03))return!1;var h=l.pickEllipsoid(new e.Cartesian2(0,u.clientHeight),a,o),c=l.pickEllipsoid(new e.Cartesian2(u.clientWidth,u.clientHeight),a,n);if(h&&c&&Math.abs(h.x-c.x)<8e4&&Math.abs(h.y-c.y)<8e4)return!1;var g=new e.Ray;g=l.getPickRay(i,g);var p=s.globe.pick(g,s);p||(g.origin=l.positionWC,g.direction=l.directionWC,p=s.globe.pick(g,s));var f=a.cartographicToCartesian(viewer.camera.positionCartographic,new e.Cartesian3),d=(a.geodeticSurfaceNormal(p),new e.BoundingSphere(p,0));return l.flyToBoundingSphere(d,{offset:new e.HeadingPitchRange(0,e.Math.toRadians(-90),e.Cartesian3.distance(f,p)),duration:0}),!0}(o,n))){var y=m/o._scene.canvas.clientHeight,v=d*(y=Math.min(y,o.maximumMovementRatio));if(!(v>0&&Math.abs(u-g)<1||v<0&&Math.abs(u-p)<1)){u-v<g?v=u-g-1:u-v>p&&(v=u-p);var A=o._scene,_=A.camera,I=A.mode,b=te.orientation;if(b.heading=_.heading,b.pitch=_.pitch,b.roll=_.roll,_.frustum instanceof C)Math.abs(v)>0&&(_.zoomIn(v),_._adjustOrthographicFrustum());else{var w,S=t.equals(n,o._zoomMouseStart),P=o._zoomingOnVector,T=o._rotatingZoom;if(S||(o._zoomMouseStart=t.clone(n,o._zoomMouseStart),s(o._globe)&&(w=I!==G.SCENE2D?fe(o,n,M):_.getPickRay(n,L).origin),s(w)?(o._useZoomWorldPosition=!0,o._zoomWorldPosition=i.clone(w,o._zoomWorldPosition)):o._useZoomWorldPosition=!1,P=o._zoomingOnVector=!1,T=o._rotatingZoom=!1),o._useZoomWorldPosition){var x=I===G.COLUMBUS_VIEW;if(_.positionCartographic.height<2e6&&(T=!0),!S||T){if(I===G.SCENE2D){var N=o._zoomWorldPosition,ie=_.position;if(!i.equals(N,ie)&&_.positionCartographic.height<2*o._maxCoord.x){var re=_.position.x,oe=i.subtract(N,ie,O);i.normalize(oe,oe);var ne=i.distance(N,ie)*v/(.5*_.getMagnitude());_.move(oe,.5*ne),(_.position.x<0&&re>0||_.position.x>0&&re<0)&&(w=_.getPickRay(n,L).origin,o._zoomWorldPosition=i.clone(w,o._zoomWorldPosition))}}else if(I===G.SCENE3D){var se=i.normalize(_.position,W);if(_.positionCartographic.height<3e3&&Math.abs(i.dot(_.direction,se))<.6)x=!0;else{var ae=A.canvas,le=F;le.x=ae.clientWidth/2,le.y=ae.clientHeight/2;var ue=fe(o,le,D);if(s(ue)&&_.positionCartographic.height<1e6){var he=j;i.clone(_.position,he);var ce=o._zoomWorldPosition,ge=V;if(ge=i.normalize(ce,ge),i.dot(ge,se)<0)return;var pe=Z,de=q;i.clone(_.direction,de),i.add(he,i.multiplyByScalar(de,1e3,J),pe);var me=X,Ce=Y;i.subtract(ce,he,me),i.normalize(me,Ce);var ye=i.dot(se,Ce);if(ye>=0)return void(o._zoomMouseStart.x=-1);var ve=Math.acos(-ye),Ae=i.magnitude(he),_e=i.magnitude(ce),Ie=Ae-v,be=i.magnitude(me),we=Math.asin(f.clamp(be/_e*Math.sin(ve),-1,1))-Math.asin(f.clamp(Ie/_e*Math.sin(ve),-1,1))+ve,Ge=H;i.normalize(he,Ge);var Ee=z;Ee=i.cross(Ce,Ge,Ee),Ee=i.normalize(Ee,Ee),i.normalize(i.cross(Ge,Ee,J),de),i.multiplyByScalar(i.normalize(pe,J),i.magnitude(pe)-v,pe),i.normalize(he,he),i.multiplyByScalar(he,Ie,he);var Se=K;i.multiplyByScalar(i.add(i.multiplyByScalar(Ge,Math.cos(we)-1,$),i.multiplyByScalar(de,Math.sin(we),ee),J),Ie,Se),i.add(he,Se,he),i.normalize(pe,Ge),i.normalize(i.cross(Ge,Ee,J),de);var Pe=Q;return i.multiplyByScalar(i.add(i.multiplyByScalar(Ge,Math.cos(we)-1,$),i.multiplyByScalar(de,Math.sin(we),ee),J),i.magnitude(pe),Pe),i.add(pe,Pe,pe),i.clone(he,_.position),i.normalize(i.subtract(pe,he,J),_.direction),i.clone(_.direction,_.direction),i.cross(_.direction,_.up,_.right),i.cross(_.right,_.direction,_.up),void _.setView(te)}if(s(ue)){var Te=i.normalize(ue,k),xe=i.normalize(o._zoomWorldPosition,U),Ne=i.dot(xe,Te);if(Ne>0&&Ne<1){var Le=f.acosClamped(Ne),Me=i.cross(xe,Te,B),Re=v/(Math.abs(Le)>f.toRadians(20)?.75*_.positionCartographic.height:_.positionCartographic.height-v);_.rotate(Me,Le*Re)}}else x=!0}}o._rotatingZoom=!x}if(!S&&x||P){var Oe=E.wgs84ToWindowCoordinates(A,o._zoomWorldPosition,R),Fe=(I!==G.COLUMBUS_VIEW&&t.equals(n,o._zoomMouseStart)&&s(Oe)?_.getPickRay(Oe,L):_.getPickRay(n,L)).direction;I===G.COLUMBUS_VIEW&&i.fromElements(Fe.y,Fe.z,Fe.x,Fe),_.move(Fe,v),o._zoomingOnVector=!0}else _.zoomIn(v);_.setView(te)}else _.zoomIn(v)}}}}var re=new A,oe=new A,ne=new i;function se(e,t,r){var o=e._scene.camera,n=o.getPickRay(r.startPosition,re).origin,s=o.getPickRay(r.endPosition,oe).origin,a=i.subtract(n,s,ne),l=i.magnitude(a);l>0&&(i.normalize(a,a),o.move(a,l))}function ae(e,t,i){s(i.distance)&&(i=i.distance);var r=e._scene.camera;ie(e,t,i,e._zoomFactor,r.getMagnitude())}var le=new t,ue=new t;function he(e,i,r){if(s(r.angleAndHeight))!function(e,t,i){var r=e._rotateFactor*e._rotateRateRangeAdjustment;r>e._maximumRotateRate&&(r=e._maximumRotateRate),r<e._minimumRotateRate&&(r=e._minimumRotateRate);var o=e._scene,n=o.camera,s=o.canvas,a=(i.endPosition.x-i.startPosition.x)/s.clientWidth,l=r*(a=Math.min(a,e.maximumMovementRatio))*Math.PI*4;n.twistRight(l)}(e,0,r.angleAndHeight);else{var o=e._scene,n=o.camera,a=o.canvas,l=a.clientWidth,u=a.clientHeight,h=le;h.x=2/l*r.startPosition.x-1,h.y=2/u*(u-r.startPosition.y)-1,h=t.normalize(h,h);var c=ue;c.x=2/l*r.endPosition.x-1,c.y=2/u*(u-r.endPosition.y)-1,c=t.normalize(c,c);var g=f.acosClamped(h.x);h.y<0&&(g=f.TWO_PI-g);var p=f.acosClamped(c.x);c.y<0&&(p=f.TWO_PI-p);var d=p-g;n.twistRight(d)}}var ce=new A,ge=new i,pe=new i;function fe(e,t,r){var o=e._scene,n=e._globe,a=o.camera;if(s(n)){var l;o.pickPositionSupported&&(l=o.pickPositionWorldCoordinates(t,ge));var u=a.getPickRay(t,ce),h=n.pick(u,o,pe);return(s(l)?i.distance(l,a.positionWC):Number.POSITIVE_INFINITY)<(s(h)?i.distance(h,a.positionWC):Number.POSITIVE_INFINITY)?i.clone(l,r):i.clone(h,r)}}var de=new A,me=new A,Ce=new i,ye=new i,ve=new i,Ae=new i,_e=new y(i.UNIT_X,0),Ie=new t,be=new t;function we(e,r,o){if(i.equals(r,e._translateMousePosition)||(e._looking=!1),i.equals(r,e._strafeMousePosition)||(e._strafing=!1),e._looking)Rt(e,r,o);else if(e._strafing)Ke(e,r,o);else{var n,a=e._scene.camera,l=t.clone(o.startPosition,Ie),u=t.clone(o.endPosition,be),h=a.getPickRay(l,de),g=i.clone(i.ZERO,Ae),p=i.UNIT_X;if(a.position.z<e._minimumPickingTerrainHeight&&(n=fe(e,l,Ce),s(n)&&(g.x=n.x)),g.x>a.position.z&&s(n))return i.clone(n,e._strafeStartPosition),e._strafing=!0,Ke(e,r,o),void(e._strafeMousePosition=t.clone(r,e._strafeMousePosition));var d=y.fromPointNormal(g,p,_e);h=a.getPickRay(l,de);var m=c.rayPlane(h,d,Ce),C=a.getPickRay(u,me),v=c.rayPlane(C,d,ye);if(!s(m)||!s(v))return e._looking=!0,Rt(e,r,o),void t.clone(r,e._translateMousePosition);var A=i.subtract(m,v,ve),_=A.x;A.x=A.y,A.y=A.z,A.z=_;var I=i.magnitude(A);I>f.EPSILON6&&(i.normalize(A,A),a.move(A,I))}}var Ge=new t,Ee=new A,Se=new i,Pe=new i,Te=new m,xe=new m,Ne=new i,Le=new y(i.UNIT_X,0),Me=new i,Re=new o,Oe=new m,Fe=new v,De=new d,ke=new i;function Ue(e,r,o){if(s(o.angleAndHeight)&&(o=o.angleAndHeight),t.equals(r,e._tiltCenterMousePosition)||(e._tiltCVOffMap=!1,e._looking=!1),e._looking)Rt(e,r,o);else{var n=e._scene.camera,a=e._maxCoord,l=Math.abs(n.position.x)-a.x<0&&Math.abs(n.position.y)-a.y<0;e._tiltCVOffMap||!l||n.position.z>e._minimumPickingTerrainHeight?(e._tiltCVOffMap=!0,function(e,r,o){var n=e._scene,a=n.camera,l=n.canvas,h=Ge;h.x=l.clientWidth/2,h.y=l.clientHeight/2;var c,g=a.getPickRay(h,Ee),p=i.UNIT_X,d=g.origin,C=g.direction,y=i.dot(p,C);if(Math.abs(y)>f.EPSILON6&&(c=-i.dot(p,d)/y),!s(c)||c<=0)return e._looking=!0,Rt(e,r,o),void t.clone(r,e._tiltCenterMousePosition);var v=i.multiplyByScalar(C,c,Se);i.add(d,v,v);var A=n.mapProjection,I=A.ellipsoid;i.fromElements(v.y,v.z,v.x,v);var b=A.unproject(v,Re);I.cartographicToCartesian(b,v);var w=_.eastNorthUpToFixedFrame(v,I,Te),G=e._globe,E=e._ellipsoid;e._globe=void 0,e._ellipsoid=u.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var S=m.clone(a.transform,Oe);a._setTransform(w),it(e,r,o,i.UNIT_Z),a._setTransform(S),e._globe=G,e._ellipsoid=E;var P=E.maximumRadius;e._rotateFactor=1/P,e._rotateRateRangeAdjustment=P}(e,r,o)):function(e,r,o){var n,a,l=e._scene,h=l.camera,g=i.UNIT_X;if(t.equals(r,e._tiltCenterMousePosition))n=i.clone(e._tiltCenter,Se);else{if(h.position.z<e._minimumPickingTerrainHeight&&(n=fe(e,r,Se)),!s(n)){var p,C=(a=h.getPickRay(r,Ee)).origin,A=a.direction,I=i.dot(g,A);if(Math.abs(I)>f.EPSILON6&&(p=-i.dot(g,C)/I),!s(p)||p<=0)return e._looking=!0,Rt(e,r,o),void t.clone(r,e._tiltCenterMousePosition);n=i.multiplyByScalar(A,p,Se),i.add(C,n,n)}t.clone(r,e._tiltCenterMousePosition),i.clone(n,e._tiltCenter)}var b=l.canvas,w=Ge;w.x=b.clientWidth/2,w.y=e._tiltCenterMousePosition.y,a=h.getPickRay(w,Ee);var G=i.clone(i.ZERO,Ne);G.x=n.x;var E=y.fromPointNormal(G,g,Le),S=c.rayPlane(a,E,Pe),P=h._projection,T=P.ellipsoid;i.fromElements(n.y,n.z,n.x,n);var x=P.unproject(n,Re);T.cartographicToCartesian(x,n);var N,L=_.eastNorthUpToFixedFrame(n,T,Te);s(S)?(i.fromElements(S.y,S.z,S.x,S),x=P.unproject(S,Re),T.cartographicToCartesian(x,S),N=_.eastNorthUpToFixedFrame(S,T,xe)):N=L;var M=e._globe,R=e._ellipsoid;e._globe=void 0,e._ellipsoid=u.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var O=i.UNIT_Z,F=m.clone(h.transform,Oe);h._setTransform(L);var D=i.cross(i.UNIT_Z,i.normalize(h.position,Me),Me),k=i.dot(h.right,D);if(it(e,r,o,O,!1,!0),h._setTransform(N),k<0){o.startPosition.y>o.endPosition.y&&(O=void 0);var U=h.constrainedAxis;h.constrainedAxis=void 0,it(e,r,o,O,!0,!1),h.constrainedAxis=U}else it(e,r,o,O,!0,!1);if(s(h.constrainedAxis)){var B=i.cross(h.direction,h.constrainedAxis,ke);i.equalsEpsilon(B,i.ZERO,f.EPSILON6)||(i.dot(B,h.right)<0&&i.negate(B,B),i.cross(B,h.direction,h.up),i.cross(h.direction,h.up,h.right),i.normalize(h.up,h.up),i.normalize(h.right,h.right))}h._setTransform(F),e._globe=M,e._ellipsoid=R;var W=R.maximumRadius;e._rotateFactor=1/W,e._rotateRateRangeAdjustment=W;var V=i.clone(h.positionWC,Me);if(h._adjustHeightForTerrain(),!i.equals(h.positionWC,V)){h._setTransform(N),h.worldToCameraCoordinatesPoint(V,V);var j=i.magnitudeSquared(V);i.magnitudeSquared(h.position)>j&&(i.normalize(h.position,h.position),i.multiplyByScalar(h.position,Math.sqrt(j),h.position));var H=i.angleBetween(V,h.position),z=i.cross(V,h.position,V);i.normalize(z,z);var q=v.fromAxisAngle(z,H,Fe),X=d.fromQuaternion(q,De);d.multiplyByVector(X,h.direction,h.direction),d.multiplyByVector(X,h.up,h.up),i.cross(h.direction,h.up,h.right),i.cross(h.right,h.direction,h.up),h._setTransform(F)}}(e,r,o)}}var Be=new t,We=new A,Ve=new i;function je(e,t,r){s(r.distance)&&(r=r.distance);var o=e._scene,n=o.camera,a=o.canvas,l=Be;l.x=a.clientWidth/2,l.y=a.clientHeight/2;var u,h,c=n.getPickRay(l,We);if(n.position.z<e._minimumPickingTerrainHeight&&(u=fe(e,l,Ve)),s(u))h=i.distance(c.origin,u);else{var g=i.UNIT_X,p=c.origin,f=c.direction;h=-i.dot(g,p)/i.dot(g,f)}ie(e,t,r,e._zoomFactor,h)}var He=new A,ze=new y(i.UNIT_X,0),qe=new i,Xe=new i,Ye=new i;function Ke(e,t,r){var o=e._scene,n=o.camera,a=fe(e,r.startPosition,Ye);if(s(a)){var l=r.endPosition,u=n.getPickRay(l,He),h=i.clone(n.direction,Xe);o.mode===G.COLUMBUS_VIEW&&i.fromElements(h.z,h.x,h.y,h);var g=y.fromPointNormal(a,h,ze),p=c.rayPlane(u,g,qe);s(p)&&(h=i.subtract(a,p,h),o.mode===G.COLUMBUS_VIEW&&i.fromElements(h.y,h.z,h.x,h),i.add(n.position,h,n.position))}}var Qe=new i,Ze=new o,Je=new i,$e=new u,et=new i;function tt(e,r,o){var n=e._scene.camera;if(m.equals(n.transform,m.IDENTITY)){var a,l,h,c=e._ellipsoid.geodeticSurfaceNormal(n.position,et),g=e._ellipsoid.cartesianToCartographic(n.positionWC,Ze).height,p=e._globe;if(s(p)&&g<e._minimumPickingTerrainHeight&&(h=fe(e,o.startPosition,Ye),s(h))){var d=n.getPickRay(o.startPosition,ce),C=e._ellipsoid.geodeticSurfaceNormal(h);Math.abs(i.dot(d.direction,C))<.05&&!e._looking&&(e._rotating=!1,e._strafing=!0)}t.equals(r,e._rotateMousePosition)?e._looking?Rt(e,r,o,c):e._rotating?it(e,r,o):e._strafing?(i.clone(h,e._strafeStartPosition),Ke(e,0,o)):(a=i.magnitude(e._rotateStartPosition),(l=Je).x=l.y=l.z=a,ct(e,r,o,u.fromCartesian3(l,$e))):(e._looking=!1,e._rotating=!1,e._strafing=!1,s(p)&&g<e._minimumPickingTerrainHeight?s(h)?i.magnitude(n.position)<i.magnitude(h)?(i.clone(h,e._strafeStartPosition),e._strafing=!0,Ke(e,0,o)):(a=i.magnitude(h),(l=Je).x=l.y=l.z=a,ct(e,r,o,u.fromCartesian3(l,$e)),i.clone(h,e._rotateStartPosition)):(e._looking=!0,Rt(e,r,o,c)):s(n.pickEllipsoid(o.startPosition,e._ellipsoid,Qe))?(ct(e,r,o,e._ellipsoid),i.clone(Qe,e._rotateStartPosition)):g>e._minimumTrackBallHeight?(e._rotating=!0,it(e,r,o)):(e._looking=!0,Rt(e,r,o,c)),t.clone(r,e._rotateMousePosition))}else o&&o.startPosition&&o.endPosition&&(r=o.endPosition,o.endPosition=o.startPosition,o.startPosition=r,o.endPosition.x=(o.startPosition.x+o.endPosition.x)/2,o.endPosition.y=(o.startPosition.y+o.endPosition.y)/2),n.pitch>f.clamp(e.constrainedPitch,-f.PI,0)&&o.startPosition.y-o.endPosition.y>=0?it(e,r,o,i.UNIT_Z,!1,!0):it(e,r,o)}function it(e,t,r,o,a,l){a=n(a,!1),l=n(l,!1);var u=e._scene,h=u.camera,c=u.canvas,g=h.constrainedAxis;s(o)&&(h.constrainedAxis=o);var p=i.magnitude(h.position),f=e._rotateFactor*(p-e._rotateRateRangeAdjustment);f>e._maximumRotateRate&&(f=e._maximumRotateRate),f<e._minimumRotateRate&&(f=e._minimumRotateRate);var d=(r.startPosition.x-r.endPosition.x)/c.clientWidth,m=(r.startPosition.y-r.endPosition.y)/c.clientHeight;d=Math.min(d,e.maximumMovementRatio),m=Math.min(m,e.maximumMovementRatio);var C=f*d*Math.PI*2,y=f*m*Math.PI;a||h.rotateRight(-C),l||h.rotateUp(y),h.constrainedAxis=g}var rt=r.clone(r.UNIT_W),ot=r.clone(r.UNIT_W),nt=new i,st=new i,at=new i,lt=new i,ut=new t,ht=new t;function ct(e,r,o,n){var a=e._scene.camera,l=t.clone(o.startPosition,ut),u=t.clone(o.endPosition,ht),h=a.pickEllipsoid(l,n,rt),c=a.pickEllipsoid(u,n,ot);if(!s(h)||!s(c))return e._rotating=!0,void it(e,0,o);if(h=a.worldToCameraCoordinates(h,h),c=a.worldToCameraCoordinates(c,c),s(a.constrainedAxis)){var g=a.constrainedAxis,p=i.mostOrthogonalAxis(g,nt);i.cross(p,g,p),i.normalize(p,p);var d=i.cross(g,p,st),m=i.magnitude(h),C=i.dot(g,h),y=Math.acos(C/m),v=i.multiplyByScalar(g,C,at);i.subtract(h,v,v),i.normalize(v,v);var A=i.magnitude(c),_=i.dot(g,c),I=Math.acos(_/A),b=i.multiplyByScalar(g,_,lt);i.subtract(c,b,b),i.normalize(b,b);var w=Math.acos(i.dot(v,p));i.dot(v,d)<0&&(w=f.TWO_PI-w);var G=Math.acos(i.dot(b,p));i.dot(b,d)<0&&(G=f.TWO_PI-G);var E,S=w-G;E=i.equalsEpsilon(g,a.position,f.EPSILON2)?a.right:i.cross(g,a.position,nt);var P,T=i.cross(g,E,nt),x=i.dot(T,i.subtract(h,g,st)),N=i.dot(T,i.subtract(c,g,st));P=x>0&&N>0?I-y:x>0&&N<=0?i.dot(a.position,g)>0?-y-I:y+I:y-I,a.rotateRight(S),a.rotateUp(P)}else{i.normalize(h,h),i.normalize(c,c);var L=i.dot(h,c),M=i.cross(h,c,nt);if(L<1&&!i.equalsEpsilon(M,i.ZERO,f.EPSILON14)){var R=Math.acos(L);a.rotate(M,R)}}}var gt=new i,pt=new o;function ft(e,t,r){s(r.distance)&&(r=r.distance);var o=e._ellipsoid,n=e._scene,a=n.camera,l=n.canvas,u=Be;u.x=l.clientWidth/2,u.y=l.clientHeight/2;var h,c,g=a.getPickRay(u,We),p=o.cartesianToCartographic(a.position,pt).height;p<e._minimumPickingTerrainHeight&&(h=fe(e,u,Ve)),c=s(h)?i.distance(g.origin,h):p;var f=i.normalize(a.position,gt);ie(e,t,r,e._zoomFactor,c,i.dot(f,a.direction))}var dt=new t,mt=new A,Ct=new i,yt=new i,vt=new m,At=new m,_t=new m,It=new v,bt=new d,wt=new o,Gt=new i;function Et(e,r,o){var n=e._scene.camera;if(o&&o.startPosition&&o.endPosition&&(r=o.endPosition,o.endPosition=o.startPosition,o.startPosition=r,o.endPosition.x=(o.startPosition.x+o.endPosition.x)/2,o.endPosition.y=(o.startPosition.y+o.endPosition.y)/2),m.equals(n.transform,m.IDENTITY))if(s(o.angleAndHeight)&&(o=o.angleAndHeight),t.equals(r,e._tiltCenterMousePosition)||(e._tiltOnEllipsoid=!1,e._looking=!1),e._looking)Rt(e,r,o,e._ellipsoid.geodeticSurfaceNormal(n.position,Gt));else{var a=e._ellipsoid.cartesianToCartographic(n.position,wt);e._tiltOnEllipsoid||a.height>e._minimumCollisionTerrainHeight?(e._tiltOnEllipsoid=!0,function(e,r,o){var n=e._ellipsoid,a=e._scene,l=a.camera,h=.25*e.minimumZoomDistance,g=n.cartesianToCartographic(l.positionWC,St).height;if(!(g-h-1<f.EPSILON3&&o.endPosition.y-o.startPosition.y<0)){var p=a.canvas,d=dt;d.x=p.clientWidth/2,d.y=p.clientHeight/2;var C,y=l.getPickRay(d,mt),v=c.rayEllipsoid(y,n);if(s(v))C=A.getPoint(y,v.start,Ct);else{if(!(g>e._minimumTrackBallHeight)){e._looking=!0;var I=e._ellipsoid.geodeticSurfaceNormal(l.position,Gt);return Rt(e,r,o,I),void t.clone(r,e._tiltCenterMousePosition)}var b=c.grazingAltitudeLocation(y,n);if(!s(b))return;var w=n.cartesianToCartographic(b,wt);w.height=0,C=n.cartographicToCartesian(w,Ct)}var G=_.eastNorthUpToFixedFrame(C,n,vt),E=e._globe,S=e._ellipsoid;e._globe=void 0,e._ellipsoid=u.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var P=m.clone(l.transform,_t);l._setTransform(G),it(e,0,o,i.UNIT_Z),l._setTransform(P),e._globe=E,e._ellipsoid=S;var T=S.maximumRadius;e._rotateFactor=1/T,e._rotateRateRangeAdjustment=T}}(e,r,o)):function(e,r,o){var n,a,l,h=e._ellipsoid,g=e._scene,p=g.camera;if(t.equals(r,e._tiltCenterMousePosition))n=i.clone(e._tiltCenter,Ct);else{if(n=fe(e,r,Ct),!s(n)){if(a=p.getPickRay(r,mt),l=c.rayEllipsoid(a,h),!s(l)){if(h.cartesianToCartographic(p.position,wt).height<=e._minimumTrackBallHeight){e._looking=!0;var C=e._ellipsoid.geodeticSurfaceNormal(p.position,Gt);Rt(e,r,o,C),t.clone(r,e._tiltCenterMousePosition)}return}n=A.getPoint(a,l.start,Ct)}t.clone(r,e._tiltCenterMousePosition),i.clone(n,e._tiltCenter)}var y=g.canvas,I=dt;I.x=y.clientWidth/2,I.y=e._tiltCenterMousePosition.y,a=p.getPickRay(I,mt);var b=i.magnitude(n),w=i.fromElements(b,b,b,Je),G=u.fromCartesian3(w,$e);if(l=c.rayEllipsoid(a,G),s(l)){var E=i.magnitude(a.origin)>b?l.start:l.stop,S=A.getPoint(a,E,yt),P=_.eastNorthUpToFixedFrame(n,h,vt),T=_.eastNorthUpToFixedFrame(S,G,At),x=e._globe,N=e._ellipsoid;e._globe=void 0,e._ellipsoid=u.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var L=i.UNIT_Z,M=m.clone(p.transform,_t);p._setTransform(P);var R=i.cross(S,p.positionWC,ke),O=i.dot(p.rightWC,R);if(it(e,0,o,L,!1,!0),p._setTransform(T),O<0){o.startPosition.y>o.endPosition.y&&(L=void 0);var F=p.constrainedAxis;p.constrainedAxis=void 0,it(e,0,o,L,!0,!1),p.constrainedAxis=F}else(p.pitch<f.clamp(e.constrainedPitch,-f.PI,0)||o.startPosition.y-o.endPosition.y<=0)&&it(e,0,o,L,!0,!1);if(s(p.constrainedAxis)){var D=i.cross(p.direction,p.constrainedAxis,ke);i.equalsEpsilon(D,i.ZERO,f.EPSILON6)||(i.dot(D,p.right)<0&&i.negate(D,D),i.cross(D,p.direction,p.up),i.cross(p.direction,p.up,p.right),i.normalize(p.up,p.up),i.normalize(p.right,p.right))}p._setTransform(M),e._globe=x,e._ellipsoid=N;var k=N.maximumRadius;e._rotateFactor=1/k,e._rotateRateRangeAdjustment=k;var U=i.clone(p.positionWC,ke);if(p._adjustHeightForTerrain(),!i.equals(p.positionWC,U)){p._setTransform(T),p.worldToCameraCoordinatesPoint(U,U);var B=i.magnitudeSquared(U);i.magnitudeSquared(p.position)>B&&(i.normalize(p.position,p.position),i.multiplyByScalar(p.position,Math.sqrt(B),p.position));var W=i.angleBetween(U,p.position),V=i.cross(U,p.position,U);i.normalize(V,V);var j=v.fromAxisAngle(V,W,It),H=d.fromQuaternion(j,bt);d.multiplyByVector(H,p.direction,p.direction),d.multiplyByVector(H,p.up,p.up),i.cross(p.direction,p.up,p.right),i.cross(p.right,p.direction,p.up),p._setTransform(M)}}}(e,r,o)}}var St=new o,Pt=new t,Tt=new t,xt=new A,Nt=new A,Lt=new i,Mt=new i;function Rt(e,t,r,o){var a=e._scene.camera,l=Pt;l.x=r.startPosition.x,l.y=0;var u=Tt;u.x=r.endPosition.x,u.y=0;var h,c,g=a.getPickRay(l,xt),p=a.getPickRay(u,Nt),d=0;a.frustum instanceof C?(h=g.origin,c=p.origin,i.add(a.direction,h,h),i.add(a.direction,c,c),i.subtract(h,a.position,h),i.subtract(c,a.position,c),i.normalize(h,h),i.normalize(c,c)):(h=g.direction,c=p.direction);var m=i.dot(h,c);m<1&&(d=Math.acos(m)),d=r.startPosition.x>r.endPosition.x?-d:d;var y=e._horizontalRotationAxis;if(s(o)?a.look(o,-d):s(y)?a.look(y,-d):a.lookLeft(d),l.x=0,l.y=r.startPosition.y,u.x=0,u.y=r.endPosition.y,g=a.getPickRay(l,xt),p=a.getPickRay(u,Nt),d=0,a.frustum instanceof C?(h=g.origin,c=p.origin,i.add(a.direction,h,h),i.add(a.direction,c,c),i.subtract(h,a.position,h),i.subtract(c,a.position,c),i.normalize(h,h),i.normalize(c,c)):(h=g.direction,c=p.direction),(m=i.dot(h,c))<1&&(d=Math.acos(m)),d=r.startPosition.y>r.endPosition.y?-d:d,o=n(o,y),s(o)){var v=a.direction,A=i.negate(o,Lt),_=i.equalsEpsilon(v,o,f.EPSILON2),I=i.equalsEpsilon(v,A,f.EPSILON2);if(_||I)(_&&d<0||I&&d>0)&&a.look(a.right,-d);else{m=i.dot(v,o);var b=f.acosClamped(m);d>0&&d>b&&(d=b-f.EPSILON4),m=i.dot(v,A),b=f.acosClamped(m),d<0&&-d>b&&(d=-b+f.EPSILON4);var w=i.cross(o,v,Mt);a.look(w,d)}}else a.lookUp(d)}P.prototype.update=function(){m.equals(this._scene.camera.transform,m.IDENTITY)?(this._globe=this._scene.globe,this._ellipsoid=s(this._globe)?this._globe.ellipsoid:this._scene.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=u.UNIT_SPHERE),this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight*this._scene.terrainExaggeration,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight*this._scene.terrainExaggeration,this._minimumTrackBallHeight=this.minimumTrackBallHeight*this._scene.terrainExaggeration;var e=this._ellipsoid.maximumRadius;this._rotateFactor=1/e,this._rotateRateRangeAdjustment=e;var t,r,o,n=this._scene.mode;n===G.SCENE2D?(o=(r=this)._scene.mapMode2D===w.ROTATE,m.equals(m.IDENTITY,r._scene.camera.transform)?(N(r,r.enableTranslate,r.translateEventTypes,se,r.inertiaTranslate,"_lastInertiaTranslateMovement"),N(r,r.enableZoom,r.zoomEventTypes,ae,r.inertiaZoom,"_lastInertiaZoomMovement"),o&&N(r,r.enableRotate,r.tiltEventTypes,he,r.inertiaSpin,"_lastInertiaTiltMovement")):(N(r,r.enableZoom,r.zoomEventTypes,ae,r.inertiaZoom,"_lastInertiaZoomMovement"),o&&N(r,r.enableRotate,r.translateEventTypes,he,r.inertiaSpin,"_lastInertiaSpinMovement"))):n===G.COLUMBUS_VIEW?(this._horizontalRotationAxis=i.UNIT_Z,function(e){var t=e._scene.camera;if(m.equals(m.IDENTITY,t.transform)){var i=e._tweens;if(e._aggregator.anyButtonDown&&i.removeAll(),N(e,e.enableTilt,e.tiltEventTypes,Ue,e.inertiaSpin,"_lastInertiaTiltMovement"),N(e,e.enableTranslate,e.translateEventTypes,we,e.inertiaTranslate,"_lastInertiaTranslateMovement"),N(e,e.enableZoom,e.zoomEventTypes,je,e.inertiaZoom,"_lastInertiaZoomMovement"),N(e,e.enableLook,e.lookEventTypes,Rt),!(e._aggregator.anyButtonDown||s(e._lastInertiaZoomMovement)&&e._lastInertiaZoomMovement.active||s(e._lastInertiaTranslateMovement)&&e._lastInertiaTranslateMovement.active||i.contains(e._tween))){var r=t.createCorrectPositionTween(e.bounceAnimationTime);s(r)&&(e._tween=i.add(r))}i.update()}else N(e,e.enableRotate,e.rotateEventTypes,it,e.inertiaSpin,"_lastInertiaSpinMovement"),N(e,e.enableZoom,e.zoomEventTypes,ft,e.inertiaZoom,"_lastInertiaZoomMovement")}(this)):n===G.SCENE3D&&(this._horizontalRotationAxis=void 0,N(t=this,t.enableRotate,t.rotateEventTypes,tt,t.inertiaSpin,"_lastInertiaSpinMovement"),N(t,t.enableZoom,t.zoomEventTypes,ft,t.inertiaZoom,"_lastInertiaZoomMovement"),N(t,t.enableTilt,t.tiltEventTypes,Et,2,"_lastInertiaTiltMovement"),N(t,t.enableLook,t.lookEventTypes,Rt)),this._aggregator.reset()},P.prototype.isDestroyed=function(){return!1},P.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),a(this)},e.GeoScreenSpaceCameraController=P}(window.Cesium),function(e){var t=e.GeoWalkerCamera=function(i){this.viewer=i.viewer,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.stepSize=e.defaultValue(i.stepSize,1),this.rotateSize=e.defaultValue(i.rotateSize,5),this.manHeight=e.defaultValue(i.manHeight,1.6),this.state=t.stateType.UNKNOWN,this._lockCamera=!1,this._readyCamera=!1,this._ellipsoid=this.scene.globe.ellipsoid,this._walkQueue=new function(){var e=[],t=0;this.push=function(t){return this.size()>=10&&this.pop(),e.push(t),!0},this.pop=function(){return e.shift()},this.getFront=function(){return e[0]},this.getRear=function(){return e[e.length-1]},this.clear=function(){e=[]},this.size=function(){return e.length},this.getAvgHeight=function(){for(var t=0,i=e.length,r=0;r<i;r++)t+=e[r].height;return t/i},this.getLatelyHeight=function(){return e.length>0?e[e.length-1].height:null},this.getDropThreshold=function(t){return e.length>0&&Math.abs(this.getLatelyHeight()-t.height)>4.5},this.preventFalling=function(e){this.getDropThreshold(e)&&(t>20?t=0:t>3?(e.height=this.getAvgHeight(),t++):(e.height=this.getLatelyHeight(),t++)),this.push(e)}}};t.prototype.setState=function(t){n()(e.GeoWalkerCamera.stateType).filter((function(i){return e.GeoWalkerCamera.stateType[i]===t})).length>0&&(this.state=t)},t.prototype.activate=function(){this.camera._hooker=this,this.scene.logarithmicDepthBuffer=!1,e.Camera.prototype._hookUpdate=e.Camera.prototype.update,e.Camera.prototype.update=function(e){this._hookUpdate(e),this._hooker&&this._hooker.raiseUpdate(this)}},t.prototype.unactivate=function(){e.Camera.prototype._hookUpdate&&(e.Camera.prototype.update=e.Camera.prototype._hookUpdate),delete this.camera._hooker&&delete this.camera.__proto__._hookUpdate},t.prototype.raiseUpdate=function(e){if(!(!this._readyCamera||this._lockCamera||this.state<1))switch(this.state){case t.stateType.FORWARD:this.computeForeward(e);break;case t.stateType.BACKWARD:this.computeBackward(e);break;case t.stateType.LEFTWARD:case t.stateType.RIGHTWARD:break;case t.stateType.UPWARD:this.computeTrunUp(e);break;case t.stateType.DOWNWARD:this.computeTrunDown(e);break;case t.stateType.LEFT:this.computeTrunLeft(e);break;case t.stateType.RIGHT:this.computeTrunRight(e);break;case t.stateType.UNKNOWN:return}},t.prototype.setView=function(e){this._lockCamera=!0,this.camera.setView(e),this._lockCamera=!1,this._readyCamera=!0},t.prototype.jumpUp=function(e){this._lockCamera=!0,this.camera.moveUp(e||100),this._lockCamera=!1},t.prototype.computeInitialPosition=function(t){this.scene.pick(t);var i=this.scene.pickPosition(t),r=e.Cartographic.fromCartesian(i,this._ellipsoid);if(r.height>0)r.height+=this.manHeight;else{var o=this.scene.globe.getHeight(r);r.height=o>0?o+this.manHeight:1e3}this._walkQueue.preventFalling(r);var n=e.Cartesian3.fromRadians(r.longitude,r.latitude,r.height,this._ellipsoid);this._lockCamera=!0,this.camera.setView({destination:n,orientation:{heading:this.camera.heading,pitch:0,up:0}}),this._lockCamera=!1,this._readyCamera=!0},t.prototype.computeForeward=function(t){var r=new e.Cartesian3,n=t.position,u=(t.positionWC,t.directionWC.clone()),h=this.getTangentNormal(),c=e.Cartesian3.cross(u,h,s);e.Cartesian3.normalize(c,c),u=e.Cartesian3.cross(h,c,o),e.Cartesian3.normalize(u,u),e.Cartesian3.multiplyByScalar(u,1/i*this.stepSize,r),e.Cartesian3.add(n,r,n);var g=l;g.origin=n,g.direction=e.Cartesian3.negate(h,a);var p=this.scene.pickFromRay(g);if(p&&p.position&&p.object)n=e.Cartesian3.clone(p.position,n),(f=e.Cartographic.fromCartesian(n,this._ellipsoid)).height+=this.manHeight,this._walkQueue.preventFalling(f),n=e.Cartesian3.fromRadians(f.longitude,f.latitude,f.height,this._ellipsoid);else{var f=e.Cartographic.fromCartesian(n,this._ellipsoid),d=this.scene.globe.getHeight(f);f.height=d>0?d+this.manHeight:f.height,this._walkQueue.preventFalling(f),n=e.Cartesian3.fromRadians(f.longitude,f.latitude,f.height,this._ellipsoid)}this._lockCamera=!0,t.setView({destination:n,orientation:{heading:t.heading,pitch:t.pitch,up:t.up}}),this._lockCamera=!1},t.prototype.computeBackward=function(t){var r=new e.Cartesian3,n=t.position,u=(t.positionWC,t.directionWC.clone()),h=this.getTangentNormal(),c=e.Cartesian3.cross(u,h,s);e.Cartesian3.normalize(c,c),u=e.Cartesian3.cross(h,c,o),e.Cartesian3.normalize(u,u),u=e.Cartesian3.negate(u,o),e.Cartesian3.multiplyByScalar(u,1/i*this.stepSize,r),e.Cartesian3.add(n,r,n);var g=l;g.origin=n,g.direction=e.Cartesian3.negate(h,a);var p=this.scene.pickFromRay(g);if(p&&p.position&&p.object)n=e.Cartesian3.clone(p.position,n),(f=e.Cartographic.fromCartesian(n,this._ellipsoid)).height+=this.manHeight,this._walkQueue.preventFalling(f),n=e.Cartesian3.fromRadians(f.longitude,f.latitude,f.height,this._ellipsoid);else{var f=e.Cartographic.fromCartesian(n,this._ellipsoid),d=this.scene.globe.getHeight(f);f.height=d>0?d+this.manHeight:f.height,this._walkQueue.preventFalling(f),n=e.Cartesian3.fromRadians(f.longitude,f.latitude,f.height,this._ellipsoid)}this._lockCamera=!0,t.setView({destination:n,orientation:{heading:t.heading,pitch:t.pitch,up:t.up}}),this._lockCamera=!1},t.prototype.computeLeftward=function(e){},t.prototype.computeRightward=function(e){},t.prototype.computeTrunLeft=function(t){t.look(this.getTangentNormal(),-e.Math.toRadians(e.defaultValue(this.rotateSize,5))/i)},t.prototype.computeTrunRight=function(t){t.look(this.getTangentNormal(),e.Math.toRadians(e.defaultValue(this.rotateSize,5))/i)},t.prototype.computeTrunUp=function(t){t.look(e.Cartesian3.cross(t.directionWC.clone(),this.getTangentNormal(),s),-e.Math.toRadians(e.defaultValue(this.rotateSize,5))/i)},t.prototype.computeTrunDown=function(t){t.look(e.Cartesian3.cross(t.directionWC.clone(),this.getTangentNormal(),s),e.Math.toRadians(e.defaultValue(this.rotateSize,5))/i)},t.prototype.getTangentNormal=function(){var t=e.Transforms.eastNorthUpToFixedFrame(this.camera.positionWC,this._ellipsoid,r);return new e.Cartesian3(t[8],t[9],t[10])},t.prototype.destroy=function(){e.Camera.prototype.update=e.Camera.prototype._hookUpdate,delete this.camera._hooker&&delete this.camera.__proto__._hookUpdate,this.scene.logarithmicDepthBuffer=!0},t.stateType={UNKNOWN:0,FORWARD:1,BACKWARD:2,LEFTWARD:3,RIGHTWARD:4,UPWARD:5,DOWNWARD:6,LEFT:7,RIGHT:8};var i=40,r=new e.Matrix4,o=new e.Cartesian3,s=new e.Cartesian3,a=new e.Cartesian3,l=new e.Ray}(window.Cesium),function(e){var t=e.defaultValue;function i(i){i=t(i,t.EMPTY_OBJECT),this.proxy=i.proxy,this.viewer=i.viewer,this.url=i.url,this.metadata=i.metadata,this.roadMetadata=i.roadMetadata,this.roadUrl=i.roadUrl,this.labelGraphics=i.labelGraphics?i.labelGraphics:{},this.billboardGraphics=i.billboardGraphics?i.billboardGraphics:{},this.aotuCollide=!!i.aotuCollide,this.collisionPadding=i.collisionPadding?i.collisionPadding:[3,5,3,5],this.serverFirstStyle=!!i.serverFirstStyle,this.subdomains=i.subdomains,e.isArray(this.subdomains)?this.subdomains=this.subdomains.slice():e.defined(this.subdomains)&&this.subdomains.length>0?this.subdomains=this.subdomains.split(""):this.subdomains=["a","b","c"],this.tileCache=[],this.labelCache=[],this._isInitial=!0,this._latelyGrid=[],this._latelyRefreshStamp=0,this._latelyCollisionStamp=0;var r=e.createGuid();this._UUID="GEO_WTFS_LABEL_"+r,this._UUIDRoad="GEO_WTFS_LABEL_ROAD_"+r,this.viewer.camera.percentageChanged=.1,this.bindEvent()}function r(e,t){return t.minX>=e.minX&&t.minX<=e.maxX&&t.minY>=e.minY&&t.minY<=e.maxY||t.maxX>=e.minX&&t.maxX<=e.maxX&&t.maxY>=e.minY&&t.maxY<=e.maxY||t.minX>=e.minX&&t.minX<=e.maxX&&t.maxY>=e.minY&&t.maxY<=e.maxY||t.maxX>=e.minX&&t.maxX<=e.maxX&&t.minY>=e.minY&&t.minY<=e.maxY}function o(e,t){var i=e.x,r=e.y,o=e.width,n=e.height,s=t.x,a=t.y,l=t.width,u=t.height;return!(i>=s&&i>=s+l||i<=s&&i+o<=s||r>=a&&r>=a+u||r<=a&&r+n<=a)}e.defined,e.defineProperties(i.prototype,{}),i.prototype.getCacheTile=function(e,t,i,r){for(var o=0;o<this.tileCache.length;o++)if(this.tileCache[o].x===e&&this.tileCache[o].y===t&&this.tileCache[o].z===i&&this.tileCache[o].t===r)return this.tileCache[o];return null},i.prototype.addCacheTile=function(e){this.tileCache.length>999&&this.tileCache.splice(0,500),this.removeCacheTile(e.x,e.y,e.z,e.t),this.tileCache.push(e)},i.prototype.removeCacheTile=function(e,t,i,r){for(var o=0;o<this.tileCache.length;o++)if(this.tileCache[o].x===e&&this.tileCache[o].y===t&&this.tileCache[o].z===i&&this.tileCache[o].t===r){this.tileCache.splice(o,1);break}},i.prototype.getCacheLabel=function(e){for(var t=0;t<this.labelCache.length;t++)if(this.labelCache[t].name===this._UUID&&this.labelCache[t].oid===e)return this.labelCache[t];return null},i.prototype.addCacheLabel=function(e){this.labelCache.length>999&&this.labelCache.splice(0,250),this.removeCacheLabel(e.oid),e.timestamp=(new Date).getTime(),this.labelCache.push(e)},i.prototype.removeCacheLabel=function(e){for(var t=0;t<this.labelCache.length;t++)if(this.labelCache[t].name===this._UUID&&this.labelCache[t].oid===e){this.labelCache.splice(t,1);break}},i.prototype.getTileUrl=function(){return(this.proxy?this.proxy.proxy:"")+this.url+"/GetTiles?lxys={z},{x},{y}"},i.prototype.getIcoUrl=function(){return(this.proxy?this.proxy.proxy:"")+this.url+"/GetIcon?id={id}"},i.prototype.getRoadTileUrl=function(){return(this.proxy?this.proxy.proxy:"")+this.roadUrl},i.prototype._moveEnd=function(){var e=this;clearTimeout(this._timer);var t=this.viewer.scene.globe._surface;if(0==t._tilesToRender.length||t._tileLoadQueueHigh.length>3)this._timer=setTimeout((function(){e._moveEnd()}),100);else{var i=this.getTilesToRender();if(this.compareArray(i,this._latelyGrid))return;this._queueCall(i),e.delaySynchronous()}},i.prototype._changed=function(){var e=(new Date).getTime(),t=e-this._latelyRefreshStamp,i=e-this._latelyCollisionStamp;t>300&&this._moveEnd(),i>100&&this.collisionDetection()},i.prototype._queueCall=function(e){var t=this;t._latelyGrid=e,t._latelyRefreshStamp=(new Date).getTime(),e.forEach((function(e,i,o){if(t.metadata&&r(t.metadata.boundBox,e.boundBox)){if(t.metadata.minLevel>e.level+1||t.metadata.maxLevel<e.level+1)return;var n=t.getCacheTile(e.x,e.y,e.level+1,0);if(n)t.addLabelAndIco(n);else{var a=t.getTileUrl().replace("{z}",e.level+1).replace("{y}",e.y).replace("{x}",e.x).replace("{s}",t.subdomains[(e.x+e.y+e.level)%t.subdomains.length]),l=new XMLHttpRequest;l.open("GET",a,!0),l.responseType="arraybuffer",l.onload=function(){if(!(l.status<200||l.status>=300)){var e=t.CutString(l.response);if(e)(i=s(e)).x=this.tile.x,i.y=this.tile.y,i.z=this.tile.z,i.t=0,t.addCacheTile(i),t.addLabelAndIco(i);else{var i={x:this.tile.x,y:this.tile.y,z:this.tile.z,t:0};t.addCacheTile(i),t.delaySynchronous()}}},l.onerror=function(e){console.error(e)},l.send(),l.tile={x:e.x,y:e.y,z:e.level+1}}}if(t.roadMetadata&&r(t.roadMetadata.boundBox,e.boundBox)){if(t.roadMetadata.minLevel>e.level+1||t.roadMetadata.maxLevel<e.level+1)return;if(n=t.getCacheTile(e.x,e.y,e.level+1,1))t.addLabelAndIco(n);else{var u=t.getRoadTileUrl().replace("{z}",e.level+1).replace("{y}",e.y).replace("{x}",e.x),h=new XMLHttpRequest;h.open("GET",u,!0),h.responseType="json",h.onload=function(){if(!(h.status<200||h.status>=300)){var e=h.response;if(e){var i={pois:e.map((function(e,t,i){return{oid:e.LabelPoint.X+"_"+e.LabelPoint.Y,name:e.Feature.properties.Name,coordinate:[e.LabelPoint.X,e.LabelPoint.Y,e.LabelPoint.Z?e.LabelPoint.Z:0]}})),x:this.tile.x,y:this.tile.y,z:this.tile.z,t:1};t.addCacheTile(i),t.addLabelAndIco(i)}else i={x:this.tile.x,y:this.tile.y,z:this.tile.z,t:1},t.addCacheTile(i),t.delaySynchronous()}},h.onerror=function(e){console.error(e)},h.send(),h.tile={x:e.x,y:e.y,z:e.level+1}}}}))},i.prototype.initTDT=function(e){var t=0,i=this;i._queueCall(e);var r=setInterval((function(){t>3&&(i._isInitial=!1,clearInterval(r)),t%2==0&&i.aotuCollide&&i.collisionDetection(),t++}),600);return i},i.prototype.getTilesToRender=function(){for(var t=this.viewer.scene.globe._surface._tilesToRender.map((function(t,i,r){return{x:t.x,y:t.y,level:t.level,boundBox:{minX:e.Math.toDegrees(t.rectangle.west),minY:e.Math.toDegrees(t.rectangle.south),maxX:e.Math.toDegrees(t.rectangle.east),maxY:e.Math.toDegrees(t.rectangle.north)}}})).sort((function(e,t){return t.level-e.level})),i=[t[0].level],r=0;r<t.length;r++)t[r].level!=i[i.length-1]&&i.push(t[r].level),i.length>4&&(t.splice(r),r--);return t},i.prototype.addLabelAndIco=function(e){if(e.pois)for(var t=0;t<e.pois.length;t++){var i=this.getCacheLabel(e.pois[t].oid);i||(i=this.createLabel(e.pois[t],e)),this.addCacheLabel(i)}this.delaySynchronous()},i.prototype.delaySynchronous=function(){var e=this;clearTimeout(e._timer2),e._timer2=setTimeout((function(){e.synchronousLabel()}),100)},i.prototype.synchronousLabel=function(){for(var e=0;e<this.labelCache.length;e++)this.labelCache[e].timestamp>=this._latelyRefreshStamp&&!this.viewer.entities.contains(this.labelCache[e])&&(this._isInitial&&this.aotuCollide&&(this.labelCache[e].show=!1),this.viewer.entities.add(this.labelCache[e]));if(!this._isInitial){for(e=0;e<this.viewer.entities.values.length;e++)!this.viewer.entities.values[e].name||this.viewer.entities.values[e].name!==this._UUID&&this.viewer.entities.values[e].name!==this._UUIDRoad||this.viewer.entities.values[e].timestamp<this._latelyRefreshStamp&&(this.viewer.entities.remove(this.viewer.entities.values[e]),e--);this.aotuCollide&&this.collisionDetection()}},i.prototype.createLabel=function(t,i){if(t){var r={show:!0,position:e.Cartesian3.fromDegrees(t.coordinate[0],t.coordinate[1],t.coordinate[2]),label:{text:t.name}};this.serverFirstStyle&&void 0!==t.fontSize?(r.label.font=t.fontSize+"px ",void 0!==t.fontNameIndex&&i.stringTable&&i.stringTable[t.fontNameIndex]?r.label.font+=i.stringTable[t.fontNameIndex]:r.label.font+="sans-serif",this.labelGraphics.bold&&(r.label.font="bold "+r.label.font)):this.labelGraphics.font&&(r.label.font=this.labelGraphics.font),this.serverFirstStyle&&void 0!==t.fontColor?r.label.fillColor=e.Color.fromCssColorString(this.HexadecimalConversion(t.fontColor)):this.labelGraphics.fillColor&&(r.label.fillColor=this.labelGraphics.fillColor),this.serverFirstStyle&&void 0!==t.shiningColor?r.label.outlineColor=e.Color.fromCssColorString(this.HexadecimalConversion(t.shiningColor)):this.labelGraphics.outlineColor&&(r.label.outlineColor=this.labelGraphics.outlineColor),this.serverFirstStyle&&void 0!==t.outlineWidth?r.label.outlineWidth=t.outlineWidth:void 0!==this.labelGraphics.outlineWidth&&(r.label.outlineWidth=this.labelGraphics.outlineWidth),this.serverFirstStyle&&void 0!==t.showBackground?r.label.showBackground=t.showBackground:void 0!==this.labelGraphics.showBackground&&(r.label.showBackground=this.labelGraphics.showBackground),this.serverFirstStyle&&void 0!==t.backgroundColor?r.label.backgroundColor=t.backgroundColor:void 0!==this.labelGraphics.backgroundColor&&(r.label.backgroundColor=this.labelGraphics.backgroundColor),this.serverFirstStyle&&void 0!==t.backgroundPadding?r.label.backgroundPadding=t.backgroundPadding:void 0!==this.labelGraphics.backgroundPadding&&(r.label.backgroundPadding=this.labelGraphics.backgroundPadding),i.t?(r.label.verticalOrigin=e.VerticalOrigin.CENTER,r.label.horizontalOrigin=e.HorizontalOrigin.CENTER):(this.serverFirstStyle&&void 0!==t.verticalOrigin?r.label.verticalOrigin=t.verticalOrigin:void 0!==this.labelGraphics.verticalOrigin&&(r.label.verticalOrigin=this.labelGraphics.verticalOrigin),this.serverFirstStyle&&void 0!==t.horizontalOrigin?r.label.horizontalOrigin=t.horizontalOrigin:void 0!==this.labelGraphics.horizontalOrigin&&(r.label.horizontalOrigin=this.labelGraphics.horizontalOrigin)),this.serverFirstStyle&&void 0!==t.eyeOffset?r.label.eyeOffset=t.eyeOffset:void 0!==this.labelGraphics.eyeOffset&&(r.label.eyeOffset=this.labelGraphics.eyeOffset),this.serverFirstStyle&&void 0!==t.pixelOffset?r.label.pixelOffset=t.pixelOffset:void 0!==this.labelGraphics.pixelOffset&&(r.label.pixelOffset=this.labelGraphics.pixelOffset),this.serverFirstStyle&&void 0!==t.style?r.label.style=t.style:void 0!==this.labelGraphics.style&&(r.label.style=this.labelGraphics.style),this.serverFirstStyle&&void 0!==t.scale?r.label.scale=t.scale:void 0!==this.labelGraphics.scale&&(r.label.scale=this.labelGraphics.scale),r.label.disableDepthTestDistance=this.labelGraphics.disableDepthTestDistance,void 0!==t.symbolID&&t.symbolID>-1&&(r.billboard={image:this.getIcoUrl().replace("{id}",t.symbolID).replace("{s}",this.subdomains[(i.x+i.y+i.z)%this.subdomains.length])},this.serverFirstStyle&&void 0!==t.displayHeight?(r.billboard.width=t.displayHeight,r.billboard.height=t.displayHeight):void 0===this.billboardGraphics.width&&void 0===this.billboardGraphics.height||(r.billboard.width=this.billboardGraphics.width,r.billboard.height=this.billboardGraphics.height),i.t?(r.label.verticalOrigin=e.VerticalOrigin.BOTTOM,r.label.horizontalOrigin=e.HorizontalOrigin.CENTER):(this.serverFirstStyle&&void 0!==t.verticalOrigin?r.billboard.verticalOrigin=t.verticalOrigin:void 0!==this.billboardGraphics.verticalOrigin&&(r.billboard.verticalOrigin=this.billboardGraphics.verticalOrigin),this.serverFirstStyle&&void 0!==t.horizontalOrigin?r.billboard.horizontalOrigin=t.horizontalOrigin:void 0!==this.billboardGraphics.horizontalOrigin&&(r.billboard.horizontalOrigin=this.billboardGraphics.horizontalOrigin)),this.serverFirstStyle&&void 0!==t.eyeOffset?r.billboard.eyeOffset=t.eyeOffset:void 0!==this.billboardGraphics.eyeOffset&&(r.billboard.eyeOffset=this.billboardGraphics.eyeOffset),this.serverFirstStyle&&void 0!==t.pixelOffset?r.billboard.pixelOffset=t.pixelOffset:void 0!==this.billboardGraphics.pixelOffset&&(r.billboard.pixelOffset=this.billboardGraphics.pixelOffset),this.serverFirstStyle&&void 0!==t.rotation?r.billboard.rotation=t.rotation:void 0!==this.billboardGraphics.rotation&&(r.billboard.rotation=this.billboardGraphics.rotation),this.serverFirstStyle&&void 0!==t.alignedAxis?r.billboard.alignedAxis=t.alignedAxis:void 0!==this.billboardGraphics.alignedAxis&&(r.billboard.alignedAxis=this.billboardGraphics.alignedAxis),this.serverFirstStyle&&void 0!==t.color?r.billboard.color=t.color:void 0!==this.billboardGraphics.color&&(r.billboard.color=this.billboardGraphics.color),this.serverFirstStyle&&void 0!==t.scale?r.billboard.scale=t.scale:void 0!==this.billboardGraphics.scale&&(r.billboard.scale=this.billboardGraphics.scale),r.billboard.disableDepthTestDistance=this.billboardGraphics.disableDepthTestDistance);var o=new e.Entity(r);return o.name=i.t?this._UUIDRoad:this._UUID,o.oid=t.oid,o.xyz=i.x+"_"+i.y+"_"+(i.z-1),o}},i.prototype.getPropertyValue=function(e,t,i,r){return void 0!==t[e]?t[e]:void 0!==i[e]?i[e]:r},i.prototype.collisionDetection=function(){if(this.debug)for(var t=document.getElementsByClassName("debug"),i=0;i<t.length;i++)this.viewer.container.removeChild(t[i]),i--;var r=[];for(i=0;i<this.viewer.entities.values.length;i++)if(this.viewer.entities.values[i].name&&(this.viewer.entities.values[i].name===this._UUID||this.viewer.entities.values[i].name===this._UUIDRoad)){var n=e.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,this.viewer.entities.values[i].position.getValue(0));this.viewer.entities.values[i].show=!!n;var s=this.getLabelReact({point:n,entity:this.viewer.entities.values[i]});this.viewer.entities.values[i].collisionBox=s;for(var a=null,l=0;l<r.length;l++)if(r[l].xyz===this.viewer.entities.values[i].xyz){a=r[l];break}if(a||(a={xyz:this.viewer.entities.values[i].xyz,entities:[]},r.push(a)),a.entities.push(this.viewer.entities.values[i]),this.debug){var u=document.createElement("div");u.setAttribute("class","debug"),u.style.cssText="position:absolute; top:"+s.y+"px; left:"+s.x+"px; width:"+s.width+"px; height:"+s.height+"px; border: solid 1px red; color: rgba(0,0,0,0);",u.innerHTML=this.viewer.entities.values[i].label.text.getValue(0),this.viewer.container.appendChild(u)}}for(var h=0;h<r.length;h++)for(i=0;i<r[h].entities.length;i++)if(r[h].entities[i].show)for(l=i+1;l<r[h].entities.length;l++)r[h].entities[l].show&&o(r[h].entities[i].collisionBox,r[h].entities[l].collisionBox)&&(r[h].entities[l].show=!1);var c=[];for(h=0;h<r.length;h++)for(i=0;i<r[h].entities.length;i++)r[h].entities[i].show&&c.push(r[h].entities[i]);for(i=0;i<c.length;i++)if(c[i].show)for(l=i+1;l<c.length;l++)c[l].show&&o(c[i].collisionBox,c[l].collisionBox)&&(c[l].show=!1)},i.prototype.bindEvent=function(){this.viewer.scene.camera.moveEnd.addEventListener(this._moveEnd,this),this.viewer.scene.camera.changed.addEventListener(this._changed,this)},i.prototype.unbindEvent=function(){this.viewer.scene.camera.moveEnd.removeEventListener(this._moveEnd,this),this.viewer.scene.camera.changed.removeEventListener(this._changed,this)},i.prototype.activate=function(){this._latelyGrid=[],this._moveEnd()},i.prototype.destroy=function(){for(var e=0;e<this.viewer.entities.values.length;e++)!this.viewer.entities.values[e].name||this.viewer.entities.values[e].name!==this._UUID&&this.viewer.entities.values[e].name!==this._UUIDRoad||(this.viewer.entities.remove(this.viewer.entities.values[e]),e--);this.viewer.camera.percentageChanged=.5,this.unbindEvent(),this.handler=this.handler&&this.handler.destroy(),this.proxy=void 0,this.viewer=void 0,this.url=void 0,this.labelGraphics=void 0,this.billboardGraphics=void 0,this.aotuCollide=void 0,this.collisionPadding=void 0,this.tileCache=void 0,this.labelCache=void 0,this._latelyGrid=void 0,this._latelyRefreshStamp=void 0,this._roadTileset=void 0},i.prototype.compareArray=function(e,t){for(var i=!1,r=0;r<e.length;r++){for(var o=!1,n=0;n<t.length;n++)if(e[r].x===t[n].x&&e[r].y===t[n].y&&e[r].level===t[n].level){o=!0;break}if(!o){i=!0;break}}return!i},i.prototype.getLabelReact=function(e){var t=p()(e.entity.label.font);t=t>0?t:15;for(var i=e.entity.label.text.getValue(0).split("\n"),r=0,o=i.length,s=0;s<i.length;s++){var a=n(i[s])/2;a>r&&(r=a)}var l=e.entity.billboard?e.entity.billboard.width.getValue(0)*e.entity.billboard.scale.getValue(0):1,u=e.entity.billboard?e.entity.billboard.height.getValue(0)*e.entity.billboard.scale.getValue(0):1;return{x:(e.point?e.point.x:-999)-l/2-this.collisionPadding[3],y:(e.point?e.point.y:-999)-u/2-this.collisionPadding[0],width:t*e.entity.label.scale.getValue(0)*r+e.entity.label.pixelOffset.getValue(0).x+l+this.collisionPadding[1],height:t*e.entity.label.scale.getValue(0)*(o+.5*(o-1))+e.entity.label.pixelOffset.getValue(0).y+u/2+this.collisionPadding[2]}},i.prototype.CutString=function(e){if(!e)return"";var t=e.byteLength;return t<=28?"":e.slice(19,t-9)},i.prototype.HexadecimalConversion=function(e){if(4278190080===e)return"#000000";var t=4278190080|p()(-Number(e));if(e="",(t=t.toString(16).substring(1)).length<6)for(var i=6-t.length,r=0;r<i;r++)e+="0";return"#"+e+t};var n=function(e){for(var t=0,i=0;i<e.length;i++)null!=e.charAt(i).match(/[^\x00-\xff]/gi)?t+=2:t+=1;return t},s=function(e){var t={stringTable:[],pois:[],enumGeometryType:[{ePoint:0},{eMultiLineString:1},{ePolygon:2}],enumZCoordType:[{eCloseGround:0},{eCloseSeaSurface:1},{eRelativelyGround:2},{eAbsolute:3}]},i=function(){if("undefined"==typeof dcodeIO||!dcodeIO.ProtoBuf)throw new Error("ProtoBuf.js is not present. Please see www/index.html for manual setup instructions.");return dcodeIO.ProtoBuf.loadProto("option optimize_for = LITE_RUNTIME;package GEOPOI;enum enumGeometryType {ePoint = 0;eMultiLineString = 1;ePolygon = 2;} ;message PBPOI{required uint64 OID = 1;required string Name =2;repeated double Coordinates =3 [packed=true];required enumGeometryType GeometryType = 4;optional int32 Interate = 5;optional int32 SymbolID = 10  [default = 0];optional double DisplayHeight = 11 [default = 32];optional uint32 ShiningColor=12 [default =0];optional uint32\tFontNameIndex=13 [default =0];optional int32\tFontSize=14 [default =18];optional uint32\tFontColor=15 [default =0];};message StringTable {repeated string s = 1;}message PBPOITile{required int64 Version = 1;required int64 TileKey = 2;required StringTable StringTable = 3;repeated PBPOI POIS = 4;};","GEOPOI","GeoPOI.proto").build("GEOPOI").PBPOITile}(),r=function(){if("undefined"==typeof dcodeIO||!dcodeIO.ProtoBuf)throw new Error("ProtoBuf.js is not present. Please see www/index.html for manual setup instructions.");return dcodeIO.ProtoBuf.loadProto("option optimize_for = LITE_RUNTIME;package GEOPOI;enum enumGeometryType {ePoint = 0;eMultiLineString = 1;ePolygon = 2;};enum enumZCoordType {eCloseGround = 0;eCloseSeaSurface = 1;eRelativelyGround = 2;eAbsolute = 3;};message PBPOI{required uint64 OID = 1;required string Name =2;repeated double Coordinates =3 [packed=true];required enumGeometryType GeometryType = 4;optional int32 Interate = 5;optional int32 SymbolID = 10  [default = 0];optional double DisplayHeight = 11 [default = 32];optional uint32 ShiningColor=12 [default =0];optional uint32\tFontNameIndex=13 [default =0];optional int32\tFontSize=14 [default =18];optional uint32\tFontColor=15 [default =0];optional enumZCoordType ZCoordType = 16 [default = eAbsolute];};message StringTable {repeated string s = 1;}message PBPOITile{required int64 Version = 1;required int64 TileKey = 2;required StringTable StringTable = 3;repeated PBPOI POIS = 4;};","GEOPOI","GeoPOI2.proto").build("GEOPOI").PBPOITile}();t.pois.length=0;var o,n=e;try{o=r.decode(n)}catch(e){console.log(e.message),o=i.decode(n)}t.version=p()(o.Version.toString()),t.titleKey=p()(o.TileKey.toString()),t.stringTable=[];for(var s=o.StringTable.s.length,a=0;a<s;a++)t.stringTable.push(o.StringTable.s[a].toString());return o.POIS.forEach((function(e){var i={};i.oid=p()(e.OID.toString()),i.name=e.Name.toString(),i.symbolID=p()(e.SymbolID.toString()),i.displayHeight=e.DisplayHeight,i.shiningColor=e.ShiningColor,i.fontNameIndex=e.FontNameIndex,i.fontSize=e.FontSize,i.fontColor=e.FontColor,e.ZCoordType&&(i.zCoordType=e.ZCoordType),i.geometryType=e.GeometryType,i.interate=e.Interate,i.coordinate=e.Coordinates,t.pois.push(i)})),t};e.GeoWTFS=i}(window.Cesium),function(e){var t=e.LayerManager=function(t){this.map=t,this.serviceLayerGroup=new e.ServiceLayerGroup(t),this.modelLayerGroup=new e.ModelLayerGroup(t),this.vectorLayerGroup=new e.VectorLayerGroup(t),this.terrainLayerGroup=new e.TerrainLayerGroup(t),this.basicLayerGroup=new e.BasicLayerGroup(t)};t.prototype.getMap=function(){return this.map},t.prototype.getServiceLayerGroup=function(){return this.serviceLayerGroup},t.prototype.getModelLayerGroup=function(){return this.modelLayerGroup},t.prototype.getVectorLayerGroup=function(){return this.vectorLayerGroup},t.prototype.getTerrainLayerGroup=function(){return this.terrainLayerGroup},t.prototype.getBasicLayerGroup=function(){return this.basicLayerGroup},t.prototype.remove=function(t){e.defined(t)?t.removeAll():(this.serviceLayerGroup.removeAll(),this.modelLayerGroup.removeAll(),this.vectorLayerGroup.removeAll(),this.terrainLayerGroup.removeAll(),this.basicLayerGroup.removeAll())}}(window.Cesium),function(e){var t=e.ServiceLayerGroup=function(){};t.prototype=new e.CompositeEntityCollection,t.prototype.addLayer=function(i,r){var o="";return t.add(r)&&(r.name=i,o=e.createGuid(),r.id=o),o},t.prototype.removeLayer=function(e){var i=t.getLayer(e);return t.remove(i)},t.prototype.queryLayerByName=function(e){for(var i=null,r=0;r<t.length;r++){var o=t.get(r);if(e==o.name){i=o;break}}return i},t.prototype.getLayer=function(e){for(var i=null,r=0;r<t.length;r++){var o=t.get(r);if(e==o.id){i=o;break}}return i},t.prototype.showLayer=function(e){t.getLayer(e).show=!0},t.prototype.hideLayer=function(e){t.getLayer(e).show=!1},t.prototype.addChildLayerGroup=function(e){}}(window.Cesium),function(e){var t=e.ModelLayerGroup=function(e){this.map=e};t.prototype=new e.PrimitiveCollection,t.prototype.addLayer=function(e,t){var i=this.map.scene.primitives.add(t),r="";return i&&(t.name=e,null!=$("#model-branch-container .layer-item-title").last()[0]&&(r=$("#model-branch-container .layer-item-title").last()[0].id),t.id=r),i},t.prototype.removeLayer=function(e){for(var t=0;t<this.map.scene.primitives.length;t++){var i=this.map.scene.primitives.get(t);if(e==i.id)break}return this.map.scene.primitives.remove(i)},t.prototype.queryLayerByName=function(e){for(var i=null,r=0;r<t.length;r++){var o=t.get(r);if(e==o.name){i=o;break}}return i},t.prototype.getLayer=function(e){var t=null;if(e)for(var i=1;i<this.map.scene.primitives.length;i++){var r=this.map.scene.primitives.get(i);if(e==r.id){t=r;break}}else t=this.map.scene.primitives._primitives;return t},t.prototype.showLayer=function(e){for(var t=null,i=0;i<this.map.scene.primitives.length;i++){var r=this.map.scene.primitives.get(i);if(e==r.id){t=r;break}}t&&(t.show=!0)},t.prototype.hideLayer=function(e){for(var t=null,i=0;i<this.map.scene.primitives.length;i++){var r=this.map.scene.primitives.get(i);if(e==r.id){t=r;break}}t&&(t.show=!1)}}(window.Cesium),function(e){var t=e.VectorLayerGroup=function(e){this.map=e};t.prototype=new e.DataSourceCollection,t.prototype.addLayer=function(t,i){return i&&(i.id||(i.id=e.createGuid())),this.map.dataSources.add(i),this.map.dataSources.get(this.map.dataSources.length-1).name=t,i.id},t.prototype.removeLayer=function(e){for(var t=null,i=0;i<this.map.dataSources.length;i++)if(e==this.map.dataSources.get(i).id){t=this.map.dataSources.get(i);break}try{this.map.dataSources.remove(t)}catch(e){return void console.log("DeveloperError")}},t.prototype.queryLayerByName=function(e){for(var t=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(e==r._name){t=r;break}}return t},t.prototype.getLayer=function(e){for(var t=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(e==r.id){t=r;break}}return t},t.prototype.showLayer=function(e){for(var t=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(e==r.id){t=r;break}}t&&(t.show=!0)},t.prototype.hideLayer=function(e){for(var t=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(e==r.id){t=r;break}}t&&(t.show=!1)}}(window.Cesium),function(e){var t=e.TerrainLayerCollection=function(e){this._layers=[],this.length=this._layers.length,this.map=e};t.prototype.addTerrainProvider=function(t){if(!defined(t))throw new e.DeveloperError("terrainProvider is required.");return this.map.terrainProvider=t,this._layers=[],this._layers.push(t),this.map.terrainProvider},t.prototype.remove=function(){var t=new e.CesiumTerrainProvider({url:""});return this.map.terrainProvider=t,this._layers=[],0==this.map.terrainProvider._url_size},t.prototype.get=function(t){if(!defined(terrainProvider))throw new e.DeveloperError("id is required.");if(t==this._layers[0].id)return this._layers[0]}}(window.Cesium),function(e){var t=e.TerrainLayerGroup=function(e){this.map=e};t.prototype.addLayer=function(t,i){if(i._credit)i.id=i._credit._text;else{var r=e.createGuid();i.id=r}return i.name=t,this.map.terrainProvider=i,i.id},t.prototype.removeLayer=function(t){if(t==this.map.terrainProvider.id){var i=new e.GeoTerrainProvider({proxy:new e.DefaultProxy("/proxyHandler?url="),dataType:e.GeoTerrainProvider.FLOAT,urls:[""]});this.map.terrainProvider=i}return!this.map.terrainProvider.id},t.prototype.getLayer=function(t){var i=null;return e.defined(t)?t==this.map.terrainProvider.id&&(i=this.map.terrainProvider):i=this.map.terrainProvider,i},t.prototype.showLayer=function(t){if(t==this.map.terrainProvider.options.credit){var i=new e.GeoTerrainProvider({proxy:new e.DefaultProxy("/proxyHandler?url="),dataType:e.GeoTerrainProvider.FLOAT,urls:this.map.terrainProvider.options._urls,credit:this.map.terrainProvider.options.credit,name:this.map.terrainProvider.options.name,maxExtent:this.map.terrainProvider.options.maxExtent,opacity:this.map.terrainProvider.options.opacity,topLevel:this.map.terrainProvider.options.topLevel,bottomLevel:this.map.terrainProvider.options.bottomLevel});i.id=t,i.name=this.map.terrainProvider.options.name,this.map.terrainProvider=i}},t.prototype.hideLayer=function(t){var i=null;if(t==this.map.terrainProvider.id){var r={_urls:(i=this.map.terrainProvider)._urls,credit:i._credit.text,name:i.name,maxExtent:i._maxExtent,opacity:i._opacity,topLevel:i._topLevel,bottomLevel:i._bottomLevel},o=new e.GeoTerrainProvider({proxy:new e.DefaultProxy("/proxyHandler?url="),dataType:e.GeoTerrainProvider.FLOAT,urls:[""]});this.map.terrainProvider=o,this.map.terrainProvider.options=r}}}(window.Cesium),function(e){var t=e.BasicLayerGroup=function(e){this.map=e};t.prototype=new e.ImageryLayerCollection,t.prototype.addLayer=function(e,t){var i=this.map.imageryLayers.addImageryProvider(t),r="";if(i){i.name=e;for(var o=0;o<$("#imagery-branch-container .layer-item-content div").length;o++)if(e==$("#imagery-branch-container .layer-item-content span")[o].innerText){r=$($("#imagery-branch-container .layer-item-content div")[o]).attr("id");break}i.id=r}return r},t.prototype.removeLayer=function(e){for(var t=null,i=0;i<this.map.imageryLayers.length;i++)if(e==this.map.imageryLayers._layers[i].id){t=this.map.imageryLayers._layers[i];break}try{this.map.imageryLayers.remove(t)}catch(e){return void console.log("DeveloperError")}},t.prototype.queryLayerByName=function(t){if(!e.defined(t))return!1;for(var i=null,r=0;r<this.map.imageryLayers.length;r++)if(t==this.map.imageryLayers._layers[r].name){i=this.map.imageryLayers._layers[r];break}return i},t.prototype.getLayer=function(e){var t=null;if(e){for(var i=0;i<this.map.imageryLayers.length;i++)if(e==this.map.imageryLayers._layers[i].id){t=this.map.imageryLayers._layers[i];break}}else t=this.map.imageryLayers._layers;return t},t.prototype.showLayer=function(e){for(var t=null,i=0;i<this.map.imageryLayers.length;i++)if(e==this.map.imageryLayers._layers[i].id){t=this.map.imageryLayers._layers[i];break}t.show=!0},t.prototype.hideLayer=function(e){for(var t=null,i=0;i<this.map.imageryLayers.length;i++)if(e==this.map.imageryLayers._layers[i].id){t=this.map.imageryLayers._layers[i];break}t.show=!1},t.prototype.moveLayer=function(e,t){for(var i=null,r=null,o=0;o<this.map.imageryLayers.length;o++)if(e==this.map.imageryLayers._layers[o].id){i=this.map.imageryLayers._layers[o];break}for(o=0;o<this.map.imageryLayers.length;o++)if(t==this.map.imageryLayers._layers[o].id){r=this.map.imageryLayers._layers[o];break}var n=this.map.imageryLayers.indexOf(i)-this.map.imageryLayers.indexOf(r);if(n>0)for(o=0;o<n;o++)try{this.map.imageryLayers.raise(i)}catch(e){return void console.log(e)}else console.log("layer located top")},t.prototype.raiseLayer=function(e){for(var t=null,i=0;i<this.map.imageryLayers.length;i++)if(e==this.map.imageryLayers._layers[i].id){t=this.map.imageryLayers._layers[i];break}try{this.map.imageryLayers.raise(t)}catch(e){return void console.log("DeveloperError")}},t.prototype.lowerLayer=function(e){for(var t=null,i=0;i<this.map.imageryLayers.length;i++)if(e==this.map.imageryLayers._layers[i].id){t=this.map.imageryLayers._layers[i];break}try{this.map.imageryLayers.lower(t)}catch(e){return void console.log("DeveloperError")}}}(window.Cesium),function(e){var t=e.Measure=function(e){this.viewer=e.viewer,this.primitives=this.viewer.scene.primitives};t.prototype.distance=function(t,i){if(t.polyline){var r=t.polyline.positions.getValue();if(!(r.length<=1)){for(var o,n=0,s=0,a=new e.EllipsoidGeodesic,l=1;l<r.length;l++){var u=e.Cartographic.fromCartesian(r[l-1]),h=e.Cartographic.fromCartesian(r[l]);a.setEndPoints(u,h),n+=Math.round(a.surfaceDistance);var c=e.Cartographic.fromCartesian(r[l-1]),g=e.Math.toDegrees(c.longitude),p=e.Math.toDegrees(c.latitude),f=e.Cartographic.fromCartesian(r[l]),d=e.Math.toDegrees(f.longitude),m=e.Math.toDegrees(f.latitude),C=turf.point([g,p]),y=turf.point([d,m]);s+=turf.distance(C,y)}return 2==i?o=n<1e3?n.toFixed(2)+"m":(n/1e3).toFixed(2)+"km":1==i&&(o=s<1?(1e3*s).toFixed(2)+"m":s.toFixed(2)+"km"),o}}},t.prototype.area=function(t){if(t.polygon){var i=t.polygon.hierarchy.getValue().positions;if(!(i.length<=2)){for(var r=[],o=0;o<i.length;o++){var n=e.Cartographic.fromCartesian(i[o]),s=e.Math.toDegrees(n.longitude),a=e.Math.toDegrees(n.latitude);r.push([s,a])}r.push(r[0]);var l=turf.polygon([r]),u=turf.area(l);return u<1e6?u.toFixed(2)+"m²":(u/1e6).toFixed(2)+"km²"}}},t.prototype.height=function(t){if(t.polyline){var i=t.polyline.positions.getValue();if(2==(i=[i[0],i[1]]).length){for(var r=[],o=0;o<i.length;o++){var n=e.Cartographic.fromCartesian(i[o]),s=e.Math.toDegrees(n.longitude),a=e.Math.toDegrees(n.latitude),l=n.height;r.push(s),r.push(a),r.push(l)}r[2]>=r[5]?(r.push(r[0]),r.push(r[1]),r.push(r[5])):(r.push(r[3]),r.push(r[4]),r.push(r[2]));var u={horizontalDistance:null,verticalHeight:null,spaceDistance:null},h=1e3*turf.distance(turf.point([r[0],r[1]]),turf.point([r[3],r[4]]));(g=[]).push((r[0]+r[3])/2),g.push((r[1]+r[4])/2),r[2]>=r[5]?g.push(r[5]):g.push(r[2]),u.horizontalDistance=h<1e3?"水平距离："+h.toFixed(2)+"m":"水平距离："+(h/1e3).toFixed(2)+"km";var c=Math.abs(r[2]-r[5]),g=[];r[2]>=r[5]?(g.push(r[0]),g.push(r[1])):(g.push(r[3]),g.push(r[4])),g.push((r[2]+r[5])/2),u.verticalHeight=c<1e3?"垂直高度："+c.toFixed(2)+"m":"垂直高度："+(c/1e3).toFixed(2)+"km";var p=Math.sqrt(Math.pow(h,2)+Math.pow(c,2));return(g=[]).push((r[0]+r[3])/2),g.push((r[1]+r[4])/2),g.push((r[2]+r[5])/2),u.spaceDistance=p<1e3?"空间距离："+p.toFixed(2)+"m":"空间距离："+(p/1e3).toFixed(2)+"km",u}}},t.prototype.elevation=function(t){if(t.point){var i=[t.position._value];1==i.length&&(e.Cartographic.fromCartesian(i[0]).height.toFixed(2),createResultLabel2(this.options,this.primitives,i))}}}(window.Cesium),function(e){var t=e.MVTProvider=function(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this._tilingScheme=e.defined(t.tilingScheme)?t.tilingScheme:new e.WebMercatorTilingScheme({ellipsoid:t.ellipsoid}),this._tileWidth=e.defaultValue(t.tileWidth,512),this._tileHeight=e.defaultValue(t.tileHeight,512),this._readyPromise=e.when.resolve(!0),this._ol=e.defaultValue(t.ol,ol),this._mvtParser=new this._ol.format.MVT,this._proxy=t.proxy,this._layer=t.layer,this._styleName=t.styleName,this._tileMatrixSetID=t.tileMatrixSetID,this._tileMatrixLabels=t.tileMatrixLabels,this._format="protobuf",this._minimumLevel=e.defaultValue(t.minimumLevel,0),this._maximumLevel=t.maximumLevel,this._key=e.defaultValue(t.key,""),this._url=e.defaultValue(t.url,"https://a.tiles.mapbox.com/v4/mapbox.mapbox-streets-v6/{z}/{x}/{y}.vector.pbf?access_token={k}");var i=this._tilingScheme._rectangleSouthwestInMeters,r=(this._tilingScheme._rectangleNortheastInMeters,null);i||this._tilingScheme.rectangle,this._tilingScheme instanceof e.WebMercatorTilingScheme?r=[-20037508.342789244,-20037508.342789244,20037508.342789244,20037508.342789244]:this._tilingScheme instanceof e.GeographicTilingScheme&&(r=[-180,-270,180,90]),this._resolutions=ol.tilegrid.resolutionsFromExtent(r,22,this._tileWidth),this._pixelRatio=1,this._transform=[.125,0,0,.125,0,0],this._replays=["Default","Image","Polygon","LineString","Text"],this._tileQueue=new e.TileReplacementQueue,this._cacheSize=1e3,this.styleFunc=function(){return[]};var o=this,n=this.getStyleUrl();n=this._proxy.getURL(n),(Number(e.VERSION)<1.42?e.loadJson(n):e.Resource.fetchJson(n)).then((function(e){for(var i="mysourceid",r=0;r<e.layers.length;r++)e.layers[r].source=i;e.sources=e.sources||{},e.sources[i]={type:"vector",url:t.url},e.sprite&&(e.sprite=Cfg.proxyHostUrl+e.sprite),e.glyphs&&(e.glyphs=Cfg.proxyHostUrl+e.glyphs),olms.applyStyle(null,e,i,null,o._resolutions).then((function(e){o.styleFunc=e}))}))};e.defineProperties(t.prototype,{url:{get:function(){return this._url}},proxy:{get:function(){return this._proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return this._minimumLevel}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return!0}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){}},hasAlphaChannel:{get:function(){return!0}}}),t.prototype.getTileCredits=function(e,t,i){},t.prototype.requestImage=function(t,i,r,o){var n=this._tileMatrixLabels,s=e.defined(n)?n[r]:r.toString(),a=function(e,t,i,r){for(var o=r.head;null!=o&&(o.xMvt!=e||o.yMvt!=t||o.zMvt!=i);)o=o.replacementNext;return o}(t,i,s,this._tileQueue);if(null!=a)return a;var l=this,u=this.getUrlTmpl();u=u.replace("{x}",t).replace("{y}",i).replace("{z}",s).replace("{k}",this._key),u=this._proxy.getURL(u);var h=e.when.defer();return(Number(e.VERSION)<1.42?e.loadArrayBuffer(u):e.Resource.fetchArrayBuffer(u)).then((function(r){var o=document.createElement("canvas");o.width=512,o.height=512;for(var n=o.getContext("2d"),a=l._mvtParser.readFeatures(r),u=l.styleFunc,c=new ol.render.canvas.ReplayGroup(0,[0,0,4096,4096],8,!0,100),g=0;g<a.length;g++)for(var p=a[g],f=u(a[g],l._resolutions[s])||[],d=0;d<f.length;d++)ol.renderer.vector.renderFeature_(c,p,f[d],16);return c.finish(),c.replay(n,l._pixelRatio,l._transform,0,{},l._replays,!0),l._tileQueue.count>l._cacheSize&&function(t,i){for(var r,o,n,s,a=t.tail;t.count>i&&e.defined(a);){var l=a.replacementPrevious;r=t,n=void 0,s=void 0,n=(o=a).replacementPrevious,s=o.replacementNext,o===r._lastBeforeStartOfFrame&&(r._lastBeforeStartOfFrame=s),o===r.head?r.head=s:n.replacementNext=s,o===r.tail?r.tail=n:s.replacementPrevious=n,o.replacementPrevious=void 0,o.replacementNext=void 0,--r.count,a=null,a=l}}(l._tileQueue,l._cacheSize/4),o.xMvt=t,o.yMvt=i,o.zMvt=s,l._tileQueue.markTileRendered(o),c=null,h.resolve(o),o})).otherwise((function(e){console.error(e)})),h.promise},t.prototype.pickFeatures=function(e,t,i,r,o){},t.prototype.getUrlTmpl=function(){var t={LAYER:this._layer,TILEMATRIXSET:this._tileMatrixSetID,FORMAT:this._format,TILEMATRIX:"{z}",TILEROW:"{y}",TILECOL:"{x}"},i=this.getParameterString(e.combine({SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetTile"},t));return this._url+"?"+i},t.prototype.getStyleUrl=function(){var t={STYLENAME:this._styleName},i=this.getParameterString(e.combine({SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetStyle"},t));return this._url+"?"+i},t.prototype.getParameterString=function(e){var t=[];for(var i in e){var r=e[i];if(null!=r&&"function"!=typeof r){var o;if("object"==C()(r)&&r.constructor==Array){for(var n,s=[],a=0,l=r.length;a<l;a++)n=r[a],s.push(null==n?"":n);o=s.join(",")}else o=r;t.push(i+"="+o)}}return t.join("&")}}(window.Cesium),function(){function e(e){throw e}var t=void 0,i=!0,r=this;function o(e,i){var o,n=e.split("."),s=r;!(n[0]in s)&&s.execScript&&s.execScript("var "+n[0]);for(;n.length&&(o=n.shift());)n.length||i===t?s=s[o]?s[o]:s[o]={}:s[o]=i}var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function a(t,i){this.index="number"==typeof i?i:0,this.i=0,this.buffer=t instanceof(s?Uint8Array:Array)?t:new(s?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&e(Error("invalid index")),this.buffer.length<=this.index&&this.f()}a.prototype.f=function(){var e,t=this.buffer,i=t.length,r=new(s?Uint8Array:Array)(i<<1);if(s)r.set(t);else for(e=0;e<i;++e)r[e]=t[e];return this.buffer=r},a.prototype.d=function(e,t,i){var r,o=this.buffer,n=this.index,s=this.i,a=o[n];if(i&&1<t&&(e=8<t?(p[255&e]<<24|p[e>>>8&255]<<16|p[e>>>16&255]<<8|p[e>>>24&255])>>32-t:p[e]>>8-t),8>t+s)a=a<<t|e,s+=t;else for(r=0;r<t;++r)a=a<<1|e>>t-r-1&1,8==++s&&(s=0,o[n++]=p[a],a=0,n===o.length&&(o=this.f()));o[n]=a,this.buffer=o,this.i=s,this.index=n},a.prototype.finish=function(){var e,t=this.buffer,i=this.index;return 0<this.i&&(t[i]<<=8-this.i,t[i]=p[t[i]],i++),s?e=t.subarray(0,i):(t.length=i,e=t),e};var l,u=new(s?Uint8Array:Array)(256);for(l=0;256>l;++l){for(var h=g=l,c=7,g=g>>>1;g;g>>>=1)h<<=1,h|=1&g,--c;u[l]=(h<<c&255)>>>0}var p=u;function f(e){this.buffer=new(s?Uint16Array:Array)(2*e),this.length=0}function d(e){var t,i,r,o,n,a,l,u,h,c,g=e.length,p=0,f=Number.POSITIVE_INFINITY;for(u=0;u<g;++u)e[u]>p&&(p=e[u]),e[u]<f&&(f=e[u]);for(t=1<<p,i=new(s?Uint32Array:Array)(t),r=1,o=0,n=2;r<=p;){for(u=0;u<g;++u)if(e[u]===r){for(a=0,l=o,h=0;h<r;++h)a=a<<1|1&l,l>>=1;for(c=r<<16|u,h=a;h<t;h+=n)i[h]=c;++o}++r,o<<=1,n<<=1}return[i,p,f]}function m(e,t){this.h=y,this.w=0,this.input=s&&e instanceof Array?new Uint8Array(e):e,this.b=0,t&&(t.lazy&&(this.w=t.lazy),"number"==typeof t.compressionType&&(this.h=t.compressionType),t.outputBuffer&&(this.a=s&&t.outputBuffer instanceof Array?new Uint8Array(t.outputBuffer):t.outputBuffer),"number"==typeof t.outputIndex&&(this.b=t.outputIndex)),this.a||(this.a=new(s?Uint8Array:Array)(32768))}f.prototype.getParent=function(e){return 2*((e-2)/4|0)},f.prototype.push=function(e,t){var i,r,o,n=this.buffer;for(i=this.length,n[this.length++]=t,n[this.length++]=e;0<i&&(r=this.getParent(i),n[i]>n[r]);)o=n[i],n[i]=n[r],n[r]=o,o=n[i+1],n[i+1]=n[r+1],n[r+1]=o,i=r;return this.length},f.prototype.pop=function(){var e,t,i,r,o,n=this.buffer;for(t=n[0],e=n[1],this.length-=2,n[0]=n[this.length],n[1]=n[this.length+1],o=0;!((r=2*o+2)>=this.length)&&(r+2<this.length&&n[r+2]>n[r]&&(r+=2),n[r]>n[o]);)i=n[o],n[o]=n[r],n[r]=i,i=n[o+1],n[o+1]=n[r+1],n[r+1]=i,o=r;return{index:e,value:t,length:this.length}};var C,y=2,v={NONE:0,r:1,k:y,O:3},A=[];for(C=0;288>C;C++)switch(!0){case 143>=C:A.push([C+48,8]);break;case 255>=C:A.push([C-144+400,9]);break;case 279>=C:A.push([C-256+0,7]);break;case 287>=C:A.push([C-280+192,8]);break;default:e("invalid literal: "+C)}m.prototype.j=function(){var r,o,n,l,u=this.input;switch(this.h){case 0:for(n=0,l=u.length;n<l;){var h,c,g,p=o=s?u.subarray(n,n+65535):u.slice(n,n+65535),f=(n+=o.length)===l,d=t,m=t,C=this.a,v=this.b;if(s){for(C=new Uint8Array(this.a.buffer);C.length<=v+p.length+5;)C=new Uint8Array(C.length<<1);C.set(this.a)}if(h=f?1:0,C[v++]=0|h,g=65536+~(c=p.length)&65535,C[v++]=255&c,C[v++]=c>>>8&255,C[v++]=255&g,C[v++]=g>>>8&255,s)C.set(p,v),v+=p.length,C=C.subarray(0,v);else{for(d=0,m=p.length;d<m;++d)C[v++]=p[d];C.length=v}this.b=v,this.a=C}break;case 1:var _=new a(s?new Uint8Array(this.a.buffer):this.a,this.b);_.d(1,1,i),_.d(1,2,i);var I,w,S,P=b(this,u);for(I=0,w=P.length;I<w;I++)if(S=P[I],a.prototype.d.apply(_,A[S]),256<S)_.d(P[++I],P[++I],i),_.d(P[++I],5),_.d(P[++I],P[++I],i);else if(256===S)break;this.a=_.finish(),this.b=this.a.length;break;case y:var T,x,N,L,M,R,O,F,D,k,U,B,W,V,j,H=new a(s?new Uint8Array(this.a.buffer):this.a,this.b),z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=Array(19);for(T=y,H.d(1,1,i),H.d(T,2,i),x=b(this,u),O=E(R=G(this.M,15)),D=E(F=G(this.L,7)),N=286;257<N&&0===R[N-1];N--);for(L=30;1<L&&0===F[L-1];L--);var X,Y,K,Q,Z,J,$=N,ee=L,te=new(s?Uint32Array:Array)($+ee),ie=new(s?Uint32Array:Array)(316),re=new(s?Uint8Array:Array)(19);for(X=Y=0;X<$;X++)te[Y++]=R[X];for(X=0;X<ee;X++)te[Y++]=F[X];if(!s)for(X=0,Q=re.length;X<Q;++X)re[X]=0;for(X=Z=0,Q=te.length;X<Q;X+=Y){for(Y=1;X+Y<Q&&te[X+Y]===te[X];++Y);if(K=Y,0===te[X])if(3>K)for(;0<K--;)ie[Z++]=0,re[0]++;else for(;0<K;)(J=138>K?K:138)>K-3&&J<K&&(J=K-3),10>=J?(ie[Z++]=17,ie[Z++]=J-3,re[17]++):(ie[Z++]=18,ie[Z++]=J-11,re[18]++),K-=J;else if(ie[Z++]=te[X],re[te[X]]++,3>--K)for(;0<K--;)ie[Z++]=te[X],re[te[X]]++;else for(;0<K;)(J=6>K?K:6)>K-3&&J<K&&(J=K-3),ie[Z++]=16,ie[Z++]=J-3,re[16]++,K-=J}for(r=s?ie.subarray(0,Z):ie.slice(0,Z),k=G(re,7),V=0;19>V;V++)q[V]=k[z[V]];for(M=19;4<M&&0===q[M-1];M--);for(U=E(k),H.d(N-257,5,i),H.d(L-1,5,i),H.d(M-4,4,i),V=0;V<M;V++)H.d(q[V],3,i);for(V=0,j=r.length;V<j;V++)if(B=r[V],H.d(U[B],k[B],i),16<=B){switch(V++,B){case 16:W=2;break;case 17:W=3;break;case 18:W=7;break;default:e("invalid code: "+B)}H.d(r[V],W,i)}var oe,ne,se,ae,le,ue,he,ce,ge=[O,R],pe=[D,F];for(le=ge[0],ue=ge[1],he=pe[0],ce=pe[1],oe=0,ne=x.length;oe<ne;++oe)if(se=x[oe],H.d(le[se],ue[se],i),256<se)H.d(x[++oe],x[++oe],i),ae=x[++oe],H.d(he[ae],ce[ae],i),H.d(x[++oe],x[++oe],i);else if(256===se)break;this.a=H.finish(),this.b=this.a.length;break;default:e("invalid compression type")}return this.a};var _=function(){function t(t){switch(!0){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:e("invalid length: "+t)}}var i,r,o=[];for(i=3;258>=i;i++)r=t(i),o[i]=r[2]<<24|r[1]<<16|r[0];return o}(),I=s?new Uint32Array(_):_;function b(r,o){function n(t,r){var o,n,s,a,l=t.H,u=[],h=0;switch(o=I[t.length],u[h++]=65535&o,u[h++]=o>>16&255,u[h++]=o>>24,i){case 1===l:n=[0,l-1,0];break;case 2===l:n=[1,l-2,0];break;case 3===l:n=[2,l-3,0];break;case 4===l:n=[3,l-4,0];break;case 6>=l:n=[4,l-5,1];break;case 8>=l:n=[5,l-7,1];break;case 12>=l:n=[6,l-9,2];break;case 16>=l:n=[7,l-13,2];break;case 24>=l:n=[8,l-17,3];break;case 32>=l:n=[9,l-25,3];break;case 48>=l:n=[10,l-33,4];break;case 64>=l:n=[11,l-49,4];break;case 96>=l:n=[12,l-65,5];break;case 128>=l:n=[13,l-97,5];break;case 192>=l:n=[14,l-129,6];break;case 256>=l:n=[15,l-193,6];break;case 384>=l:n=[16,l-257,7];break;case 512>=l:n=[17,l-385,7];break;case 768>=l:n=[18,l-513,8];break;case 1024>=l:n=[19,l-769,8];break;case 1536>=l:n=[20,l-1025,9];break;case 2048>=l:n=[21,l-1537,9];break;case 3072>=l:n=[22,l-2049,10];break;case 4096>=l:n=[23,l-3073,10];break;case 6144>=l:n=[24,l-4097,11];break;case 8192>=l:n=[25,l-6145,11];break;case 12288>=l:n=[26,l-8193,12];break;case 16384>=l:n=[27,l-12289,12];break;case 24576>=l:n=[28,l-16385,13];break;case 32768>=l:n=[29,l-24577,13];break;default:e("invalid distance")}for(o=n,u[h++]=o[0],u[h++]=o[1],u[h++]=o[2],s=0,a=u.length;s<a;++s)C[y++]=u[s];A[u[0]]++,_[u[3]]++,v=t.length+r-1,f=null}var a,l,u,h,c,g,p,f,d,m={},C=s?new Uint16Array(2*o.length):[],y=0,v=0,A=new(s?Uint32Array:Array)(286),_=new(s?Uint32Array:Array)(30),b=r.w;if(!s){for(u=0;285>=u;)A[u++]=0;for(u=0;29>=u;)_[u++]=0}for(A[256]=1,a=0,l=o.length;a<l;++a){for(u=c=0,h=3;u<h&&a+u!==l;++u)c=c<<8|o[a+u];if(m[c]===t&&(m[c]=[]),g=m[c],!(0<v--)){for(;0<g.length&&32768<a-g[0];)g.shift();if(a+3>=l){for(f&&n(f,-1),u=0,h=l-a;u<h;++u)d=o[a+u],C[y++]=d,++A[d];break}0<g.length?(p=w(o,a,g),f?f.length<p.length?(d=o[a-1],C[y++]=d,++A[d],n(p,0)):n(f,-1):p.length<b?f=p:n(p,0)):f?n(f,-1):(d=o[a],C[y++]=d,++A[d])}g.push(a)}return C[y++]=256,A[256]++,r.M=A,r.L=_,s?C.subarray(0,y):C}function w(e,t,i){var r,o,n,s,a,l,u=0,h=e.length;s=0,l=i.length;e:for(;s<l;s++){if(r=i[l-s-1],n=3,3<u){for(a=u;3<a;a--)if(e[r+a-1]!==e[t+a-1])continue e;n=u}for(;258>n&&t+n<h&&e[r+n]===e[t+n];)++n;if(n>u&&(o=r,u=n),258===n)break}return new function(e,t){this.length=e,this.H=t}(u,t-o)}function G(e,t){var i,r,o,n,a,l=e.length,u=new f(572),h=new(s?Uint8Array:Array)(l);if(!s)for(n=0;n<l;n++)h[n]=0;for(n=0;n<l;++n)0<e[n]&&u.push(n,e[n]);if(i=Array(u.length/2),r=new(s?Uint32Array:Array)(u.length/2),1===i.length)return h[u.pop().index]=1,h;for(n=0,a=u.length/2;n<a;++n)i[n]=u.pop(),r[n]=i[n].value;for(o=function(e,t,i){function r(e){var i=f[e][d[e]];i===t?(r(e+1),r(e+1)):--g[i],++d[e]}var o,n,a,l,u,h=new(s?Uint16Array:Array)(i),c=new(s?Uint8Array:Array)(i),g=new(s?Uint8Array:Array)(t),p=Array(i),f=Array(i),d=Array(i),m=(1<<i)-t,C=1<<i-1;for(h[i-1]=t,n=0;n<i;++n)m<C?c[n]=0:(c[n]=1,m-=C),m<<=1,h[i-2-n]=(h[i-1-n]/2|0)+t;for(h[0]=c[0],p[0]=Array(h[0]),f[0]=Array(h[0]),n=1;n<i;++n)h[n]>2*h[n-1]+c[n]&&(h[n]=2*h[n-1]+c[n]),p[n]=Array(h[n]),f[n]=Array(h[n]);for(o=0;o<t;++o)g[o]=i;for(a=0;a<h[i-1];++a)p[i-1][a]=e[a],f[i-1][a]=a;for(o=0;o<i;++o)d[o]=0;for(1===c[i-1]&&(--g[0],++d[i-1]),n=i-2;0<=n;--n){for(l=o=0,u=d[n+1],a=0;a<h[n];a++)(l=p[n+1][u]+p[n+1][u+1])>e[o]?(p[n][a]=l,f[n][a]=t,u+=2):(p[n][a]=e[o],f[n][a]=o,++o);d[n]=0,1===c[n]&&r(n)}return g}(r,r.length,t),n=0,a=i.length;n<a;++n)h[i[n].index]=o[n];return h}function E(e){var t,i,r,o,n=new(s?Uint16Array:Array)(e.length),a=[],l=[],u=0;for(t=0,i=e.length;t<i;t++)a[e[t]]=1+(0|a[e[t]]);for(t=1,i=16;t<=i;t++)l[t]=u,u+=0|a[t],u<<=1;for(t=0,i=e.length;t<i;t++)for(u=l[e[t]],l[e[t]]+=1,r=n[t]=0,o=e[t];r<o;r++)n[t]=n[t]<<1|1&u,u>>>=1;return n}function S(t,i){switch(this.l=[],this.m=32768,this.e=this.g=this.c=this.q=0,this.input=s?new Uint8Array(t):t,this.s=!1,this.n=T,this.C=!1,!i&&(i={})||(i.index&&(this.c=i.index),i.bufferSize&&(this.m=i.bufferSize),i.bufferType&&(this.n=i.bufferType),i.resize&&(this.C=i.resize)),this.n){case P:this.b=32768,this.a=new(s?Uint8Array:Array)(32768+this.m+258);break;case T:this.b=0,this.a=new(s?Uint8Array:Array)(this.m),this.f=this.K,this.t=this.I,this.o=this.J;break;default:e(Error("invalid inflate mode"))}}var P=0,T=1,x={F:P,D:T};S.prototype.p=function(){for(;!this.s;){var r=K(this,3);switch(1&r&&(this.s=i),r>>>=1){case 0:var o=this.input,n=this.c,a=this.a,l=this.b,u=o.length,h=t,c=a.length,g=t;switch(this.e=this.g=0,n+1>=u&&e(Error("invalid uncompressed block header: LEN")),h=o[n++]|o[n++]<<8,n+1>=u&&e(Error("invalid uncompressed block header: NLEN")),h===~(o[n++]|o[n++]<<8)&&e(Error("invalid uncompressed block header: length verify")),n+h>o.length&&e(Error("input buffer is broken")),this.n){case P:for(;l+h>a.length;){if(h-=g=c-l,s)a.set(o.subarray(n,n+g),l),l+=g,n+=g;else for(;g--;)a[l++]=o[n++];this.b=l,a=this.f(),l=this.b}break;case T:for(;l+h>a.length;)a=this.f({v:2});break;default:e(Error("invalid inflate mode"))}if(s)a.set(o.subarray(n,n+h),l),l+=h,n+=h;else for(;h--;)a[l++]=o[n++];this.c=n,this.b=l,this.a=a;break;case 1:this.o(q,Y);break;case 2:Z(this);break;default:e(Error("unknown BTYPE: "+r))}}return this.t()};var N,L,M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],R=s?new Uint16Array(M):M,O=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],F=s?new Uint16Array(O):O,D=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],k=s?new Uint8Array(D):D,U=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],B=s?new Uint16Array(U):U,W=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],V=s?new Uint8Array(W):W,j=new(s?Uint8Array:Array)(288);for(N=0,L=j.length;N<L;++N)j[N]=143>=N?8:255>=N?9:279>=N?7:8;var H,z,q=d(j),X=new(s?Uint8Array:Array)(30);for(H=0,z=X.length;H<z;++H)X[H]=5;var Y=d(X);function K(t,i){for(var r,o=t.g,n=t.e,s=t.input,a=t.c,l=s.length;n<i;)a>=l&&e(Error("input buffer is broken")),o|=s[a++]<<n,n+=8;return r=o&(1<<i)-1,t.g=o>>>i,t.e=n-i,t.c=a,r}function Q(e,t){for(var i,r,o=e.g,n=e.e,s=e.input,a=e.c,l=s.length,u=t[0],h=t[1];n<h&&!(a>=l);)o|=s[a++]<<n,n+=8;return r=(i=u[o&(1<<h)-1])>>>16,e.g=o>>r,e.e=n-r,e.c=a,65535&i}function Z(e){function t(e,t,i){var r,o,n,s=this.z;for(n=0;n<e;)switch(r=Q(this,t)){case 16:for(o=3+K(this,2);o--;)i[n++]=s;break;case 17:for(o=3+K(this,3);o--;)i[n++]=0;s=0;break;case 18:for(o=11+K(this,7);o--;)i[n++]=0;s=0;break;default:s=i[n++]=r}return this.z=s,i}var i,r,o,n,a=K(e,5)+257,l=K(e,5)+1,u=K(e,4)+4,h=new(s?Uint8Array:Array)(R.length);for(n=0;n<u;++n)h[R[n]]=K(e,3);if(!s)for(n=u,u=h.length;n<u;++n)h[R[n]]=0;i=d(h),r=new(s?Uint8Array:Array)(a),o=new(s?Uint8Array:Array)(l),e.z=0,e.o(d(t.call(e,a,i,r)),d(t.call(e,l,i,o)))}function J(e){if("string"==typeof e){var t,i,r=e.split("");for(t=0,i=r.length;t<i;t++)r[t]=(255&r[t].charCodeAt(0))>>>0;e=r}for(var o,n=1,s=0,a=e.length,l=0;0<a;){a-=o=1024<a?1024:a;do{s+=n+=e[l++]}while(--o);n%=65521,s%=65521}return(s<<16|n)>>>0}function $(t,i){var r,o;switch(this.input=t,this.c=0,!i&&(i={})||(i.index&&(this.c=i.index),i.verify&&(this.N=i.verify)),r=t[this.c++],o=t[this.c++],15&r){case ee:this.method=ee;break;default:e(Error("unsupported compression method"))}0!=((r<<8)+o)%31&&e(Error("invalid fcheck flag:"+((r<<8)+o)%31)),32&o&&e(Error("fdict flag is not supported")),this.B=new S(t,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}S.prototype.o=function(e,t){var i=this.a,r=this.b;this.u=e;for(var o,n,s,a,l=i.length-258;256!==(o=Q(this,e));)if(256>o)r>=l&&(this.b=r,i=this.f(),r=this.b),i[r++]=o;else for(a=F[n=o-257],0<k[n]&&(a+=K(this,k[n])),o=Q(this,t),s=B[o],0<V[o]&&(s+=K(this,V[o])),r>=l&&(this.b=r,i=this.f(),r=this.b);a--;)i[r]=i[r++-s];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},S.prototype.J=function(e,t){var i=this.a,r=this.b;this.u=e;for(var o,n,s,a,l=i.length;256!==(o=Q(this,e));)if(256>o)r>=l&&(l=(i=this.f()).length),i[r++]=o;else for(a=F[n=o-257],0<k[n]&&(a+=K(this,k[n])),o=Q(this,t),s=B[o],0<V[o]&&(s+=K(this,V[o])),r+a>l&&(l=(i=this.f()).length);a--;)i[r]=i[r++-s];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},S.prototype.f=function(){var e,t,i=new(s?Uint8Array:Array)(this.b-32768),r=this.b-32768,o=this.a;if(s)i.set(o.subarray(32768,i.length));else for(e=0,t=i.length;e<t;++e)i[e]=o[e+32768];if(this.l.push(i),this.q+=i.length,s)o.set(o.subarray(r,r+32768));else for(e=0;32768>e;++e)o[e]=o[r+e];return this.b=32768,o},S.prototype.K=function(e){var t,i,r,o=this.input.length/this.c+1|0,n=this.input,a=this.a;return e&&("number"==typeof e.v&&(o=e.v),"number"==typeof e.G&&(o+=e.G)),i=2>o?(r=(n.length-this.c)/this.u[2]/2*258|0)<a.length?a.length+r:a.length<<1:a.length*o,s?(t=new Uint8Array(i)).set(a):t=a,this.a=t},S.prototype.t=function(){var e,t,i,r,o,n=0,a=this.a,l=this.l,u=new(s?Uint8Array:Array)(this.q+(this.b-32768));if(0===l.length)return s?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(t=0,i=l.length;t<i;++t)for(r=0,o=(e=l[t]).length;r<o;++r)u[n++]=e[r];for(t=32768,i=this.b;t<i;++t)u[n++]=a[t];return this.l=[],this.buffer=u},S.prototype.I=function(){var e,t=this.b;return s?this.C?(e=new Uint8Array(t)).set(this.a.subarray(0,t)):e=this.a.subarray(0,t):(this.a.length>t&&(this.a.length=t),e=this.a),this.buffer=e},$.prototype.p=function(){var t,i=this.input;return t=this.B.p(),this.c=this.B.c,this.N&&(i[this.c++]<<24|i[this.c++]<<16|i[this.c++]<<8|i[this.c++])>>>0!==J(t)&&e(Error("invalid adler-32 checksum")),t};var ee=8;function te(e,t){this.input=e,this.a=new(s?Uint8Array:Array)(32768),this.h=ie.k;var i,r={};for(i in!t&&(t={})||"number"!=typeof t.compressionType||(this.h=t.compressionType),t)r[i]=t[i];r.outputBuffer=this.a,this.A=new m(this.input,r)}var ie=v;function re(e,t){var i,r,s,a;if(n.a)i=n()(t);else for(r in i=[],s=0,t)i[s++]=r;for(s=0,a=i.length;s<a;++s)o(e+"."+(r=i[s]),t[r])}te.prototype.j=function(){var t,i,r,o,n,a,l,u=0;switch(l=this.a,t=ee){case ee:i=Math.LOG2E*Math.log(32768)-8;break;default:e(Error("invalid compression method"))}switch(r=i<<4|t,l[u++]=r,t){case ee:switch(this.h){case ie.NONE:n=0;break;case ie.r:n=1;break;case ie.k:n=2;break;default:e(Error("unsupported compression type"))}break;default:e(Error("invalid compression method"))}return o=n<<6|0,l[u++]=o|31-(256*r+o)%31,a=J(this.input),this.A.b=u,u=(l=this.A.j()).length,s&&((l=new Uint8Array(l.buffer)).length<=u+4&&(this.a=new Uint8Array(l.length+4),this.a.set(l),l=this.a),l=l.subarray(0,u+4)),l[u++]=a>>24&255,l[u++]=a>>16&255,l[u++]=a>>8&255,l[u++]=255&a,l},o("Zlib.Inflate",$),o("Zlib.Inflate.prototype.decompress",$.prototype.p),re("Zlib.Inflate.BufferType",{ADAPTIVE:x.D,BLOCK:x.F}),o("Zlib.Deflate",te),o("Zlib.Deflate.compress",(function(e,t){return new te(e,t).j()})),o("Zlib.Deflate.prototype.compress",te.prototype.j),re("Zlib.Deflate.CompressionType",{NONE:ie.NONE,FIXED:ie.r,DYNAMIC:ie.k})}.call(void 0);r(227)}])}));